<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Task 모듈 아키텍처</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/db8/md_docs_2task_2ARCHITECTURE__KO.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Task 모듈 아키텍처</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1626"></a> 이 문서는 Task 모듈의 아키텍처와 설계를 설명합니다.</p>
<h1><a class="anchor" id="autotoc_md1627"></a>
개요</h1>
<p>Task 모듈은 비동기 작업 실행을 위한 분산 작업 큐 시스템을 제공합니다. 신뢰성, 확장성, 사용 편의성을 위해 설계되었습니다.</p>
<h1><a class="anchor" id="autotoc_md1628"></a>
시스템 아키텍처</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                          task_system (파사드)                        │</div>
<div class="line">├─────────────────────────────────────────────────────────────────────┤</div>
<div class="line">│                                                                      │</div>
<div class="line">│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────────┐  │</div>
<div class="line">│  │ task_client │    │ task_queue  │    │      worker_pool        │  │</div>
<div class="line">│  │             │───▶│             │───▶│                         │  │</div>
<div class="line">│  │ 제출 API    │    │ 작업 저장소 │    │ ┌─────────────────────┐ │  │</div>
<div class="line">│  └─────────────┘    └─────────────┘    │ │   task_handler(s)   │ │  │</div>
<div class="line">│         │                   ▲          │ └─────────────────────┘ │  │</div>
<div class="line">│         │                   │          │           │             │  │</div>
<div class="line">│         ▼                   │          │           ▼             │  │</div>
<div class="line">│  ┌─────────────┐            │          │ ┌─────────────────────┐ │  │</div>
<div class="line">│  │async_result │            │          │ │   task_context      │ │  │</div>
<div class="line">│  └─────────────┘            │          │ └─────────────────────┘ │  │</div>
<div class="line">│         │                   │          └─────────────────────────┘  │</div>
<div class="line">│         │                   │                      │                │</div>
<div class="line">│         ▼                   │                      ▼                │</div>
<div class="line">│  ┌─────────────────────────────────────────────────────────────┐   │</div>
<div class="line">│  │                     result_backend                           │   │</div>
<div class="line">│  │                (memory_result_backend)                       │   │</div>
<div class="line">│  └─────────────────────────────────────────────────────────────┘   │</div>
<div class="line">│                                                                      │</div>
<div class="line">│  ┌──────────────────┐              ┌──────────────────┐            │</div>
<div class="line">│  │  task_scheduler  │              │   task_monitor   │            │</div>
<div class="line">│  │                  │              │                  │            │</div>
<div class="line">│  │ 주기적/Cron      │              │ 통계 및 이벤트   │            │</div>
<div class="line">│  └──────────────────┘              └──────────────────┘            │</div>
<div class="line">│                                                                      │</div>
<div class="line">└─────────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1629"></a>
핵심 컴포넌트</h1>
<h2><a class="anchor" id="autotoc_md1630"></a>
1. task_system (파사드)</h2>
<p><code>task_system</code>은 모든 컴포넌트를 통합하는 메인 진입점입니다. 제공 기능:</p>
<ul>
<li>통합 라이프사이클 관리 (시작/중지)</li>
<li>일반적인 작업을 위한 편의 메서드</li>
<li>필요 시 개별 컴포넌트 접근</li>
</ul>
<div class="fragment"><div class="line">task_system system(config);</div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;task.name&quot;</span>, handler);</div>
<div class="line">system.start();</div>
<div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;task.name&quot;</span>, payload);</div>
<div class="line">system.stop();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1631"></a>
2. task</h2>
<p><code>task</code> 클래스는 작업 단위를 나타냅니다. 메시징 인프라의 <code>message</code> 클래스를 확장합니다.</p>
<p><b>주요 속성:</b></p><ul>
<li><code>task_id</code>: 고유 식별자 (UUID)</li>
<li><code>task_name</code>: 실행할 핸들러 이름</li>
<li><code>payload</code>: 입력 데이터 (value_container)</li>
<li><code>config</code>: 실행 설정</li>
<li><code>state</code>: 현재 라이프사이클 상태</li>
</ul>
<p><b>Task 상태:</b></p>
<div class="fragment"><div class="line">                 ┌──────────────────────────────────────────────────┐</div>
<div class="line">                 │                                                  │</div>
<div class="line">                 ▼                                                  │</div>
<div class="line">┌─────────┐   ┌────────┐   ┌─────────┐   ┌───────────┐   ┌─────────┴───┐</div>
<div class="line">│ PENDING │──▶│ QUEUED │──▶│ RUNNING │──▶│ SUCCEEDED │   │   RETRYING  │</div>
<div class="line">│ (대기중)│   │(큐 등록)│   │ (실행중)│   │  (성공)   │   │  (재시도중) │</div>
<div class="line">└─────────┘   └────────┘   └────┬────┘   └───────────┘   └─────────────┘</div>
<div class="line">                 │              │                              ▲</div>
<div class="line">                 │              ▼                              │</div>
<div class="line">                 │        ┌──────────┐                         │</div>
<div class="line">                 │        │  FAILED  │─────────────────────────┘</div>
<div class="line">                 │        │  (실패)  │        (재시도 남음)</div>
<div class="line">                 │        └────┬─────┘</div>
<div class="line">                 │             │</div>
<div class="line">                 │             ▼ (재시도 소진)</div>
<div class="line">                 │        ┌──────────┐</div>
<div class="line">                 │        │  FAILED  │ (최종)</div>
<div class="line">                 │        │  (실패)  │</div>
<div class="line">                 │        └──────────┘</div>
<div class="line">                 │</div>
<div class="line">                 ▼</div>
<div class="line">           ┌───────────┐        ┌──────────┐</div>
<div class="line">           │ CANCELLED │        │ EXPIRED  │</div>
<div class="line">           │  (취소됨) │        │ (만료됨) │</div>
<div class="line">           └───────────┘        └──────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1632"></a>
3. task_queue</h2>
<p><code>task_queue</code>는 우선순위를 지원하는 다중 명명 큐를 관리합니다.</p>
<p><b>기능:</b></p><ul>
<li>다중 명명 큐 (예: "default", "high-priority")</li>
<li>ETA를 사용한 지연 작업 스케줄링</li>
<li>ID 또는 태그로 작업 취소</li>
<li>스레드 안전 작업</li>
</ul>
<p><b>데이터 흐름:</b></p>
<div class="fragment"><div class="line">┌──────────────────────────────────────────────────────────┐</div>
<div class="line">│                       task_queue                          │</div>
<div class="line">├──────────────────────────────────────────────────────────┤</div>
<div class="line">│                                                          │</div>
<div class="line">│   ┌─────────────────────────────────────────────────┐   │</div>
<div class="line">│   │              즉시 실행 큐                         │   │</div>
<div class="line">│   │  ┌─────────┐  ┌─────────┐  ┌─────────────────┐  │   │</div>
<div class="line">│   │  │ default │  │  high   │  │ custom-queue    │  │   │</div>
<div class="line">│   │  │ 큐      │  │priority │  │                 │  │   │</div>
<div class="line">│   │  └─────────┘  └─────────┘  └─────────────────┘  │   │</div>
<div class="line">│   └─────────────────────────────────────────────────┘   │</div>
<div class="line">│                          ▲                               │</div>
<div class="line">│                          │ (ETA 도달 시)                 │</div>
<div class="line">│   ┌─────────────────────────────────────────────────┐   │</div>
<div class="line">│   │              지연 큐                              │   │</div>
<div class="line">│   │  예약된 시간을 기다리는 작업들                    │   │</div>
<div class="line">│   └─────────────────────────────────────────────────┘   │</div>
<div class="line">│                                                          │</div>
<div class="line">└──────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1633"></a>
4. worker_pool</h2>
<p><code>worker_pool</code>은 스레드 풀을 사용하여 작업을 실행합니다.</p>
<p><b>책임:</b></p><ul>
<li>워커 스레드 관리</li>
<li>큐에서 작업 가져오기</li>
<li>작업을 등록된 핸들러와 매칭</li>
<li>지수 백오프를 사용한 재시도 처리</li>
<li>실행 통계 수집</li>
</ul>
<p><b>실행 흐름:</b></p>
<div class="fragment"><div class="line">┌────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                         worker_pool                             │</div>
<div class="line">├────────────────────────────────────────────────────────────────┤</div>
<div class="line">│                                                                 │</div>
<div class="line">│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │</div>
<div class="line">│   │워커 1   │  │워커 2   │  │워커 3   │  │워커 N   │          │</div>
<div class="line">│   └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘          │</div>
<div class="line">│        │            │            │            │                │</div>
<div class="line">│        └────────────┴─────┬──────┴────────────┘                │</div>
<div class="line">│                           │                                    │</div>
<div class="line">│                           ▼                                    │</div>
<div class="line">│                  ┌────────────────┐                            │</div>
<div class="line">│                  │ 작업 꺼내기    │◀───── task_queue           │</div>
<div class="line">│                  └───────┬────────┘                            │</div>
<div class="line">│                          │                                     │</div>
<div class="line">│                          ▼                                     │</div>
<div class="line">│                  ┌────────────────┐                            │</div>
<div class="line">│                  │ 핸들러 찾기    │                            │</div>
<div class="line">│                  └───────┬────────┘                            │</div>
<div class="line">│                          │                                     │</div>
<div class="line">│                          ▼                                     │</div>
<div class="line">│                  ┌────────────────┐                            │</div>
<div class="line">│                  │ 작업 실행      │                            │</div>
<div class="line">│                  └───────┬────────┘                            │</div>
<div class="line">│                          │                                     │</div>
<div class="line">│              ┌───────────┼───────────┐                         │</div>
<div class="line">│              ▼           ▼           ▼                         │</div>
<div class="line">│         ┌────────┐  ┌────────┐  ┌────────┐                    │</div>
<div class="line">│         │ 성공   │  │ 재시도 │  │ 실패   │                    │</div>
<div class="line">│         └───┬────┘  └───┬────┘  └───┬────┘                    │</div>
<div class="line">│             │           │           │                          │</div>
<div class="line">│             └───────────┴───────────┘                          │</div>
<div class="line">│                         │                                      │</div>
<div class="line">│                         ▼                                      │</div>
<div class="line">│                  result_backend                                │</div>
<div class="line">│                                                                │</div>
<div class="line">└────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1634"></a>
5. task_handler</h2>
<p><code>task_handler_interface</code>는 작업 실행 방법을 정의합니다.</p>
<p><b>인터페이스:</b></p>
<div class="fragment"><div class="line"><span class="keyword">class </span>task_handler_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> std::string name() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::Result&lt;value_container&gt; execute(</div>
<div class="line">        <span class="keyword">const</span> task&amp; t,</div>
<div class="line">        task_context&amp; ctx) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 선택적 라이프사이클 훅</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_retry(<span class="keyword">const</span> task&amp; t, <span class="keywordtype">size_t</span> attempt) { }</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_failure(<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> std::string&amp; error) { }</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_success(<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> value_container&amp; result) { }</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>핸들러 유형:</b></p><ul>
<li>클래스 기반: <code>task_handler_interface</code> 상속</li>
<li>람다 기반: <code>make_handler()</code> 사용 또는 직접 등록</li>
</ul>
<h2><a class="anchor" id="autotoc_md1635"></a>
6. task_context</h2>
<p><code>task_context</code>는 핸들러에게 실행 컨텍스트를 제공합니다.</p>
<p><b>기능:</b></p><ul>
<li>진행 상황 추적 및 보고</li>
<li>복구를 위한 체크포인트 관리</li>
<li>하위 작업 생성</li>
<li>취소 감지</li>
<li>로깅</li>
</ul>
<div class="fragment"><div class="line">common::Result&lt;value_container&gt; execute(<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="comment">// 진행 상황 업데이트</span></div>
<div class="line">    ctx.update_progress(0.0, <span class="stringliteral">&quot;시작 중...&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 취소 확인</span></div>
<div class="line">    <span class="keywordflow">if</span> (ctx.is_cancelled()) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(<span class="stringliteral">&quot;취소됨&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 복구를 위한 체크포인트 저장</span></div>
<div class="line">    ctx.save_checkpoint({{<span class="stringliteral">&quot;step&quot;</span>, current_step}});</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 하위 작업 생성</span></div>
<div class="line">    ctx.spawn_subtask(subtask);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 정보 로깅</span></div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;처리 완료&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1636"></a>
7. result_backend</h2>
<p><code>result_backend_interface</code>는 작업 결과 저장소를 제공합니다.</p>
<p><b>구현체:</b></p><ul>
<li><code>memory_result_backend</code>: 인메모리 저장소 (기본값)</li>
<li>커스텀 구현 가능 (Redis, 데이터베이스 등)</li>
</ul>
<p><b>저장 데이터:</b></p><ul>
<li>작업 상태</li>
<li>작업 결과</li>
<li>에러 정보</li>
<li>진행 데이터</li>
</ul>
<h2><a class="anchor" id="autotoc_md1637"></a>
8. async_result</h2>
<p><code>async_result</code>는 작업 실행 추적을 위한 핸들을 제공합니다.</p>
<p><b>사용 패턴:</b></p>
<div class="fragment"><div class="line"><span class="comment">// 폴링</span></div>
<div class="line"><span class="keywordflow">while</span> (!result.is_ready()) {</div>
<div class="line">    std::cout &lt;&lt; result.progress() &lt;&lt; <span class="stringliteral">&quot;%\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 블로킹 대기</span></div>
<div class="line"><span class="keyword">auto</span> outcome = result.get(timeout);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 콜백 기반</span></div>
<div class="line">result.then(</div>
<div class="line">    [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; value) { <span class="comment">/* 성공 */</span> },</div>
<div class="line">    [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; error) { <span class="comment">/* 실패 */</span> }</div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1638"></a>
9. task_scheduler</h2>
<p><code>task_scheduler</code>는 주기적 및 cron 기반 작업 실행을 관리합니다.</p>
<p><b>스케줄 유형:</b></p><ul>
<li>주기적: 고정 간격 (예: 5분마다)</li>
<li>Cron: Cron 표현식 (예: "0 3 * * *" - 매일 오전 3시)</li>
</ul>
<div class="fragment"><div class="line">┌────────────────────────────────────────┐</div>
<div class="line">│            task_scheduler               │</div>
<div class="line">├────────────────────────────────────────┤</div>
<div class="line">│                                         │</div>
<div class="line">│  ┌───────────────────────────────────┐ │</div>
<div class="line">│  │         스케줄 레지스트리          │ │</div>
<div class="line">│  │                                    │ │</div>
<div class="line">│  │  ┌────────────────────────────┐   │ │</div>
<div class="line">│  │  │ cleanup-job (주기: 5분)    │   │ │</div>
<div class="line">│  │  ├────────────────────────────┤   │ │</div>
<div class="line">│  │  │ daily-report (cron: 0 3 *) │   │ │</div>
<div class="line">│  │  ├────────────────────────────┤   │ │</div>
<div class="line">│  │  │ weekly-summary (cron: ...) │   │ │</div>
<div class="line">│  │  └────────────────────────────┘   │ │</div>
<div class="line">│  └───────────────────────────────────┘ │</div>
<div class="line">│                    │                    │</div>
<div class="line">│                    ▼                    │</div>
<div class="line">│           ┌────────────────┐           │</div>
<div class="line">│           │ 스케줄러 루프  │           │</div>
<div class="line">│           │ (시간 확인)    │           │</div>
<div class="line">│           └───────┬────────┘           │</div>
<div class="line">│                   │                    │</div>
<div class="line">│                   ▼                    │</div>
<div class="line">│            task_client.send()          │</div>
<div class="line">│                                         │</div>
<div class="line">└────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1639"></a>
10. task_monitor</h2>
<p><code>task_monitor</code>는 시스템 관측성을 제공합니다.</p>
<p><b>기능:</b></p><ul>
<li>큐 통계</li>
<li>워커 상태</li>
<li>활성/대기/실패 작업 목록</li>
<li>이벤트 구독</li>
</ul>
<h1><a class="anchor" id="autotoc_md1640"></a>
데이터 흐름</h1>
<h2><a class="anchor" id="autotoc_md1641"></a>
작업 제출 흐름</h2>
<div class="fragment"><div class="line">1. 클라이언트가 페이로드로 작업 생성</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">2. task_client.send(task)</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">3. task_queue.enqueue(task)</div>
<div class="line">   - task_id가 없으면 할당</div>
<div class="line">   - 지연 실행(ETA) 확인</div>
<div class="line">   - 적절한 큐에 추가</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">4. async_result를 클라이언트에 반환</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">5. 워커가 작업을 꺼냄</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">6. 워커가 매칭되는 핸들러 찾음</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">7. 핸들러가 task_context와 함께 실행</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">8. 결과가 result_backend에 저장</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">9. async_result.get()이 결과 반환</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1642"></a>
재시도 흐름</h2>
<div class="fragment"><div class="line">1. 작업 실행 실패</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">2. 재시도 정책 확인</div>
<div class="line">   - 시도 횟수 &lt; max_retries?</div>
<div class="line">         │</div>
<div class="line">    ┌────┴────┐</div>
<div class="line">    │         │</div>
<div class="line">   예         아니오</div>
<div class="line">    │         │</div>
<div class="line">    ▼         ▼</div>
<div class="line">3a. 재시도   3b. FAILED로</div>
<div class="line">    지연 계산     상태 변경</div>
<div class="line">    │               │</div>
<div class="line">    ▼               ▼</div>
<div class="line">4a. 상태를   4b. 에러를</div>
<div class="line">    RETRYING으로   백엔드에 저장</div>
<div class="line">    변경</div>
<div class="line">    │</div>
<div class="line">    ▼</div>
<div class="line">5a. 지연과 함께 다시 큐에 추가</div>
<div class="line">    │</div>
<div class="line">    ▼</div>
<div class="line">6a. 워커가 다시 작업을 가져감</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1643"></a>
스레드 안전성</h1>
<p>모든 공개 API는 스레드 안전합니다:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">컴포넌트   </th><th class="markdownTableHeadNone">스레드 안전 메커니즘    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">task_queue   </td><td class="markdownTableBodyNone">뮤텍스로 보호되는 내부 상태, thread_system 통합    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">worker_pool   </td><td class="markdownTableBodyNone">동시 워커 실행    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">async_result   </td><td class="markdownTableBodyNone">원자적 상태 + 조건 변수    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">task_context   </td><td class="markdownTableBodyNone">원자적 진행 상황 업데이트    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">memory_result_backend   </td><td class="markdownTableBodyNone">R/W 잠금을 위한 shared_mutex    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">task_scheduler   </td><td class="markdownTableBodyNone">뮤텍스로 보호되는 스케줄   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md1644"></a>
thread_system 통합</h2>
<p><code>task_queue</code>와 <code>worker_pool</code> 컴포넌트 모두 스레드 관리를 위해 <code>thread_system</code>을 사용합니다. 직접적인 <code>std::thread</code> 사용 대신 <code>kcenon::thread::thread_base</code>를 활용하여 다음을 제공합니다:</p>
<ul>
<li>표준화된 스레드 수명 주기 관리 (시작/중지)</li>
<li>주기적 태스크를 위한 적절한 wake interval 처리</li>
<li>일관된 스레드 명명 및 모니터링</li>
<li>프로젝트의 스레딩 인프라와의 통합</li>
</ul>
<p><b>task_queue</b>: 예약된 태스크를 처리하는 지연 태스크 워커 스레드에 <code>thread_base</code>를 사용합니다.</p>
<p><b>worker_pool</b>: <code>task_pool_worker</code> 클래스를 통해 <code>thread_base</code>를 사용합니다. 각 워커 스레드는 <code>thread_base</code>를 상속하여 스레드 수명 주기 관리를 <code>thread_system</code>에 위임합니다. 이를 통해 직접적인 <code>std::thread</code> 사용을 다음으로 대체합니다:</p><ul>
<li>태스크별 처리를 위한 <code>task_pool_worker::do_work()</code></li>
<li>종료 조정을 위한 <code>task_pool_worker::should_continue_work()</code></li>
<li>풀의 poll interval에 맞춘 자동 wake interval 구성</li>
</ul>
<p><b>task_scheduler</b>: <code>scheduler_worker</code> 클래스를 통해 <code>thread_base</code>를 사용합니다. 스케줄러의 백그라운드 스레드는 <code>thread_base</code>를 상속하여 다음을 제공합니다:</p><ul>
<li>예정된 스케줄 확인 및 실행을 위한 <code>scheduler_worker::do_work()</code></li>
<li>정상 종료를 위한 <code>scheduler_worker::should_continue_work()</code></li>
<li>스케줄 변경 시 즉시 깨어나기 위한 조건 변수 통합</li>
<li>다른 컴포넌트와 일관된 스레드 수명 주기 관리</li>
</ul>
<h1><a class="anchor" id="autotoc_md1645"></a>
확장 포인트</h1>
<h2><a class="anchor" id="autotoc_md1646"></a>
커스텀 Result Backend</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>redis_result_backend : <span class="keyword">public</span> result_backend_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    common::VoidResult store_result(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; task_id,</div>
<div class="line">        <span class="keyword">const</span> value_container&amp; result)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Redis에 저장</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;value_container&gt; get_result(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; task_id)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Redis에서 가져오기</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... 다른 메서드 구현</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1647"></a>
커스텀 Task Handler</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>custom_handler : <span class="keyword">public</span> task_handler_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    std::string name()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;custom.task&quot;</span>; }</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;value_container&gt; execute(</div>
<div class="line">        <span class="keyword">const</span> task&amp; t,</div>
<div class="line">        task_context&amp; ctx)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// 구현</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_retry(<span class="keyword">const</span> task&amp; t, <span class="keywordtype">size_t</span> attempt)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// 커스텀 재시도 로직</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1648"></a>
설계 결정</h1>
<h2><a class="anchor" id="autotoc_md1649"></a>
1. 메시지 기반 작업</h2>
<p>작업은 직렬화 및 메타데이터 처리를 위해 기존 메시징 인프라를 활용하도록 <code>message</code> 클래스를 확장합니다.</p>
<h2><a class="anchor" id="autotoc_md1650"></a>
2. Result 타입 패턴</h2>
<p>모든 작업은 예외 없이 명시적 에러 처리를 위해 <code>Result&lt;T&gt;</code> 또는 <code>VoidResult</code>를 반환합니다.</p>
<h2><a class="anchor" id="autotoc_md1651"></a>
3. 빌더 패턴</h2>
<p><code>task_builder</code>는 복잡한 설정의 작업 구성을 위한 유창한 API를 제공합니다.</p>
<h2><a class="anchor" id="autotoc_md1652"></a>
4. 파사드 패턴</h2>
<p><code>task_system</code>은 개별 컴포넌트 접근을 허용하면서 인터페이스를 단순화하는 파사드 역할을 합니다.</p>
<h2><a class="anchor" id="autotoc_md1653"></a>
5. 전략 패턴</h2>
<p><code>result_backend_interface</code>는 핵심 로직을 변경하지 않고 다른 저장소 전략을 교체할 수 있게 합니다.</p>
<h1><a class="anchor" id="autotoc_md1654"></a>
테스트</h1>
<p>작업 모듈은 <code>integration_tests/task/</code>에 위치한 포괄적인 통합 테스트를 제공합니다:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">테스트 파일   </th><th class="markdownTableHeadNone">설명    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>test_task_lifecycle.cpp</code>   </td><td class="markdownTableBodyNone">제출부터 완료까지 전체 작업 라이프사이클    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>test_worker_scenarios.cpp</code>   </td><td class="markdownTableBodyNone">다중 워커, 동시성, 핸들러 매칭    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>test_failure_recovery.cpp</code>   </td><td class="markdownTableBodyNone">재시도 메커니즘, 타임아웃 처리, 에러 전파    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>test_scheduling.cpp</code>   </td><td class="markdownTableBodyNone">주기적 및 크론 기반 작업 스케줄링    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>test_concurrent_load.cpp</code>   </td><td class="markdownTableBodyNone">대용량 처리, 처리량 측정   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md1655"></a>
테스트 실행</h2>
<div class="fragment"><div class="line"># 테스트 빌드</div>
<div class="line">cmake --build build --target test_task_lifecycle test_worker_scenarios \</div>
<div class="line">    test_failure_recovery test_scheduling test_concurrent_load</div>
<div class="line"> </div>
<div class="line"># 모든 작업 통합 테스트 실행</div>
<div class="line">ctest --test-dir build -R &quot;test_(task_lifecycle|worker_scenarios|failure_recovery|scheduling|concurrent_load)&quot;</div>
<div class="line"> </div>
<div class="line"># 특정 테스트 실행</div>
<div class="line">./build/integration_tests/test_task_lifecycle</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1656"></a>
관련 문서</h1>
<ul>
<li><a class="el" href="../../da/dee/md_docs_2task_2QUICK__START__KO.html">빠른 시작 가이드</a></li>
<li><a class="el" href="../../dd/db9/md_docs_2task_2API__REFERENCE__KO.html">API 레퍼런스</a></li>
<li><a class="el" href="../../dd/d35/md_docs_2task_2PATTERNS__KO.html">패턴 가이드</a></li>
<li><a class="el" href="../../d4/de7/md_docs_2task_2CONFIGURATION__KO.html">설정 가이드</a></li>
<li><a class="el" href="../../de/da3/md_docs_2task_2TROUBLESHOOTING__KO.html">문제 해결</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
