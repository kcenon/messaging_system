<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Monitoring System Performance Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/dbb/md_libraries_2monitoring__system_2docs_2performance.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Monitoring System Performance Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md590"></a> </p>
<h1><a class="anchor" id="autotoc_md591"></a>
Overview</h1>
<p>The Monitoring System is designed for minimal overhead while providing comprehensive performance metrics. This guide covers performance characteristics, overhead analysis, and optimization strategies.</p>
<h1><a class="anchor" id="autotoc_md592"></a>
Performance Characteristics</h1>
<h2><a class="anchor" id="autotoc_md593"></a>
Update Operations</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operation   </th><th class="markdownTableHeadNone">Typical Latency   </th><th class="markdownTableHeadNone">Throughput    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">System Metrics Update   </td><td class="markdownTableBodyNone">&lt; 1 μs   </td><td class="markdownTableBodyNone">&gt; 2M ops/sec    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Thread Pool Update   </td><td class="markdownTableBodyNone">&lt; 1 μs   </td><td class="markdownTableBodyNone">&gt; 2M ops/sec    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Worker Metrics Update   </td><td class="markdownTableBodyNone">&lt; 2 μs   </td><td class="markdownTableBodyNone">&gt; 1M ops/sec    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Snapshot Retrieval   </td><td class="markdownTableBodyNone">&lt; 5 μs   </td><td class="markdownTableBodyNone">&gt; 200K ops/sec   </td></tr>
</table>
<p><b>Characteristics:</b></p><ul>
<li>Non-blocking updates</li>
<li>Minimal lock contention</li>
<li>Cache-friendly operations</li>
<li>No allocations in hot path</li>
</ul>
<h2><a class="anchor" id="autotoc_md594"></a>
Collection Operations</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration   </th><th class="markdownTableHeadNone">CPU Overhead   </th><th class="markdownTableHeadNone">Memory Overhead    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1Hz collection   </td><td class="markdownTableBodyNone">&lt; 0.1%   </td><td class="markdownTableBodyNone">&lt; 1MB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">10Hz collection   </td><td class="markdownTableBodyNone">&lt; 0.5%   </td><td class="markdownTableBodyNone">&lt; 1MB    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">100Hz collection   </td><td class="markdownTableBodyNone">&lt; 2%   </td><td class="markdownTableBodyNone">&lt; 2MB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1000Hz collection   </td><td class="markdownTableBodyNone">&lt; 10%   </td><td class="markdownTableBodyNone">&lt; 5MB   </td></tr>
</table>
<p><b>Characteristics:</b></p><ul>
<li>Single background thread</li>
<li>Configurable frequency</li>
<li>Bounded memory usage</li>
<li>Predictable performance</li>
</ul>
<h1><a class="anchor" id="autotoc_md595"></a>
Benchmarks</h1>
<h2><a class="anchor" id="autotoc_md596"></a>
Test Environment</h2>
<ul>
<li>CPU: Intel Core i7-9700K @ 3.6GHz</li>
<li>RAM: 32GB DDR4</li>
<li>OS: Ubuntu 20.04 LTS</li>
<li>Compiler: GCC 10.3 with -O3</li>
</ul>
<h2><a class="anchor" id="autotoc_md597"></a>
Update Performance</h2>
<div class="fragment"><div class="line"><span class="comment">// Benchmark: 1 million metric updates</span></div>
<div class="line"><span class="keyword">auto</span> monitor = std::make_shared&lt;monitoring_module::monitoring&gt;();</div>
<div class="line">monitor-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1&#39;000&#39;000; ++i) {</div>
<div class="line">    <a class="code hl_struct" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html">monitoring_interface::system_metrics</a> metrics;</div>
<div class="line">    metrics.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#aa7a000a777db44c0f6edaf97b87c9a5e">cpu_usage_percent</a> = i % 100;</div>
<div class="line">    monitor-&gt;update_system_metrics(metrics);</div>
<div class="line">}</div>
<div class="line"><span class="keyword">auto</span> end = std::chrono::high_resolution_clock::now();</div>
<div class="ttc" id="astructmonitoring__interface_1_1system__metrics_html"><div class="ttname"><a href="../../df/d06/structmonitoring__interface_1_1system__metrics.html">monitoring_interface::system_metrics</a></div><div class="ttdoc">System-level performance metrics interface.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00047">monitoring_interface.h:47</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1system__metrics_html_aa7a000a777db44c0f6edaf97b87c9a5e"><div class="ttname"><a href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#aa7a000a777db44c0f6edaf97b87c9a5e">monitoring_interface::system_metrics::cpu_usage_percent</a></div><div class="ttdeci">std::uint64_t cpu_usage_percent</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00048">monitoring_interface.h:48</a></div></div>
</div><!-- fragment --><p><b>Results:</b></p><ul>
<li>Single thread: ~2.1M updates/second</li>
<li>4 threads concurrent: ~1.8M updates/second total</li>
<li>8 threads concurrent: ~1.5M updates/second total</li>
</ul>
<h2><a class="anchor" id="autotoc_md598"></a>
Collection Performance</h2>
<div class="fragment"><div class="line"><span class="comment">// Benchmark: Collector execution time</span></div>
<div class="line"><span class="keyword">class </span>benchmark_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a> {</div>
<div class="line">    <span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Simulate work</span></div>
<div class="line">        <span class="keyword">auto</span> sum = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i) {</div>
<div class="line">            sum += i;</div>
<div class="line">        }</div>
<div class="line">        snapshot.system.cpu_usage_percent = sum % 100;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassmetrics__collector_html"><div class="ttname"><a href="../../d7/db0/classmetrics__collector.html">metrics_collector</a></div><div class="ttdef"><b>Definition</b> <a href="../../d9/dd9/production__ready__example_8cpp_source.html#l00041">production_ready_example.cpp:41</a></div></div>
</div><!-- fragment --><p><b>Results:</b></p><ul>
<li>Empty collector: &lt; 100 ns</li>
<li>Simple collector: &lt; 1 μs</li>
<li>Complex collector: &lt; 100 μs</li>
<li>10 collectors: &lt; 1 ms total</li>
</ul>
<h2><a class="anchor" id="autotoc_md599"></a>
Memory Usage</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration   </th><th class="markdownTableHeadNone">Base Memory   </th><th class="markdownTableHeadNone">Per Snapshot   </th><th class="markdownTableHeadNone">1K History   </th><th class="markdownTableHeadNone">10K History    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Minimal   </td><td class="markdownTableBodyNone">~100 KB   </td><td class="markdownTableBodyNone">~100 bytes   </td><td class="markdownTableBodyNone">~200 KB   </td><td class="markdownTableBodyNone">~1.1 MB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Typical   </td><td class="markdownTableBodyNone">~150 KB   </td><td class="markdownTableBodyNone">~150 bytes   </td><td class="markdownTableBodyNone">~300 KB   </td><td class="markdownTableBodyNone">~1.6 MB    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Extended   </td><td class="markdownTableBodyNone">~200 KB   </td><td class="markdownTableBodyNone">~300 bytes   </td><td class="markdownTableBodyNone">~500 KB   </td><td class="markdownTableBodyNone">~3.1 MB   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md600"></a>
Overhead Analysis</h1>
<h2><a class="anchor" id="autotoc_md601"></a>
CPU Overhead</h2>
<div class="fragment"><div class="line"><span class="comment">// Measure monitoring overhead</span></div>
<div class="line"><span class="keywordtype">void</span> measure_overhead() {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> iterations = 1&#39;000&#39;000;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Baseline: No monitoring</span></div>
<div class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; iterations; ++i) {</div>
<div class="line">        do_work();</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">auto</span> baseline_time = std::chrono::high_resolution_clock::now() - start;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// With monitoring</span></div>
<div class="line">    <span class="keyword">auto</span> monitor = std::make_shared&lt;monitoring_module::monitoring&gt;();</div>
<div class="line">    monitor-&gt;start();</div>
<div class="line">    </div>
<div class="line">    start = std::chrono::high_resolution_clock::now();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; iterations; ++i) {</div>
<div class="line">        do_work();</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_struct" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html">monitoring_interface::system_metrics</a> metrics;</div>
<div class="line">        metrics.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#aa7a000a777db44c0f6edaf97b87c9a5e">cpu_usage_percent</a> = i % 100;</div>
<div class="line">        monitor-&gt;update_system_metrics(metrics);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">auto</span> monitored_time = std::chrono::high_resolution_clock::now() - start;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> overhead_percent = ((monitored_time - baseline_time) * 100.0) / baseline_time;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Typical Results:</b></p><ul>
<li>Light updates (1K/sec): &lt; 0.1% overhead</li>
<li>Moderate updates (10K/sec): &lt; 0.5% overhead</li>
<li>Heavy updates (100K/sec): &lt; 2% overhead</li>
<li>Extreme updates (1M/sec): &lt; 5% overhead</li>
</ul>
<h2><a class="anchor" id="autotoc_md602"></a>
Memory Overhead</h2>
<div class="fragment"><div class="line"><span class="comment">// Memory usage breakdown</span></div>
<div class="line"><span class="keyword">struct </span>memory_breakdown {</div>
<div class="line">    <span class="keywordtype">size_t</span> base_object;      <span class="comment">// ~1 KB</span></div>
<div class="line">    <span class="keywordtype">size_t</span> ring_buffer;      <span class="comment">// history_size * sizeof(snapshot)</span></div>
<div class="line">    <span class="keywordtype">size_t</span> current_metrics;  <span class="comment">// ~500 bytes</span></div>
<div class="line">    <span class="keywordtype">size_t</span> collectors;       <span class="comment">// ~100 bytes per collector</span></div>
<div class="line">    <span class="keywordtype">size_t</span> thread_overhead;  <span class="comment">// ~8 KB</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md603"></a>
Optimization Strategies</h1>
<h2><a class="anchor" id="autotoc_md604"></a>
1. Tune Collection Frequency</h2>
<div class="fragment"><div class="line"><span class="comment">// Low-frequency for production</span></div>
<div class="line"><span class="keyword">auto</span> prod_monitor = std::make_shared&lt;monitoring&gt;(1000, 5000); <span class="comment">// 5 seconds</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// High-frequency for debugging</span></div>
<div class="line"><span class="keyword">auto</span> debug_monitor = std::make_shared&lt;monitoring&gt;(100, 100); <span class="comment">// 100ms</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Adaptive frequency</span></div>
<div class="line"><span class="keyword">class </span>adaptive_monitor {</div>
<div class="line">    <span class="keywordtype">void</span> adjust_frequency() {</div>
<div class="line">        <span class="keywordflow">if</span> (system_load_high()) {</div>
<div class="line">            monitor-&gt;set_collection_interval(5000); <span class="comment">// Reduce frequency</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            monitor-&gt;set_collection_interval(1000); <span class="comment">// Normal frequency</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md605"></a>
2. Optimize History Size</h2>
<div class="fragment"><div class="line"><span class="comment">// Calculate optimal history size</span></div>
<div class="line"><span class="keywordtype">size_t</span> calculate_history_size(<span class="keywordtype">int</span> retention_minutes, <span class="keywordtype">int</span> collection_hz) {</div>
<div class="line">    <span class="keywordflow">return</span> retention_minutes * 60 * collection_hz;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Examples:</span></div>
<div class="line"><span class="comment">// 5 minutes at 1Hz = 300 snapshots</span></div>
<div class="line"><span class="comment">// 1 hour at 0.1Hz = 360 snapshots</span></div>
<div class="line"><span class="comment">// 10 minutes at 10Hz = 6000 snapshots</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md606"></a>
3. Batch Updates</h2>
<div class="fragment"><div class="line"><span class="comment">// Instead of individual updates</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; worker : workers) {</div>
<div class="line">    monitor-&gt;update_worker_metrics(worker.id, worker.metrics);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Batch updates</span></div>
<div class="line"><span class="keyword">struct </span>batch_updater {</div>
<div class="line">    monitoring* monitor_;</div>
<div class="line">    std::vector&lt;std::pair&lt;size_t, worker_metrics&gt;&gt; pending_;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d2/d11/test__std__concepts_8cpp.html#acb807bc597e1fc5883bc91a306d44f03">add</a>(<span class="keywordtype">size_t</span> <span class="keywordtype">id</span>, <span class="keyword">const</span> worker_metrics&amp; metrics) {</div>
<div class="line">        pending_.emplace_back(<span class="keywordtype">id</span>, metrics);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> flush() {</div>
<div class="line">        <span class="comment">// Aggregate first</span></div>
<div class="line">        worker_metrics aggregated{};</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [<span class="keywordtype">id</span>, metrics] : pending_) {</div>
<div class="line">            aggregated.jobs_processed += metrics.jobs_processed;</div>
<div class="line">            aggregated.total_processing_time_ns += metrics.total_processing_time_ns;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Single update</span></div>
<div class="line">        monitor_-&gt;update_worker_metrics(0, aggregated);</div>
<div class="line">        pending_.clear();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="atest__std__concepts_8cpp_html_acb807bc597e1fc5883bc91a306d44f03"><div class="ttname"><a href="../../d2/d11/test__std__concepts_8cpp.html#acb807bc597e1fc5883bc91a306d44f03">add</a></div><div class="ttdeci">T add(T a, T b)</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d11/test__std__concepts_8cpp_source.html#l00043">test_std_concepts.cpp:43</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md607"></a>
4. Conditional Updates</h2>
<div class="fragment"><div class="line"><span class="comment">// Update only on change</span></div>
<div class="line"><span class="keyword">class </span>smart_updater {</div>
<div class="line">    monitoring* monitor_;</div>
<div class="line">    system_metrics last_metrics_;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> update(<span class="keyword">const</span> system_metrics&amp; metrics) {</div>
<div class="line">        <span class="keywordflow">if</span> (metrics.cpu_usage_percent != last_metrics_.cpu_usage_percent ||</div>
<div class="line">            metrics.memory_usage_bytes != last_metrics_.memory_usage_bytes) {</div>
<div class="line">            monitor_-&gt;update_system_metrics(metrics);</div>
<div class="line">            last_metrics_ = metrics;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md608"></a>
5. Lightweight Collectors</h2>
<div class="fragment"><div class="line"><span class="comment">// Efficient collector implementation</span></div>
<div class="line"><span class="keyword">class </span>efficient_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a> {</div>
<div class="line">    <span class="comment">// Cache expensive operations</span></div>
<div class="line">    <span class="keyword">mutable</span> std::chrono::steady_clock::time_point last_update_;</div>
<div class="line">    <span class="keyword">mutable</span> std::uint64_t cached_value_;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> now = std::chrono::steady_clock::now();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Update cache periodically</span></div>
<div class="line">        <span class="keywordflow">if</span> (now - last_update_ &gt; std::chrono::seconds(1)) {</div>
<div class="line">            cached_value_ = expensive_calculation();</div>
<div class="line">            last_update_ = now;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        snapshot.system.custom_metric = cached_value_;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md609"></a>
Performance Anti-patterns</h1>
<h2><a class="anchor" id="autotoc_md610"></a>
1. High-Frequency String Operations</h2>
<div class="fragment"><div class="line"><span class="comment">// Bad: String operations in hot path</span></div>
<div class="line"><span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">    std::string status = get_system_status();</div>
<div class="line">    snapshot.system.status_code = parse_status(status); <span class="comment">// Expensive</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Good: Use numeric codes</span></div>
<div class="line"><span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">    snapshot.system.status_code = get_system_status_code(); <span class="comment">// Direct</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md611"></a>
2. Synchronous I/O in Collectors</h2>
<div class="fragment"><div class="line"><span class="comment">// Bad: Blocking I/O</span></div>
<div class="line"><span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">    std::ifstream file(<span class="stringliteral">&quot;/proc/stat&quot;</span>);</div>
<div class="line">    <span class="comment">// Parse file... blocks collection thread</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Good: Cached or async I/O</span></div>
<div class="line"><span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">    snapshot.system.cpu_usage_percent = cached_cpu_reader_.get();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md612"></a>
3. Unbounded History</h2>
<div class="fragment"><div class="line"><span class="comment">// Bad: Unlimited history growth</span></div>
<div class="line"><span class="keyword">auto</span> monitor = std::make_shared&lt;monitoring&gt;(</div>
<div class="line">    std::numeric_limits&lt;size_t&gt;::max(), <span class="comment">// Don&#39;t do this!</span></div>
<div class="line">    1000</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Good: Reasonable bounds</span></div>
<div class="line"><span class="keyword">auto</span> monitor = std::make_shared&lt;monitoring&gt;(</div>
<div class="line">    3600, <span class="comment">// 1 hour at 1Hz</span></div>
<div class="line">    1000</div>
<div class="line">);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md613"></a>
Profiling and Monitoring</h1>
<h2><a class="anchor" id="autotoc_md614"></a>
Built-in Metrics</h2>
<p>Monitor the monitor:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> monitor_health_check() {</div>
<div class="line">    <span class="keyword">auto</span> stats = monitor-&gt;get_stats();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (stats.dropped_snapshots &gt; 0) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Warning: Dropping snapshots!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (stats.collector_errors &gt; 100) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Warning: Collector failures!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> uptime = std::chrono::steady_clock::now() - stats.start_time;</div>
<div class="line">    <span class="keyword">auto</span> collections_per_sec = stats.total_collections / </div>
<div class="line">        std::chrono::duration_cast&lt;std::chrono::seconds&gt;(uptime).count();</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Collection rate: &quot;</span> &lt;&lt; collections_per_sec &lt;&lt; <span class="stringliteral">&quot; Hz&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md615"></a>
External Profiling</h2>
<div class="fragment"><div class="line"># CPU profiling</div>
<div class="line">perf record -g ./your_app_with_monitoring</div>
<div class="line">perf report</div>
<div class="line"> </div>
<div class="line"># Memory profiling</div>
<div class="line">valgrind --tool=massif ./your_app_with_monitoring</div>
<div class="line">ms_print massif.out.*</div>
<div class="line"> </div>
<div class="line"># System call overhead</div>
<div class="line">strace -c -e trace=futex ./your_app_with_monitoring</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md616"></a>
Best Practices Summary</h1>
<ol type="1">
<li><b>Right-size History</b> - Keep only what you need</li>
<li><b>Tune Collection Rate</b> - Balance detail vs overhead</li>
<li><b>Efficient Collectors</b> - Cache expensive operations</li>
<li><b>Batch When Possible</b> - Reduce update frequency</li>
<li><b>Monitor the Monitor</b> - Track meta-metrics</li>
<li><b>Profile Real Workloads</b> - Measure actual impact</li>
</ol>
<h1><a class="anchor" id="autotoc_md617"></a>
Platform-Specific Optimizations</h1>
<h2><a class="anchor" id="autotoc_md618"></a>
Linux</h2>
<ul>
<li>Use <code>/proc</code> filesystem efficiently</li>
<li>Consider <code>perf_event_open</code> for hardware counters</li>
<li>Leverage <code>cgroups</code> for container metrics</li>
</ul>
<h2><a class="anchor" id="autotoc_md619"></a>
Windows</h2>
<ul>
<li>Use Performance Counters API</li>
<li>Query WMI efficiently</li>
<li>Consider ETW for detailed metrics</li>
</ul>
<h2><a class="anchor" id="autotoc_md620"></a>
macOS</h2>
<ul>
<li>Use <code>host_statistics64</code> for system metrics</li>
<li>Leverage <code>mach_absolute_time</code> for timing</li>
<li>Consider <code>dtrace</code> for detailed profiling </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
