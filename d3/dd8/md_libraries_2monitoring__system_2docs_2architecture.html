<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Monitoring System Architecture</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/dd8/md_libraries_2monitoring__system_2docs_2architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Monitoring System Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md507"></a> </p>
<h1><a class="anchor" id="autotoc_md508"></a>
Overview</h1>
<p>The Monitoring System is designed as a low-overhead, real-time performance monitoring framework that implements the <code><a class="el" href="../../d6/d8e/classmonitoring__interface_1_1monitoring__interface.html">monitoring_interface::monitoring_interface</a></code> from the Thread System. It provides continuous metrics collection with historical data storage and extensible collector support.</p>
<h1><a class="anchor" id="autotoc_md509"></a>
Architecture Diagram</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────┐</div>
<div class="line">│                      Client Application                      │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│              monitoring_interface (API)                      │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│                       monitoring                             │</div>
<div class="line">│  ┌─────────────────────────────────────────────────────┐    │</div>
<div class="line">│  │                  Metrics Storage                     │    │</div>
<div class="line">│  │  ┌────────────┐  ┌──────────────┐  ┌────────────┐  │    │</div>
<div class="line">│  │  │  Current   │  │ Ring Buffer  │  │ Snapshots  │  │    │</div>
<div class="line">│  │  │  Metrics   │  │  (History)   │  │   Index    │  │    │</div>
<div class="line">│  │  └────────────┘  └──────────────┘  └────────────┘  │    │</div>
<div class="line">│  └─────────────────────────────────────────────────────┘    │</div>
<div class="line">│  ┌─────────────────────────────────────────────────────┐    │</div>
<div class="line">│  │               Collection Engine                      │    │</div>
<div class="line">│  │  ┌────────────┐  ┌──────────────┐  ┌────────────┐  │    │</div>
<div class="line">│  │  │Background  │  │  Collector   │  │   Timer    │  │    │</div>
<div class="line">│  │  │  Thread    │  │   Chain      │  │  Trigger   │  │    │</div>
<div class="line">│  │  └────────────┘  └──────────────┘  └────────────┘  │    │</div>
<div class="line">│  └─────────────────────────────────────────────────────┘    │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│                      Collectors                              │</div>
<div class="line">│  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐     │</div>
<div class="line">│  │   System     │  │   Custom     │  │   External    │     │</div>
<div class="line">│  │  Collector   │  │  Collector   │  │  Collector    │     │</div>
<div class="line">│  └──────────────┘  └──────────────┘  └───────────────┘     │</div>
<div class="line">└─────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md510"></a>
Core Components</h1>
<h2><a class="anchor" id="autotoc_md511"></a>
1. Monitoring Interface</h2>
<p>The system implements <code><a class="el" href="../../d6/d8e/classmonitoring__interface_1_1monitoring__interface.html">monitoring_interface::monitoring_interface</a></code> providing:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_namespace" href="../../d3/d7a/namespacemonitoring__interface.html">monitoring_interface</a> {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> update_system_metrics(<span class="keyword">const</span> system_metrics&amp; metrics) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> update_thread_pool_metrics(<span class="keyword">const</span> thread_pool_metrics&amp; metrics) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> update_worker_metrics(std::size_t worker_id, <span class="keyword">const</span> worker_metrics&amp; metrics) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> metrics_snapshot get_current_snapshot() <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> std::vector&lt;metrics_snapshot&gt; get_recent_snapshots(std::size_t count) <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_active() <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="ttc" id="anamespacemonitoring__interface_html"><div class="ttname"><a href="../../d3/d7a/namespacemonitoring__interface.html">monitoring_interface</a></div><div class="ttdef"><b>Definition</b> <a href="../../da/dd3/multi__process__monitoring__interface_8h_source.html#l00015">multi_process_monitoring_interface.h:15</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md512"></a>
2. Monitoring Implementation</h2>
<p>The main <code>monitoring</code> class provides:</p><ul>
<li><b>Real-time Updates</b>: Immediate metrics updates</li>
<li><b>Historical Storage</b>: Ring buffer for time-series data</li>
<li><b>Automatic Collection</b>: Background thread for periodic snapshots</li>
<li><b>Extensible Collectors</b>: Plugin system for custom metrics</li>
</ul>
<h3><a class="anchor" id="autotoc_md513"></a>
Key Features:</h3>
<ul>
<li><b>PIMPL Pattern</b>: Implementation hiding for ABI stability</li>
<li><b>Lock-free Reads</b>: Atomic operations where possible</li>
<li><b>Configurable Storage</b>: Adjustable history size</li>
<li><b>Low Overhead</b>: Minimal impact on monitored application</li>
</ul>
<h2><a class="anchor" id="autotoc_md514"></a>
3. Metrics Types</h2>
<h3><a class="anchor" id="autotoc_md515"></a>
System Metrics</h3>
<div class="fragment"><div class="line"><span class="keyword">struct </span>system_metrics {</div>
<div class="line">    std::uint64_t cpu_usage_percent;</div>
<div class="line">    std::uint64_t memory_usage_bytes;</div>
<div class="line">    std::uint64_t active_threads;</div>
<div class="line">    std::uint64_t total_allocations;</div>
<div class="line">    std::chrono::steady_clock::time_point timestamp;</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md516"></a>
Thread Pool Metrics</h3>
<div class="fragment"><div class="line"><span class="keyword">struct </span>thread_pool_metrics {</div>
<div class="line">    std::uint64_t <a class="code hl_variable" href="../../df/de0/optimized__storage_8h.html#a1e01545799cb0944029bea465dd2c0ba">jobs_completed</a>;</div>
<div class="line">    std::uint64_t jobs_pending;</div>
<div class="line">    std::uint64_t total_execution_time_ns;</div>
<div class="line">    std::uint64_t average_latency_ns;</div>
<div class="line">    std::uint64_t worker_threads;</div>
<div class="line">    std::uint64_t idle_threads;</div>
<div class="line">    std::chrono::steady_clock::time_point timestamp;</div>
<div class="line">};</div>
<div class="ttc" id="aoptimized__storage_8h_html_a1e01545799cb0944029bea465dd2c0ba"><div class="ttname"><a href="../../df/de0/optimized__storage_8h.html#a1e01545799cb0944029bea465dd2c0ba">jobs_completed</a></div><div class="ttdeci">std::uint32_t jobs_completed</div><div class="ttdef"><b>Definition</b> <a href="../../df/de0/optimized__storage_8h_source.html#l00004">optimized_storage.h:4</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md517"></a>
Worker Metrics</h3>
<div class="fragment"><div class="line"><span class="keyword">struct </span>worker_metrics {</div>
<div class="line">    std::uint64_t jobs_processed;</div>
<div class="line">    std::uint64_t total_processing_time_ns;</div>
<div class="line">    std::uint64_t idle_time_ns;</div>
<div class="line">    std::uint64_t context_switches;</div>
<div class="line">    std::chrono::steady_clock::time_point timestamp;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md518"></a>
4. Ring Buffer Storage</h2>
<p>The <code>ring_buffer&lt;T&gt;</code> provides efficient circular storage:</p><ul>
<li><b>Fixed Capacity</b>: No dynamic allocations after initialization</li>
<li><b>Thread-safe</b>: Mutex-protected operations</li>
<li><b>Overwrite Policy</b>: Oldest data replaced when full</li>
<li><b>Fast Access</b>: O(1) push, O(n) retrieval</li>
</ul>
<h3><a class="anchor" id="autotoc_md519"></a>
Design Decisions:</h3>
<ul>
<li>Simple mutex over lock-free for correctness</li>
<li>Vector backing for cache efficiency</li>
<li>Head/tail pointers for circular behavior</li>
</ul>
<h2><a class="anchor" id="autotoc_md520"></a>
5. Collector System</h2>
<p>Collectors gather metrics from various sources:</p>
<h3><a class="anchor" id="autotoc_md521"></a>
Base Collector</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a> {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> std::string name() <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="ttc" id="aclassmetrics__collector_html"><div class="ttname"><a href="../../d7/db0/classmetrics__collector.html">metrics_collector</a></div><div class="ttdef"><b>Definition</b> <a href="../../d9/dd9/production__ready__example_8cpp_source.html#l00041">production_ready_example.cpp:41</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md522"></a>
Collector Chain</h3>
<ul>
<li>Multiple collectors executed sequentially</li>
<li>Error isolation - one failure doesn't affect others</li>
<li>Configurable at runtime</li>
</ul>
<h1><a class="anchor" id="autotoc_md523"></a>
Threading Model</h1>
<h2><a class="anchor" id="autotoc_md524"></a>
Update Operations</h2>
<ul>
<li>Direct updates from client threads</li>
<li>Mutex protection for current metrics</li>
<li>Atomic operations where possible</li>
<li>Non-blocking for metric producers</li>
</ul>
<h2><a class="anchor" id="autotoc_md525"></a>
Collection Thread</h2>
<ul>
<li>Single background thread</li>
<li>Periodic snapshot creation</li>
<li>Collector chain execution</li>
<li>Ring buffer management</li>
</ul>
<h2><a class="anchor" id="autotoc_md526"></a>
Thread Safety Guarantees</h2>
<ul>
<li>All public methods are thread-safe</li>
<li>Concurrent reads supported</li>
<li>Updates serialized per metric type</li>
<li>Collectors run sequentially</li>
</ul>
<h1><a class="anchor" id="autotoc_md527"></a>
Memory Management</h1>
<h2><a class="anchor" id="autotoc_md528"></a>
Storage Strategy</h2>
<ul>
<li>Pre-allocated ring buffer</li>
<li>No allocations during normal operation</li>
<li>Configurable memory footprint</li>
<li>Bounded memory usage</li>
</ul>
<h2><a class="anchor" id="autotoc_md529"></a>
Object Lifetime</h2>
<ul>
<li>Shared ownership via shared_ptr</li>
<li>Collectors owned by monitoring</li>
<li>Metrics copied, not referenced</li>
</ul>
<h2><a class="anchor" id="autotoc_md530"></a>
Performance Considerations</h2>
<ul>
<li>Cache-friendly data layout</li>
<li>Minimal pointer chasing</li>
<li>Batch operations where possible</li>
</ul>
<h1><a class="anchor" id="autotoc_md531"></a>
Integration Points</h1>
<h2><a class="anchor" id="autotoc_md532"></a>
Service Container Integration</h2>
<div class="fragment"><div class="line"><span class="comment">// Register monitoring</span></div>
<div class="line">service_container::global()</div>
<div class="line">    .register_singleton&lt;<a class="code hl_namespace" href="../../d3/d7a/namespacemonitoring__interface.html">monitoring_interface</a>&gt;(monitor);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Automatic resolution in thread_context</span></div>
<div class="line">thread_context context; <span class="comment">// Resolves monitoring from container</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md533"></a>
Direct Integration</h2>
<div class="fragment"><div class="line"><span class="comment">// Use as monitoring_interface</span></div>
<div class="line">std::shared_ptr&lt;monitoring_interface&gt; iface = monitor;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pass to components</span></div>
<div class="line"><span class="keyword">auto</span> context = thread_context(<span class="keyword">nullptr</span>, iface);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md534"></a>
Metric Sources</h2>
<ul>
<li>Manual updates via API</li>
<li>Automatic from Thread System components</li>
<li>Custom collectors for system metrics</li>
<li>External data sources</li>
</ul>
<h1><a class="anchor" id="autotoc_md535"></a>
Performance Characteristics</h1>
<h2><a class="anchor" id="autotoc_md536"></a>
Update Operations</h2>
<ul>
<li><b>Latency</b>: &lt; 1μs typical</li>
<li><b>Throughput</b>: &gt; 1M updates/second</li>
<li><b>Lock Contention</b>: Minimal with proper usage</li>
<li><b>Memory</b>: O(1) per update</li>
</ul>
<h2><a class="anchor" id="autotoc_md537"></a>
Collection Operations</h2>
<ul>
<li><b>Frequency</b>: Configurable (default 1Hz)</li>
<li><b>Duration</b>: Depends on collectors</li>
<li><b>Overhead</b>: &lt; 1% CPU typical</li>
<li><b>Memory</b>: Bounded by ring buffer size</li>
</ul>
<h2><a class="anchor" id="autotoc_md538"></a>
Storage Costs</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">History Size   </th><th class="markdownTableHeadNone">Memory Usage    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">100 snapshots   </td><td class="markdownTableBodyNone">~10 KB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1,000 snapshots   </td><td class="markdownTableBodyNone">~100 KB    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10,000 snapshots   </td><td class="markdownTableBodyNone">~1 MB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">100,000 snapshots   </td><td class="markdownTableBodyNone">~10 MB   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md539"></a>
Design Patterns Used</h1>
<ol type="1">
<li><b>PIMPL (Pointer to Implementation)</b><ul>
<li>Hides implementation details</li>
<li>Provides ABI stability</li>
<li>Reduces compilation dependencies</li>
</ul>
</li>
<li><b>Observer Pattern</b><ul>
<li>Collectors observe system state</li>
<li>Decoupled metric gathering</li>
</ul>
</li>
<li><b>Strategy Pattern</b><ul>
<li>Collectors as strategies</li>
<li>Runtime configuration</li>
</ul>
</li>
<li><b>Singleton Pattern</b> (optional)<ul>
<li>Global monitoring instance</li>
<li>Service container integration</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md540"></a>
Extensibility</h1>
<h2><a class="anchor" id="autotoc_md541"></a>
Custom Collectors</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>gpu_metrics_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a> {</div>
<div class="line">    <span class="keywordtype">void</span> collect(metrics_snapshot&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        snapshot.system.gpu_usage = query_gpu_usage();</div>
<div class="line">        snapshot.system.gpu_memory = query_gpu_memory();</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md542"></a>
Custom Metrics</h2>
<p>Extend existing structures: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>extended_system_metrics : system_metrics {</div>
<div class="line">    std::uint64_t gpu_usage_percent;</div>
<div class="line">    std::uint64_t network_bytes_sent;</div>
<div class="line">    std::uint64_t disk_io_bytes;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md543"></a>
Storage Backends</h2>
<p>Future enhancement for different storage:</p><ul>
<li>Time-series databases</li>
<li>File-based storage</li>
<li>Network streaming</li>
</ul>
<h1><a class="anchor" id="autotoc_md544"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md545"></a>
For Library Users</h2>
<ul>
<li>Update metrics from appropriate threads</li>
<li>Use collectors for periodic data</li>
<li>Size history buffer appropriately</li>
<li>Monitor the monitor (meta-metrics)</li>
</ul>
<h2><a class="anchor" id="autotoc_md546"></a>
For Contributors</h2>
<ul>
<li>Maintain thread safety invariants</li>
<li>Minimize allocation in hot paths</li>
<li>Document performance implications</li>
<li>Provide meaningful error handling</li>
</ul>
<h1><a class="anchor" id="autotoc_md547"></a>
Future Enhancements</h1>
<h2><a class="anchor" id="autotoc_md548"></a>
Planned Features</h2>
<ol type="1">
<li><b>Lock-free Updates</b>: Atomic-only operations</li>
<li><b>Compression</b>: Historical data compression</li>
<li><b>Aggregation</b>: Built-in statistics</li>
<li><b>Alerts</b>: Threshold-based notifications</li>
<li><b>Export</b>: Various output formats</li>
</ol>
<h2><a class="anchor" id="autotoc_md549"></a>
Extension Points</h2>
<ul>
<li>Custom storage backends</li>
<li>Metric transformations</li>
<li>Real-time streaming</li>
<li>Distributed monitoring </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
