<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: ADR-001: Logging Architecture - ILogger Interface vs logger_system</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/dd2/md_docs_2adr_2001-logging-architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ADR-001: Logging Architecture - ILogger Interface vs logger_system</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Status</h1>
<p><b>Accepted</b> - Current implementation is correct</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Context</h1>
<p>The messaging_system project uses logging throughout its codebase. This ADR documents the architectural decision regarding how logging is integrated and the relationship between <code>common_system::ILogger</code> and <code>logger_system</code>.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Background</h2>
<p>The project initially had a direct dependency on <code>logger_system</code> for logging functionality. This created tight coupling and potential circular dependency issues, particularly between <code>thread_system</code> and <code>logger_system</code>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Problem Statement</h2>
<ol type="1">
<li>Direct dependency on <code>logger_system</code> created tight coupling</li>
<li>Circular dependencies were possible between core systems</li>
<li>Testing required full logger_system initialization</li>
<li>Applications without logging needs still pulled in the entire logger implementation</li>
</ol>
<h1><a class="anchor" id="autotoc_md5"></a>
Decision</h1>
<p>Use <code>common_system::ILogger</code> interface with runtime binding via <code>GlobalLoggerRegistry</code> instead of direct <code>logger_system</code> dependency.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Architecture Overview</h2>
<div class="fragment"><div class="line">messaging_system</div>
<div class="line">    |</div>
<div class="line">    v</div>
<div class="line">common::logging::log_info/error/debug (convenience functions)</div>
<div class="line">    |</div>
<div class="line">    v</div>
<div class="line">GlobalLoggerRegistry::instance() (thread-safe singleton)</div>
<div class="line">    |</div>
<div class="line">    v</div>
<div class="line">common::interfaces::ILogger (abstract interface)</div>
<div class="line">    |</div>
<div class="line">    v (optional runtime binding)</div>
<div class="line">logger_system::logger (concrete implementation)</div>
<div class="line">    |</div>
<div class="line">    v</div>
<div class="line">logger_adapter (ILogger adapter)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Implementation Details</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
1. ILogger Interface (&lt;tt&gt;common_system&lt;/tt&gt;)</h3>
<p>Location: <code>common_system/include/kcenon/common/interfaces/logger_interface.h</code></p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ILogger {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> log(log_level level, std::string_view message,</div>
<div class="line">                     <span class="keyword">const</span> source_location&amp; loc = source_location::current()) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> log(<span class="keyword">const</span> log_entry&amp; entry) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_enabled(log_level level) <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> set_level(log_level level) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> log_level get_level() <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> flush() = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
2. GlobalLoggerRegistry (&lt;tt&gt;common_system&lt;/tt&gt;)</h3>
<p>Location: <code>common_system/include/kcenon/common/interfaces/global_logger_registry.h</code></p>
<p>Features:</p><ul>
<li>Thread-safe singleton (Meyer's singleton pattern)</li>
<li>Named logger management via <code>register_logger()</code>, <code>get_logger()</code></li>
<li>Default logger management via <code>set_default_logger()</code>, <code>get_default_logger()</code></li>
<li>Factory-based lazy initialization with <code>register_factory()</code></li>
<li>NullLogger fallback for safe operation without logger</li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
3. Convenience Functions (&lt;tt&gt;common_system&lt;/tt&gt;)</h3>
<p>Location: <code>common_system/include/kcenon/common/logging/log_functions.h</code></p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>common::logging {</div>
<div class="line">    <span class="keywordtype">void</span> log_info(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    <span class="keywordtype">void</span> log_error(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    <span class="keywordtype">void</span> log_debug(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    <span class="keywordtype">void</span> log_warning(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    <span class="keywordtype">void</span> log_trace(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    <span class="keywordtype">void</span> log_critical(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
4. CMake Dependency Configuration</h3>
<p>Location: <code>messaging_system/CMakeLists.txt</code> (lines 126-128)</p>
<div class="fragment"><div class="line"># NOTE: logger_system is no longer a direct dependency (Issue #94).</div>
<div class="line"># Logging is now provided through common_system&#39;s ILogger interface</div>
<div class="line"># with runtime binding via GlobalLoggerRegistry.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
Consequences</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Positive</h2>
<ol type="1">
<li><b>Zero Coupling</b>: messaging_system has no compile-time dependency on logger_system</li>
<li><b>Optional Integration</b>: Works with or without logger_system installed</li>
<li><b>Safe Defaults</b>: NullLogger prevents null pointer crashes when no logger is configured</li>
<li><b>Flexible Binding</b>: Different ILogger implementations can be bound at runtime</li>
<li><b>Circular Dependency Resolution</b>: Breaks the thread_system &lt;-&gt; logger_system cycle</li>
<li><b>Testability</b>: Unit tests can run without full logger initialization</li>
<li><b>Reduced Binary Size</b>: Applications not using logging don't include logger_system</li>
</ol>
<h2><a class="anchor" id="autotoc_md14"></a>
Negative</h2>
<ol type="1">
<li><b>Runtime Overhead</b>: Virtual function calls instead of direct calls (minimal impact)</li>
<li><b>Configuration Complexity</b>: Requires explicit logger registration at application startup</li>
<li><b>Feature Limitation</b>: Some logger_system-specific features require direct dependency</li>
</ol>
<h2><a class="anchor" id="autotoc_md15"></a>
Neutral</h2>
<ol type="1">
<li><b>Documentation Requirement</b>: Architecture needs clear documentation (this ADR)</li>
<li><b>Migration Effort</b>: Existing code using logger_system directly needs refactoring</li>
</ol>
<h1><a class="anchor" id="autotoc_md16"></a>
Alternatives Considered</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Alternative A: Direct logger_system Dependency</h2>
<p><b>Rejected</b> because:</p><ul>
<li>Creates tight coupling</li>
<li>Prevents optional logging</li>
<li>Causes circular dependency issues</li>
</ul>
<h2><a class="anchor" id="autotoc_md18"></a>
Alternative B: Compile-time Logger Selection via Templates</h2>
<p><b>Rejected</b> because:</p><ul>
<li>Increases binary size (template instantiation)</li>
<li>Reduces flexibility for runtime configuration</li>
<li>More complex API</li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
Alternative C: Macro-based Logging</h2>
<p><b>Rejected</b> because:</p><ul>
<li>Less type-safe</li>
<li>Harder to maintain</li>
<li>Doesn't integrate well with C++20 features</li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
Compliance</h1>
<h2><a class="anchor" id="autotoc_md21"></a>
Current Implementation Status</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Requirement   </th><th class="markdownTableHeadNone">Status   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ILogger interface usage   </td><td class="markdownTableBodyNone">Complete   </td><td class="markdownTableBodyNone">All logging via convenience functions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">No direct logger_system dependency   </td><td class="markdownTableBodyNone">Complete   </td><td class="markdownTableBodyNone">CMakeLists.txt verified    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GlobalLoggerRegistry integration   </td><td class="markdownTableBodyNone">Complete   </td><td class="markdownTableBodyNone">Thread-safe singleton    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">NullLogger fallback   </td><td class="markdownTableBodyNone">Complete   </td><td class="markdownTableBodyNone">Safe default behavior    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Source location support   </td><td class="markdownTableBodyNone">Complete   </td><td class="markdownTableBodyNone">C++20 source_location   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md22"></a>
Usage Examples in messaging_system</h2>
<div class="fragment"><div class="line"><span class="comment">// src/impl/core/message_bus.cpp</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/logging/log_functions.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> message_bus::start() {</div>
<div class="line">    common::logging::log_info(<span class="stringliteral">&quot;Starting message bus with &quot;</span> +</div>
<div class="line">                               std::to_string(worker_count) + <span class="stringliteral">&quot; workers&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> message_bus::on_error(<span class="keyword">const</span> std::string&amp; error) {</div>
<div class="line">    common::logging::log_error(<span class="stringliteral">&quot;Failed to process message: &quot;</span> + error);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md23"></a>
Related Decisions</h1>
<ul>
<li><b>Issue #94</b>: Migration from direct logger_system dependency</li>
<li><b>Issue #139</b>: Thread pool architecture decision (similar pattern)</li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
References</h1>
<ul>
<li><code>common_system/include/kcenon/common/interfaces/logger_interface.h</code></li>
<li><code>common_system/include/kcenon/common/interfaces/global_logger_registry.h</code></li>
<li><code>common_system/include/kcenon/common/logging/log_functions.h</code></li>
<li><code>messaging_system/CMakeLists.txt</code></li>
<li><code>messaging_system/include/kcenon/messaging/utils/integration_detector.h</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Date   </th><th class="markdownTableHeadNone">Version   </th><th class="markdownTableHeadNone">Author   </th><th class="markdownTableHeadNone">Changes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2025-12-10   </td><td class="markdownTableBodyNone">1.0   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Initial ADR creation   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
