<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Task 모듈 문제 해결 가이드</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/da3/md_docs_2task_2TROUBLESHOOTING__KO.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Task 모듈 문제 해결 가이드</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2120"></a> 이 가이드는 Task 모듈의 일반적인 문제를 진단하고 해결하는 데 도움을 줍니다.</p>
<h1><a class="anchor" id="autotoc_md2121"></a>
목차</h1>
<ul>
<li>일반적인 문제</li>
<li>디버깅 방법</li>
<li>성능 문제</li>
<li>FAQ</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2123"></a>
일반적인 문제</h1>
<h2><a class="anchor" id="autotoc_md2124"></a>
작업이 처리되지 않음</h2>
<p><b>증상:</b></p><ul>
<li>작업이 큐에 남아 있음</li>
<li><code>async_result.is_ready()</code>가 <code>true</code>를 반환하지 않음</li>
<li>큐 크기가 계속 증가함</li>
</ul>
<p><b>가능한 원인과 해결책:</b></p>
<ol type="1">
<li><p class="startli"><b>작업 이름에 대한 핸들러가 등록되지 않음</b></p>
<div class="fragment"><div class="line"><span class="comment">// 핸들러 존재 확인</span></div>
<div class="line"><span class="keywordflow">if</span> (!system.workers().has_handler(<span class="stringliteral">&quot;my.task&quot;</span>)) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;핸들러 &#39;my.task&#39;가 등록되지 않았습니다!\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 등록된 모든 핸들러 목록</span></div>
<div class="line"><span class="keyword">auto</span> handlers = system.workers().list_handlers();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; h : handlers) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;등록됨: &quot;</span> &lt;&lt; h &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>시스템이 시작되지 않음</b></p>
<div class="fragment"><div class="line"><span class="comment">// 시스템이 실행 중인지 확인</span></div>
<div class="line"><span class="keywordflow">if</span> (!system.is_running()) {</div>
<div class="line">    <span class="keyword">auto</span> result = system.start();</div>
<div class="line">    <span class="keywordflow">if</span> (!result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;시작 실패: &quot;</span> &lt;&lt; result.error().message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>잘못된 큐 이름</b></p>
<div class="fragment"><div class="line"><span class="comment">// 작업이 워커가 모니터링하지 않는 큐에 제출됨</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;my.task&quot;</span>)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;custom-queue&quot;</span>)  <span class="comment">// 워커가 이 큐를 듣고 있지 않을 수 있음</span></div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 워커가 해당 큐를 모니터링하도록 보장</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;custom-queue&quot;</span>};  <span class="comment">// 큐 추가</span></div>
</div><!-- fragment --></li>
<li><p class="startli"><b>모든 워커가 바쁨</b></p>
<div class="fragment"><div class="line"><span class="comment">// 워커 상태 확인</span></div>
<div class="line"><span class="keyword">auto</span> stats = system.get_statistics();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;활성: &quot;</span> &lt;&lt; system.active_workers()</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; system.total_workers() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md2125"></a>
작업이 즉시 실패함</h2>
<p><b>증상:</b></p><ul>
<li><code>async_result.is_failed()</code>가 <code>true</code> 반환</li>
<li>작업이 너무 빨리 완료됨</li>
<li>에러 메시지 출현</li>
</ul>
<p><b>가능한 원인과 해결책:</b></p>
<ol type="1">
<li><p class="startli"><b>핸들러가 예외를 던짐</b></p>
<div class="fragment"><div class="line"><span class="comment">// 핸들러는 throw 대신 Result를 반환해야 함</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;safe.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="comment">// 로직</span></div>
<div class="line">        <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(error_code::execution_failed, e.what());</div>
<div class="line">    }</div>
<div class="line">});</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>잘못된 페이로드 데이터</b></p>
<div class="fragment"><div class="line"><span class="comment">// 처리 전 페이로드 유효성 검사</span></div>
<div class="line"><span class="keyword">auto</span> required_field = t.payload().get_string(<span class="stringliteral">&quot;required&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!required_field) {</div>
<div class="line">    <span class="keywordflow">return</span> common::error(error_code::validation_failed,</div>
<div class="line">                       <span class="stringliteral">&quot;필수 필드 누락&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>리소스 사용 불가</b></p>
<div class="fragment"><div class="line"><span class="comment">// 외부 종속성 확인</span></div>
<div class="line"><span class="keywordflow">if</span> (!database.is_connected()) {</div>
<div class="line">    ctx.log_error(<span class="stringliteral">&quot;데이터베이스 연결 끊김&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> common::error(error_code::resource_unavailable,</div>
<div class="line">                       <span class="stringliteral">&quot;데이터베이스 사용 불가&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md2126"></a>
작업 타임아웃</h2>
<p><b>증상:</b></p><ul>
<li>작업이 전체 타임아웃 시간 동안 실행된 후 실패</li>
<li><code>error_message()</code>에 타임아웃 언급</li>
</ul>
<p><b>가능한 원인과 해결책:</b></p>
<ol type="1">
<li><p class="startli"><b>핸들러가 너무 오래 걸림</b></p>
<div class="fragment"><div class="line"><span class="comment">// 긴 작업에 대해 타임아웃 증가</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;long.task&quot;</span>)</div>
<div class="line">    .timeout(std::chrono::minutes(30))</div>
<div class="line">    .build();</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>핸들러가 블로킹됨</b></p>
<p class="startli">핸들러가 다음 상태인지 확인:</p><ul>
<li>응답하지 않는 외부 서비스를 대기 중</li>
<li>로직에 데드락이 있음</li>
<li>무한 루프에 빠짐</li>
</ul>
</li>
<li><p class="startli"><b>블로킹 작업 확인</b></p>
<div class="fragment"><div class="line"><span class="comment">// 가능하면 비동기 작업 사용</span></div>
<div class="line"><span class="comment">// 긴 루프에서 취소 확인</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; items.size(); ++i) {</div>
<div class="line">    <span class="keywordflow">if</span> (ctx.is_cancelled()) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(<span class="stringliteral">&quot;취소됨&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    process_item(items[i]);</div>
<div class="line">    ctx.update_progress(<span class="keywordtype">double</span>(i) / items.size(), <span class="stringliteral">&quot;처리 중...&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md2127"></a>
재시도가 작동하지 않음</h2>
<p><b>증상:</b></p><ul>
<li>실패한 작업이 재시도되지 않음</li>
<li>재시도 횟수가 0으로 유지됨</li>
</ul>
<p><b>가능한 원인과 해결책:</b></p>
<ol type="1">
<li><p class="startli"><b>max_retries가 0으로 설정됨</b></p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;retryable.task&quot;</span>)</div>
<div class="line">    .retries(3)  <span class="comment">// 재시도 활성화</span></div>
<div class="line">    .retry_delay(std::chrono::seconds(5))</div>
<div class="line">    .build();</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>재시도 불가능한 에러 반환</b></p>
<p class="startli">일부 에러는 재시도를 건너뛰도록 설정될 수 있습니다. 핸들러가 적절한 에러를 반환하는지 확인하세요.</p>
</li>
<li><p class="startli"><b>작업이 이미 최대 재시도에 도달</b></p>
<div class="fragment"><div class="line"><span class="comment">// 시도 횟수 확인</span></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;시도: &quot;</span> &lt;&lt; t.attempt_count()</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; t.config().max_retries &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md2128"></a>
메모리 사용량 증가</h2>
<p><b>증상:</b></p><ul>
<li>시간이 지남에 따라 프로세스 메모리가 증가</li>
<li>시스템이 느려짐</li>
<li>결국 메모리 부족</li>
</ul>
<p><b>가능한 원인과 해결책:</b></p>
<ol type="1">
<li><p class="startli"><b>결과가 정리되지 않음</b></p>
<div class="fragment"><div class="line"><span class="comment">// 주기적으로 오래된 결과 정리</span></div>
<div class="line">system.results()-&gt;cleanup_expired(std::chrono::hours(24));</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>큐가 무제한 증가</b></p>
<div class="fragment"><div class="line"><span class="comment">// 최대 큐 크기 설정</span></div>
<div class="line">task_queue_config queue_config;</div>
<div class="line">queue_config.max_size = 100000;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>진행 기록 축적</b></p>
<p class="startli">진행 업데이트가 메모리에 저장됩니다. 자주 업데이트되는 매우 긴 작업의 경우 축적될 수 있습니다.</p>
</li>
<li><p class="startli"><b>메모리 오프로드를 위해 영속성 활성화</b></p>
<div class="fragment"><div class="line">task_queue_config queue_config;</div>
<div class="line">queue_config.enable_persistence = <span class="keyword">true</span>;</div>
<div class="line">queue_config.persistence_path = <span class="stringliteral">&quot;/var/lib/task_queue/&quot;</span>;</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md2130"></a>
디버깅 방법</h1>
<h2><a class="anchor" id="autotoc_md2131"></a>
로깅 활성화</h2>
<p>task context를 사용하여 정보 로깅:</p>
<div class="fragment"><div class="line">system.register_handler(<span class="stringliteral">&quot;debug.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;작업 시작: &quot;</span> + t.task_id());</div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;페이로드: &quot;</span> + t.payload().to_string());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... 처리 ...</span></div>
<div class="line"> </div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;작업 성공적으로 완료&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2132"></a>
이벤트 모니터링</h2>
<p>디버깅을 위해 작업 이벤트 구독:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> monitor = system.monitor();</div>
<div class="line"><span class="keywordflow">if</span> (monitor) {</div>
<div class="line">    monitor-&gt;on_task_started([](<span class="keyword">const</span> task&amp; t) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[시작됨] &quot;</span> &lt;&lt; t.task_name()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot; (ID: &quot;</span> &lt;&lt; t.task_id() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    monitor-&gt;on_task_completed([](<span class="keyword">const</span> task&amp; t, <span class="keywordtype">bool</span> success) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; (success ? <span class="stringliteral">&quot;성공&quot;</span> : <span class="stringliteral">&quot;실패&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;] &quot;</span></div>
<div class="line">                  &lt;&lt; t.task_name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    monitor-&gt;on_task_failed([](<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> std::string&amp; error) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[실패] &quot;</span> &lt;&lt; t.task_name()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2133"></a>
큐 상태 확인</h2>
<div class="fragment"><div class="line"><span class="comment">// 큐 통계 가져오기</span></div>
<div class="line"><span class="keyword">auto</span> monitor = system.monitor();</div>
<div class="line"><span class="keywordflow">if</span> (monitor) {</div>
<div class="line">    <span class="keyword">auto</span> stats = monitor-&gt;get_queue_stats();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; q : stats) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;큐 &#39;&quot;</span> &lt;&lt; q.name &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span></div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;대기=&quot;</span> &lt;&lt; q.pending_count</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;, 실행중=&quot;</span> &lt;&lt; q.running_count</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;, 지연=&quot;</span> &lt;&lt; q.delayed_count &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2134"></a>
워커 상태 확인</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> stats = system.get_statistics();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;처리된 작업: &quot;</span> &lt;&lt; stats.total_tasks_processed &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;성공한 작업: &quot;</span> &lt;&lt; stats.total_tasks_succeeded &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;실패한 작업: &quot;</span> &lt;&lt; stats.total_tasks_failed &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;재시도한 작업: &quot;</span> &lt;&lt; stats.total_tasks_retried &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;평균 실행 시간: &quot;</span> &lt;&lt; stats.avg_execution_time.count() &lt;&lt; <span class="stringliteral">&quot;ms\n&quot;</span>;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2135"></a>
작업 로그 보기</h2>
<p>완료된 작업에서 로그 접근:</p>
<div class="fragment"><div class="line"><span class="comment">// 로그는 task_context에 저장됨</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;logging.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;단계 1 완료&quot;</span>);</div>
<div class="line">    ctx.log_warning(<span class="stringliteral">&quot;서비스 응답 느림&quot;</span>);</div>
<div class="line">    ctx.log_error(<span class="stringliteral">&quot;연결 실패, 재시도 중&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 실행 후 로그 사용 가능</span></div>
<div class="line">    <span class="keyword">auto</span> logs = ctx.logs();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : logs) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; entry.timestamp &lt;&lt; <span class="stringliteral">&quot;] &quot;</span></div>
<div class="line">                  &lt;&lt; level_to_string(entry.log_level) &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">                  &lt;&lt; entry.message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2137"></a>
성능 문제</h1>
<h2><a class="anchor" id="autotoc_md2138"></a>
높은 CPU 사용량</h2>
<p><b>가능한 원인:</b></p>
<ol type="1">
<li><p class="startli"><b>워커가 너무 많음</b></p>
<div class="fragment"><div class="line"><span class="comment">// 동시성 줄이기</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.concurrency = std::thread::hardware_concurrency() / 2;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>폴링 간격이 너무 짧음</b></p>
<div class="fragment"><div class="line"><span class="comment">// 폴링 간격 늘리기</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.poll_interval = std::chrono::milliseconds(100);</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>CPU 집약적 핸들러</b></p>
<p class="startli">무거운 계산을 전용 스레드로 이동하거나 작업을 배치로 처리하는 것을 고려하세요.</p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md2139"></a>
높은 메모리 사용량</h2>
<p><b>가능한 원인:</b></p>
<ol type="1">
<li><p class="startli"><b>큐에 큰 페이로드</b></p>
<div class="fragment"><div class="line"><span class="comment">// 큐 크기 제한</span></div>
<div class="line">task_queue_config config;</div>
<div class="line">config.max_size = 10000;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>프리페치된 작업이 너무 많음</b></p>
<div class="fragment"><div class="line"><span class="comment">// 프리페치 수 줄이기</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.prefetch_count = 5;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>결과 축적</b></p>
<div class="fragment"><div class="line"><span class="comment">// 오래된 결과 정리</span></div>
<div class="line">system.results()-&gt;cleanup_expired(std::chrono::hours(1));</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md2140"></a>
낮은 처리량</h2>
<p><b>가능한 원인:</b></p>
<ol type="1">
<li><p class="startli"><b>워커 부족</b></p>
<div class="fragment"><div class="line"><span class="comment">// 동시성 늘리기</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.concurrency = std::thread::hardware_concurrency() * 2;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>핸들러에서 I/O 병목</b></p>
<p class="startli">가능하면 비동기 I/O 또는 배치 작업을 사용하세요.</p>
</li>
<li><p class="startli"><b>프리페치 비활성화</b></p>
<div class="fragment"><div class="line"><span class="comment">// 프리페칭 활성화</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.prefetch = <span class="keyword">true</span>;</div>
<div class="line">config.prefetch_count = 20;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>단일 큐 병목</b></p>
<div class="fragment"><div class="line"><span class="comment">// 여러 큐 사용</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;high&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;low&quot;</span>};</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md2141"></a>
높은 지연 시간</h2>
<p><b>가능한 원인:</b></p>
<ol type="1">
<li><p class="startli"><b>긴 폴링 간격</b></p>
<div class="fragment"><div class="line"><span class="comment">// 폴링 간격 줄이기</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.poll_interval = std::chrono::milliseconds(10);</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>큐 깊이가 너무 높음</b></p>
<p class="startli">큐 깊이를 모니터링하고 과부하 시 워커를 확장하거나 새 작업을 거부하세요.</p>
</li>
<li><p class="startli"><b>프리페치가 작업을 보유</b></p>
<div class="fragment"><div class="line"><span class="comment">// 지연에 민감한 큐에서 프리페치 비활성화</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.prefetch = <span class="keyword">false</span>;</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md2143"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md2144"></a>
Q: 실행 중인 작업을 어떻게 취소하나요?</h2>
<p>작업은 취소할 수 있지만 핸들러가 취소를 확인해야 합니다:</p>
<div class="fragment"><div class="line">system.register_handler(<span class="stringliteral">&quot;cancellable.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keywordflow">while</span> (processing) {</div>
<div class="line">        <span class="keywordflow">if</span> (ctx.is_cancelled()) {</div>
<div class="line">            <span class="comment">// 정리하고 반환</span></div>
<div class="line">            return common::error(<span class="stringliteral">&quot;사용자가 작업 취소함&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// 처리 계속</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 취소 요청</span></div>
<div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;cancellable.task&quot;</span>, payload);</div>
<div class="line">result.revoke();  <span class="comment">// 취소 플래그 설정</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2145"></a>
Q: 핸들러 외부에서 작업 진행 상황을 어떻게 얻나요?</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;long.task&quot;</span>, payload);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 진행 상황 폴링</span></div>
<div class="line"><span class="keywordflow">while</span> (!result.is_ready()) {</div>
<div class="line">    <span class="keywordtype">double</span> progress = result.progress();</div>
<div class="line">    std::string message = result.progress_message();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;진행률: &quot;</span> &lt;&lt; (progress * 100) &lt;&lt; <span class="stringliteral">&quot;% - &quot;</span> &lt;&lt; message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    std::this_thread::sleep_for(std::chrono::seconds(1));</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2146"></a>
Q: 작업 종속성을 어떻게 처리하나요?</h2>
<p>Chain 패턴 사용:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> step1 = task_builder(<span class="stringliteral">&quot;step1&quot;</span>).payload(data).build().value();</div>
<div class="line"><span class="keyword">auto</span> step2 = task_builder(<span class="stringliteral">&quot;step2&quot;</span>).build().value();</div>
<div class="line"><span class="keyword">auto</span> step3 = task_builder(<span class="stringliteral">&quot;step3&quot;</span>).build().value();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> result = client.chain({step1, step2, step3});</div>
<div class="line"><span class="comment">// step2는 step1의 결과를 받고, step3는 step2의 결과를 받음</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2147"></a>
Q: 작업을 순서대로 처리하려면 어떻게 하나요?</h2>
<p>엄격한 순서를 위해 <code>concurrency = 1</code> 설정:</p>
<div class="fragment"><div class="line">worker_config config;</div>
<div class="line">config.concurrency = 1;  <span class="comment">// 단일 워커가 순서 보장</span></div>
<div class="line">config.queues = {<span class="stringliteral">&quot;ordered-queue&quot;</span>};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2148"></a>
Q: 특정 작업의 우선순위를 어떻게 높이나요?</h2>
<p>우선순위 수준과 큐 이름 사용:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> urgent = task_builder(<span class="stringliteral">&quot;urgent.task&quot;</span>)</div>
<div class="line">    .priority(message_priority::highest)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;critical&quot;</span>)</div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> normal = task_builder(<span class="stringliteral">&quot;normal.task&quot;</span>)</div>
<div class="line">    .priority(message_priority::normal)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;default&quot;</span>)</div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// critical 큐를 먼저 처리하도록 워커 설정</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;critical&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;background&quot;</span>};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2149"></a>
Q: 재시도 횟수를 어떻게 제한하나요?</h2>
<p>task_config를 통해 설정:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;limited.retry&quot;</span>)</div>
<div class="line">    .retries(1)  <span class="comment">// 한 번만 재시도</span></div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 또는 재시도 완전히 비활성화</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;no.retry&quot;</span>)</div>
<div class="line">    .retries(0)  <span class="comment">// 재시도 없음</span></div>
<div class="line">    .build();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2150"></a>
Q: 독약 메시지(항상 실패하는 작업)를 어떻게 처리하나요?</h2>
<p><code>on_failure</code> 훅을 사용하여 실패 추적:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>monitored_handler : <span class="keyword">public</span> task_handler_interface {</div>
<div class="line">    std::unordered_map&lt;std::string, size_t&gt; failure_counts_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> on_failure(<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> std::string&amp; error)<span class="keyword"> override </span>{</div>
<div class="line">        failure_counts_[t.task_name()]++;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (failure_counts_[t.task_name()] &gt; 10) {</div>
<div class="line">            <span class="comment">// 데드 레터 큐로 이동하거나 알림</span></div>
<div class="line">            log_alert(<span class="stringliteral">&quot;작업 &quot;</span> + t.task_name() + <span class="stringliteral">&quot; 반복적으로 실패 중&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2151"></a>
Q: 시스템을 우아하게 종료하려면 어떻게 하나요?</h2>
<div class="fragment"><div class="line"><span class="comment">// 우아한 종료는 현재 작업이 완료될 때까지 대기</span></div>
<div class="line">system.shutdown_graceful(std::chrono::seconds(30));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 이것은:</span></div>
<div class="line"><span class="comment">// 1. 새 작업 수락 중지</span></div>
<div class="line"><span class="comment">// 2. 실행 중인 작업이 완료될 때까지 최대 30초 대기</span></div>
<div class="line"><span class="comment">// 3. 타임아웃에 도달하면 강제 중지</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2153"></a>
관련 문서</h1>
<ul>
<li><a class="el" href="../../da/dee/md_docs_2task_2QUICK__START__KO.html">빠른 시작 가이드</a></li>
<li><a class="el" href="../../d9/db8/md_docs_2task_2ARCHITECTURE__KO.html">아키텍처 가이드</a></li>
<li><a class="el" href="../../dd/db9/md_docs_2task_2API__REFERENCE__KO.html">API 레퍼런스</a></li>
<li><a class="el" href="../../dd/d35/md_docs_2task_2PATTERNS__KO.html">패턴 가이드</a></li>
<li><a class="el" href="../../d4/de7/md_docs_2task_2CONFIGURATION__KO.html">설정 가이드</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
