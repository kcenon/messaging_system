<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Task Module Architecture</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d1/d5e/md_docs_2task_2ARCHITECTURE.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Task Module Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1717"></a> This document describes the architecture and design of the Task module.</p>
<h1><a class="anchor" id="autotoc_md1718"></a>
Overview</h1>
<p>The Task module provides a distributed task queue system for asynchronous task execution. It is designed for reliability, scalability, and ease of use.</p>
<h1><a class="anchor" id="autotoc_md1719"></a>
System Architecture</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                          task_system (Facade)                        │</div>
<div class="line">├─────────────────────────────────────────────────────────────────────┤</div>
<div class="line">│                                                                      │</div>
<div class="line">│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────────┐  │</div>
<div class="line">│  │ task_client │    │ task_queue  │    │      worker_pool        │  │</div>
<div class="line">│  │             │───▶│             │───▶│                         │  │</div>
<div class="line">│  │ Submit API  │    │ Task Store  │    │ ┌─────────────────────┐ │  │</div>
<div class="line">│  └─────────────┘    └─────────────┘    │ │   task_handler(s)   │ │  │</div>
<div class="line">│         │                   ▲          │ └─────────────────────┘ │  │</div>
<div class="line">│         │                   │          │           │             │  │</div>
<div class="line">│         ▼                   │          │           ▼             │  │</div>
<div class="line">│  ┌─────────────┐            │          │ ┌─────────────────────┐ │  │</div>
<div class="line">│  │async_result │            │          │ │   task_context      │ │  │</div>
<div class="line">│  └─────────────┘            │          │ └─────────────────────┘ │  │</div>
<div class="line">│         │                   │          └─────────────────────────┘  │</div>
<div class="line">│         │                   │                      │                │</div>
<div class="line">│         ▼                   │                      ▼                │</div>
<div class="line">│  ┌─────────────────────────────────────────────────────────────┐   │</div>
<div class="line">│  │                     result_backend                           │   │</div>
<div class="line">│  │                (memory_result_backend)                       │   │</div>
<div class="line">│  └─────────────────────────────────────────────────────────────┘   │</div>
<div class="line">│                                                                      │</div>
<div class="line">│  ┌──────────────────┐              ┌──────────────────┐            │</div>
<div class="line">│  │  task_scheduler  │              │   task_monitor   │            │</div>
<div class="line">│  │                  │              │                  │            │</div>
<div class="line">│  │ Periodic/Cron    │              │ Stats &amp; Events   │            │</div>
<div class="line">│  └──────────────────┘              └──────────────────┘            │</div>
<div class="line">│                                                                      │</div>
<div class="line">└─────────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1720"></a>
Core Components</h1>
<h2><a class="anchor" id="autotoc_md1721"></a>
1. task_system (Facade)</h2>
<p>The <code>task_system</code> is the main entry point that integrates all components. It provides:</p>
<ul>
<li>Unified lifecycle management (start/stop)</li>
<li>Convenience methods for common operations</li>
<li>Access to individual components when needed</li>
</ul>
<div class="fragment"><div class="line">task_system system(config);</div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;task.name&quot;</span>, handler);</div>
<div class="line">system.start();</div>
<div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;task.name&quot;</span>, payload);</div>
<div class="line">system.stop();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1722"></a>
2. task</h2>
<p>The <code>task</code> class represents a unit of work. It extends the <code>message</code> class from the messaging infrastructure.</p>
<p><b>Key Properties:</b></p><ul>
<li><code>task_id</code>: Unique identifier (UUID)</li>
<li><code>task_name</code>: Handler name to execute</li>
<li><code>payload</code>: Input data (value_container)</li>
<li><code>config</code>: Execution configuration</li>
<li><code>state</code>: Current lifecycle state</li>
</ul>
<p><b>Task States:</b></p>
<div class="fragment"><div class="line">                 ┌──────────────────────────────────────────────────┐</div>
<div class="line">                 │                                                  │</div>
<div class="line">                 ▼                                                  │</div>
<div class="line">┌─────────┐   ┌────────┐   ┌─────────┐   ┌───────────┐   ┌─────────┴───┐</div>
<div class="line">│ PENDING │──▶│ QUEUED │──▶│ RUNNING │──▶│ SUCCEEDED │   │   RETRYING  │</div>
<div class="line">└─────────┘   └────────┘   └────┬────┘   └───────────┘   └─────────────┘</div>
<div class="line">                 │              │                              ▲</div>
<div class="line">                 │              ▼                              │</div>
<div class="line">                 │        ┌──────────┐                         │</div>
<div class="line">                 │        │  FAILED  │─────────────────────────┘</div>
<div class="line">                 │        └────┬─────┘        (if retries left)</div>
<div class="line">                 │             │</div>
<div class="line">                 │             ▼ (no retries)</div>
<div class="line">                 │        ┌──────────┐</div>
<div class="line">                 │        │  FAILED  │ (terminal)</div>
<div class="line">                 │        └──────────┘</div>
<div class="line">                 │</div>
<div class="line">                 ▼</div>
<div class="line">           ┌───────────┐        ┌──────────┐</div>
<div class="line">           │ CANCELLED │        │ EXPIRED  │</div>
<div class="line">           └───────────┘        └──────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1723"></a>
3. task_queue</h2>
<p>The <code>task_queue</code> manages multiple named queues with priority support.</p>
<p><b>Features:</b></p><ul>
<li>Multiple named queues (e.g., "default", "high-priority")</li>
<li>Delayed task scheduling using ETA</li>
<li>Task cancellation by ID or tag</li>
<li>Thread-safe operations</li>
</ul>
<p><b>Data Flow:</b></p>
<div class="fragment"><div class="line">┌──────────────────────────────────────────────────────────┐</div>
<div class="line">│                       task_queue                          │</div>
<div class="line">├──────────────────────────────────────────────────────────┤</div>
<div class="line">│                                                          │</div>
<div class="line">│   ┌─────────────────────────────────────────────────┐   │</div>
<div class="line">│   │              Immediate Queues                    │   │</div>
<div class="line">│   │  ┌─────────┐  ┌─────────┐  ┌─────────────────┐  │   │</div>
<div class="line">│   │  │ default │  │  high   │  │ custom-queue    │  │   │</div>
<div class="line">│   │  │ queue   │  │priority │  │                 │  │   │</div>
<div class="line">│   │  └─────────┘  └─────────┘  └─────────────────┘  │   │</div>
<div class="line">│   └─────────────────────────────────────────────────┘   │</div>
<div class="line">│                          ▲                               │</div>
<div class="line">│                          │ (when ETA reached)           │</div>
<div class="line">│   ┌─────────────────────────────────────────────────┐   │</div>
<div class="line">│   │              Delayed Queue                       │   │</div>
<div class="line">│   │  Tasks waiting for their scheduled time          │   │</div>
<div class="line">│   └─────────────────────────────────────────────────┘   │</div>
<div class="line">│                                                          │</div>
<div class="line">└──────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1724"></a>
4. worker_pool</h2>
<p>The <code>worker_pool</code> executes tasks using a thread pool.</p>
<p><b>Responsibilities:</b></p><ul>
<li>Manage worker threads</li>
<li>Fetch tasks from queues</li>
<li>Match tasks to registered handlers</li>
<li>Handle retries with exponential backoff</li>
<li>Collect execution statistics</li>
</ul>
<p><b>Execution Flow:</b></p>
<div class="fragment"><div class="line">┌────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                         worker_pool                             │</div>
<div class="line">├────────────────────────────────────────────────────────────────┤</div>
<div class="line">│                                                                 │</div>
<div class="line">│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │</div>
<div class="line">│   │Worker 1 │  │Worker 2 │  │Worker 3 │  │Worker N │          │</div>
<div class="line">│   └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘          │</div>
<div class="line">│        │            │            │            │                │</div>
<div class="line">│        └────────────┴─────┬──────┴────────────┘                │</div>
<div class="line">│                           │                                    │</div>
<div class="line">│                           ▼                                    │</div>
<div class="line">│                  ┌────────────────┐                            │</div>
<div class="line">│                  │ Dequeue Task   │◀───── task_queue           │</div>
<div class="line">│                  └───────┬────────┘                            │</div>
<div class="line">│                          │                                     │</div>
<div class="line">│                          ▼                                     │</div>
<div class="line">│                  ┌────────────────┐                            │</div>
<div class="line">│                  │ Find Handler   │                            │</div>
<div class="line">│                  └───────┬────────┘                            │</div>
<div class="line">│                          │                                     │</div>
<div class="line">│                          ▼                                     │</div>
<div class="line">│                  ┌────────────────┐                            │</div>
<div class="line">│                  │ Execute Task   │                            │</div>
<div class="line">│                  └───────┬────────┘                            │</div>
<div class="line">│                          │                                     │</div>
<div class="line">│              ┌───────────┼───────────┐                         │</div>
<div class="line">│              ▼           ▼           ▼                         │</div>
<div class="line">│         ┌────────┐  ┌────────┐  ┌────────┐                    │</div>
<div class="line">│         │Success │  │ Retry  │  │ Failed │                    │</div>
<div class="line">│         └───┬────┘  └───┬────┘  └───┬────┘                    │</div>
<div class="line">│             │           │           │                          │</div>
<div class="line">│             └───────────┴───────────┘                          │</div>
<div class="line">│                         │                                      │</div>
<div class="line">│                         ▼                                      │</div>
<div class="line">│                  result_backend                                │</div>
<div class="line">│                                                                │</div>
<div class="line">└────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1725"></a>
5. task_handler</h2>
<p>The <code>task_handler_interface</code> defines how tasks are executed.</p>
<p><b>Interface:</b></p>
<div class="fragment"><div class="line"><span class="keyword">class </span>task_handler_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> std::string name() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::Result&lt;value_container&gt; execute(</div>
<div class="line">        <span class="keyword">const</span> task&amp; t,</div>
<div class="line">        task_context&amp; ctx) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Optional lifecycle hooks</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_retry(<span class="keyword">const</span> task&amp; t, <span class="keywordtype">size_t</span> attempt) { }</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_failure(<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> std::string&amp; error) { }</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_success(<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> value_container&amp; result) { }</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Handler Types:</b></p><ul>
<li>Class-based: Inherit from <code>task_handler_interface</code></li>
<li>Lambda-based: Use <code>make_handler()</code> or register directly</li>
</ul>
<h2><a class="anchor" id="autotoc_md1726"></a>
6. task_context</h2>
<p>The <code>task_context</code> provides execution context to handlers.</p>
<p><b>Features:</b></p><ul>
<li>Progress tracking and reporting</li>
<li>Checkpoint management for recovery</li>
<li>Subtask spawning</li>
<li>Cancellation detection</li>
<li>Logging</li>
</ul>
<div class="fragment"><div class="line">common::Result&lt;value_container&gt; execute(<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="comment">// Update progress</span></div>
<div class="line">    ctx.update_progress(0.0, <span class="stringliteral">&quot;Starting...&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check for cancellation</span></div>
<div class="line">    <span class="keywordflow">if</span> (ctx.is_cancelled()) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(<span class="stringliteral">&quot;Cancelled&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Save checkpoint for recovery</span></div>
<div class="line">    ctx.save_checkpoint({{<span class="stringliteral">&quot;step&quot;</span>, current_step}});</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Spawn subtask</span></div>
<div class="line">    ctx.spawn_subtask(subtask);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Log information</span></div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;Processing complete&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1727"></a>
7. result_backend</h2>
<p>The <code>result_backend_interface</code> provides storage for task results.</p>
<p><b>Implementations:</b></p><ul>
<li><code>memory_result_backend</code>: In-memory storage (default)</li>
<li>Custom implementations possible (Redis, database, etc.)</li>
</ul>
<p><b>Stored Data:</b></p><ul>
<li>Task state</li>
<li>Task result</li>
<li>Error information</li>
<li>Progress data</li>
</ul>
<h2><a class="anchor" id="autotoc_md1728"></a>
8. async_result</h2>
<p>The <code>async_result</code> provides a handle for tracking task execution.</p>
<p><b>Usage Patterns:</b></p>
<div class="fragment"><div class="line"><span class="comment">// Polling</span></div>
<div class="line"><span class="keywordflow">while</span> (!result.is_ready()) {</div>
<div class="line">    std::cout &lt;&lt; result.progress() &lt;&lt; <span class="stringliteral">&quot;%\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Blocking wait</span></div>
<div class="line"><span class="keyword">auto</span> outcome = result.get(timeout);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Callback-based</span></div>
<div class="line">result.then(</div>
<div class="line">    [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; value) { <span class="comment">/* success */</span> },</div>
<div class="line">    [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; error) { <span class="comment">/* failure */</span> }</div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1729"></a>
9. task_scheduler</h2>
<p>The <code>task_scheduler</code> manages periodic and cron-based task execution.</p>
<p><b>Schedule Types:</b></p><ul>
<li>Periodic: Fixed interval (e.g., every 5 minutes)</li>
<li>Cron: Cron expression (e.g., "0 3 * * *" for daily at 3 AM)</li>
</ul>
<div class="fragment"><div class="line">┌────────────────────────────────────────┐</div>
<div class="line">│            task_scheduler               │</div>
<div class="line">├────────────────────────────────────────┤</div>
<div class="line">│                                         │</div>
<div class="line">│  ┌───────────────────────────────────┐ │</div>
<div class="line">│  │         Schedule Registry          │ │</div>
<div class="line">│  │                                    │ │</div>
<div class="line">│  │  ┌────────────────────────────┐   │ │</div>
<div class="line">│  │  │ cleanup-job (periodic: 5m) │   │ │</div>
<div class="line">│  │  ├────────────────────────────┤   │ │</div>
<div class="line">│  │  │ daily-report (cron: 0 3 *) │   │ │</div>
<div class="line">│  │  ├────────────────────────────┤   │ │</div>
<div class="line">│  │  │ weekly-summary (cron: ...)  │   │ │</div>
<div class="line">│  │  └────────────────────────────┘   │ │</div>
<div class="line">│  └───────────────────────────────────┘ │</div>
<div class="line">│                    │                    │</div>
<div class="line">│                    ▼                    │</div>
<div class="line">│           ┌────────────────┐           │</div>
<div class="line">│           │ Scheduler Loop │           │</div>
<div class="line">│           │ (check times)  │           │</div>
<div class="line">│           └───────┬────────┘           │</div>
<div class="line">│                   │                    │</div>
<div class="line">│                   ▼                    │</div>
<div class="line">│            task_client.send()          │</div>
<div class="line">│                                         │</div>
<div class="line">└────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1730"></a>
10. task_monitor</h2>
<p>The <code>task_monitor</code> provides observability into the system.</p>
<p><b>Features:</b></p><ul>
<li>Queue statistics</li>
<li>Worker status</li>
<li>Active/pending/failed task listings</li>
<li>Event subscriptions</li>
</ul>
<h1><a class="anchor" id="autotoc_md1731"></a>
Data Flow</h1>
<h2><a class="anchor" id="autotoc_md1732"></a>
Task Submission Flow</h2>
<div class="fragment"><div class="line">1. Client creates task with payload</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">2. task_client.send(task)</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">3. task_queue.enqueue(task)</div>
<div class="line">   - Assign task_id if not set</div>
<div class="line">   - Check for delayed execution (ETA)</div>
<div class="line">   - Add to appropriate queue</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">4. async_result returned to client</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">5. Worker dequeues task</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">6. Worker finds matching handler</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">7. Handler executes with task_context</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">8. Result stored in result_backend</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">9. async_result.get() returns result</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1733"></a>
Retry Flow</h2>
<div class="fragment"><div class="line">1. Task execution fails</div>
<div class="line">         │</div>
<div class="line">         ▼</div>
<div class="line">2. Check retry policy</div>
<div class="line">   - attempts &lt; max_retries?</div>
<div class="line">         │</div>
<div class="line">    ┌────┴────┐</div>
<div class="line">    │         │</div>
<div class="line">   Yes        No</div>
<div class="line">    │         │</div>
<div class="line">    ▼         ▼</div>
<div class="line">3a. Calculate   3b. Mark as</div>
<div class="line">    retry delay     FAILED</div>
<div class="line">    │               │</div>
<div class="line">    ▼               ▼</div>
<div class="line">4a. Set state   4b. Store error</div>
<div class="line">    to RETRYING     in backend</div>
<div class="line">    │</div>
<div class="line">    ▼</div>
<div class="line">5a. Re-queue with delay</div>
<div class="line">    │</div>
<div class="line">    ▼</div>
<div class="line">6a. Worker picks up again</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1734"></a>
Thread Safety</h1>
<p>All public APIs are thread-safe:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Thread Safety Mechanism    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">task_queue   </td><td class="markdownTableBodyNone">Mutex-protected internal state, thread_system integration    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">worker_pool   </td><td class="markdownTableBodyNone">Concurrent worker execution    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">async_result   </td><td class="markdownTableBodyNone">Atomic state + condition variables    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">task_context   </td><td class="markdownTableBodyNone">Atomic progress updates    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">memory_result_backend   </td><td class="markdownTableBodyNone">shared_mutex for R/W locking    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">task_scheduler   </td><td class="markdownTableBodyNone">Mutex-protected schedules   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md1735"></a>
thread_system Integration</h2>
<p>Both <code>task_queue</code> and <code>worker_pool</code> components use <code>thread_system</code> for thread management. Instead of direct <code>std::thread</code> usage, they leverage <code>kcenon::thread::thread_base</code> which provides:</p>
<ul>
<li>Standardized thread lifecycle management (start/stop)</li>
<li>Proper wake interval handling for periodic tasks</li>
<li>Consistent thread naming and monitoring</li>
<li>Integration with the project's threading infrastructure</li>
</ul>
<p><b>task_queue</b>: Uses <code>thread_base</code> for the delayed task worker thread that processes scheduled tasks.</p>
<p><b>worker_pool</b>: Uses <code>thread_base</code> through the <code>task_pool_worker</code> class. Each worker thread inherits from <code>thread_base</code>, delegating thread lifecycle management to <code>thread_system</code>. This replaces direct <code>std::thread</code> usage with:</p><ul>
<li><code>task_pool_worker::do_work()</code> for per-task processing</li>
<li><code>task_pool_worker::should_continue_work()</code> for shutdown coordination</li>
<li>Automatic wake interval configuration matching the pool's poll interval</li>
</ul>
<p><b>task_scheduler</b>: Uses <code>thread_base</code> through the <code>scheduler_worker</code> class. The scheduler's background thread inherits from <code>thread_base</code>, providing:</p><ul>
<li><code>scheduler_worker::do_work()</code> for checking and executing due schedules</li>
<li><code>scheduler_worker::should_continue_work()</code> for graceful shutdown</li>
<li>Condition variable integration for immediate wake-up on schedule changes</li>
<li>Consistent thread lifecycle management with other components</li>
</ul>
<h1><a class="anchor" id="autotoc_md1736"></a>
Extension Points</h1>
<h2><a class="anchor" id="autotoc_md1737"></a>
Custom Result Backend</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>redis_result_backend : <span class="keyword">public</span> result_backend_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    common::VoidResult store_result(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; task_id,</div>
<div class="line">        <span class="keyword">const</span> value_container&amp; result)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Store in Redis</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;value_container&gt; get_result(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; task_id)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Fetch from Redis</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... implement other methods</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1738"></a>
Custom Task Handler</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>custom_handler : <span class="keyword">public</span> task_handler_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    std::string name()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;custom.task&quot;</span>; }</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;value_container&gt; execute(</div>
<div class="line">        <span class="keyword">const</span> task&amp; t,</div>
<div class="line">        task_context&amp; ctx)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Implementation</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_retry(<span class="keyword">const</span> task&amp; t, <span class="keywordtype">size_t</span> attempt)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Custom retry logic</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1739"></a>
Design Decisions</h1>
<h2><a class="anchor" id="autotoc_md1740"></a>
1. Message-Based Tasks</h2>
<p>Tasks extend the <code>message</code> class to leverage existing messaging infrastructure for serialization and metadata handling.</p>
<h2><a class="anchor" id="autotoc_md1741"></a>
2. Result Type Pattern</h2>
<p>All operations return <code>Result&lt;T&gt;</code> or <code>VoidResult</code> for explicit error handling without exceptions.</p>
<h2><a class="anchor" id="autotoc_md1742"></a>
3. Builder Pattern</h2>
<p>The <code>task_builder</code> provides a fluent API for constructing tasks with complex configurations.</p>
<h2><a class="anchor" id="autotoc_md1743"></a>
4. Facade Pattern</h2>
<p><code>task_system</code> acts as a facade, simplifying the interface while allowing access to individual components.</p>
<h2><a class="anchor" id="autotoc_md1744"></a>
5. Strategy Pattern</h2>
<p><code>result_backend_interface</code> allows different storage strategies to be swapped without changing the core logic.</p>
<h1><a class="anchor" id="autotoc_md1745"></a>
Testing</h1>
<p>The task module has comprehensive integration tests located in <code>integration_tests/task/</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Test File   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>test_task_lifecycle.cpp</code>   </td><td class="markdownTableBodyNone">Full task lifecycle from submission to completion    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>test_worker_scenarios.cpp</code>   </td><td class="markdownTableBodyNone">Multiple workers, concurrency, handler matching    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>test_failure_recovery.cpp</code>   </td><td class="markdownTableBodyNone">Retry mechanisms, timeout handling, error propagation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>test_scheduling.cpp</code>   </td><td class="markdownTableBodyNone">Periodic and cron-based task scheduling    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>test_concurrent_load.cpp</code>   </td><td class="markdownTableBodyNone">High volume processing, throughput measurement   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md1746"></a>
Running Tests</h2>
<div class="fragment"><div class="line"># Build tests</div>
<div class="line">cmake --build build --target test_task_lifecycle test_worker_scenarios \</div>
<div class="line">    test_failure_recovery test_scheduling test_concurrent_load</div>
<div class="line"> </div>
<div class="line"># Run all task integration tests</div>
<div class="line">ctest --test-dir build -R &quot;test_(task_lifecycle|worker_scenarios|failure_recovery|scheduling|concurrent_load)&quot;</div>
<div class="line"> </div>
<div class="line"># Run specific test</div>
<div class="line">./build/integration_tests/test_task_lifecycle</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1747"></a>
Related Documentation</h1>
<ul>
<li><a class="el" href="../../d9/dff/md_docs_2task_2QUICK__START.html">Quick Start Guide</a></li>
<li><a class="el" href="../../df/d18/md_docs_2task_2API__REFERENCE.html">API Reference</a></li>
<li><a class="el" href="../../d5/dd2/md_docs_2task_2PATTERNS.html">Patterns Guide</a></li>
<li><a class="el" href="../../dc/d1e/md_docs_2task_2CONFIGURATION.html">Configuration Guide</a></li>
<li><a class="el" href="../../dd/df5/md_docs_2task_2TROUBLESHOOTING.html">Troubleshooting</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
