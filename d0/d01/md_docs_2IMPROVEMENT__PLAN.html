<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Messaging System Improvement Plan</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d0/d01/md_docs_2IMPROVEMENT__PLAN.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Messaging System Improvement Plan</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md366"></a> <b>Version</b>: 2.0 <b>Date</b>: 2025-11-16 <b>Status</b>: In Progress - Phase 8 Complete <b>Last Updated</b>: 2025-11-17</p>
<h1><a class="anchor" id="autotoc_md367"></a>
Progress Overview</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Phase   </th><th class="markdownTableHeadNone">Status   </th><th class="markdownTableHeadNone">Completion Date   </th><th class="markdownTableHeadNone">Branch    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Phase 1: Foundation   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-16   </td><td class="markdownTableBodyNone">feature/phase-1-foundation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Phase 2: Core Message Types   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-16   </td><td class="markdownTableBodyNone">feature/phase-2-core-message-types    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Phase 3: Message Queue   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-16   </td><td class="markdownTableBodyNone">feature/phase-3-message-queue    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Phase 4: Backend Pattern   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-17   </td><td class="markdownTableBodyNone">feature/phase-4-backend-pattern    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Phase 5: Topic Router   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-17   </td><td class="markdownTableBodyNone">feature/phase-5-topic-router    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Phase 6: Message Bus   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-17   </td><td class="markdownTableBodyNone">feature/phase-6-message-bus    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Phase 7: DI Container   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-17   </td><td class="markdownTableBodyNone">feature/phase-7-di-container    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Phase 8: Messaging Patterns   </td><td class="markdownTableBodyNone">âœ… Complete   </td><td class="markdownTableBodyNone">2025-11-17   </td><td class="markdownTableBodyNone">feature/phase-8-messaging-patterns    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Phase 9-10: Testing &amp; Docs   </td><td class="markdownTableBodyNone">ğŸ”„ In Progress   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">feature/phase-9-testing-docs   </td></tr>
</table>
<p><b>Overall Progress</b>: 8.5/10 phases complete (85% - Pattern tests added)</p>
<h1><a class="anchor" id="autotoc_md368"></a>
Executive Summary</h1>
<p>This document outlines a comprehensive plan to restructure the messaging_system to align with the architectural patterns established in other system modules (common_system, thread_system, logger_system, monitoring_system). The goal is to create a consistent, maintainable, and production-ready messaging infrastructure.</p>
<h1><a class="anchor" id="autotoc_md369"></a>
Table of Contents</h1>
<ol type="1">
<li>Current State Analysis</li>
<li>Identified Issues</li>
<li>Improvement Objectives</li>
<li>Target Architecture</li>
<li>Implementation Plan</li>
<li>Migration Strategy</li>
<li>Testing Strategy</li>
<li>Timeline and Milestones</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md371"></a>
Current State Analysis</h1>
<h2><a class="anchor" id="autotoc_md372"></a>
Existing Directory Structure</h2>
<div class="fragment"><div class="line">messaging_system/</div>
<div class="line">â”œâ”€â”€ include/messaging_system/          # Legacy structure</div>
<div class="line">â”‚   â”œâ”€â”€ core/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_bus.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ topic_router.h</div>
<div class="line">â”‚   â”‚   â””â”€â”€ messaging_container.h</div>
<div class="line">â”‚   â”œâ”€â”€ integration/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ trace_context.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ config_loader.h</div>
<div class="line">â”‚   â”‚   â””â”€â”€ network_bridge.h</div>
<div class="line">â”‚   â””â”€â”€ error_codes.h                  # âŒ Conflicts with centralized codes</div>
<div class="line">â”‚</div>
<div class="line">â”œâ”€â”€ application_layer/include/kcenon/messaging/  # âŒ Duplicate structure</div>
<div class="line">â”‚   â”œâ”€â”€ core/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_bus.h</div>
<div class="line">â”‚   â”‚   â””â”€â”€ message_types.h</div>
<div class="line">â”‚   â”œâ”€â”€ cluster/</div>
<div class="line">â”‚   â”œâ”€â”€ routing/</div>
<div class="line">â”‚   â”œâ”€â”€ security/</div>
<div class="line">â”‚   â””â”€â”€ services/</div>
<div class="line">â”‚</div>
<div class="line">â””â”€â”€ src/</div>
<div class="line">    â”œâ”€â”€ core/</div>
<div class="line">    â””â”€â”€ integration/</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md373"></a>
Current Capabilities</h2>
<p><b>Strengths</b>:</p><ul>
<li>âœ… Uses <code>Result&lt;T&gt;</code> pattern from common_system</li>
<li>âœ… Integrates with container_system for message payloads</li>
<li>âœ… Basic pub/sub implementation (TopicRouter)</li>
<li>âœ… Message bus with async capabilities</li>
<li>âœ… Topic pattern matching (wildcards)</li>
</ul>
<p><b>Weaknesses</b>:</p><ul>
<li>âŒ Error codes conflict with logger_system (-200 to -299)</li>
<li>âŒ No DI container pattern</li>
<li>âŒ No backend abstraction (standalone vs integration)</li>
<li>âŒ Missing integration detection</li>
<li>âŒ No unified adapter pattern</li>
<li>âŒ Inconsistent directory structure with other systems</li>
<li>âŒ Duplicate code between include/ and application_layer/</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md375"></a>
Identified Issues</h1>
<h2><a class="anchor" id="autotoc_md376"></a>
1. Error Code Range Conflict</h2>
<p><b>Problem</b>: messaging_system uses error codes -200 to -299, which conflicts with logger_system.</p>
<p><b>Current</b>: </p><div class="fragment"><div class="line"><span class="comment">// messaging_system/include/messaging_system/error_codes.h</span></div>
<div class="line"><span class="keyword">namespace </span>messaging::error {</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> INVALID_MESSAGE = -200;  <span class="comment">// âŒ Conflicts with logger_system</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> ROUTING_FAILED = -201;</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Impact</b>: Build failures when both systems are integrated.</p>
<h2><a class="anchor" id="autotoc_md377"></a>
2. Directory Structure Inconsistency</h2>
<p><b>Problem</b>: Other systems follow <code>kcenon/{system}/</code> pattern in include/, but messaging_system has both <code>messaging_system/</code> and <code>kcenon/messaging/</code>.</p>
<p><b>Reference Pattern</b> (from logger_system, thread_system): </p><div class="fragment"><div class="line">include/kcenon/{system}/</div>
<div class="line">â”œâ”€â”€ core/</div>
<div class="line">â”œâ”€â”€ interfaces/</div>
<div class="line">â”œâ”€â”€ adapters/</div>
<div class="line">â”œâ”€â”€ backends/</div>
<div class="line">â””â”€â”€ utils/</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md378"></a>
3. Missing Architectural Patterns</h2>
<p><b>Missing from messaging_system</b> but present in other systems:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pattern   </th><th class="markdownTableHeadNone">logger_system   </th><th class="markdownTableHeadNone">monitoring_system   </th><th class="markdownTableHeadNone">messaging_system    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DI Container   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âŒ    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Backend Abstraction   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âŒ    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Integration Detection   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âŒ    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Adapter Pattern   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âŒ    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Builder Pattern   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âŒ   </td><td class="markdownTableBodyNone">âŒ    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Interface Segregation   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âœ…   </td><td class="markdownTableBodyNone">âš ï¸ Partial   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md379"></a>
4. Lack of Interface Definitions</h2>
<p><b>Problem</b>: No dedicated <code>interfaces/</code> directory for clean abstraction.</p>
<p><b>Needed Interfaces</b>:</p><ul>
<li><code>message_handler_interface.h</code> - Message processing abstraction</li>
<li><code>message_router_interface.h</code> - Routing abstraction</li>
<li><code>publisher_interface.h</code> - Publishing abstraction</li>
<li><code>subscriber_interface.h</code> - Subscription abstraction</li>
<li><code>message_broker_interface.h</code> - Broker abstraction</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md381"></a>
Improvement Objectives</h1>
<h2><a class="anchor" id="autotoc_md382"></a>
Primary Goals</h2>
<ol type="1">
<li><b>Consistency</b>: Align with established patterns in common_system, thread_system, logger_system</li>
<li><b>Modularity</b>: Clear separation of concerns with well-defined interfaces</li>
<li><b>Flexibility</b>: Support standalone, integrated, and distributed modes</li>
<li><b>Performance</b>: Lock-free queues, efficient routing, minimal overhead</li>
<li><b>Reliability</b>: Comprehensive error handling, Result&lt;T&gt; pattern throughout</li>
<li><b>Observability</b>: Deep integration with logger_system and monitoring_system</li>
</ol>
<h2><a class="anchor" id="autotoc_md383"></a>
Secondary Goals</h2>
<ol type="1">
<li>Backward compatibility layer for existing code</li>
<li>Comprehensive documentation</li>
<li>Rich example suite</li>
<li>Performance benchmarks</li>
<li>Integration tests with all dependent systems</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md385"></a>
Target Architecture</h1>
<h2><a class="anchor" id="autotoc_md386"></a>
Directory Structure (New)</h2>
<div class="fragment"><div class="line">messaging_system/</div>
<div class="line">â”œâ”€â”€ include/kcenon/messaging/</div>
<div class="line">â”‚   â”œâ”€â”€ core/                          # Core messaging components</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message.h                  # Message structure</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_bus.h              # Central message hub</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_broker.h           # Message brokering logic</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_queue.h            # Queue implementation</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ topic_router.h             # Topic-based routing</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ subscription_manager.h     # Subscription lifecycle</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_serializer.h       # Serialization utilities</div>
<div class="line">â”‚   â”‚   â””â”€â”€ error_codes.h              # Forward to common_system</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ interfaces/                    # Abstract interfaces</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_handler_interface.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_router_interface.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ publisher_interface.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ subscriber_interface.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_broker_interface.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ queue_interface.h</div>
<div class="line">â”‚   â”‚   â””â”€â”€ serializer_interface.h</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ adapters/                      # System integration adapters</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ common_system_adapter.h    # common_system types</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ thread_pool_adapter.h      # thread_system executor</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ logger_adapter.h           # logger_system integration</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ monitoring_adapter.h       # monitoring_system integration</div>
<div class="line">â”‚   â”‚   â””â”€â”€ container_adapter.h        # container_system messages</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ backends/                      # Execution backends</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ backend_interface.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ standalone_backend.h       # Independent operation</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ integration_backend.h      # Full system integration</div>
<div class="line">â”‚   â”‚   â””â”€â”€ distributed_backend.h      # Cluster/distributed mode</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ patterns/                      # Messaging patterns</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ pub_sub.h                  # Publish-Subscribe pattern</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ request_reply.h            # Request-Reply pattern</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ event_streaming.h          # Event sourcing/streaming</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_pipeline.h         # Message processing pipeline</div>
<div class="line">â”‚   â”‚   â””â”€â”€ saga_coordinator.h         # Distributed transactions</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ reliability/                   # Reliability features</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ retry_policy.h             # Retry strategies</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ circuit_breaker.h          # Circuit breaker pattern</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ dead_letter_queue.h        # Failed message handling</div>
<div class="line">â”‚   â”‚   â””â”€â”€ message_persistence.h      # Durable messaging</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ routing/                       # Advanced routing</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ topic_matcher.h            # Pattern matching</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ content_router.h           # Content-based routing</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ routing_table.h            # Routing rules</div>
<div class="line">â”‚   â”‚   â””â”€â”€ load_balancer.h            # Message distribution</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ security/                      # Security features</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_validator.h        # Message validation</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ access_control.h           # Authorization</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ encryption.h               # Message encryption</div>
<div class="line">â”‚   â”‚   â””â”€â”€ signature.h                # Message signing</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ monitoring/                    # Observability</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_metrics.h          # Metrics collection</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_tracer.h           # Distributed tracing</div>
<div class="line">â”‚   â”‚   â””â”€â”€ health_monitor.h           # System health</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â”œâ”€â”€ utils/                         # Utilities</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_id_generator.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ timestamp_provider.h</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ compression.h</div>
<div class="line">â”‚   â”‚   â””â”€â”€ thread_integration_detector.h</div>
<div class="line">â”‚   â”‚</div>
<div class="line">â”‚   â””â”€â”€ compatibility.h                # Backward compatibility</div>
<div class="line">â”‚</div>
<div class="line">â”œâ”€â”€ src/impl/                          # Implementation details</div>
<div class="line">â”‚   â”œâ”€â”€ core/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_bus_impl.cpp</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ message_broker_impl.cpp</div>
<div class="line">â”‚   â”‚   â””â”€â”€ message_queue_impl.cpp</div>
<div class="line">â”‚   â”œâ”€â”€ adapters/</div>
<div class="line">â”‚   â”œâ”€â”€ backends/</div>
<div class="line">â”‚   â”œâ”€â”€ patterns/</div>
<div class="line">â”‚   â”œâ”€â”€ di/                            # Dependency injection</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ messaging_di_container.cpp</div>
<div class="line">â”‚   â”‚   â””â”€â”€ service_registry.cpp</div>
<div class="line">â”‚   â””â”€â”€ lockfree/                      # Lock-free structures</div>
<div class="line">â”‚       â”œâ”€â”€ spsc_queue.h               # Single-producer single-consumer</div>
<div class="line">â”‚       â””â”€â”€ mpmc_queue.h               # Multi-producer multi-consumer</div>
<div class="line">â”‚</div>
<div class="line">â”œâ”€â”€ integration_tests/                 # Integration tests</div>
<div class="line">â”‚   â”œâ”€â”€ framework/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ messaging_fixture.h</div>
<div class="line">â”‚   â”‚   â””â”€â”€ test_helpers.h</div>
<div class="line">â”‚   â”œâ”€â”€ test_pub_sub.cpp</div>
<div class="line">â”‚   â”œâ”€â”€ test_request_reply.cpp</div>
<div class="line">â”‚   â”œâ”€â”€ test_integration_with_logger.cpp</div>
<div class="line">â”‚   â””â”€â”€ test_integration_with_monitoring.cpp</div>
<div class="line">â”‚</div>
<div class="line">â”œâ”€â”€ examples/                          # Example applications</div>
<div class="line">â”‚   â”œâ”€â”€ basic_pub_sub/</div>
<div class="line">â”‚   â”œâ”€â”€ request_reply/</div>
<div class="line">â”‚   â”œâ”€â”€ event_streaming/</div>
<div class="line">â”‚   â”œâ”€â”€ distributed_messaging/</div>
<div class="line">â”‚   â””â”€â”€ integration_example/</div>
<div class="line">â”‚</div>
<div class="line">â””â”€â”€ docs/</div>
<div class="line">    â”œâ”€â”€ IMPROVEMENT_PLAN.md            # This document</div>
<div class="line">    â”œâ”€â”€ ARCHITECTURE.md</div>
<div class="line">    â”œâ”€â”€ API_REFERENCE.md</div>
<div class="line">    â””â”€â”€ MIGRATION_GUIDE.md</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md387"></a>
Component Architecture</h2>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                      Application Layer                       â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                              â”‚</div>
<div class="line">                              â–¼</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                    Messaging Patterns                        â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</div>
<div class="line">â”‚  â”‚ Pub/Sub  â”‚  â”‚ Req/Rep  â”‚  â”‚ Pipeline â”‚  â”‚  Saga    â”‚   â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                              â”‚</div>
<div class="line">                              â–¼</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                      Message Bus                             â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚</div>
<div class="line">â”‚  â”‚ Message Broker   â”‚  â”‚ Topic Router     â”‚                â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                              â”‚</div>
<div class="line">                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                â–¼                           â–¼</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚   Message Queue           â”‚   â”‚  Subscription Manager     â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</div>
<div class="line">â”‚  â”‚ Priority Queue      â”‚  â”‚   â”‚  â”‚ Subscriber Registry â”‚ â”‚</div>
<div class="line">â”‚  â”‚ Dead Letter Queue   â”‚  â”‚   â”‚  â”‚ Filter Chain        â”‚ â”‚</div>
<div class="line">â”‚  â”‚ Persistent Queue    â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                              â”‚</div>
<div class="line">                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                â–¼                           â–¼</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚  Integration Layer        â”‚   â”‚   Reliability Layer       â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚</div>
<div class="line">â”‚  â”‚ Logger Adapter   â”‚     â”‚   â”‚  â”‚ Retry Policy     â”‚    â”‚</div>
<div class="line">â”‚  â”‚ Monitor Adapter  â”‚     â”‚   â”‚  â”‚ Circuit Breaker  â”‚    â”‚</div>
<div class="line">â”‚  â”‚ Thread Adapter   â”‚     â”‚   â”‚  â”‚ Persistence      â”‚    â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                              â”‚</div>
<div class="line">                              â–¼</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                   Backend Selection                          â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</div>
<div class="line">â”‚  â”‚ Standalone   â”‚  â”‚ Integration  â”‚  â”‚ Distributed  â”‚      â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                              â”‚</div>
<div class="line">                              â–¼</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚              Foundation (common_system)                      â”‚</div>
<div class="line">â”‚   Result&lt;T&gt;, error_info, event_bus, interfaces              â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md389"></a>
Implementation Plan</h1>
<h2><a class="anchor" id="autotoc_md390"></a>
Phase 1: Foundation and Error Codes (Week 1)</h2>
<h3><a class="anchor" id="autotoc_md391"></a>
1.1 Add messaging_system Error Codes to common_system</h3>
<p><b>File</b>: <code>common_system/include/kcenon/common/error/error_codes.h</code></p>
<p><b>Changes</b>: </p><div class="fragment"><div class="line"><span class="comment">// ============================================================================</span></div>
<div class="line"><span class="comment">// messaging_system Error Codes (-700 to -799)</span></div>
<div class="line"><span class="comment">// ============================================================================</span></div>
<div class="line"><span class="keyword">namespace </span>messaging_system {</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> base = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(category::messaging_system);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Message errors (-700 to -719)</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> invalid_message = base - 0;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> message_too_large = base - 1;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> message_expired = base - 2;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> invalid_payload = base - 3;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Routing errors (-720 to -739)</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> routing_failed = base - 20;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> unknown_topic = base - 21;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> no_subscribers = base - 22;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> invalid_topic_pattern = base - 23;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Queue errors (-740 to -759)</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> queue_full = base - 40;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> queue_empty = base - 41;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> queue_stopped = base - 42;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> enqueue_failed = base - 43;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> dequeue_failed = base - 44;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Subscription errors (-760 to -779)</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> subscription_failed = base - 60;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> subscription_not_found = base - 61;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> duplicate_subscription = base - 62;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> unsubscribe_failed = base - 63;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Publishing errors (-780 to -799)</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> publication_failed = base - 80;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> no_route_found = base - 81;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> message_rejected = base - 82;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> broker_unavailable = base - 83;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Also add to category enum</b>: </p><div class="fragment"><div class="line"><span class="keyword">enum class</span> category : <span class="keywordtype">int</span> {</div>
<div class="line">    success = 0,</div>
<div class="line">    common = -1,</div>
<div class="line">    thread_system = -100,</div>
<div class="line">    logger_system = -200,</div>
<div class="line">    monitoring_system = -300,</div>
<div class="line">    container_system = -400,</div>
<div class="line">    database_system = -500,</div>
<div class="line">    network_system = -600,</div>
<div class="line">    messaging_system = -700,  <span class="comment">// NEW</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Validation</b>: </p><div class="fragment"><div class="line"><span class="comment">// Add to validation namespace</span></div>
<div class="line"><span class="keyword">static_assert</span>(codes::messaging_system::base == -700,</div>
<div class="line">              <span class="stringliteral">&quot;messaging_system base must be -700&quot;</span>);</div>
<div class="line"><span class="keyword">static_assert</span>(codes::messaging_system::invalid_message &gt;= -799 &amp;&amp;</div>
<div class="line">              codes::messaging_system::invalid_message &lt;= -700,</div>
<div class="line">              <span class="stringliteral">&quot;messaging_system error codes must be in range [-799, -700]&quot;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md392"></a>
1.2 Create Core Interfaces</h3>
<p><b>File</b>: <code>include/kcenon/messaging/interfaces/message_handler_interface.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Forward declarations</span></div>
<div class="line"><span class="keyword">class </span>message;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>message_handler_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> ~message_handler_interface() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::VoidResult handle(<span class="keyword">const</span> message&amp; msg) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> can_handle(<span class="keyword">const</span> message&amp; msg) <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><p><b>File</b>: <code>include/kcenon/messaging/interfaces/publisher_interface.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>message;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>publisher_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> ~publisher_interface() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::VoidResult publish(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; topic,</div>
<div class="line">        <span class="keyword">const</span> message&amp; msg</div>
<div class="line">    ) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_ready() <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md393"></a>
1.3 Integration Detection Utility</h3>
<p><b>File</b>: <code>include/kcenon/messaging/utils/thread_integration_detector.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>thread_integration_detector {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> has_thread_system() {</div>
<div class="line"><span class="preprocessor">#ifdef KCENON_THREAD_SYSTEM_AVAILABLE</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> has_logger_system() {</div>
<div class="line"><span class="preprocessor">#ifdef KCENON_LOGGER_SYSTEM_AVAILABLE</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> has_monitoring_system() {</div>
<div class="line"><span class="preprocessor">#ifdef KCENON_MONITORING_SYSTEM_AVAILABLE</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md394"></a>
Phase 2: Core Message Types (Week 2)</h2>
<h3><a class="anchor" id="autotoc_md395"></a>
2.1 Message Structure</h3>
<p><b>File</b>: <code>include/kcenon/messaging/core/message.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;core/container.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum class</span> message_priority : uint8_t {</div>
<div class="line">    lowest = 0,</div>
<div class="line">    low = 1,</div>
<div class="line">    normal = 2,</div>
<div class="line">    high = 3,</div>
<div class="line">    highest = 4,</div>
<div class="line">    critical = 5</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum class</span> message_type {</div>
<div class="line">    command,        <span class="comment">// Execute an action</span></div>
<div class="line">    event,          <span class="comment">// Something happened</span></div>
<div class="line">    query,          <span class="comment">// Request information</span></div>
<div class="line">    reply,          <span class="comment">// Response to query/command</span></div>
<div class="line">    notification    <span class="comment">// Informational message</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>message_metadata {</div>
<div class="line">    std::string id;                    <span class="comment">// Unique message ID</span></div>
<div class="line">    std::string topic;                 <span class="comment">// Topic/channel</span></div>
<div class="line">    std::string source;                <span class="comment">// Source service/component</span></div>
<div class="line">    std::string target;                <span class="comment">// Target service/component (optional)</span></div>
<div class="line">    std::string correlation_id;        <span class="comment">// For request/reply correlation</span></div>
<div class="line">    std::string trace_id;              <span class="comment">// Distributed tracing ID</span></div>
<div class="line"> </div>
<div class="line">    message_type type;</div>
<div class="line">    message_priority priority;</div>
<div class="line"> </div>
<div class="line">    std::chrono::system_clock::time_point timestamp;</div>
<div class="line">    std::optional&lt;std::chrono::milliseconds&gt; ttl;  <span class="comment">// Time-to-live</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Additional headers (key-value pairs)</span></div>
<div class="line">    std::unordered_map&lt;std::string, std::string&gt; headers;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>message {</div>
<div class="line">    message_metadata metadata_;</div>
<div class="line">    std::shared_ptr&lt;container_module::value_container&gt; payload_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    message();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Constructors</span></div>
<div class="line">    <span class="keyword">explicit</span> message(<span class="keyword">const</span> std::string&amp; topic);</div>
<div class="line">    message(<span class="keyword">const</span> std::string&amp; topic, message_type type);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Metadata access</span></div>
<div class="line">    <span class="keyword">const</span> message_metadata&amp; metadata()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> metadata_; }</div>
<div class="line">    message_metadata&amp; metadata() { <span class="keywordflow">return</span> metadata_; }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Payload access</span></div>
<div class="line">    <span class="keyword">const</span> container_module::value_container&amp; payload() <span class="keyword">const</span>;</div>
<div class="line">    container_module::value_container&amp; payload();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Convenience methods</span></div>
<div class="line">    <span class="keywordtype">bool</span> is_expired() <span class="keyword">const</span>;</div>
<div class="line">    std::chrono::milliseconds age() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Serialization</span></div>
<div class="line">    common::Result&lt;std::vector&lt;uint8_t&gt;&gt; serialize() <span class="keyword">const</span>;</div>
<div class="line">    <span class="keyword">static</span> common::Result&lt;message&gt; deserialize(<span class="keyword">const</span> std::vector&lt;uint8_t&gt;&amp; data);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>message_builder {</div>
<div class="line">    message msg_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    message_builder();</div>
<div class="line"> </div>
<div class="line">    message_builder&amp; topic(std::string topic);</div>
<div class="line">    message_builder&amp; source(std::string source);</div>
<div class="line">    message_builder&amp; target(std::string target);</div>
<div class="line">    message_builder&amp; type(message_type type);</div>
<div class="line">    message_builder&amp; priority(message_priority priority);</div>
<div class="line">    message_builder&amp; ttl(std::chrono::milliseconds ttl);</div>
<div class="line">    message_builder&amp; correlation_id(std::string <span class="keywordtype">id</span>);</div>
<div class="line">    message_builder&amp; trace_id(std::string <span class="keywordtype">id</span>);</div>
<div class="line">    message_builder&amp; header(std::string key, std::string value);</div>
<div class="line"> </div>
<div class="line">    message_builder&amp; payload(std::shared_ptr&lt;container_module::value_container&gt; payload);</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;message&gt; build();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md396"></a>
Phase 3: Message Queue and Broker (Week 3)</h2>
<h3><a class="anchor" id="autotoc_md397"></a>
3.1 Queue Interface</h3>
<p><b>File</b>: <code>include/kcenon/messaging/interfaces/queue_interface.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../core/message.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>queue_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> ~queue_interface() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::VoidResult enqueue(message msg) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::Result&lt;message&gt; dequeue(</div>
<div class="line">        std::chrono::milliseconds timeout = std::chrono::milliseconds::max()</div>
<div class="line">    ) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::Result&lt;message&gt; try_dequeue() = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">size_t</span> size() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> empty() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> clear() = 0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md398"></a>
3.2 Message Queue Implementation</h3>
<p><b>File</b>: <code>include/kcenon/messaging/core/message_queue.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;../interfaces/queue_interface.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;queue&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;condition_variable&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>queue_config {</div>
<div class="line">    <span class="keywordtype">size_t</span> max_size = 10000;</div>
<div class="line">    <span class="keywordtype">bool</span> enable_priority = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> enable_persistence = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> drop_on_full = <span class="keyword">false</span>;  <span class="comment">// Drop oldest on full vs reject</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>message_queue : <span class="keyword">public</span> queue_interface {</div>
<div class="line">    <span class="keyword">struct </span>priority_comparator {</div>
<div class="line">        <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> message&amp; a, <span class="keyword">const</span> message&amp; b)<span class="keyword"> const </span>{</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(a.metadata().priority) &lt;</div>
<div class="line">                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(b.metadata().priority);</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    queue_config config_;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Use priority_queue if enabled, else regular queue</span></div>
<div class="line">    std::variant&lt;</div>
<div class="line">        std::queue&lt;message&gt;,</div>
<div class="line">        std::priority_queue&lt;message, std::vector&lt;message&gt;, priority_comparator&gt;</div>
<div class="line">    &gt; queue_;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">mutable</span> std::mutex mutex_;</div>
<div class="line">    std::condition_variable cv_;</div>
<div class="line">    std::atomic&lt;bool&gt; stopped_{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> message_queue(queue_config config = {});</div>
<div class="line">    ~message_queue() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// queue_interface implementation</span></div>
<div class="line">    common::VoidResult enqueue(message msg) <span class="keyword">override</span>;</div>
<div class="line">    common::Result&lt;message&gt; dequeue(std::chrono::milliseconds timeout) <span class="keyword">override</span>;</div>
<div class="line">    common::Result&lt;message&gt; try_dequeue() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> size() <span class="keyword">const override</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> empty() <span class="keyword">const override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> clear() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Lifecycle</span></div>
<div class="line">    <span class="keywordtype">void</span> stop();</div>
<div class="line">    <span class="keywordtype">bool</span> is_stopped()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> stopped_.load(); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">size_t</span> get_queue_size() <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> push_to_queue(message msg);</div>
<div class="line">    std::optional&lt;message&gt; pop_from_queue();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md399"></a>
Phase 4: Backend Pattern (Week 4)</h2>
<h3><a class="anchor" id="autotoc_md400"></a>
4.1 Backend Interface</h3>
<p><b>File</b>: <code>include/kcenon/messaging/backends/backend_interface.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/executor_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/logger_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/monitoring_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>backend_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> ~backend_interface() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::VoidResult initialize() = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> common::VoidResult shutdown() = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::shared_ptr&lt;common::interfaces::IExecutor&gt; get_executor() = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::shared_ptr&lt;common::interfaces::ILogger&gt; get_logger() {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::shared_ptr&lt;common::interfaces::IMonitoring&gt; get_monitoring() {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_ready() <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md401"></a>
4.2 Standalone Backend</h3>
<p><b>File</b>: <code>include/kcenon/messaging/backends/standalone_backend.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;backend_interface.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>standalone_backend : <span class="keyword">public</span> backend_interface {</div>
<div class="line">    <span class="keyword">struct </span>internal_executor;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> num_threads_;</div>
<div class="line">    std::shared_ptr&lt;internal_executor&gt; executor_;</div>
<div class="line">    <span class="keywordtype">bool</span> initialized_{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> standalone_backend(<span class="keywordtype">size_t</span> num_threads = std::thread::hardware_concurrency());</div>
<div class="line">    ~standalone_backend() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    common::VoidResult initialize() <span class="keyword">override</span>;</div>
<div class="line">    common::VoidResult shutdown() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    std::shared_ptr&lt;common::interfaces::IExecutor&gt; get_executor() <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> is_ready() <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md402"></a>
4.3 Integration Backend</h3>
<p><b>File</b>: <code>include/kcenon/messaging/backends/integration_backend.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;backend_interface.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>integration_backend : <span class="keyword">public</span> backend_interface {</div>
<div class="line">    std::shared_ptr&lt;common::interfaces::IExecutor&gt; executor_;</div>
<div class="line">    std::shared_ptr&lt;common::interfaces::ILogger&gt; logger_;</div>
<div class="line">    std::shared_ptr&lt;common::interfaces::IMonitoring&gt; monitoring_;</div>
<div class="line">    <span class="keywordtype">bool</span> initialized_{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    integration_backend(</div>
<div class="line">        std::shared_ptr&lt;common::interfaces::IExecutor&gt; executor,</div>
<div class="line">        std::shared_ptr&lt;common::interfaces::ILogger&gt; logger = <span class="keyword">nullptr</span>,</div>
<div class="line">        std::shared_ptr&lt;common::interfaces::IMonitoring&gt; monitoring = <span class="keyword">nullptr</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    common::VoidResult initialize() <span class="keyword">override</span>;</div>
<div class="line">    common::VoidResult shutdown() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    std::shared_ptr&lt;common::interfaces::IExecutor&gt; get_executor() <span class="keyword">override</span>;</div>
<div class="line">    std::shared_ptr&lt;common::interfaces::ILogger&gt; get_logger() <span class="keyword">override</span>;</div>
<div class="line">    std::shared_ptr&lt;common::interfaces::IMonitoring&gt; get_monitoring() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> is_ready() <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md403"></a>
Phase 5: Topic Router and Pub/Sub (Week 5)</h2>
<h3><a class="anchor" id="autotoc_md404"></a>
5.1 Topic Router Implementation</h3>
<p><b>File</b>: <code>include/kcenon/messaging/core/topic_router.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../interfaces/message_router_interface.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;message.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;shared_mutex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;regex&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>subscription_callback = std::function&lt;common::VoidResult(<span class="keyword">const</span> message&amp;)&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>message_filter = std::function&lt;bool(<span class="keyword">const</span> message&amp;)&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>subscription {</div>
<div class="line">    uint64_t id;</div>
<div class="line">    std::string topic_pattern;  <span class="comment">// Supports wildcards: *, #</span></div>
<div class="line">    subscription_callback callback;</div>
<div class="line">    message_filter filter;</div>
<div class="line">    <span class="keywordtype">int</span> priority;  <span class="comment">// Higher = executed first</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> matches(<span class="keyword">const</span> std::string&amp; topic) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>topic_router {</div>
<div class="line">    std::unordered_map&lt;std::string, std::vector&lt;subscription&gt;&gt; subscriptions_;</div>
<div class="line">    <span class="keyword">mutable</span> std::shared_mutex mutex_;</div>
<div class="line">    std::atomic&lt;uint64_t&gt; next_id_{1};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    topic_router() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;uint64_t&gt; subscribe(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; pattern,</div>
<div class="line">        subscription_callback callback,</div>
<div class="line">        message_filter filter = <span class="keyword">nullptr</span>,</div>
<div class="line">        <span class="keywordtype">int</span> priority = 5</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    common::VoidResult unsubscribe(uint64_t subscription_id);</div>
<div class="line"> </div>
<div class="line">    common::VoidResult route(<span class="keyword">const</span> message&amp; msg);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> subscriber_count(<span class="keyword">const</span> std::string&amp; topic) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::string&gt; get_topics() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::vector&lt;subscription*&gt; find_matching_subscriptions(<span class="keyword">const</span> std::string&amp; topic);</div>
<div class="line">    <span class="keywordtype">bool</span> match_pattern(<span class="keyword">const</span> std::string&amp; topic, <span class="keyword">const</span> std::string&amp; pattern) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><p><b>Topic Pattern Matching</b>:</p><ul>
<li><code>user.*</code> matches <code>user.created</code>, <code>user.updated</code> (single level)</li>
<li><code>user.#</code> matches <code>user.created</code>, <code>user.profile.updated</code> (multi-level)</li>
<li><code>*.created</code> matches <code>user.created</code>, <code>order.created</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md405"></a>
Phase 6: Message Bus (Week 6)</h2>
<h3><a class="anchor" id="autotoc_md406"></a>
6.1 Message Bus Implementation</h3>
<p><b>File</b>: <code>include/kcenon/messaging/core/message_bus.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;message.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;message_queue.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;topic_router.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../backends/backend_interface.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>message_bus_config {</div>
<div class="line">    <span class="keywordtype">size_t</span> queue_capacity = 10000;</div>
<div class="line">    <span class="keywordtype">size_t</span> worker_threads = 4;</div>
<div class="line">    <span class="keywordtype">bool</span> enable_priority_queue = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> enable_dead_letter_queue = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> enable_metrics = <span class="keyword">true</span>;</div>
<div class="line">    std::chrono::milliseconds processing_timeout{5000};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>message_bus {</div>
<div class="line">    message_bus_config config_;</div>
<div class="line">    std::shared_ptr&lt;backend_interface&gt; backend_;</div>
<div class="line">    std::unique_ptr&lt;message_queue&gt; queue_;</div>
<div class="line">    std::unique_ptr&lt;topic_router&gt; router_;</div>
<div class="line">    std::atomic&lt;bool&gt; running_{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Statistics</span></div>
<div class="line">    <span class="keyword">struct </span>statistics {</div>
<div class="line">        std::atomic&lt;uint64_t&gt; messages_published{0};</div>
<div class="line">        std::atomic&lt;uint64_t&gt; messages_processed{0};</div>
<div class="line">        std::atomic&lt;uint64_t&gt; messages_failed{0};</div>
<div class="line">        std::atomic&lt;uint64_t&gt; messages_dropped{0};</div>
<div class="line">    } stats_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> message_bus(</div>
<div class="line">        std::shared_ptr&lt;backend_interface&gt; backend,</div>
<div class="line">        message_bus_config config = {}</div>
<div class="line">    );</div>
<div class="line">    ~message_bus();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Lifecycle</span></div>
<div class="line">    common::VoidResult start();</div>
<div class="line">    common::VoidResult stop();</div>
<div class="line">    <span class="keywordtype">bool</span> is_running()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> running_.load(); }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Publishing</span></div>
<div class="line">    common::VoidResult publish(<span class="keyword">const</span> message&amp; msg);</div>
<div class="line">    common::VoidResult publish(<span class="keyword">const</span> std::string&amp; topic, message msg);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Subscription</span></div>
<div class="line">    common::Result&lt;uint64_t&gt; subscribe(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; topic_pattern,</div>
<div class="line">        subscription_callback callback,</div>
<div class="line">        message_filter filter = <span class="keyword">nullptr</span>,</div>
<div class="line">        <span class="keywordtype">int</span> priority = 5</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    common::VoidResult unsubscribe(uint64_t subscription_id);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Request-Reply pattern</span></div>
<div class="line">    common::Result&lt;message&gt; request(</div>
<div class="line">        <span class="keyword">const</span> message&amp; request,</div>
<div class="line">        std::chrono::milliseconds timeout = std::chrono::milliseconds{5000}</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Statistics</span></div>
<div class="line">    <span class="keyword">struct </span>statistics_snapshot {</div>
<div class="line">        uint64_t messages_published;</div>
<div class="line">        uint64_t messages_processed;</div>
<div class="line">        uint64_t messages_failed;</div>
<div class="line">        uint64_t messages_dropped;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    statistics_snapshot get_statistics() <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> reset_statistics();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> process_messages();</div>
<div class="line">    common::VoidResult handle_message(<span class="keyword">const</span> message&amp; msg);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md407"></a>
Phase 7: DI Container (Week 7)</h2>
<h3><a class="anchor" id="autotoc_md408"></a>
7.1 DI Container Interface</h3>
<p><b>File</b>: <code>src/impl/di/messaging_di_container.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/executor_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/logger_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/monitoring_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;typeindex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;any&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging::di {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>messaging_di_container {</div>
<div class="line">    std::unordered_map&lt;std::type_index, std::any&gt; services_;</div>
<div class="line">    <span class="keyword">mutable</span> std::mutex mutex_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">    <span class="keywordtype">void</span> register_service(std::shared_ptr&lt;T&gt; service) {</div>
<div class="line">        std::lock_guard lock(mutex_);</div>
<div class="line">        services_[<span class="keyword">typeid</span>(T)] = service;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">    std::shared_ptr&lt;T&gt; resolve()<span class="keyword"> const </span>{</div>
<div class="line">        std::lock_guard lock(mutex_);</div>
<div class="line">        <span class="keyword">auto</span> it = services_.find(<span class="keyword">typeid</span>(T));</div>
<div class="line">        <span class="keywordflow">if</span> (it != services_.end()) {</div>
<div class="line">            <span class="keywordflow">return</span> std::any_cast&lt;std::shared_ptr&lt;T&gt;&gt;(it-&gt;second);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">    <span class="keywordtype">bool</span> has_service()<span class="keyword"> const </span>{</div>
<div class="line">        std::lock_guard lock(mutex_);</div>
<div class="line">        <span class="keywordflow">return</span> services_.find(<span class="keyword">typeid</span>(T)) != services_.end();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> clear() {</div>
<div class="line">        std::lock_guard lock(mutex_);</div>
<div class="line">        services_.clear();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">messaging_di_container&amp; get_global_container();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging::di</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md409"></a>
Phase 8: Patterns Implementation (Week 8)</h2>
<h3><a class="anchor" id="autotoc_md410"></a>
8.1 Pub/Sub Pattern</h3>
<p><b>File</b>: <code>include/kcenon/messaging/patterns/pub_sub.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;../core/message_bus.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging::patterns {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>publisher {</div>
<div class="line">    std::shared_ptr&lt;message_bus&gt; bus_;</div>
<div class="line">    std::string default_topic_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    publisher(std::shared_ptr&lt;message_bus&gt; bus, std::string default_topic);</div>
<div class="line"> </div>
<div class="line">    common::VoidResult publish(message msg);</div>
<div class="line"> </div>
<div class="line">    common::VoidResult publish(<span class="keyword">const</span> std::string&amp; topic, message msg);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>subscriber {</div>
<div class="line">    std::shared_ptr&lt;message_bus&gt; bus_;</div>
<div class="line">    std::vector&lt;uint64_t&gt; subscription_ids_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> subscriber(std::shared_ptr&lt;message_bus&gt; bus);</div>
<div class="line">    ~subscriber();</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;uint64_t&gt; subscribe(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; topic_pattern,</div>
<div class="line">        subscription_callback callback,</div>
<div class="line">        message_filter filter = <span class="keyword">nullptr</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    common::VoidResult unsubscribe_all();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging::patterns</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md411"></a>
8.2 Request-Reply Pattern</h3>
<p><b>File</b>: <code>include/kcenon/messaging/patterns/request_reply.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;../core/message_bus.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;future&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>kcenon::messaging::patterns {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>request_reply_handler {</div>
<div class="line">    std::shared_ptr&lt;message_bus&gt; bus_;</div>
<div class="line">    std::string service_topic_;</div>
<div class="line">    std::unordered_map&lt;std::string, std::promise&lt;message&gt;&gt; pending_requests_;</div>
<div class="line">    <span class="keyword">mutable</span> std::mutex mutex_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    request_reply_handler(std::shared_ptr&lt;message_bus&gt; bus, std::string service_topic);</div>
<div class="line"> </div>
<div class="line">    common::Result&lt;message&gt; request(</div>
<div class="line">        message req,</div>
<div class="line">        std::chrono::milliseconds timeout = std::chrono::milliseconds{5000}</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    common::VoidResult register_handler(</div>
<div class="line">        std::function&lt;common::Result&lt;message&gt;(<span class="keyword">const</span> message&amp;)&gt; handler</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> handle_reply(<span class="keyword">const</span> message&amp; reply);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::messaging::patterns</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md413"></a>
Migration Strategy</h1>
<h2><a class="anchor" id="autotoc_md414"></a>
Backward Compatibility</h2>
<h3><a class="anchor" id="autotoc_md415"></a>
Legacy Include Guard</h3>
<p><b>File</b>: <code>include/kcenon/messaging/compatibility.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Provide backward compatibility for existing code</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;core/message.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;core/message_bus.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>messaging {</div>
<div class="line">    <span class="comment">// Legacy namespace aliases</span></div>
<div class="line">    <span class="keyword">using </span>kcenon::messaging::message;</div>
<div class="line">    <span class="keyword">using </span>kcenon::messaging::message_bus;</div>
<div class="line">    <span class="keyword">using </span>kcenon::messaging::message_priority;</div>
<div class="line">    <span class="keyword">using </span>kcenon::messaging::message_type;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Legacy error codes (forward to centralized codes)</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/error/error_codes.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>messaging::error {</div>
<div class="line">    <span class="keyword">using namespace </span>kcenon::common::error::codes::messaging_system;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Remap old codes to new ones</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> INVALID_MESSAGE = invalid_message;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> ROUTING_FAILED = routing_failed;</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> QUEUE_FULL = queue_full;</div>
<div class="line">    <span class="comment">// ... other mappings</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md416"></a>
Migration Path</h2>
<p><b>Step 1</b>: Update common_system with new error codes <b>Step 2</b>: Add compatibility.h for legacy code <b>Step 3</b>: Gradually migrate components to new structure <b>Step 4</b>: Update examples and tests <b>Step 5</b>: Mark old headers as deprecated <b>Step 6</b>: Remove deprecated code after grace period</p>
<h2><a class="anchor" id="autotoc_md417"></a>
Coexistence Period</h2>
<p>For 2 releases, support both: </p><div class="fragment"><div class="line"><span class="comment">// Old way (deprecated)</span></div>
<div class="line"><span class="preprocessor">#include &lt;messaging_system/core/message_bus.h&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>messaging;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// New way (recommended)</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/messaging/core/message_bus.h&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>kcenon::messaging;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md419"></a>
Testing Strategy</h1>
<h2><a class="anchor" id="autotoc_md420"></a>
Unit Tests</h2>
<p><b>Coverage targets</b>:</p><ul>
<li>Core components: 90%+</li>
<li>Interfaces: 100%</li>
<li>Adapters: 85%+</li>
<li>Patterns: 90%+</li>
</ul>
<p><b>Test structure</b>: </p><div class="fragment"><div class="line">tests/</div>
<div class="line">â”œâ”€â”€ unit/</div>
<div class="line">â”‚   â”œâ”€â”€ core/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ test_message.cpp</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ test_message_queue.cpp</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ test_topic_router.cpp</div>
<div class="line">â”‚   â”‚   â””â”€â”€ test_message_bus.cpp</div>
<div class="line">â”‚   â”œâ”€â”€ patterns/</div>
<div class="line">â”‚   â”‚   â”œâ”€â”€ test_pub_sub.cpp</div>
<div class="line">â”‚   â”‚   â””â”€â”€ test_request_reply.cpp</div>
<div class="line">â”‚   â””â”€â”€ backends/</div>
<div class="line">â”‚       â”œâ”€â”€ test_standalone_backend.cpp</div>
<div class="line">â”‚       â””â”€â”€ test_integration_backend.cpp</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md421"></a>
Integration Tests</h2>
<p><b>Scenarios</b>:</p><ol type="1">
<li><b>Message Bus + Topic Router</b>: Publish-subscribe flow</li>
<li><b>Message Queue + Priority</b>: Priority message handling</li>
<li><b>Backend Integration</b>: Thread pool integration</li>
<li><b>Logger Integration</b>: Logging integration</li>
<li><b>Monitoring Integration</b>: Metrics collection</li>
<li><b>Full Stack</b>: End-to-end messaging</li>
</ol>
<p><b>File</b>: <code>integration_tests/test_full_integration.cpp</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/messaging/core/message_bus.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/messaging/backends/integration_backend.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/thread/core/thread_pool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/core/logger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/monitoring/core/performance_monitor.h&gt;</span></div>
<div class="line"> </div>
<div class="line">TEST(FullIntegration, MessageBusWithAllSystems) {</div>
<div class="line">    <span class="comment">// Setup thread pool</span></div>
<div class="line">    <span class="keyword">auto</span> thread_pool = thread::create_thread_pool(4);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup logger</span></div>
<div class="line">    <span class="keyword">auto</span> logger = logger::logger_builder()</div>
<div class="line">        .with_async(<span class="keyword">true</span>)</div>
<div class="line">        .build();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup monitoring</span></div>
<div class="line">    <span class="keyword">auto</span> monitor = monitoring::performance_monitor::create();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create integration backend</span></div>
<div class="line">    <span class="keyword">auto</span> backend = std::make_shared&lt;messaging::integration_backend&gt;(</div>
<div class="line">        thread_pool, logger, monitor</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create message bus</span></div>
<div class="line">    <span class="keyword">auto</span> bus = std::make_shared&lt;messaging::message_bus&gt;(backend);</div>
<div class="line">    ASSERT_TRUE(bus-&gt;start().is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Test pub/sub</span></div>
<div class="line">    <span class="keywordtype">bool</span> received = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keyword">auto</span> sub_result = bus-&gt;subscribe(<span class="stringliteral">&quot;test.topic&quot;</span>, [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; msg) {</div>
<div class="line">        received = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">return</span> common::ok();</div>
<div class="line">    });</div>
<div class="line">    ASSERT_TRUE(sub_result.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Publish message</span></div>
<div class="line">    <span class="keyword">auto</span> msg = messaging::message_builder()</div>
<div class="line">        .topic(<span class="stringliteral">&quot;test.topic&quot;</span>)</div>
<div class="line">        .build();</div>
<div class="line">    ASSERT_TRUE(msg.is_ok());</div>
<div class="line">    ASSERT_TRUE(bus-&gt;publish(msg.unwrap()).is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for delivery</span></div>
<div class="line">    std::this_thread::sleep_for(std::chrono::milliseconds(100));</div>
<div class="line">    EXPECT_TRUE(received);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check statistics</span></div>
<div class="line">    <span class="keyword">auto</span> stats = bus-&gt;get_statistics();</div>
<div class="line">    EXPECT_EQ(stats.messages_published, 1);</div>
<div class="line">    EXPECT_EQ(stats.messages_processed, 1);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md422"></a>
Performance Benchmarks</h2>
<p><b>Metrics</b>:</p><ul>
<li>Message throughput (messages/sec)</li>
<li>Latency (p50, p95, p99)</li>
<li>Memory usage</li>
<li>CPU usage</li>
<li>Lock contention</li>
</ul>
<p><b>Benchmark suite</b>: </p><div class="fragment"><div class="line">benchmarks/</div>
<div class="line">â”œâ”€â”€ bench_message_creation.cpp</div>
<div class="line">â”œâ”€â”€ bench_message_queue.cpp</div>
<div class="line">â”œâ”€â”€ bench_topic_router.cpp</div>
<div class="line">â”œâ”€â”€ bench_pub_sub_throughput.cpp</div>
<div class="line">â””â”€â”€ bench_request_reply_latency.cpp</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md424"></a>
Timeline and Milestones</h1>
<h2><a class="anchor" id="autotoc_md425"></a>
Phase 1: Foundation (Week 1) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Error codes in messaging_system (-700 to -799 range)</li>
<li>âœ… Core interfaces defined (message_handler, publisher, subscriber)</li>
<li>âœ… Integration detector utility</li>
<li>â³ Message structure implementation (moved to Phase 2)</li>
</ul>
<p><b>Status</b>: Completed 2025-11-16 <b>Branch</b>: feature/phase-1-foundation <b>Deliverable</b>: Error codes, core interfaces, and integration detection</p>
<h2><a class="anchor" id="autotoc_md426"></a>
Phase 2: Core Message Types (Week 2) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Message structure implemented</li>
<li>âœ… Message builder pattern</li>
<li>âœ… Message serialization/deserialization</li>
</ul>
<p><b>Status</b>: Completed 2025-11-16 <b>Branch</b>: feature/phase-2-core-message-types <b>Deliverable</b>: Core message types and builders</p>
<h2><a class="anchor" id="autotoc_md427"></a>
Phase 3: Message Queue (Week 3) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Queue interface</li>
<li>âœ… Message queue implementation</li>
<li>âœ… Priority queue support</li>
<li>âœ… Dead letter queue</li>
</ul>
<p><b>Status</b>: Completed 2025-11-16 <b>Branch</b>: feature/phase-3-message-queue <b>Deliverable</b>: Thread-safe message queue</p>
<h2><a class="anchor" id="autotoc_md428"></a>
Phase 4: Backend Pattern (Week 4) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Backend interface</li>
<li>âœ… Standalone backend</li>
<li>âœ… Integration backend</li>
<li>âœ… Backend auto-detection</li>
<li>âœ… Unit tests (27 tests passing)</li>
</ul>
<p><b>Status</b>: Completed 2025-11-17 <b>Branch</b>: feature/phase-4-backend-pattern <b>Deliverable</b>: Backend abstraction working with comprehensive tests</p>
<h2><a class="anchor" id="autotoc_md429"></a>
Phase 5: Topic Router (Week 5) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Topic pattern matching</li>
<li>âœ… Subscription manager</li>
<li>âœ… Wildcard support (*, #)</li>
<li>âœ… Filter chains</li>
<li>âœ… Unit tests (27 tests passing)</li>
</ul>
<p><b>Status</b>: Completed 2025-11-17 <b>Branch</b>: feature/phase-5-topic-router <b>Deliverable</b>: Topic routing with pattern matching</p>
<h2><a class="anchor" id="autotoc_md430"></a>
Phase 6: Message Bus (Week 6) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Message bus core</li>
<li>âœ… Pub/sub basic functionality</li>
<li>âœ… Worker threads</li>
<li>âœ… Statistics collection</li>
<li>âœ… Unit tests (17 tests passing)</li>
</ul>
<p><b>Status</b>: Completed 2025-11-17 <b>Branch</b>: feature/phase-6-message-bus <b>Deliverable</b>: Working message bus with comprehensive tests</p>
<h2><a class="anchor" id="autotoc_md431"></a>
Phase 7: DI Container (Week 7) - âœ… COMPLETED</h2>
<ul>
<li>âœ… DI container implementation</li>
<li>âœ… Service registry</li>
<li>âœ… Lifetime management (singleton, transient)</li>
<li>âœ… Unit tests (22 tests passing)</li>
</ul>
<p><b>Status</b>: Completed 2025-11-17 <b>Branch</b>: feature/phase-7-di-container <b>Deliverable</b>: Dependency injection system with comprehensive tests</p>
<h2><a class="anchor" id="autotoc_md432"></a>
Phase 8: Messaging Patterns (Week 8) - âœ… COMPLETED</h2>
<ul>
<li>âœ… Pub/sub pattern helpers (publisher, subscriber)</li>
<li>âœ… Request-reply pattern (request_reply_handler, request_client, request_server)</li>
<li>âœ… Event streaming (event_stream, event_batch_processor)</li>
<li>âœ… Message pipeline (message_pipeline, pipeline_builder, pipeline_stages)</li>
<li>âœ… Build integration successful</li>
</ul>
<p><b>Status</b>: Completed 2025-11-17 <b>Branch</b>: feature/phase-8-messaging-patterns <b>Deliverable</b>: High-level messaging patterns with complete implementations</p>
<p><b>Implementation Details</b>:</p><ul>
<li><b>Pub/Sub Pattern</b>: Publisher and Subscriber classes for simplified pub/sub operations</li>
<li><b>Request-Reply Pattern</b>: Synchronous request-reply over async messaging with correlation IDs</li>
<li><b>Event Streaming</b>: Event sourcing with replay capabilities and batch processing</li>
<li><b>Message Pipeline</b>: Pipes-and-filters pattern with stage chaining and error handling</li>
</ul>
<h2><a class="anchor" id="autotoc_md433"></a>
Phase 9-10: Testing and Documentation (Weeks 9-10) - ğŸ”„ IN PROGRESS</h2>
<ul>
<li>ğŸ”„ Pattern unit tests (Pub/Sub, Request-Reply) - 32/35 tests passing (91%)</li>
<li>â³ Pattern unit tests (Event Streaming, Message Pipeline)</li>
<li>â³ Integration tests</li>
<li>â³ Performance benchmarks</li>
<li>â³ API documentation</li>
<li>â³ Migration guide</li>
<li>â³ Examples</li>
</ul>
<p><b>Status</b>: In Progress - Pattern tests partially complete (2025-11-17) <b>Branch</b>: feature/phase-9-testing-docs <b>Deliverable</b>: Production-ready system</p>
<p><b>Current Progress</b>:</p><ul>
<li>âœ… Added Pub/Sub pattern tests: 16/17 tests passing (94%)</li>
<li>âœ… Added Request-Reply pattern tests: 16/18 tests passing (89%)</li>
<li>âœ… CMake test infrastructure for patterns</li>
<li>â³ Event Streaming and Message Pipeline tests pending</li>
<li>â³ Integration test framework pending</li>
<li>â³ Benchmarks pending</li>
<li>â³ Documentation pending</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md435"></a>
Success Criteria</h1>
<h2><a class="anchor" id="autotoc_md436"></a>
Functional</h2>
<ul>
<li>[ ] All core messaging patterns work (pub/sub, request/reply)</li>
<li>[ ] Topic routing with wildcards functional</li>
<li>[ ] Priority queue working correctly</li>
<li>[ ] Backend abstraction allows standalone and integrated modes</li>
<li>[ ] DI container manages all dependencies</li>
</ul>
<h2><a class="anchor" id="autotoc_md437"></a>
Non-Functional</h2>
<ul>
<li>[ ] Message throughput &gt; 100k messages/sec</li>
<li>[ ] Pub/sub latency p99 &lt; 10ms</li>
<li>[ ] Request/reply latency p99 &lt; 50ms</li>
<li>[ ] Memory overhead &lt; 1KB per message</li>
<li>[ ] Zero memory leaks under valgrind</li>
</ul>
<h2><a class="anchor" id="autotoc_md438"></a>
Quality</h2>
<ul>
<li>[ ] Unit test coverage &gt; 90%</li>
<li>[ ] Integration tests pass with all systems</li>
<li>[ ] No compiler warnings (-Wall -Wextra -Wpedantic)</li>
<li>[ ] Passes ASAN, TSAN, UBSAN</li>
<li>[ ] Documentation complete and accurate</li>
</ul>
<h2><a class="anchor" id="autotoc_md439"></a>
Integration</h2>
<ul>
<li>[ ] Works with thread_system</li>
<li>[ ] Works with logger_system</li>
<li>[ ] Works with monitoring_system</li>
<li>[ ] Works with container_system</li>
<li>[ ] Standalone mode functional</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md441"></a>
Risk Assessment</h1>
<h2><a class="anchor" id="autotoc_md442"></a>
High Risk</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Risk   </th><th class="markdownTableHeadNone">Mitigation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Performance degradation vs current impl   </td><td class="markdownTableBodyNone">Early benchmarking, profiling    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Breaking changes in dependent systems   </td><td class="markdownTableBodyNone">Version pinning, compatibility layer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Lock contention in router   </td><td class="markdownTableBodyNone">Lock-free structures, RCU patterns   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md443"></a>
Medium Risk</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Risk   </th><th class="markdownTableHeadNone">Mitigation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Complexity of pattern matching   </td><td class="markdownTableBodyNone">Thorough testing, regex caching    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Memory overhead of message metadata   </td><td class="markdownTableBodyNone">Pooling, small string optimization    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Integration test flakiness   </td><td class="markdownTableBodyNone">Retry logic, timeouts, isolation   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md444"></a>
Low Risk</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Risk   </th><th class="markdownTableHeadNone">Mitigation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Documentation drift   </td><td class="markdownTableBodyNone">Auto-generated docs, code comments    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example code outdated   </td><td class="markdownTableBodyNone">CI checks for examples   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md446"></a>
Appendix</h1>
<h2><a class="anchor" id="autotoc_md447"></a>
A. Error Code Mapping</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Old Code   </th><th class="markdownTableHeadNone">New Code   </th><th class="markdownTableHeadNone">Category    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-200 (INVALID_MESSAGE)   </td><td class="markdownTableBodyNone">-700   </td><td class="markdownTableBodyNone">Message errors    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-201 (ROUTING_FAILED)   </td><td class="markdownTableBodyNone">-720   </td><td class="markdownTableBodyNone">Routing errors    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-205 (QUEUE_FULL)   </td><td class="markdownTableBodyNone">-740   </td><td class="markdownTableBodyNone">Queue errors    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-209 (SUBSCRIPTION_FAILED)   </td><td class="markdownTableBodyNone">-760   </td><td class="markdownTableBodyNone">Subscription errors    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-210 (PUBLICATION_FAILED)   </td><td class="markdownTableBodyNone">-780   </td><td class="markdownTableBodyNone">Publishing errors   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md448"></a>
B. File Relocation Map</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Old Location   </th><th class="markdownTableHeadNone">New Location    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>include/messaging_system/core/</code>   </td><td class="markdownTableBodyNone"><code>include/kcenon/messaging/core/</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>include/messaging_system/error_codes.h</code>   </td><td class="markdownTableBodyNone"><code>include/kcenon/messaging/core/error_codes.h</code> (forward)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>application_layer/include/kcenon/messaging/</code>   </td><td class="markdownTableBodyNone">Merged into <code>include/kcenon/messaging/</code>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md449"></a>
C. Dependencies</h2>
<p><b>Required</b>:</p><ul>
<li>common_system &gt;= 2.0</li>
<li>container_system &gt;= 2.0</li>
</ul>
<p><b>Optional</b>:</p><ul>
<li>thread_system &gt;= 2.0 (for integration backend)</li>
<li>logger_system &gt;= 2.0 (for logging)</li>
<li>monitoring_system &gt;= 2.0 (for metrics)</li>
</ul>
<h2><a class="anchor" id="autotoc_md450"></a>
D. References</h2>
<ul>
<li>logger_system Architecture</li>
<li>thread_system Documentation</li>
<li><a href="../../../../common_system/include/kcenon/common/error/error_codes.h">common_system Error Codes</a></li>
<li><a class="el" href="../../d5/dca/md_docs_2DESIGN__PATTERNS.html">Design Patterns</a></li>
</ul>
<hr  />
<p><b>Document Control</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Version   </th><th class="markdownTableHeadNone">Date   </th><th class="markdownTableHeadNone">Author   </th><th class="markdownTableHeadNone">Changes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1.0   </td><td class="markdownTableBodyNone">2025-11-16   </td><td class="markdownTableBodyNone">Claude   </td><td class="markdownTableBodyNone">Initial draft   </td></tr>
</table>
<p><b>Approval</b></p>
<ul>
<li>[ ] Architecture Review</li>
<li>[ ] Security Review</li>
<li>[ ] Performance Review</li>
<li>[ ] Implementation Team Sign-off </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
