<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Creating Custom Collectors</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d9a/md_libraries_2monitoring__system_2docs_2custom-collectors.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Creating Custom Collectors</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md550"></a> This guide explains how to create custom collectors for the Monitoring System to gather metrics from various sources.</p>
<h1><a class="anchor" id="autotoc_md551"></a>
Overview</h1>
<p>Collectors are responsible for gathering metrics during each collection cycle. The Monitoring System provides a flexible <code><a class="el" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a></code> base class that you can extend to collect custom metrics.</p>
<h1><a class="anchor" id="autotoc_md552"></a>
Base Collector Interface</h1>
<p>All custom collectors must inherit from <code><a class="el" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a></code>:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="../../d7/db0/classmetrics__collector.html">metrics_collector</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code hl_function" href="../../d7/db0/classmetrics__collector.html#a66f854341c231aa33327e20a26f56ff0">~metrics_collector</a>() = <span class="keywordflow">default</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Called during each collection cycle</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> collect(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot) = 0;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Return a descriptive name for the collector</span></div>
<div class="line">    <span class="keyword">virtual</span> std::string name() <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="ttc" id="aclassmetrics__collector_html"><div class="ttname"><a href="../../d7/db0/classmetrics__collector.html">metrics_collector</a></div><div class="ttdef"><b>Definition</b> <a href="../../d9/dd9/production__ready__example_8cpp_source.html#l00041">production_ready_example.cpp:41</a></div></div>
<div class="ttc" id="aclassmetrics__collector_html_a66f854341c231aa33327e20a26f56ff0"><div class="ttname"><a href="../../d7/db0/classmetrics__collector.html#a66f854341c231aa33327e20a26f56ff0">metrics_collector::~metrics_collector</a></div><div class="ttdeci">~metrics_collector()</div><div class="ttdef"><b>Definition</b> <a href="../../d9/dd9/production__ready__example_8cpp_source.html#l00064">production_ready_example.cpp:64</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1metrics__snapshot_html"><div class="ttname"><a href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a></div><div class="ttdoc">Complete snapshot of all metrics at a point in time.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00092">monitoring_interface.h:92</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md553"></a>
Simple Examples</h1>
<h2><a class="anchor" id="autotoc_md554"></a>
1. CPU Usage Collector (Linux)</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;monitoring_system/monitoring.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>linux_cpu_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">struct </span>cpu_stats {</div>
<div class="line">        <span class="keywordtype">long</span> user, nice, system, idle, iowait, irq, softirq;</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    cpu_stats last_stats_{};</div>
<div class="line">    </div>
<div class="line">    cpu_stats read_cpu_stats() {</div>
<div class="line">        std::ifstream stat_file(<span class="stringliteral">&quot;/proc/stat&quot;</span>);</div>
<div class="line">        std::string line;</div>
<div class="line">        std::getline(stat_file, line);</div>
<div class="line">        </div>
<div class="line">        cpu_stats stats{};</div>
<div class="line">        std::istringstream iss(line);</div>
<div class="line">        std::string cpu;</div>
<div class="line">        iss &gt;&gt; cpu &gt;&gt; stats.user &gt;&gt; stats.nice &gt;&gt; stats.system </div>
<div class="line">            &gt;&gt; stats.idle &gt;&gt; stats.iowait &gt;&gt; stats.irq &gt;&gt; stats.softirq;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> stats;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> current = read_cpu_stats();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Calculate deltas</span></div>
<div class="line">        <span class="keywordtype">long</span> total_delta = (current.user - last_stats_.user) +</div>
<div class="line">                          (current.nice - last_stats_.nice) +</div>
<div class="line">                          (current.system - last_stats_.system) +</div>
<div class="line">                          (current.idle - last_stats_.idle) +</div>
<div class="line">                          (current.iowait - last_stats_.iowait) +</div>
<div class="line">                          (current.irq - last_stats_.irq) +</div>
<div class="line">                          (current.softirq - last_stats_.softirq);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">long</span> active_delta = total_delta - (current.idle - last_stats_.idle);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (total_delta &gt; 0) {</div>
<div class="line">            snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#aa7a000a777db44c0f6edaf97b87c9a5e">cpu_usage_percent</a> = (active_delta * 100) / total_delta;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        last_stats_ = current;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::string <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">name</a>()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;LinuxCPUCollector&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Usage</span></div>
<div class="line">monitor-&gt;add_collector(std::make_unique&lt;linux_cpu_collector&gt;());</div>
<div class="ttc" id="aclassmonitoring__module_1_1metrics__collector_html"><div class="ttname"><a href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a></div><div class="ttdoc">Base class for custom metrics collectors.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d54/monitoring_8h_source.html#l00151">monitoring.h:151</a></div></div>
<div class="ttc" id="aclassmonitoring__module_1_1metrics__collector_html_a37e6cac79348fdb50ccfa32fad520cc3"><div class="ttname"><a href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">monitoring_module::metrics_collector::collect</a></div><div class="ttdeci">virtual void collect(metrics_snapshot &amp;snapshot)=0</div><div class="ttdoc">Collect metrics and update the snapshot.</div></div>
<div class="ttc" id="aclassmonitoring__module_1_1metrics__collector_html_aac8596926cd8c9c74963ae1cb7dc92fb"><div class="ttname"><a href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">monitoring_module::metrics_collector::name</a></div><div class="ttdeci">virtual std::string name() const =0</div><div class="ttdoc">Get collector name for debugging.</div></div>
<div class="ttc" id="astructmonitoring__interface_1_1metrics__snapshot_html_ad44d60abb123f57185df9232e8ffea8e"><div class="ttname"><a href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">monitoring_interface::metrics_snapshot::system</a></div><div class="ttdeci">system_metrics system</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00093">monitoring_interface.h:93</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1system__metrics_html_aa7a000a777db44c0f6edaf97b87c9a5e"><div class="ttname"><a href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#aa7a000a777db44c0f6edaf97b87c9a5e">monitoring_interface::system_metrics::cpu_usage_percent</a></div><div class="ttdeci">std::uint64_t cpu_usage_percent</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00048">monitoring_interface.h:48</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md555"></a>
2. Memory Usage Collector</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>memory_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="preprocessor">    #ifdef __linux__</span></div>
<div class="line">    std::uint64_t get_memory_usage() {</div>
<div class="line">        std::ifstream meminfo(<span class="stringliteral">&quot;/proc/meminfo&quot;</span>);</div>
<div class="line">        std::string line;</div>
<div class="line">        std::uint64_t total_kb = 0, available_kb = 0;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">while</span> (std::getline(meminfo, line)) {</div>
<div class="line">            <span class="keywordflow">if</span> (line.find(<span class="stringliteral">&quot;MemTotal:&quot;</span>) == 0) {</div>
<div class="line">                std::sscanf(line.c_str(), <span class="stringliteral">&quot;MemTotal: %lu kB&quot;</span>, &amp;total_kb);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line.find(<span class="stringliteral">&quot;MemAvailable:&quot;</span>) == 0) {</div>
<div class="line">                std::sscanf(line.c_str(), <span class="stringliteral">&quot;MemAvailable: %lu kB&quot;</span>, &amp;available_kb);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> (total_kb - available_kb) * 1024; <span class="comment">// Convert to bytes</span></div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #elif defined(_WIN32)</span></div>
<div class="line">    std::uint64_t get_memory_usage() {</div>
<div class="line">        MEMORYSTATUSEX mem_info;</div>
<div class="line">        mem_info.dwLength = <span class="keyword">sizeof</span>(MEMORYSTATUSEX);</div>
<div class="line">        GlobalMemoryStatusEx(&amp;mem_info);</div>
<div class="line">        <span class="keywordflow">return</span> mem_info.ullTotalPhys - mem_info.ullAvailPhys;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #else</span></div>
<div class="line">    std::uint64_t get_memory_usage() {</div>
<div class="line">        <span class="keywordflow">return</span> 0; <span class="comment">// Not implemented</span></div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#a5d6218f3f24fabb62d05ed33abb6798e">memory_usage_bytes</a> = get_memory_usage();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::string <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">name</a>()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;MemoryCollector&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="astructmonitoring__interface_1_1system__metrics_html_a5d6218f3f24fabb62d05ed33abb6798e"><div class="ttname"><a href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#a5d6218f3f24fabb62d05ed33abb6798e">monitoring_interface::system_metrics::memory_usage_bytes</a></div><div class="ttdeci">std::uint64_t memory_usage_bytes</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00049">monitoring_interface.h:49</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md556"></a>
3. Process-Specific Collector</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>process_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    pid_t pid_;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">struct </span>process_stats {</div>
<div class="line">        std::uint64_t cpu_time_ns;</div>
<div class="line">        std::uint64_t memory_rss_bytes;</div>
<div class="line">        std::uint64_t <a class="code hl_variable" href="../../df/de0/optimized__storage_8h.html#acbe3ff89760ba4e883cfef7df57f461c">thread_count</a>;</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    process_stats get_process_stats() {</div>
<div class="line">        process_stats stats{};</div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">        #ifdef __linux__</span></div>
<div class="line">        <span class="comment">// Read from /proc/[pid]/stat</span></div>
<div class="line">        std::string stat_path = <span class="stringliteral">&quot;/proc/&quot;</span> + std::to_string(pid_) + <span class="stringliteral">&quot;/stat&quot;</span>;</div>
<div class="line">        std::ifstream stat_file(stat_path);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (stat_file.is_open()) {</div>
<div class="line">            std::string line;</div>
<div class="line">            std::getline(stat_file, line);</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Parse the stat file (simplified)</span></div>
<div class="line">            std::vector&lt;std::string&gt; fields;</div>
<div class="line">            std::istringstream iss(line);</div>
<div class="line">            std::string field;</div>
<div class="line">            <span class="keywordflow">while</span> (iss &gt;&gt; field) {</div>
<div class="line">                fields.push_back(field);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (fields.size() &gt; 23) {</div>
<div class="line">                <span class="comment">// utime + stime (in clock ticks)</span></div>
<div class="line">                <span class="keywordtype">long</span> utime = std::stol(fields[13]);</div>
<div class="line">                <span class="keywordtype">long</span> stime = std::stol(fields[14]);</div>
<div class="line">                stats.cpu_time_ns = (utime + stime) * (1000000000L / sysconf(_SC_CLK_TCK));</div>
<div class="line">                </div>
<div class="line">                <span class="comment">// RSS pages</span></div>
<div class="line">                <span class="keywordtype">long</span> rss_pages = std::stol(fields[23]);</div>
<div class="line">                stats.memory_rss_bytes = rss_pages * sysconf(_SC_PAGESIZE);</div>
<div class="line">                </div>
<div class="line">                <span class="comment">// Thread count</span></div>
<div class="line">                stats.thread_count = std::stoul(fields[19]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">        #endif</span></div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> stats;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> process_collector(pid_t pid = 0) </div>
<div class="line">        : pid_(pid ? pid : getpid()) {}</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> stats = get_process_stats();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Update relevant fields</span></div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#a5d6218f3f24fabb62d05ed33abb6798e">memory_usage_bytes</a> = stats.memory_rss_bytes;</div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#a39b96825f25d18c453fc58d67d94fdd4">active_threads</a> = stats.thread_count;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Could extend metrics_snapshot to include process-specific data</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::string <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">name</a>()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;ProcessCollector[&quot;</span> + std::to_string(pid_) + <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aoptimized__storage_8h_html_acbe3ff89760ba4e883cfef7df57f461c"><div class="ttname"><a href="../../df/de0/optimized__storage_8h.html#acbe3ff89760ba4e883cfef7df57f461c">thread_count</a></div><div class="ttdeci">std::uint16_t thread_count</div><div class="ttdef"><b>Definition</b> <a href="../../df/de0/optimized__storage_8h_source.html#l00003">optimized_storage.h:3</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1system__metrics_html_a39b96825f25d18c453fc58d67d94fdd4"><div class="ttname"><a href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#a39b96825f25d18c453fc58d67d94fdd4">monitoring_interface::system_metrics::active_threads</a></div><div class="ttdeci">std::uint64_t active_threads</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00050">monitoring_interface.h:50</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md557"></a>
Advanced Collectors</h1>
<h2><a class="anchor" id="autotoc_md558"></a>
1. Network Statistics Collector</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>network_stats_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">struct </span>network_stats {</div>
<div class="line">        std::uint64_t bytes_sent;</div>
<div class="line">        std::uint64_t bytes_received;</div>
<div class="line">        std::uint64_t packets_sent;</div>
<div class="line">        std::uint64_t packets_received;</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    network_stats last_stats_{};</div>
<div class="line">    std::chrono::steady_clock::time_point last_collection_;</div>
<div class="line">    </div>
<div class="line">    network_stats read_network_stats() {</div>
<div class="line">        network_stats total{};</div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">        #ifdef __linux__</span></div>
<div class="line">        std::ifstream net_dev(<span class="stringliteral">&quot;/proc/net/dev&quot;</span>);</div>
<div class="line">        std::string line;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Skip header lines</span></div>
<div class="line">        std::getline(net_dev, line);</div>
<div class="line">        std::getline(net_dev, line);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">while</span> (std::getline(net_dev, line)) {</div>
<div class="line">            <span class="keywordflow">if</span> (line.find(<span class="stringliteral">&quot;lo:&quot;</span>) != std::string::npos) {</div>
<div class="line">                <span class="keywordflow">continue</span>; <span class="comment">// Skip loopback</span></div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            std::istringstream iss(line);</div>
<div class="line">            std::string interface;</div>
<div class="line">            iss &gt;&gt; interface;</div>
<div class="line">            </div>
<div class="line">            network_stats iface_stats{};</div>
<div class="line">            iss &gt;&gt; iface_stats.bytes_received</div>
<div class="line">                &gt;&gt; iface_stats.packets_received</div>
<div class="line">                &gt;&gt; std::ws <span class="comment">// Skip some fields</span></div>
<div class="line">                &gt;&gt; std::ws &gt;&gt; std::ws &gt;&gt; std::ws &gt;&gt; std::ws &gt;&gt; std::ws</div>
<div class="line">                &gt;&gt; iface_stats.bytes_sent</div>
<div class="line">                &gt;&gt; iface_stats.packets_sent;</div>
<div class="line">            </div>
<div class="line">            total.bytes_sent += iface_stats.bytes_sent;</div>
<div class="line">            total.bytes_received += iface_stats.bytes_received;</div>
<div class="line">            total.packets_sent += iface_stats.packets_sent;</div>
<div class="line">            total.packets_received += iface_stats.packets_received;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">        #endif</span></div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> total;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> current = read_network_stats();</div>
<div class="line">        <span class="keyword">auto</span> now = std::chrono::steady_clock::now();</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (last_collection_ != std::chrono::steady_clock::time_point{}) {</div>
<div class="line">            <span class="keyword">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::seconds&gt;(</div>
<div class="line">                now - last_collection_).count();</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (duration &gt; 0) {</div>
<div class="line">                <span class="comment">// Calculate rates (bytes per second)</span></div>
<div class="line">                <span class="keyword">auto</span> send_rate = (current.bytes_sent - last_stats_.bytes_sent) / duration;</div>
<div class="line">                <span class="keyword">auto</span> recv_rate = (current.bytes_received - last_stats_.bytes_received) / duration;</div>
<div class="line">                </div>
<div class="line">                <span class="comment">// Would need to extend metrics_snapshot for network data</span></div>
<div class="line">                <span class="comment">// For now, could repurpose unused fields or use custom storage</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        last_stats_ = current;</div>
<div class="line">        last_collection_ = now;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::string <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">name</a>()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;NetworkStatsCollector&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md559"></a>
2. Disk I/O Collector</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>disk_io_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">struct </span>disk_stats {</div>
<div class="line">        std::uint64_t read_bytes;</div>
<div class="line">        std::uint64_t write_bytes;</div>
<div class="line">        std::uint64_t read_ops;</div>
<div class="line">        std::uint64_t write_ops;</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    std::unordered_map&lt;std::string, disk_stats&gt; last_stats_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line"><span class="preprocessor">        #ifdef __linux__</span></div>
<div class="line">        std::ifstream diskstats(<span class="stringliteral">&quot;/proc/diskstats&quot;</span>);</div>
<div class="line">        std::string line;</div>
<div class="line">        </div>
<div class="line">        disk_stats total{};</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">while</span> (std::getline(diskstats, line)) {</div>
<div class="line">            std::istringstream iss(line);</div>
<div class="line">            <span class="keywordtype">int</span> major, minor;</div>
<div class="line">            std::string device;</div>
<div class="line">            </div>
<div class="line">            iss &gt;&gt; major &gt;&gt; minor &gt;&gt; device;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Skip partitions, only count whole devices</span></div>
<div class="line">            <span class="keywordflow">if</span> (device.find_first_of(<span class="stringliteral">&quot;0123456789&quot;</span>) != std::string::npos) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            disk_stats stats{};</div>
<div class="line">            std::uint64_t tmp;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Skip to the fields we want</span></div>
<div class="line">            iss &gt;&gt; stats.read_ops &gt;&gt; tmp &gt;&gt; stats.read_bytes &gt;&gt; tmp</div>
<div class="line">                &gt;&gt; stats.write_ops &gt;&gt; tmp &gt;&gt; stats.write_bytes;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Convert sectors to bytes</span></div>
<div class="line">            stats.read_bytes *= 512;</div>
<div class="line">            stats.write_bytes *= 512;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Calculate deltas</span></div>
<div class="line">            <span class="keywordflow">if</span> (last_stats_.count(device)) {</div>
<div class="line">                <span class="keyword">auto</span>&amp; last = last_stats_[device];</div>
<div class="line">                total.read_bytes += stats.read_bytes - last.read_bytes;</div>
<div class="line">                total.write_bytes += stats.write_bytes - last.write_bytes;</div>
<div class="line">                total.read_ops += stats.read_ops - last.read_ops;</div>
<div class="line">                total.write_ops += stats.write_ops - last.write_ops;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            last_stats_[device] = stats;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Store in custom fields or aggregate into existing metrics</span></div>
<div class="line"><span class="preprocessor">        #endif</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::string <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">name</a>()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;DiskIOCollector&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md560"></a>
3. Application-Specific Collector</h2>
<div class="fragment"><div class="line"><span class="comment">// Example: Database connection pool monitor</span></div>
<div class="line"><span class="keyword">class </span>db_pool_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::shared_ptr&lt;connection_pool&gt; pool_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> db_pool_collector(std::shared_ptr&lt;connection_pool&gt; pool)</div>
<div class="line">        : pool_(pool) {}</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (!pool_) <span class="keywordflow">return</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span> stats = pool_-&gt;get_statistics();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Map to thread pool metrics (similar concept)</span></div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#a51741e0d2777e5a70d76c2d08282c550">thread_pool</a>.<a class="code hl_variable" href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a847ac2ac98d7e31461a5b9bf145a90fa">worker_threads</a> = stats.total_connections;</div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#a51741e0d2777e5a70d76c2d08282c550">thread_pool</a>.<a class="code hl_variable" href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a658c8655b491367af07d78d475ab4989">idle_threads</a> = stats.idle_connections;</div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#a51741e0d2777e5a70d76c2d08282c550">thread_pool</a>.<a class="code hl_variable" href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#aeafd7b1f23ea5884d37e90b396c5d47c">jobs_pending</a> = stats.waiting_requests;</div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#a51741e0d2777e5a70d76c2d08282c550">thread_pool</a>.<a class="code hl_variable" href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a217e5aa6aa3a89d329f4e074e17af75f">jobs_completed</a> = stats.total_requests;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Calculate average latency</span></div>
<div class="line">        <span class="keywordflow">if</span> (stats.total_requests &gt; 0) {</div>
<div class="line">            snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#a51741e0d2777e5a70d76c2d08282c550">thread_pool</a>.<a class="code hl_variable" href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a771c59e62fa4edc7a83973461a32bce9">average_latency_ns</a> = </div>
<div class="line">                stats.total_request_time_ns / stats.total_requests;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::string <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#aac8596926cd8c9c74963ae1cb7dc92fb">name</a>()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;DatabasePoolCollector&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="astructmonitoring__interface_1_1metrics__snapshot_html_a51741e0d2777e5a70d76c2d08282c550"><div class="ttname"><a href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#a51741e0d2777e5a70d76c2d08282c550">monitoring_interface::metrics_snapshot::thread_pool</a></div><div class="ttdeci">thread_pool_metrics thread_pool</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00094">monitoring_interface.h:94</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1thread__pool__metrics_html_a217e5aa6aa3a89d329f4e074e17af75f"><div class="ttname"><a href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a217e5aa6aa3a89d329f4e074e17af75f">monitoring_interface::thread_pool_metrics::jobs_completed</a></div><div class="ttdeci">std::uint64_t jobs_completed</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00062">monitoring_interface.h:62</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1thread__pool__metrics_html_a658c8655b491367af07d78d475ab4989"><div class="ttname"><a href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a658c8655b491367af07d78d475ab4989">monitoring_interface::thread_pool_metrics::idle_threads</a></div><div class="ttdeci">std::uint64_t idle_threads</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00068">monitoring_interface.h:68</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1thread__pool__metrics_html_a771c59e62fa4edc7a83973461a32bce9"><div class="ttname"><a href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a771c59e62fa4edc7a83973461a32bce9">monitoring_interface::thread_pool_metrics::average_latency_ns</a></div><div class="ttdeci">std::uint64_t average_latency_ns</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00066">monitoring_interface.h:66</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1thread__pool__metrics_html_a847ac2ac98d7e31461a5b9bf145a90fa"><div class="ttname"><a href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#a847ac2ac98d7e31461a5b9bf145a90fa">monitoring_interface::thread_pool_metrics::worker_threads</a></div><div class="ttdeci">std::uint64_t worker_threads</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00067">monitoring_interface.h:67</a></div></div>
<div class="ttc" id="astructmonitoring__interface_1_1thread__pool__metrics_html_aeafd7b1f23ea5884d37e90b396c5d47c"><div class="ttname"><a href="../../d6/d3b/structmonitoring__interface_1_1thread__pool__metrics.html#aeafd7b1f23ea5884d37e90b396c5d47c">monitoring_interface::thread_pool_metrics::jobs_pending</a></div><div class="ttdeci">std::uint64_t jobs_pending</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0a/monitoring__system_2sources_2monitoring_2monitoring__interface_8h_source.html#l00063">monitoring_interface.h:63</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md561"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md562"></a>
1. Error Handling</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>robust_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">try</span> {</div>
<div class="line">            <span class="comment">// Potentially failing operation</span></div>
<div class="line">            <span class="keyword">auto</span> data = read_external_source();</div>
<div class="line">            snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.custom_metric = process_data(data);</div>
<div class="line">        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">            <span class="comment">// Log error but don&#39;t propagate</span></div>
<div class="line">            <span class="comment">// The monitoring system handles collector errors</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md563"></a>
2. Caching Expensive Operations</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>cached_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">mutable</span> std::chrono::steady_clock::time_point last_update_;</div>
<div class="line">    <span class="keyword">mutable</span> std::uint64_t cached_value_;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> cache_duration = std::chrono::seconds(5);</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> now = std::chrono::steady_clock::now();</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (now - last_update_ &gt; cache_duration) {</div>
<div class="line">            cached_value_ = expensive_calculation();</div>
<div class="line">            last_update_ = now;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.custom_metric = cached_value_;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md564"></a>
3. Thread-Safe Collectors</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>thread_safe_collector : <span class="keyword">public</span> <a class="code hl_class" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html">monitoring_module::metrics_collector</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">mutable</span> std::mutex mutex_;</div>
<div class="line">    shared_resource resource_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d98/classmonitoring__module_1_1metrics__collector.html#a37e6cac79348fdb50ccfa32fad520cc3">collect</a>(<a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a>&amp; snapshot)<span class="keyword"> override </span>{</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; lock(mutex_);</div>
<div class="line">        snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.custom_metric = resource_.get_value();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> update_resource(<span class="keyword">const</span> data&amp; new_data) {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; lock(mutex_);</div>
<div class="line">        resource_.update(new_data);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md565"></a>
Testing Custom Collectors</h1>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../d9/d22/ring__buffer__test_8cpp.html#a00f7cf7e0a118da418e38a390949587d">TEST</a>(CollectorTest, CustomCollector) {</div>
<div class="line">    <span class="comment">// Create monitoring instance</span></div>
<div class="line">    <span class="keyword">auto</span> monitor = std::make_shared&lt;monitoring_module::monitoring&gt;();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Add custom collector</span></div>
<div class="line">    <span class="keyword">auto</span> collector = std::make_unique&lt;my_custom_collector&gt;();</div>
<div class="line">    monitor-&gt;add_collector(std::move(collector));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Force collection</span></div>
<div class="line">    monitor-&gt;collect_now();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Verify results</span></div>
<div class="line">    <span class="keyword">auto</span> snapshot = monitor-&gt;get_current_snapshot();</div>
<div class="line">    EXPECT_GT(snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.custom_metric, 0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Benchmark collector performance</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> BM_CollectorPerformance(benchmark::State&amp; state) {</div>
<div class="line">    <span class="keyword">auto</span> collector = std::make_unique&lt;my_custom_collector&gt;();</div>
<div class="line">    <a class="code hl_struct" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html">monitoring_interface::metrics_snapshot</a> snapshot;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> _ : state) {</div>
<div class="line">        collector-&gt;collect(snapshot);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_CollectorPerformance);</div>
<div class="ttc" id="alog__level__benchmark_8cpp_html_a5ac153b82890aad253a9a12b1c89543b"><div class="ttname"><a href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a></div><div class="ttdeci">BENCHMARK(BM_LogLevelFiltering_Enabled)</div></div>
<div class="ttc" id="aring__buffer__test_8cpp_html_a00f7cf7e0a118da418e38a390949587d"><div class="ttname"><a href="../../d9/d22/ring__buffer__test_8cpp.html#a00f7cf7e0a118da418e38a390949587d">TEST</a></div><div class="ttdeci">TEST(RingBufferGenericTest, DifferentTypes)</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d22/ring__buffer__test_8cpp_source.html#l00124">ring_buffer_test.cpp:124</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md566"></a>
Integration Example</h1>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../db/d5d/basic__usage__example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <span class="comment">// Create monitoring system</span></div>
<div class="line">    <span class="keyword">auto</span> monitor = std::make_shared&lt;monitoring_module::monitoring&gt;();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Add multiple collectors</span></div>
<div class="line">    monitor-&gt;add_collector(std::make_unique&lt;linux_cpu_collector&gt;());</div>
<div class="line">    monitor-&gt;add_collector(std::make_unique&lt;memory_collector&gt;());</div>
<div class="line">    monitor-&gt;add_collector(std::make_unique&lt;network_stats_collector&gt;());</div>
<div class="line">    monitor-&gt;add_collector(std::make_unique&lt;disk_io_collector&gt;());</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Start monitoring</span></div>
<div class="line">    monitor-&gt;start();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Your application runs here...</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Get comprehensive metrics</span></div>
<div class="line">    <span class="keyword">auto</span> snapshot = monitor-&gt;get_current_snapshot();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;System Metrics:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  CPU: &quot;</span> &lt;&lt; snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#aa7a000a777db44c0f6edaf97b87c9a5e">cpu_usage_percent</a> &lt;&lt; <span class="stringliteral">&quot;%&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  Memory: &quot;</span> &lt;&lt; snapshot.<a class="code hl_variable" href="../../dc/d59/structmonitoring__interface_1_1metrics__snapshot.html#ad44d60abb123f57185df9232e8ffea8e">system</a>.<a class="code hl_variable" href="../../df/d06/structmonitoring__interface_1_1system__metrics.html#a5d6218f3f24fabb62d05ed33abb6798e">memory_usage_bytes</a> / (1024*1024) &lt;&lt; <span class="stringliteral">&quot; MB&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    monitor-&gt;stop();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="abasic__usage__example_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="../../db/d5d/basic__usage__example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> <a href="../../db/d5d/basic__usage__example_8cpp_source.html#l00015">basic_usage_example.cpp:15</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
