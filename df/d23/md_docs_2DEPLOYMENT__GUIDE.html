<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Deployment Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d23/md_docs_2DEPLOYMENT__GUIDE.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Deployment Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md216"></a> </p>
<h1><a class="anchor" id="autotoc_md217"></a>
System Requirements</h1>
<h2><a class="anchor" id="autotoc_md218"></a>
Hardware Requirements</h2>
<h3><a class="anchor" id="autotoc_md219"></a>
Minimum Requirements</h3>
<ul>
<li><b>CPU</b>: 2 cores (x86_64 or ARM64)</li>
<li><b>RAM</b>: 4 GB</li>
<li><b>Storage</b>: 10 GB available space</li>
<li><b>Network</b>: 100 Mbps</li>
</ul>
<h3><a class="anchor" id="autotoc_md220"></a>
Recommended Requirements</h3>
<ul>
<li><b>CPU</b>: 8+ cores (x86_64 or ARM64)</li>
<li><b>RAM</b>: 16 GB</li>
<li><b>Storage</b>: 50 GB SSD</li>
<li><b>Network</b>: 1 Gbps</li>
</ul>
<h3><a class="anchor" id="autotoc_md221"></a>
Production Requirements</h3>
<ul>
<li><b>CPU</b>: 16+ cores (x86_64 or ARM64)</li>
<li><b>RAM</b>: 32+ GB</li>
<li><b>Storage</b>: 100+ GB NVMe SSD</li>
<li><b>Network</b>: 10 Gbps</li>
</ul>
<h2><a class="anchor" id="autotoc_md222"></a>
Operating System Support</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">OS   </th><th class="markdownTableHeadNone">Version   </th><th class="markdownTableHeadNone">Architecture   </th><th class="markdownTableHeadNone">Support Level    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Ubuntu   </td><td class="markdownTableBodyNone">20.04, 22.04   </td><td class="markdownTableBodyNone">x86_64, ARM64   </td><td class="markdownTableBodyNone">Full    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Debian   </td><td class="markdownTableBodyNone">11, 12   </td><td class="markdownTableBodyNone">x86_64, ARM64   </td><td class="markdownTableBodyNone">Full    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RHEL/CentOS   </td><td class="markdownTableBodyNone">8, 9   </td><td class="markdownTableBodyNone">x86_64   </td><td class="markdownTableBodyNone">Full    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">macOS   </td><td class="markdownTableBodyNone">11+, 12+, 13+   </td><td class="markdownTableBodyNone">x86_64, ARM64   </td><td class="markdownTableBodyNone">Full    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows   </td><td class="markdownTableBodyNone">10, 11, Server 2019+   </td><td class="markdownTableBodyNone">x86_64   </td><td class="markdownTableBodyNone">Partial    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Alpine Linux   </td><td class="markdownTableBodyNone">3.16+   </td><td class="markdownTableBodyNone">x86_64, ARM64   </td><td class="markdownTableBodyNone">Container only   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md223"></a>
Software Dependencies</h2>
<h3><a class="anchor" id="autotoc_md224"></a>
Build Dependencies</h3>
<div class="fragment"><div class="line"># Ubuntu/Debian</div>
<div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install -y \</div>
<div class="line">    build-essential \</div>
<div class="line">    cmake \</div>
<div class="line">    git \</div>
<div class="line">    pkg-config \</div>
<div class="line">    libssl-dev \</div>
<div class="line">    libpq-dev</div>
<div class="line"> </div>
<div class="line"># RHEL/CentOS</div>
<div class="line">sudo yum install -y \</div>
<div class="line">    gcc-c++ \</div>
<div class="line">    cmake3 \</div>
<div class="line">    git \</div>
<div class="line">    openssl-devel \</div>
<div class="line">    postgresql-devel</div>
<div class="line"> </div>
<div class="line"># macOS</div>
<div class="line">brew install \</div>
<div class="line">    cmake \</div>
<div class="line">    postgresql \</div>
<div class="line">    openssl</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md225"></a>
Runtime Dependencies</h3>
<ul>
<li>PostgreSQL 12+ (for database features)</li>
<li>OpenSSL 1.1.1+ (for SSL/TLS)</li>
<li>libc++ or libstdc++ (C++20 support)</li>
</ul>
<h1><a class="anchor" id="autotoc_md226"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md227"></a>
From Source</h2>
<h3><a class="anchor" id="autotoc_md228"></a>
1. Clone Repository</h3>
<div class="fragment"><div class="line">git clone https://github.com/yourorg/messaging_system.git</div>
<div class="line">cd messaging_system</div>
<div class="line">git submodule update --init --recursive</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md229"></a>
2. Configure Build</h3>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line"> </div>
<div class="line"># Standard build</div>
<div class="line">cmake .. \</div>
<div class="line">    -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">    -DCMAKE_INSTALL_PREFIX=/opt/messaging_system</div>
<div class="line"> </div>
<div class="line"># Custom configuration</div>
<div class="line">cmake .. \</div>
<div class="line">    -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">    -DCMAKE_INSTALL_PREFIX=/opt/messaging_system \</div>
<div class="line">    -DUSE_DATABASE=ON \</div>
<div class="line">    -DUSE_PYTHON_BINDING=OFF \</div>
<div class="line">    -DENABLE_LTO=ON \</div>
<div class="line">    -DENABLE_SIMD=ON</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md230"></a>
3. Build and Install</h3>
<div class="fragment"><div class="line"># Build</div>
<div class="line">cmake --build . --parallel $(nproc)</div>
<div class="line"> </div>
<div class="line"># Run tests</div>
<div class="line">ctest --output-on-failure</div>
<div class="line"> </div>
<div class="line"># Install</div>
<div class="line">sudo cmake --install .</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md231"></a>
Using Package Managers</h2>
<h3><a class="anchor" id="autotoc_md232"></a>
APT Repository (Ubuntu/Debian)</h3>
<div class="fragment"><div class="line"># Add repository</div>
<div class="line">echo &quot;deb https://repo.messaging-system.io/apt stable main&quot; | \</div>
<div class="line">    sudo tee /etc/apt/sources.list.d/messaging-system.list</div>
<div class="line"> </div>
<div class="line"># Add GPG key</div>
<div class="line">curl -fsSL https://repo.messaging-system.io/apt/gpg.key | \</div>
<div class="line">    sudo apt-key add -</div>
<div class="line"> </div>
<div class="line"># Install</div>
<div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install messaging-system</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md233"></a>
YUM Repository (RHEL/CentOS)</h3>
<div class="fragment"><div class="line"># Add repository</div>
<div class="line">sudo tee /etc/yum.repos.d/messaging-system.repo &lt;&lt;EOF</div>
<div class="line">[messaging-system]</div>
<div class="line">name=Messaging System Repository</div>
<div class="line">baseurl=https://repo.messaging-system.io/yum/\$releasever/\$basearch/</div>
<div class="line">enabled=1</div>
<div class="line">gpgcheck=1</div>
<div class="line">gpgkey=https://repo.messaging-system.io/yum/gpg.key</div>
<div class="line">EOF</div>
<div class="line"> </div>
<div class="line"># Install</div>
<div class="line">sudo yum install messaging-system</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md234"></a>
Docker Installation</h2>
<h3><a class="anchor" id="autotoc_md235"></a>
Pull Official Image</h3>
<div class="fragment"><div class="line">docker pull messaging-system/server:latest</div>
<div class="line">docker pull messaging-system/worker:latest</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md236"></a>
Build Custom Image</h3>
<div class="fragment"><div class="line"><span class="preprocessor"># Dockerfile</span></div>
<div class="line">FROM ubuntu:22.04 AS builder</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Install build dependencies</span></div>
<div class="line">RUN apt-get update &amp;&amp; apt-get install -y \</div>
<div class="line">    build-essential \</div>
<div class="line">    cmake \</div>
<div class="line">    git \</div>
<div class="line">    libpq-dev \</div>
<div class="line">    &amp;&amp; rm -rf /var/lib/apt/lists<span class="comment">/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Copy source</span></div>
<div class="line"><span class="comment">WORKDIR /build</span></div>
<div class="line"><span class="comment">COPY . .</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Build</span></div>
<div class="line"><span class="comment">RUN mkdir build &amp;&amp; cd build &amp;&amp; \</span></div>
<div class="line"><span class="comment">    cmake .. -DCMAKE_BUILD_TYPE=Release &amp;&amp; \</span></div>
<div class="line"><span class="comment">    cmake --build . --parallel</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Runtime image</span></div>
<div class="line"><span class="comment">FROM ubuntu:22.04</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Install runtime dependencies</span></div>
<div class="line"><span class="comment">RUN apt-get update &amp;&amp; apt-get install -y \</span></div>
<div class="line"><span class="comment">    libpq5 \</span></div>
<div class="line"><span class="comment">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Copy binaries</span></div>
<div class="line"><span class="comment">COPY --from=builder /build/build/bin/* /usr/local/bin/</span></div>
<div class="line"><span class="comment">COPY --from=builder /build/build/lib/* /usr/local/lib/</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Configuration</span></div>
<div class="line"><span class="comment">ENV LD_LIBRARY_PATH=/usr/local/lib</span></div>
<div class="line"><span class="comment">EXPOSE 8080 9090</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Health check</span></div>
<div class="line"><span class="comment">HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \</span></div>
<div class="line"><span class="comment">    CMD curl -f http://localhost:9090/health || exit 1</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Run</span></div>
<div class="line"><span class="comment">CMD [&quot;/usr/local/bin/messaging_server&quot;]</span></div>
</div><!-- fragment --><p>Build and run: </p><div class="fragment"><div class="line">docker build -t my-messaging-system .</div>
<div class="line">docker run -d \</div>
<div class="line">    --name messaging \</div>
<div class="line">    -p 8080:8080 \</div>
<div class="line">    -p 9090:9090 \</div>
<div class="line">    -v /etc/messaging:/etc/messaging \</div>
<div class="line">    my-messaging-system</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md237"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md238"></a>
Configuration File Structure</h2>
<div class="fragment"><div class="line">; /etc/messaging/config.ini</div>
<div class="line"> </div>
<div class="line">[system]</div>
<div class="line">instance_id = prod-server-01</div>
<div class="line">datacenter = us-east-1</div>
<div class="line">environment = production</div>
<div class="line">log_level = info</div>
<div class="line"> </div>
<div class="line">[network]</div>
<div class="line">bind_address = 0.0.0.0</div>
<div class="line">listen_port = 8080</div>
<div class="line">max_connections = 10000</div>
<div class="line">connection_timeout_ms = 5000</div>
<div class="line">keepalive_interval_s = 30</div>
<div class="line">enable_ssl = true</div>
<div class="line">ssl_cert_file = /etc/messaging/certs/server.crt</div>
<div class="line">ssl_key_file = /etc/messaging/certs/server.key</div>
<div class="line"> </div>
<div class="line">[database]</div>
<div class="line">host = db.internal.example.com</div>
<div class="line">port = 5432</div>
<div class="line">database = messaging_prod</div>
<div class="line">username = messaging_user</div>
<div class="line">password = ${DB_PASSWORD}</div>
<div class="line">pool_size = 50</div>
<div class="line">max_pool_size = 100</div>
<div class="line">connection_timeout_ms = 3000</div>
<div class="line">idle_timeout_s = 300</div>
<div class="line"> </div>
<div class="line">[message_bus]</div>
<div class="line">worker_threads = 16</div>
<div class="line">queue_size = 100000</div>
<div class="line">batch_size = 100</div>
<div class="line">enable_persistence = true</div>
<div class="line">persistence_path = /var/lib/messaging/queue</div>
<div class="line"> </div>
<div class="line">[monitoring]</div>
<div class="line">enable = true</div>
<div class="line">metrics_port = 9090</div>
<div class="line">metrics_path = /metrics</div>
<div class="line">enable_tracing = true</div>
<div class="line">jaeger_endpoint = http://jaeger:14268/api/traces</div>
<div class="line"> </div>
<div class="line">[security]</div>
<div class="line">enable_auth = true</div>
<div class="line">auth_type = jwt</div>
<div class="line">jwt_secret = ${JWT_SECRET}</div>
<div class="line">token_expiry_minutes = 60</div>
<div class="line">enable_rate_limiting = true</div>
<div class="line">rate_limit_window_s = 60</div>
<div class="line">rate_limit_requests = 1000</div>
<div class="line"> </div>
<div class="line">[clustering]</div>
<div class="line">enable = true</div>
<div class="line">cluster_name = messaging-prod</div>
<div class="line">discovery_method = consul</div>
<div class="line">consul_endpoint = consul.service.consul:8500</div>
<div class="line">heartbeat_interval_s = 5</div>
<div class="line">election_timeout_s = 10</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md239"></a>
Environment Variables</h2>
<div class="fragment"><div class="line"># System</div>
<div class="line">export MESSAGING_INSTANCE_ID=prod-01</div>
<div class="line">export MESSAGING_ENVIRONMENT=production</div>
<div class="line">export MESSAGING_LOG_LEVEL=info</div>
<div class="line"> </div>
<div class="line"># Network</div>
<div class="line">export MESSAGING_PORT=8080</div>
<div class="line">export MESSAGING_SSL_CERT=/etc/messaging/certs/server.crt</div>
<div class="line">export MESSAGING_SSL_KEY=/etc/messaging/certs/server.key</div>
<div class="line"> </div>
<div class="line"># Database</div>
<div class="line">export DB_HOST=localhost</div>
<div class="line">export DB_PORT=5432</div>
<div class="line">export DB_NAME=messaging_prod</div>
<div class="line">export DB_USER=messaging_user</div>
<div class="line">export DB_PASSWORD=secure_password_here</div>
<div class="line"> </div>
<div class="line"># Security</div>
<div class="line">export JWT_SECRET=your_jwt_secret_key_here</div>
<div class="line">export API_KEY=your_api_key_here</div>
<div class="line"> </div>
<div class="line"># Performance</div>
<div class="line">export WORKER_THREADS=16</div>
<div class="line">export MAX_CONNECTIONS=10000</div>
<div class="line">export QUEUE_SIZE=100000</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md240"></a>
Secrets Management</h2>
<h3><a class="anchor" id="autotoc_md241"></a>
Using HashiCorp Vault</h3>
<div class="fragment"><div class="line"># Store secrets in Vault</div>
<div class="line">vault kv put secret/messaging/prod \</div>
<div class="line">    db_password=&quot;secure_password&quot; \</div>
<div class="line">    jwt_secret=&quot;jwt_secret_key&quot; \</div>
<div class="line">    api_key=&quot;api_key_value&quot;</div>
<div class="line"> </div>
<div class="line"># Retrieve secrets at runtime</div>
<div class="line">export DB_PASSWORD=$(vault kv get -field=db_password secret/messaging/prod)</div>
<div class="line">export JWT_SECRET=$(vault kv get -field=jwt_secret secret/messaging/prod)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md242"></a>
Using Kubernetes Secrets</h3>
<div class="fragment"><div class="line">apiVersion: v1</div>
<div class="line">kind: Secret</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-secrets</div>
<div class="line">type: Opaque</div>
<div class="line">data:</div>
<div class="line">  db-password: &lt;base64-encoded-password&gt;</div>
<div class="line">  jwt-secret: &lt;base64-encoded-secret&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md243"></a>
Deployment Scenarios</h1>
<h2><a class="anchor" id="autotoc_md244"></a>
Single Server Deployment</h2>
<p>Suitable for development and small-scale production.</p>
<div class="fragment"><div class="line"># Install</div>
<div class="line">sudo apt-get install messaging-system</div>
<div class="line"> </div>
<div class="line"># Configure</div>
<div class="line">sudo vi /etc/messaging/config.ini</div>
<div class="line"> </div>
<div class="line"># Start service</div>
<div class="line">sudo systemctl start messaging-system</div>
<div class="line">sudo systemctl enable messaging-system</div>
<div class="line"> </div>
<div class="line"># Check status</div>
<div class="line">sudo systemctl status messaging-system</div>
<div class="line">sudo journalctl -u messaging-system -f</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md245"></a>
High Availability Deployment</h2>
<p>Multi-server setup with load balancing and failover.</p>
<h3><a class="anchor" id="autotoc_md246"></a>
Architecture</h3>
<div class="fragment"><div class="line">                ┌──────────────┐</div>
<div class="line">                │Load Balancer │</div>
<div class="line">                └──────┬───────┘</div>
<div class="line">                       │</div>
<div class="line">     ┌─────────────────┼─────────────────┐</div>
<div class="line">     │                 │                 │</div>
<div class="line">┌────▼────┐      ┌────▼────┐      ┌────▼────┐</div>
<div class="line">│Server 1 │      │Server 2 │      │Server 3 │</div>
<div class="line">└────┬────┘      └────┬────┘      └────┬────┘</div>
<div class="line">     │                 │                 │</div>
<div class="line">     └─────────────────┼─────────────────┘</div>
<div class="line">                       │</div>
<div class="line">                ┌──────▼──────┐</div>
<div class="line">                │  PostgreSQL  │</div>
<div class="line">                │   Cluster    │</div>
<div class="line">                └─────────────┘</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md247"></a>
HAProxy Configuration</h3>
<div class="fragment"><div class="line"># /etc/haproxy/haproxy.cfg</div>
<div class="line"> </div>
<div class="line">global</div>
<div class="line">    maxconn 50000</div>
<div class="line">    log /dev/log local0</div>
<div class="line">    user haproxy</div>
<div class="line">    group haproxy</div>
<div class="line">    daemon</div>
<div class="line"> </div>
<div class="line">defaults</div>
<div class="line">    mode tcp</div>
<div class="line">    log global</div>
<div class="line">    option tcplog</div>
<div class="line">    option dontlognull</div>
<div class="line">    timeout connect 5000ms</div>
<div class="line">    timeout client 50000ms</div>
<div class="line">    timeout server 50000ms</div>
<div class="line"> </div>
<div class="line">frontend messaging_frontend</div>
<div class="line">    bind *:8080</div>
<div class="line">    default_backend messaging_backend</div>
<div class="line"> </div>
<div class="line">backend messaging_backend</div>
<div class="line">    balance roundrobin</div>
<div class="line">    option tcp-check</div>
<div class="line"> </div>
<div class="line">    server msg1 10.0.1.10:8080 check</div>
<div class="line">    server msg2 10.0.1.11:8080 check</div>
<div class="line">    server msg3 10.0.1.12:8080 check</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md248"></a>
Kubernetes Deployment</h2>
<h3><a class="anchor" id="autotoc_md249"></a>
Namespace and ConfigMap</h3>
<div class="fragment"><div class="line"># namespace.yaml</div>
<div class="line">apiVersion: v1</div>
<div class="line">kind: Namespace</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-system</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"># configmap.yaml</div>
<div class="line">apiVersion: v1</div>
<div class="line">kind: ConfigMap</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-config</div>
<div class="line">  namespace: messaging-system</div>
<div class="line">data:</div>
<div class="line">  config.ini: |</div>
<div class="line">    [system]</div>
<div class="line">    environment = production</div>
<div class="line">    log_level = info</div>
<div class="line"> </div>
<div class="line">    [network]</div>
<div class="line">    listen_port = 8080</div>
<div class="line">    max_connections = 10000</div>
<div class="line"> </div>
<div class="line">    [database]</div>
<div class="line">    host = postgres-service</div>
<div class="line">    port = 5432</div>
<div class="line">    database = messaging</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md250"></a>
Deployment</h3>
<div class="fragment"><div class="line"># deployment.yaml</div>
<div class="line">apiVersion: apps/v1</div>
<div class="line">kind: Deployment</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-server</div>
<div class="line">  namespace: messaging-system</div>
<div class="line">spec:</div>
<div class="line">  replicas: 3</div>
<div class="line">  selector:</div>
<div class="line">    matchLabels:</div>
<div class="line">      app: messaging-server</div>
<div class="line">  template:</div>
<div class="line">    metadata:</div>
<div class="line">      labels:</div>
<div class="line">        app: messaging-server</div>
<div class="line">    spec:</div>
<div class="line">      containers:</div>
<div class="line">      - name: messaging</div>
<div class="line">        image: messaging-system/server:latest</div>
<div class="line">        ports:</div>
<div class="line">        - containerPort: 8080</div>
<div class="line">          name: messaging</div>
<div class="line">        - containerPort: 9090</div>
<div class="line">          name: metrics</div>
<div class="line">        env:</div>
<div class="line">        - name: DB_PASSWORD</div>
<div class="line">          valueFrom:</div>
<div class="line">            secretKeyRef:</div>
<div class="line">              name: messaging-secrets</div>
<div class="line">              key: db-password</div>
<div class="line">        - name: JWT_SECRET</div>
<div class="line">          valueFrom:</div>
<div class="line">            secretKeyRef:</div>
<div class="line">              name: messaging-secrets</div>
<div class="line">              key: jwt-secret</div>
<div class="line">        volumeMounts:</div>
<div class="line">        - name: config</div>
<div class="line">          mountPath: /etc/messaging</div>
<div class="line">        - name: data</div>
<div class="line">          mountPath: /var/lib/messaging</div>
<div class="line">        resources:</div>
<div class="line">          requests:</div>
<div class="line">            memory: &quot;2Gi&quot;</div>
<div class="line">            cpu: &quot;1000m&quot;</div>
<div class="line">          limits:</div>
<div class="line">            memory: &quot;4Gi&quot;</div>
<div class="line">            cpu: &quot;2000m&quot;</div>
<div class="line">        livenessProbe:</div>
<div class="line">          httpGet:</div>
<div class="line">            path: /health</div>
<div class="line">            port: 9090</div>
<div class="line">          initialDelaySeconds: 30</div>
<div class="line">          periodSeconds: 10</div>
<div class="line">        readinessProbe:</div>
<div class="line">          httpGet:</div>
<div class="line">            path: /ready</div>
<div class="line">            port: 9090</div>
<div class="line">          initialDelaySeconds: 5</div>
<div class="line">          periodSeconds: 5</div>
<div class="line">      volumes:</div>
<div class="line">      - name: config</div>
<div class="line">        configMap:</div>
<div class="line">          name: messaging-config</div>
<div class="line">      - name: data</div>
<div class="line">        persistentVolumeClaim:</div>
<div class="line">          claimName: messaging-data</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md251"></a>
Service and Ingress</h3>
<div class="fragment"><div class="line"># service.yaml</div>
<div class="line">apiVersion: v1</div>
<div class="line">kind: Service</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-service</div>
<div class="line">  namespace: messaging-system</div>
<div class="line">spec:</div>
<div class="line">  selector:</div>
<div class="line">    app: messaging-server</div>
<div class="line">  ports:</div>
<div class="line">  - name: messaging</div>
<div class="line">    port: 8080</div>
<div class="line">    targetPort: 8080</div>
<div class="line">  - name: metrics</div>
<div class="line">    port: 9090</div>
<div class="line">    targetPort: 9090</div>
<div class="line">  type: ClusterIP</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"># ingress.yaml</div>
<div class="line">apiVersion: networking.k8s.io/v1</div>
<div class="line">kind: Ingress</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-ingress</div>
<div class="line">  namespace: messaging-system</div>
<div class="line">  annotations:</div>
<div class="line">    kubernetes.io/ingress.class: nginx</div>
<div class="line">    cert-manager.io/cluster-issuer: letsencrypt-prod</div>
<div class="line">spec:</div>
<div class="line">  tls:</div>
<div class="line">  - hosts:</div>
<div class="line">    - messaging.example.com</div>
<div class="line">    secretName: messaging-tls</div>
<div class="line">  rules:</div>
<div class="line">  - host: messaging.example.com</div>
<div class="line">    http:</div>
<div class="line">      paths:</div>
<div class="line">      - path: /</div>
<div class="line">        pathType: Prefix</div>
<div class="line">        backend:</div>
<div class="line">          service:</div>
<div class="line">            name: messaging-service</div>
<div class="line">            port:</div>
<div class="line">              number: 8080</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md252"></a>
Horizontal Pod Autoscaler</h3>
<div class="fragment"><div class="line"># hpa.yaml</div>
<div class="line">apiVersion: autoscaling/v2</div>
<div class="line">kind: HorizontalPodAutoscaler</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-hpa</div>
<div class="line">  namespace: messaging-system</div>
<div class="line">spec:</div>
<div class="line">  scaleTargetRef:</div>
<div class="line">    apiVersion: apps/v1</div>
<div class="line">    kind: Deployment</div>
<div class="line">    name: messaging-server</div>
<div class="line">  minReplicas: 3</div>
<div class="line">  maxReplicas: 20</div>
<div class="line">  metrics:</div>
<div class="line">  - type: Resource</div>
<div class="line">    resource:</div>
<div class="line">      name: cpu</div>
<div class="line">      target:</div>
<div class="line">        type: Utilization</div>
<div class="line">        averageUtilization: 70</div>
<div class="line">  - type: Resource</div>
<div class="line">    resource:</div>
<div class="line">      name: memory</div>
<div class="line">      target:</div>
<div class="line">        type: Utilization</div>
<div class="line">        averageUtilization: 80</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md253"></a>
Docker Compose Deployment</h2>
<div class="fragment"><div class="line"># docker-compose.yml</div>
<div class="line">version: &#39;3.8&#39;</div>
<div class="line"> </div>
<div class="line">services:</div>
<div class="line">  postgres:</div>
<div class="line">    image: postgres:15-alpine</div>
<div class="line">    environment:</div>
<div class="line">      POSTGRES_DB: messaging</div>
<div class="line">      POSTGRES_USER: messaging_user</div>
<div class="line">      POSTGRES_PASSWORD: secure_password</div>
<div class="line">    volumes:</div>
<div class="line">      - postgres_data:/var/lib/postgresql/data</div>
<div class="line">    networks:</div>
<div class="line">      - messaging_network</div>
<div class="line">    healthcheck:</div>
<div class="line">      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U messaging_user&quot;]</div>
<div class="line">      interval: 10s</div>
<div class="line">      timeout: 5s</div>
<div class="line">      retries: 5</div>
<div class="line"> </div>
<div class="line">  redis:</div>
<div class="line">    image: redis:7-alpine</div>
<div class="line">    command: redis-server --appendonly yes</div>
<div class="line">    volumes:</div>
<div class="line">      - redis_data:/data</div>
<div class="line">    networks:</div>
<div class="line">      - messaging_network</div>
<div class="line">    healthcheck:</div>
<div class="line">      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]</div>
<div class="line">      interval: 10s</div>
<div class="line">      timeout: 5s</div>
<div class="line">      retries: 5</div>
<div class="line"> </div>
<div class="line">  messaging-server:</div>
<div class="line">    image: messaging-system/server:latest</div>
<div class="line">    depends_on:</div>
<div class="line">      postgres:</div>
<div class="line">        condition: service_healthy</div>
<div class="line">      redis:</div>
<div class="line">        condition: service_healthy</div>
<div class="line">    environment:</div>
<div class="line">      DB_HOST: postgres</div>
<div class="line">      DB_PORT: 5432</div>
<div class="line">      DB_NAME: messaging</div>
<div class="line">      DB_USER: messaging_user</div>
<div class="line">      DB_PASSWORD: secure_password</div>
<div class="line">      REDIS_HOST: redis</div>
<div class="line">      REDIS_PORT: 6379</div>
<div class="line">      WORKER_THREADS: 8</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;8080:8080&quot;</div>
<div class="line">      - &quot;9090:9090&quot;</div>
<div class="line">    volumes:</div>
<div class="line">      - ./config:/etc/messaging</div>
<div class="line">      - messaging_data:/var/lib/messaging</div>
<div class="line">    networks:</div>
<div class="line">      - messaging_network</div>
<div class="line">    deploy:</div>
<div class="line">      replicas: 3</div>
<div class="line">      resources:</div>
<div class="line">        limits:</div>
<div class="line">          cpus: &#39;2&#39;</div>
<div class="line">          memory: 2G</div>
<div class="line">        reservations:</div>
<div class="line">          cpus: &#39;1&#39;</div>
<div class="line">          memory: 1G</div>
<div class="line">    healthcheck:</div>
<div class="line">      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:9090/health&quot;]</div>
<div class="line">      interval: 30s</div>
<div class="line">      timeout: 10s</div>
<div class="line">      retries: 3</div>
<div class="line"> </div>
<div class="line">  nginx:</div>
<div class="line">    image: nginx:alpine</div>
<div class="line">    volumes:</div>
<div class="line">      - ./nginx.conf:/etc/nginx/nginx.conf</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;80:80&quot;</div>
<div class="line">      - &quot;443:443&quot;</div>
<div class="line">    depends_on:</div>
<div class="line">      - messaging-server</div>
<div class="line">    networks:</div>
<div class="line">      - messaging_network</div>
<div class="line"> </div>
<div class="line">volumes:</div>
<div class="line">  postgres_data:</div>
<div class="line">  redis_data:</div>
<div class="line">  messaging_data:</div>
<div class="line"> </div>
<div class="line">networks:</div>
<div class="line">  messaging_network:</div>
<div class="line">    driver: bridge</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md254"></a>
Performance Tuning</h1>
<h2><a class="anchor" id="autotoc_md255"></a>
System Tuning</h2>
<h3><a class="anchor" id="autotoc_md256"></a>
Linux Kernel Parameters</h3>
<div class="fragment"><div class="line"># /etc/sysctl.d/99-messaging.conf</div>
<div class="line"> </div>
<div class="line"># Network</div>
<div class="line">net.core.somaxconn = 65535</div>
<div class="line">net.core.netdev_max_backlog = 65536</div>
<div class="line">net.ipv4.tcp_max_syn_backlog = 65536</div>
<div class="line">net.ipv4.tcp_fin_timeout = 15</div>
<div class="line">net.ipv4.tcp_tw_reuse = 1</div>
<div class="line">net.ipv4.tcp_keepalive_time = 300</div>
<div class="line">net.ipv4.tcp_keepalive_probes = 5</div>
<div class="line">net.ipv4.tcp_keepalive_intvl = 15</div>
<div class="line"> </div>
<div class="line"># Memory</div>
<div class="line">vm.swappiness = 10</div>
<div class="line">vm.dirty_ratio = 15</div>
<div class="line">vm.dirty_background_ratio = 5</div>
<div class="line"> </div>
<div class="line"># File descriptors</div>
<div class="line">fs.file-max = 2097152</div>
<div class="line">fs.nr_open = 2097152</div>
<div class="line"> </div>
<div class="line"># Apply settings</div>
<div class="line">sudo sysctl -p /etc/sysctl.d/99-messaging.conf</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md257"></a>
ulimit Configuration</h3>
<div class="fragment"><div class="line"># /etc/security/limits.d/messaging.conf</div>
<div class="line"> </div>
<div class="line">messaging soft nofile 1048576</div>
<div class="line">messaging hard nofile 1048576</div>
<div class="line">messaging soft nproc 65536</div>
<div class="line">messaging hard nproc 65536</div>
<div class="line">messaging soft memlock unlimited</div>
<div class="line">messaging hard memlock unlimited</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md258"></a>
Application Tuning</h2>
<h3><a class="anchor" id="autotoc_md259"></a>
Thread Pool Configuration</h3>
<div class="fragment"><div class="line">[thread_pool]</div>
<div class="line">; Number of worker threads (2 * CPU cores recommended)</div>
<div class="line">worker_threads = 32</div>
<div class="line"> </div>
<div class="line">; Thread pool priorities</div>
<div class="line">realtime_threads = 4</div>
<div class="line">batch_threads = 16</div>
<div class="line">background_threads = 8</div>
<div class="line"> </div>
<div class="line">; CPU affinity (bind threads to specific cores)</div>
<div class="line">enable_cpu_affinity = true</div>
<div class="line">cpu_affinity_mask = 0xFFFFFFFF</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md260"></a>
Memory Management</h3>
<div class="fragment"><div class="line">[memory]</div>
<div class="line">; Object pool sizes</div>
<div class="line">message_pool_size = 10000</div>
<div class="line">buffer_pool_size = 1000</div>
<div class="line">connection_pool_size = 100</div>
<div class="line"> </div>
<div class="line">; Arena allocator settings</div>
<div class="line">arena_size_mb = 128</div>
<div class="line">arena_count = 4</div>
<div class="line"> </div>
<div class="line">; Garbage collection</div>
<div class="line">gc_interval_seconds = 60</div>
<div class="line">gc_threshold_mb = 1024</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md261"></a>
Network Optimization</h3>
<div class="fragment"><div class="line">[network_optimization]</div>
<div class="line">; TCP settings</div>
<div class="line">tcp_nodelay = true</div>
<div class="line">tcp_quickack = true</div>
<div class="line">socket_buffer_size = 1048576</div>
<div class="line"> </div>
<div class="line">; Connection pooling</div>
<div class="line">connection_pool_size = 100</div>
<div class="line">connection_idle_timeout_s = 300</div>
<div class="line">connection_max_age_s = 3600</div>
<div class="line"> </div>
<div class="line">; Batch processing</div>
<div class="line">enable_batching = true</div>
<div class="line">batch_size = 100</div>
<div class="line">batch_timeout_ms = 10</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md262"></a>
Database Tuning</h2>
<h3><a class="anchor" id="autotoc_md263"></a>
PostgreSQL Configuration</h3>
<div class="fragment"><div class="line"># postgresql.conf</div>
<div class="line"> </div>
<div class="line"># Connection settings</div>
<div class="line">max_connections = 200</div>
<div class="line">superuser_reserved_connections = 3</div>
<div class="line"> </div>
<div class="line"># Memory settings</div>
<div class="line">shared_buffers = 4GB</div>
<div class="line">effective_cache_size = 12GB</div>
<div class="line">maintenance_work_mem = 1GB</div>
<div class="line">work_mem = 64MB</div>
<div class="line"> </div>
<div class="line"># Write performance</div>
<div class="line">checkpoint_segments = 32</div>
<div class="line">checkpoint_completion_target = 0.9</div>
<div class="line">wal_buffers = 16MB</div>
<div class="line"> </div>
<div class="line"># Query tuning</div>
<div class="line">random_page_cost = 1.1</div>
<div class="line">effective_io_concurrency = 200</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md264"></a>
Connection Pool Tuning</h3>
<div class="fragment"><div class="line">[database_pool]</div>
<div class="line">min_connections = 10</div>
<div class="line">max_connections = 100</div>
<div class="line">connection_timeout_ms = 3000</div>
<div class="line">idle_timeout_s = 300</div>
<div class="line">validation_query = SELECT 1</div>
<div class="line">validation_interval_s = 30</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md265"></a>
Monitoring Setup</h1>
<h2><a class="anchor" id="autotoc_md266"></a>
Prometheus Integration</h2>
<h3><a class="anchor" id="autotoc_md267"></a>
Prometheus Configuration</h3>
<div class="fragment"><div class="line"># prometheus.yml</div>
<div class="line">global:</div>
<div class="line">  scrape_interval: 15s</div>
<div class="line">  evaluation_interval: 15s</div>
<div class="line"> </div>
<div class="line">scrape_configs:</div>
<div class="line">  - job_name: &#39;messaging-system&#39;</div>
<div class="line">    static_configs:</div>
<div class="line">      - targets:</div>
<div class="line">        - &#39;messaging-server-1:9090&#39;</div>
<div class="line">        - &#39;messaging-server-2:9090&#39;</div>
<div class="line">        - &#39;messaging-server-3:9090&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md268"></a>
Metrics Exposed</h3>
<div class="fragment"><div class="line"># System metrics</div>
<div class="line">messaging_system_uptime_seconds</div>
<div class="line">messaging_system_cpu_usage_percent</div>
<div class="line">messaging_system_memory_usage_bytes</div>
<div class="line">messaging_system_thread_count</div>
<div class="line"> </div>
<div class="line"># Message metrics</div>
<div class="line">messaging_messages_processed_total</div>
<div class="line">messaging_messages_failed_total</div>
<div class="line">messaging_message_processing_duration_seconds</div>
<div class="line">messaging_message_queue_size</div>
<div class="line"> </div>
<div class="line"># Network metrics</div>
<div class="line">messaging_connections_active</div>
<div class="line">messaging_connections_total</div>
<div class="line">messaging_bytes_sent_total</div>
<div class="line">messaging_bytes_received_total</div>
<div class="line"> </div>
<div class="line"># Database metrics</div>
<div class="line">messaging_db_connections_active</div>
<div class="line">messaging_db_queries_total</div>
<div class="line">messaging_db_query_duration_seconds</div>
<div class="line">messaging_db_errors_total</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md269"></a>
Grafana Dashboard</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;dashboard&quot;: {</div>
<div class="line">    &quot;title&quot;: &quot;Messaging System Dashboard&quot;,</div>
<div class="line">    &quot;panels&quot;: [</div>
<div class="line">      {</div>
<div class="line">        &quot;title&quot;: &quot;Message Throughput&quot;,</div>
<div class="line">        &quot;targets&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;expr&quot;: &quot;rate(messaging_messages_processed_total[5m])&quot;</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;title&quot;: &quot;Error Rate&quot;,</div>
<div class="line">        &quot;targets&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;expr&quot;: &quot;rate(messaging_messages_failed_total[5m])&quot;</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;title&quot;: &quot;Active Connections&quot;,</div>
<div class="line">        &quot;targets&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;expr&quot;: &quot;messaging_connections_active&quot;</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;title&quot;: &quot;CPU Usage&quot;,</div>
<div class="line">        &quot;targets&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;expr&quot;: &quot;messaging_system_cpu_usage_percent&quot;</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      }</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md270"></a>
Logging Configuration</h2>
<h3><a class="anchor" id="autotoc_md271"></a>
Structured Logging</h3>
<div class="fragment"><div class="line">[logging]</div>
<div class="line">; Log format</div>
<div class="line">format = json</div>
<div class="line"> </div>
<div class="line">; Log levels</div>
<div class="line">level = info</div>
<div class="line">levels.network = debug</div>
<div class="line">levels.database = warn</div>
<div class="line"> </div>
<div class="line">; Output destinations</div>
<div class="line">console.enabled = true</div>
<div class="line">file.enabled = true</div>
<div class="line">file.path = /var/log/messaging/messaging.log</div>
<div class="line">file.rotate_size_mb = 100</div>
<div class="line">file.rotate_count = 10</div>
<div class="line"> </div>
<div class="line">; Remote logging</div>
<div class="line">syslog.enabled = true</div>
<div class="line">syslog.address = syslog.example.com:514</div>
<div class="line">syslog.protocol = tcp</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md272"></a>
Log Aggregation (ELK Stack)</h3>
<div class="fragment"><div class="line"># filebeat.yml</div>
<div class="line">filebeat.inputs:</div>
<div class="line">- type: log</div>
<div class="line">  enabled: true</div>
<div class="line">  paths:</div>
<div class="line">    - /var/log/messaging/*.log</div>
<div class="line">  json.keys_under_root: true</div>
<div class="line">  json.add_error_key: true</div>
<div class="line"> </div>
<div class="line">output.elasticsearch:</div>
<div class="line">  hosts: [&quot;elasticsearch:9200&quot;]</div>
<div class="line">  index: &quot;messaging-%{+yyyy.MM.dd}&quot;</div>
<div class="line"> </div>
<div class="line">processors:</div>
<div class="line">  - add_host_metadata:</div>
<div class="line">      when.not.contains:</div>
<div class="line">        tags: forwarded</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md273"></a>
Scaling Strategies</h1>
<h2><a class="anchor" id="autotoc_md274"></a>
Horizontal Scaling</h2>
<h3><a class="anchor" id="autotoc_md275"></a>
Load Balancer Configuration</h3>
<div class="fragment"><div class="line"># nginx.conf</div>
<div class="line">upstream messaging_backend {</div>
<div class="line">    least_conn;</div>
<div class="line"> </div>
<div class="line">    server server1.example.com:8080 weight=5;</div>
<div class="line">    server server2.example.com:8080 weight=5;</div>
<div class="line">    server server3.example.com:8080 weight=5;</div>
<div class="line"> </div>
<div class="line">    # Backup servers</div>
<div class="line">    server backup1.example.com:8080 backup;</div>
<div class="line">    server backup2.example.com:8080 backup;</div>
<div class="line"> </div>
<div class="line">    # Health check</div>
<div class="line">    check interval=3000 rise=2 fall=3 timeout=1000;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md276"></a>
Auto-scaling Rules</h3>
<div class="fragment"><div class="line"># AWS Auto Scaling</div>
<div class="line">AutoScalingGroup:</div>
<div class="line">  MinSize: 3</div>
<div class="line">  MaxSize: 20</div>
<div class="line">  DesiredCapacity: 5</div>
<div class="line">  TargetGroupARNs:</div>
<div class="line">    - !Ref TargetGroup</div>
<div class="line">  MetricsCollection:</div>
<div class="line">    - Granularity: 1Minute</div>
<div class="line">  ScalingPolicies:</div>
<div class="line">    - PolicyName: ScaleUp</div>
<div class="line">      ScalingAdjustment: 2</div>
<div class="line">      AdjustmentType: ChangeInCapacity</div>
<div class="line">      Cooldown: 300</div>
<div class="line">      MetricAggregationType: Average</div>
<div class="line">      StepAdjustments:</div>
<div class="line">        - MetricIntervalLowerBound: 0</div>
<div class="line">          ScalingAdjustment: 2</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md277"></a>
Vertical Scaling</h2>
<h3><a class="anchor" id="autotoc_md278"></a>
Resource Allocation</h3>
<div class="fragment"><div class="line"># CPU affinity for high-performance</div>
<div class="line">taskset -c 0-15 /usr/local/bin/messaging_server</div>
<div class="line"> </div>
<div class="line"># Memory allocation</div>
<div class="line">numactl --cpubind=0 --membind=0 /usr/local/bin/messaging_server</div>
<div class="line"> </div>
<div class="line"># I/O scheduling</div>
<div class="line">echo noop &gt; /sys/block/sda/queue/scheduler</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md279"></a>
Database Scaling</h2>
<h3><a class="anchor" id="autotoc_md280"></a>
Read Replicas</h3>
<div class="fragment"><div class="line">[database_replicas]</div>
<div class="line">master.host = db-master.example.com</div>
<div class="line">master.port = 5432</div>
<div class="line"> </div>
<div class="line">replica1.host = db-replica1.example.com</div>
<div class="line">replica1.port = 5432</div>
<div class="line">replica1.weight = 1</div>
<div class="line"> </div>
<div class="line">replica2.host = db-replica2.example.com</div>
<div class="line">replica2.port = 5432</div>
<div class="line">replica2.weight = 1</div>
<div class="line"> </div>
<div class="line"># Read preference</div>
<div class="line">read_preference = replica</div>
<div class="line">failover_to_master = true</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md281"></a>
Sharding Strategy</h3>
<div class="fragment"><div class="line">[database_sharding]</div>
<div class="line">enable = true</div>
<div class="line">shard_count = 4</div>
<div class="line">shard_key = user_id</div>
<div class="line">distribution = consistent_hash</div>
<div class="line"> </div>
<div class="line">shard1.range = 0-25</div>
<div class="line">shard1.host = db-shard1.example.com</div>
<div class="line"> </div>
<div class="line">shard2.range = 26-50</div>
<div class="line">shard2.host = db-shard2.example.com</div>
<div class="line"> </div>
<div class="line">shard3.range = 51-75</div>
<div class="line">shard3.host = db-shard3.example.com</div>
<div class="line"> </div>
<div class="line">shard4.range = 76-100</div>
<div class="line">shard4.host = db-shard4.example.com</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md282"></a>
Backup and Recovery</h1>
<h2><a class="anchor" id="autotoc_md283"></a>
Backup Strategy</h2>
<h3><a class="anchor" id="autotoc_md284"></a>
Application State Backup</h3>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># backup.sh</div>
<div class="line"> </div>
<div class="line"># Configuration</div>
<div class="line">BACKUP_DIR=&quot;/backup/messaging&quot;</div>
<div class="line">DATE=$(date +%Y%m%d_%H%M%S)</div>
<div class="line">RETENTION_DAYS=30</div>
<div class="line"> </div>
<div class="line"># Create backup directory</div>
<div class="line">mkdir -p $BACKUP_DIR/$DATE</div>
<div class="line"> </div>
<div class="line"># Backup configuration</div>
<div class="line">cp -r /etc/messaging $BACKUP_DIR/$DATE/config</div>
<div class="line"> </div>
<div class="line"># Backup persistent queues</div>
<div class="line">cp -r /var/lib/messaging/queue $BACKUP_DIR/$DATE/queue</div>
<div class="line"> </div>
<div class="line"># Backup database</div>
<div class="line">pg_dump -h localhost -U messaging_user messaging &gt; \</div>
<div class="line">    $BACKUP_DIR/$DATE/database.sql</div>
<div class="line"> </div>
<div class="line"># Compress backup</div>
<div class="line">tar -czf $BACKUP_DIR/messaging_$DATE.tar.gz \</div>
<div class="line">    -C $BACKUP_DIR $DATE</div>
<div class="line"> </div>
<div class="line"># Remove uncompressed files</div>
<div class="line">rm -rf $BACKUP_DIR/$DATE</div>
<div class="line"> </div>
<div class="line"># Clean old backups</div>
<div class="line">find $BACKUP_DIR -name &quot;*.tar.gz&quot; -mtime +$RETENTION_DAYS -delete</div>
<div class="line"> </div>
<div class="line"># Upload to S3</div>
<div class="line">aws s3 cp $BACKUP_DIR/messaging_$DATE.tar.gz \</div>
<div class="line">    s3://backup-bucket/messaging/</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md285"></a>
Database Backup</h3>
<div class="fragment"><div class="line"><span class="comment">-- Continuous archiving with PostgreSQL</span></div>
<div class="line"><span class="comment">-- postgresql.conf</span></div>
<div class="line"> </div>
<div class="line">archive_mode = <span class="keyword">on</span></div>
<div class="line">archive_command = <span class="stringliteral">&#39;test ! -f /backup/wal/%f &amp;&amp; cp %p /backup/wal/%f&#39;</span></div>
<div class="line">archive_timeout = <span class="stringliteral">300</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">-- Base backup</span></div>
<div class="line">pg_basebackup -h localhost -D /backup/base -U replicator -W -P</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md286"></a>
Recovery Procedures</h2>
<h3><a class="anchor" id="autotoc_md287"></a>
Service Recovery</h3>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># recovery.sh</div>
<div class="line"> </div>
<div class="line"># Stop services</div>
<div class="line">systemctl stop messaging-system</div>
<div class="line"> </div>
<div class="line"># Restore from backup</div>
<div class="line">BACKUP_FILE=$1</div>
<div class="line">RESTORE_DIR=&quot;/tmp/restore&quot;</div>
<div class="line"> </div>
<div class="line"># Extract backup</div>
<div class="line">tar -xzf $BACKUP_FILE -C $RESTORE_DIR</div>
<div class="line"> </div>
<div class="line"># Restore configuration</div>
<div class="line">cp -r $RESTORE_DIR/*/config/* /etc/messaging/</div>
<div class="line"> </div>
<div class="line"># Restore queue data</div>
<div class="line">cp -r $RESTORE_DIR/*/queue/* /var/lib/messaging/queue/</div>
<div class="line"> </div>
<div class="line"># Restore database</div>
<div class="line">psql -h localhost -U messaging_user messaging &lt; \</div>
<div class="line">    $RESTORE_DIR/*/database.sql</div>
<div class="line"> </div>
<div class="line"># Start services</div>
<div class="line">systemctl start messaging-system</div>
<div class="line"> </div>
<div class="line"># Verify recovery</div>
<div class="line">curl http://localhost:9090/health</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md288"></a>
Disaster Recovery Plan</h3>
<div class="fragment"><div class="line"># Disaster Recovery Configuration</div>
<div class="line">DR:</div>
<div class="line">  RPO: 15 minutes  # Recovery Point Objective</div>
<div class="line">  RTO: 1 hour      # Recovery Time Objective</div>
<div class="line"> </div>
<div class="line">  Primary_Site:</div>
<div class="line">    Region: us-east-1</div>
<div class="line">    Database: rds-primary.amazonaws.com</div>
<div class="line"> </div>
<div class="line">  Secondary_Site:</div>
<div class="line">    Region: us-west-2</div>
<div class="line">    Database: rds-secondary.amazonaws.com</div>
<div class="line">    Replication_Lag: 5 seconds</div>
<div class="line"> </div>
<div class="line">  Failover_Procedure:</div>
<div class="line">    1. Detect primary failure</div>
<div class="line">    2. Promote secondary database</div>
<div class="line">    3. Update DNS to point to secondary</div>
<div class="line">    4. Start services in secondary region</div>
<div class="line">    5. Verify system health</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md289"></a>
Security Hardening</h1>
<h2><a class="anchor" id="autotoc_md290"></a>
Network Security</h2>
<h3><a class="anchor" id="autotoc_md291"></a>
Firewall Rules</h3>
<div class="fragment"><div class="line"># iptables rules</div>
<div class="line">iptables -A INPUT -p tcp --dport 8080 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT</div>
<div class="line">iptables -A INPUT -p tcp --dport 9090 -s 10.0.0.0/8 -j ACCEPT  # Metrics only from internal</div>
<div class="line">iptables -A INPUT -p tcp --dport 5432 -s 10.0.0.0/8 -j ACCEPT  # Database from internal</div>
<div class="line">iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</div>
<div class="line">iptables -A INPUT -j DROP</div>
<div class="line"> </div>
<div class="line"># Save rules</div>
<div class="line">iptables-save &gt; /etc/iptables/rules.v4</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md292"></a>
SSL/TLS Configuration</h3>
<div class="fragment"><div class="line">[security.ssl]</div>
<div class="line">enabled = true</div>
<div class="line">min_version = TLSv1.3</div>
<div class="line">cert_file = /etc/messaging/certs/server.crt</div>
<div class="line">key_file = /etc/messaging/certs/server.key</div>
<div class="line">ca_file = /etc/messaging/certs/ca.crt</div>
<div class="line">verify_client = true</div>
<div class="line">cipher_suites = TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md293"></a>
Application Security</h2>
<h3><a class="anchor" id="autotoc_md294"></a>
Authentication</h3>
<div class="fragment"><div class="line">[security.auth]</div>
<div class="line">type = jwt</div>
<div class="line">algorithm = RS256</div>
<div class="line">public_key_file = /etc/messaging/keys/public.pem</div>
<div class="line">private_key_file = /etc/messaging/keys/private.pem</div>
<div class="line">token_expiry = 3600</div>
<div class="line">refresh_token_expiry = 86400</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md295"></a>
Rate Limiting</h3>
<div class="fragment"><div class="line">[security.rate_limit]</div>
<div class="line">enabled = true</div>
<div class="line">window_seconds = 60</div>
<div class="line">max_requests = 1000</div>
<div class="line">burst_size = 100</div>
<div class="line">blacklist_threshold = 10</div>
<div class="line">blacklist_duration = 3600</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md296"></a>
Compliance</h2>
<h3><a class="anchor" id="autotoc_md297"></a>
Audit Logging</h3>
<div class="fragment"><div class="line">[audit]</div>
<div class="line">enabled = true</div>
<div class="line">log_file = /var/log/messaging/audit.log</div>
<div class="line">log_format = json</div>
<div class="line">log_level = info</div>
<div class="line"> </div>
<div class="line">events_to_log = [</div>
<div class="line">    &quot;authentication&quot;,</div>
<div class="line">    &quot;authorization&quot;,</div>
<div class="line">    &quot;configuration_change&quot;,</div>
<div class="line">    &quot;data_access&quot;,</div>
<div class="line">    &quot;data_modification&quot;,</div>
<div class="line">    &quot;system_start&quot;,</div>
<div class="line">    &quot;system_stop&quot;</div>
<div class="line">]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md298"></a>
Data Encryption</h3>
<div class="fragment"><div class="line">[security.encryption]</div>
<div class="line">data_at_rest = true</div>
<div class="line">algorithm = AES-256-GCM</div>
<div class="line">key_rotation_days = 90</div>
<div class="line">key_store = /etc/messaging/keys/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md299"></a>
Troubleshooting Deployment</h1>
<h2><a class="anchor" id="autotoc_md300"></a>
Common Issues</h2>
<h3><a class="anchor" id="autotoc_md301"></a>
Service Won't Start</h3>
<div class="fragment"><div class="line"># Check logs</div>
<div class="line">journalctl -u messaging-system -n 100</div>
<div class="line"> </div>
<div class="line"># Check configuration</div>
<div class="line">/usr/local/bin/messaging_server --validate-config</div>
<div class="line"> </div>
<div class="line"># Check permissions</div>
<div class="line">ls -la /etc/messaging/</div>
<div class="line">ls -la /var/lib/messaging/</div>
<div class="line"> </div>
<div class="line"># Check port availability</div>
<div class="line">netstat -tulpn | grep 8080</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md302"></a>
High Memory Usage</h3>
<div class="fragment"><div class="line"># Check memory usage</div>
<div class="line">ps aux | grep messaging</div>
<div class="line">top -p $(pgrep messaging)</div>
<div class="line"> </div>
<div class="line"># Memory profiling</div>
<div class="line">pmap -x $(pgrep messaging)</div>
<div class="line"> </div>
<div class="line"># Check for leaks</div>
<div class="line">valgrind --leak-check=full /usr/local/bin/messaging_server</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md303"></a>
Performance Issues</h3>
<div class="fragment"><div class="line"># CPU profiling</div>
<div class="line">perf top -p $(pgrep messaging)</div>
<div class="line"> </div>
<div class="line"># I/O analysis</div>
<div class="line">iotop -p $(pgrep messaging)</div>
<div class="line"> </div>
<div class="line"># Network analysis</div>
<div class="line">ss -tunapl | grep messaging</div>
<div class="line">tcpdump -i eth0 port 8080</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md304"></a>
Health Checks</h2>
<h3><a class="anchor" id="autotoc_md305"></a>
Application Health</h3>
<div class="fragment"><div class="line"># Basic health check</div>
<div class="line">curl http://localhost:9090/health</div>
<div class="line"> </div>
<div class="line"># Detailed health check</div>
<div class="line">curl http://localhost:9090/health/detailed</div>
<div class="line"> </div>
<div class="line"># Response format</div>
<div class="line">{</div>
<div class="line">  &quot;status&quot;: &quot;healthy&quot;,</div>
<div class="line">  &quot;uptime&quot;: 3600,</div>
<div class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</div>
<div class="line">  &quot;components&quot;: {</div>
<div class="line">    &quot;database&quot;: &quot;healthy&quot;,</div>
<div class="line">    &quot;queue&quot;: &quot;healthy&quot;,</div>
<div class="line">    &quot;cache&quot;: &quot;healthy&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md306"></a>
System Health</h3>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># health_check.sh</div>
<div class="line"> </div>
<div class="line"># Check service status</div>
<div class="line">if ! systemctl is-active --quiet messaging-system; then</div>
<div class="line">    echo &quot;Service is not running&quot;</div>
<div class="line">    exit 1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Check port availability</div>
<div class="line">if ! nc -z localhost 8080; then</div>
<div class="line">    echo &quot;Port 8080 is not accessible&quot;</div>
<div class="line">    exit 1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Check database connection</div>
<div class="line">if ! psql -h localhost -U messaging_user -c &quot;SELECT 1&quot; &gt; /dev/null 2&gt;&amp;1; then</div>
<div class="line">    echo &quot;Database is not accessible&quot;</div>
<div class="line">    exit 1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">echo &quot;All health checks passed&quot;</div>
<div class="line">exit 0</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
