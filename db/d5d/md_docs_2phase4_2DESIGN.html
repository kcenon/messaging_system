<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Phase 4: Validation and Deployment - Design Document</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d5d/md_docs_2phase4_2DESIGN.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Phase 4: Validation and Deployment - Design Document</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2142"></a> </p>
<h1><a class="anchor" id="autotoc_md2143"></a>
Overview</h1>
<p>Comprehensive validation, testing, benchmarking, security review, and production deployment preparation.</p>
<h1><a class="anchor" id="autotoc_md2144"></a>
Architecture</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────┐</div>
<div class="line">│                      Validation Pipeline                     │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│  Unit Tests → Integration Tests → Performance Tests         │</div>
<div class="line">│       ↓              ↓                    ↓                  │</div>
<div class="line">│  Code Coverage → Security Scan → Benchmark Results          │</div>
<div class="line">│       ↓              ↓                    ↓                  │</div>
<div class="line">│  Quality Gate → Documentation → Deployment Artifacts        │</div>
<div class="line">└─────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2145"></a>
Component Designs</h1>
<h2><a class="anchor" id="autotoc_md2146"></a>
1. Unit Test Framework (Task 4.1)</h2>
<p><b>Directory Structure:</b></p>
<div class="fragment"><div class="line">test/</div>
<div class="line">├── unit/</div>
<div class="line">│   ├── core/</div>
<div class="line">│   │   ├── test_messaging_container.cpp</div>
<div class="line">│   │   ├── test_message_bus.cpp</div>
<div class="line">│   │   └── test_topic_router.cpp</div>
<div class="line">│   ├── integration/</div>
<div class="line">│   │   ├── test_network_bridge.cpp</div>
<div class="line">│   │   ├── test_persistent_queue.cpp</div>
<div class="line">│   │   ├── test_trace_context.cpp</div>
<div class="line">│   │   └── test_config_loader.cpp</div>
<div class="line">│   └── test_main.cpp</div>
<div class="line">├── integration/</div>
<div class="line">│   ├── test_end_to_end.cpp</div>
<div class="line">│   ├── test_multi_subscriber.cpp</div>
<div class="line">│   └── test_failover.cpp</div>
<div class="line">├── benchmarks/</div>
<div class="line">│   ├── bench_message_creation.cpp</div>
<div class="line">│   ├── bench_routing.cpp</div>
<div class="line">│   ├── bench_serialization.cpp</div>
<div class="line">│   └── bench_network_throughput.cpp</div>
<div class="line">└── CMakeLists.txt</div>
</div><!-- fragment --><p><b>Test CMakeLists.txt:</b></p>
<div class="fragment"><div class="line"># test/CMakeLists.txt</div>
<div class="line"> </div>
<div class="line">find_package(GTest REQUIRED)</div>
<div class="line">find_package(benchmark REQUIRED)</div>
<div class="line"> </div>
<div class="line"># ============================================================================</div>
<div class="line"># Unit Tests</div>
<div class="line"># ============================================================================</div>
<div class="line"> </div>
<div class="line">add_executable(messaging_tests</div>
<div class="line">    unit/core/test_messaging_container.cpp</div>
<div class="line">    unit/core/test_message_bus.cpp</div>
<div class="line">    unit/core/test_topic_router.cpp</div>
<div class="line">    unit/integration/test_network_bridge.cpp</div>
<div class="line">    unit/integration/test_persistent_queue.cpp</div>
<div class="line">    unit/integration/test_trace_context.cpp</div>
<div class="line">    unit/integration/test_config_loader.cpp</div>
<div class="line">    unit/test_main.cpp</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">target_link_libraries(messaging_tests</div>
<div class="line">    PRIVATE</div>
<div class="line">        messaging_system_core</div>
<div class="line">        GTest::GTest</div>
<div class="line">        GTest::Main</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">target_compile_definitions(messaging_tests PRIVATE</div>
<div class="line">    TESTING_MODE</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Enable code coverage</div>
<div class="line">if(CMAKE_BUILD_TYPE STREQUAL &quot;Debug&quot;)</div>
<div class="line">    target_compile_options(messaging_tests PRIVATE</div>
<div class="line">        --coverage</div>
<div class="line">        -fprofile-arcs</div>
<div class="line">        -ftest-coverage</div>
<div class="line">    )</div>
<div class="line">    target_link_options(messaging_tests PRIVATE</div>
<div class="line">        --coverage</div>
<div class="line">    )</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line"># ============================================================================</div>
<div class="line"># Integration Tests</div>
<div class="line"># ============================================================================</div>
<div class="line"> </div>
<div class="line">add_executable(messaging_integration_tests</div>
<div class="line">    integration/test_end_to_end.cpp</div>
<div class="line">    integration/test_multi_subscriber.cpp</div>
<div class="line">    integration/test_failover.cpp</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">target_link_libraries(messaging_integration_tests</div>
<div class="line">    PRIVATE</div>
<div class="line">        messaging_system_core</div>
<div class="line">        GTest::GTest</div>
<div class="line">        GTest::Main</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># ============================================================================</div>
<div class="line"># Benchmarks</div>
<div class="line"># ============================================================================</div>
<div class="line"> </div>
<div class="line">add_executable(messaging_benchmarks</div>
<div class="line">    benchmarks/bench_message_creation.cpp</div>
<div class="line">    benchmarks/bench_routing.cpp</div>
<div class="line">    benchmarks/bench_serialization.cpp</div>
<div class="line">    benchmarks/bench_network_throughput.cpp</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">target_link_libraries(messaging_benchmarks</div>
<div class="line">    PRIVATE</div>
<div class="line">        messaging_system_core</div>
<div class="line">        benchmark::benchmark</div>
<div class="line">        benchmark::benchmark_main</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># ============================================================================</div>
<div class="line"># Test Registration</div>
<div class="line"># ============================================================================</div>
<div class="line"> </div>
<div class="line">include(GoogleTest)</div>
<div class="line">gtest_discover_tests(messaging_tests)</div>
<div class="line">gtest_discover_tests(messaging_integration_tests)</div>
<div class="line"> </div>
<div class="line"># Add custom target for all tests</div>
<div class="line">add_custom_target(run_all_tests</div>
<div class="line">    COMMAND ${CMAKE_CTEST_COMMAND} --output-on-failure</div>
<div class="line">    DEPENDS messaging_tests messaging_integration_tests</div>
<div class="line">    COMMENT &quot;Running all tests&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Add custom target for benchmarks</div>
<div class="line">add_custom_target(run_benchmarks</div>
<div class="line">    COMMAND $&lt;TARGET_FILE:messaging_benchmarks&gt; --benchmark_format=json --benchmark_out=benchmark_results.json</div>
<div class="line">    DEPENDS messaging_benchmarks</div>
<div class="line">    COMMENT &quot;Running benchmarks&quot;</div>
<div class="line">)</div>
</div><!-- fragment --><p><b>Example Test: MessagingContainer</b></p>
<p><b>File:</b> <code>test/unit/core/test_messaging_container.cpp</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;messaging_system/core/messaging_container.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>messaging;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MessagingContainerTest : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keywordtype">void</span> SetUp()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Setup code if needed</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> TearDown()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Cleanup code if needed</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(MessagingContainerTest, CreateValidMessage) {</div>
<div class="line">    <span class="keyword">auto</span> result = MessagingContainer::create(<span class="stringliteral">&quot;source1&quot;</span>, <span class="stringliteral">&quot;target1&quot;</span>, <span class="stringliteral">&quot;user.created&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ASSERT_TRUE(result.is_ok());</div>
<div class="line">    <span class="keyword">auto</span> msg = result.value();</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(msg.source(), <span class="stringliteral">&quot;source1&quot;</span>);</div>
<div class="line">    EXPECT_EQ(msg.target(), <span class="stringliteral">&quot;target1&quot;</span>);</div>
<div class="line">    EXPECT_EQ(msg.topic(), <span class="stringliteral">&quot;user.created&quot;</span>);</div>
<div class="line">    EXPECT_FALSE(msg.trace_id().empty());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(MessagingContainerTest, CreateInvalidMessage_EmptyTopic) {</div>
<div class="line">    <span class="keyword">auto</span> result = MessagingContainer::create(<span class="stringliteral">&quot;source1&quot;</span>, <span class="stringliteral">&quot;target1&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ASSERT_TRUE(result.is_error());</div>
<div class="line">    EXPECT_EQ(result.error().code, error::INVALID_MESSAGE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(MessagingContainerTest, SerializeAndDeserialize) {</div>
<div class="line">    <span class="keyword">auto</span> create_result = MessagingContainer::create(<span class="stringliteral">&quot;source1&quot;</span>, <span class="stringliteral">&quot;target1&quot;</span>, <span class="stringliteral">&quot;test.topic&quot;</span>);</div>
<div class="line">    ASSERT_TRUE(create_result.is_ok());</div>
<div class="line">    <span class="keyword">auto</span> original = create_result.value();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add some data</span></div>
<div class="line">    original.container().set_value(<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;value1&quot;</span>);</div>
<div class="line">    original.container().set_value(<span class="stringliteral">&quot;key2&quot;</span>, 42);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Serialize</span></div>
<div class="line">    <span class="keyword">auto</span> serialize_result = original.serialize();</div>
<div class="line">    ASSERT_TRUE(serialize_result.is_ok());</div>
<div class="line">    <span class="keyword">auto</span> bytes = serialize_result.value();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Deserialize</span></div>
<div class="line">    <span class="keyword">auto</span> deserialize_result = MessagingContainer::deserialize(bytes);</div>
<div class="line">    ASSERT_TRUE(deserialize_result.is_ok());</div>
<div class="line">    <span class="keyword">auto</span> restored = deserialize_result.value();</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(restored.source(), original.source());</div>
<div class="line">    EXPECT_EQ(restored.target(), original.target());</div>
<div class="line">    EXPECT_EQ(restored.topic(), original.topic());</div>
<div class="line">    EXPECT_EQ(restored.trace_id(), original.trace_id());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(MessagingContainerTest, BuilderPattern) {</div>
<div class="line">    <span class="keyword">auto</span> result = MessagingContainerBuilder()</div>
<div class="line">        .source(<span class="stringliteral">&quot;src&quot;</span>)</div>
<div class="line">        .target(<span class="stringliteral">&quot;tgt&quot;</span>)</div>
<div class="line">        .topic(<span class="stringliteral">&quot;user.login&quot;</span>)</div>
<div class="line">        .add_value(<span class="stringliteral">&quot;user_id&quot;</span>, <span class="stringliteral">&quot;12345&quot;</span>)</div>
<div class="line">        .add_value(<span class="stringliteral">&quot;timestamp&quot;</span>, 1234567890)</div>
<div class="line">        .optimize_for_speed()</div>
<div class="line">        .build();</div>
<div class="line"> </div>
<div class="line">    ASSERT_TRUE(result.is_ok());</div>
<div class="line">    <span class="keyword">auto</span> msg = result.value();</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(msg.source(), <span class="stringliteral">&quot;src&quot;</span>);</div>
<div class="line">    EXPECT_EQ(msg.topic(), <span class="stringliteral">&quot;user.login&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Performance test</span></div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(MessagingContainerTest, CreationPerformance) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> iterations = 1000000;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; iterations; ++i) {</div>
<div class="line">        <span class="keyword">auto</span> result = MessagingContainer::create(<span class="stringliteral">&quot;src&quot;</span>, <span class="stringliteral">&quot;tgt&quot;</span>, <span class="stringliteral">&quot;topic&quot;</span>);</div>
<div class="line">        ASSERT_TRUE(result.is_ok());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::now();</div>
<div class="line">    <span class="keyword">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(end - start);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> ops_per_sec = (iterations * 1000000.0) / duration.count();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Target: 5M containers/sec</span></div>
<div class="line">    EXPECT_GT(ops_per_sec, 5000000.0)</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Performance below target: &quot;</span> &lt;&lt; ops_per_sec &lt;&lt; <span class="stringliteral">&quot; ops/sec&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="atest__messaging__integration_8cpp_html_afa9a03b8890cf589bc9d9246e1149b1b"><div class="ttname"><a href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a></div><div class="ttdeci">TEST_F(MessagingIntegrationTest, EndToEndMessaging)</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d62/test__messaging__integration_8cpp_source.html#l00038">test_messaging_integration.cpp:38</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2147"></a>
2. Integration Tests (Task 4.1)</h2>
<p><b>File:</b> <code>test/integration/test_end_to_end.cpp</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;messaging_system/core/message_bus.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;messaging_system/core/topic_router.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;messaging_system/integration/network_bridge.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/thread/core/thread_pool.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>messaging;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>EndToEndTest : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    std::shared_ptr&lt;thread::thread_pool&gt; io_executor_;</div>
<div class="line">    std::shared_ptr&lt;thread::thread_pool&gt; work_executor_;</div>
<div class="line">    std::shared_ptr&lt;TopicRouter&gt; router_;</div>
<div class="line">    std::shared_ptr&lt;MessageBus&gt; message_bus_;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> SetUp()<span class="keyword"> override </span>{</div>
<div class="line">        io_executor_ = std::make_shared&lt;thread::thread_pool&gt;(2);</div>
<div class="line">        work_executor_ = std::make_shared&lt;thread::thread_pool&gt;(4);</div>
<div class="line">        router_ = std::make_shared&lt;TopicRouter&gt;(work_executor_);</div>
<div class="line">        message_bus_ = std::make_shared&lt;MessageBus&gt;(io_executor_, work_executor_, router_);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> start_result = message_bus_-&gt;start();</div>
<div class="line">        ASSERT_TRUE(start_result.is_ok());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> TearDown()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> stop_result = message_bus_-&gt;stop();</div>
<div class="line">        ASSERT_TRUE(stop_result.is_ok());</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(EndToEndTest, PublishAndSubscribe) {</div>
<div class="line">    std::atomic&lt;int&gt; received_count{0};</div>
<div class="line">    std::string received_topic;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Subscribe</span></div>
<div class="line">    <span class="keyword">auto</span> subscribe_result = message_bus_-&gt;subscribe(</div>
<div class="line">        <span class="stringliteral">&quot;user.created&quot;</span>,</div>
<div class="line">        [&amp;](<span class="keyword">const</span> MessagingContainer&amp; msg) -&gt; Result&lt;void&gt; {</div>
<div class="line">            received_count++;</div>
<div class="line">            received_topic = msg.topic();</div>
<div class="line">            <span class="keywordflow">return</span> VoidResult::ok();</div>
<div class="line">        }</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    ASSERT_TRUE(subscribe_result.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Publish</span></div>
<div class="line">    <span class="keyword">auto</span> msg_result = MessagingContainer::create(<span class="stringliteral">&quot;test_src&quot;</span>, <span class="stringliteral">&quot;test_tgt&quot;</span>, <span class="stringliteral">&quot;user.created&quot;</span>);</div>
<div class="line">    ASSERT_TRUE(msg_result.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> publish_result = message_bus_-&gt;publish_async(msg_result.value());</div>
<div class="line">    ASSERT_TRUE(publish_result.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for message processing</span></div>
<div class="line">    std::this_thread::sleep_for(std::chrono::milliseconds(100));</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(received_count.load(), 1);</div>
<div class="line">    EXPECT_EQ(received_topic, <span class="stringliteral">&quot;user.created&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(EndToEndTest, MultipleSubscribers) {</div>
<div class="line">    std::atomic&lt;int&gt; subscriber1_count{0};</div>
<div class="line">    std::atomic&lt;int&gt; subscriber2_count{0};</div>
<div class="line">    std::atomic&lt;int&gt; subscriber3_count{0};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Subscribe three handlers to same topic</span></div>
<div class="line">    <span class="keyword">auto</span> sub1 = message_bus_-&gt;subscribe(<span class="stringliteral">&quot;order.placed&quot;</span>,</div>
<div class="line">        [&amp;](<span class="keyword">const</span> MessagingContainer&amp;) { subscriber1_count++; <span class="keywordflow">return</span> VoidResult::ok(); });</div>
<div class="line">    <span class="keyword">auto</span> sub2 = message_bus_-&gt;subscribe(<span class="stringliteral">&quot;order.placed&quot;</span>,</div>
<div class="line">        [&amp;](<span class="keyword">const</span> MessagingContainer&amp;) { subscriber2_count++; <span class="keywordflow">return</span> VoidResult::ok(); });</div>
<div class="line">    <span class="keyword">auto</span> sub3 = message_bus_-&gt;subscribe(<span class="stringliteral">&quot;order.placed&quot;</span>,</div>
<div class="line">        [&amp;](<span class="keyword">const</span> MessagingContainer&amp;) { subscriber3_count++; <span class="keywordflow">return</span> VoidResult::ok(); });</div>
<div class="line"> </div>
<div class="line">    ASSERT_TRUE(sub1.is_ok() &amp;&amp; sub2.is_ok() &amp;&amp; sub3.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Publish one message</span></div>
<div class="line">    <span class="keyword">auto</span> msg = MessagingContainer::create(<span class="stringliteral">&quot;src&quot;</span>, <span class="stringliteral">&quot;tgt&quot;</span>, <span class="stringliteral">&quot;order.placed&quot;</span>);</div>
<div class="line">    ASSERT_TRUE(msg.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> publish = message_bus_-&gt;publish_async(msg.value());</div>
<div class="line">    ASSERT_TRUE(publish.is_ok());</div>
<div class="line"> </div>
<div class="line">    std::this_thread::sleep_for(std::chrono::milliseconds(100));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// All three subscribers should receive it</span></div>
<div class="line">    EXPECT_EQ(subscriber1_count.load(), 1);</div>
<div class="line">    EXPECT_EQ(subscriber2_count.load(), 1);</div>
<div class="line">    EXPECT_EQ(subscriber3_count.load(), 1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d7/d62/test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(EndToEndTest, HighThroughput) {</div>
<div class="line">    std::atomic&lt;int&gt; total_received{0};</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> message_count = 100000;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> subscribe = message_bus_-&gt;subscribe(<span class="stringliteral">&quot;perf.test&quot;</span>,</div>
<div class="line">        [&amp;](<span class="keyword">const</span> MessagingContainer&amp;) {</div>
<div class="line">            total_received++;</div>
<div class="line">            <span class="keywordflow">return</span> VoidResult::ok();</div>
<div class="line">        });</div>
<div class="line">    ASSERT_TRUE(subscribe.is_ok());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Publish 100K messages</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; message_count; ++i) {</div>
<div class="line">        <span class="keyword">auto</span> msg = MessagingContainer::create(<span class="stringliteral">&quot;src&quot;</span>, <span class="stringliteral">&quot;tgt&quot;</span>, <span class="stringliteral">&quot;perf.test&quot;</span>);</div>
<div class="line">        ASSERT_TRUE(msg.is_ok());</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> publish = message_bus_-&gt;publish_async(msg.value());</div>
<div class="line">        ASSERT_TRUE(publish.is_ok());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for all messages to be processed</span></div>
<div class="line">    <span class="keywordflow">while</span> (total_received.load() &lt; message_count) {</div>
<div class="line">        std::this_thread::sleep_for(std::chrono::milliseconds(10));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::now();</div>
<div class="line">    <span class="keyword">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end - start);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> msgs_per_sec = (message_count * 1000.0) / duration.count();</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Throughput: &quot;</span> &lt;&lt; msgs_per_sec &lt;&lt; <span class="stringliteral">&quot; msg/s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Target: 100K+ msg/s</span></div>
<div class="line">    EXPECT_GT(msgs_per_sec, 100000.0);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2148"></a>
3. Benchmarks (Task 4.2)</h2>
<p><b>File:</b> <code>test/benchmarks/bench_routing.cpp</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;benchmark/benchmark.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;messaging_system/core/topic_router.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;messaging_system/core/messaging_container.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/thread/core/thread_pool.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>messaging;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> BM_TopicRouter_ExactMatch(benchmark::State&amp; state) {</div>
<div class="line">    <span class="keyword">auto</span> executor = std::make_shared&lt;thread::thread_pool&gt;(4);</div>
<div class="line">    <span class="keyword">auto</span> router = std::make_shared&lt;TopicRouter&gt;(executor);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add subscriber</span></div>
<div class="line">    <span class="keyword">auto</span> subscribe = router-&gt;subscribe(</div>
<div class="line">        <span class="stringliteral">&quot;user.created&quot;</span>,</div>
<div class="line">        [](<span class="keyword">const</span> MessagingContainer&amp;) { <span class="keywordflow">return</span> VoidResult::ok(); }</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> msg = MessagingContainer::create(<span class="stringliteral">&quot;src&quot;</span>, <span class="stringliteral">&quot;tgt&quot;</span>, <span class="stringliteral">&quot;user.created&quot;</span>).value();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> _ : state) {</div>
<div class="line">        <span class="keyword">auto</span> result = router-&gt;route(msg);</div>
<div class="line">        benchmark::DoNotOptimize(result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    state.SetItemsProcessed(state.iterations());</div>
<div class="line">}</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_TopicRouter_ExactMatch);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> BM_TopicRouter_PatternMatch(benchmark::State&amp; state) {</div>
<div class="line">    <span class="keyword">auto</span> executor = std::make_shared&lt;thread::thread_pool&gt;(4);</div>
<div class="line">    <span class="keyword">auto</span> router = std::make_shared&lt;TopicRouter&gt;(executor);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add pattern subscriber</span></div>
<div class="line">    <span class="keyword">auto</span> subscribe = router-&gt;subscribe(</div>
<div class="line">        <span class="stringliteral">&quot;user.*&quot;</span>,</div>
<div class="line">        [](<span class="keyword">const</span> MessagingContainer&amp;) { <span class="keywordflow">return</span> VoidResult::ok(); }</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> msg = MessagingContainer::create(<span class="stringliteral">&quot;src&quot;</span>, <span class="stringliteral">&quot;tgt&quot;</span>, <span class="stringliteral">&quot;user.login&quot;</span>).value();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> _ : state) {</div>
<div class="line">        <span class="keyword">auto</span> result = router-&gt;route(msg);</div>
<div class="line">        benchmark::DoNotOptimize(result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    state.SetItemsProcessed(state.iterations());</div>
<div class="line">}</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_TopicRouter_PatternMatch);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> BM_MessageCreation(benchmark::State&amp; state) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> _ : state) {</div>
<div class="line">        <span class="keyword">auto</span> result = MessagingContainer::create(<span class="stringliteral">&quot;source&quot;</span>, <span class="stringliteral">&quot;target&quot;</span>, <span class="stringliteral">&quot;topic&quot;</span>);</div>
<div class="line">        benchmark::DoNotOptimize(result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    state.SetItemsProcessed(state.iterations());</div>
<div class="line">}</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_MessageCreation);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> BM_MessageSerialization(benchmark::State&amp; state) {</div>
<div class="line">    <span class="keyword">auto</span> msg = MessagingContainer::create(<span class="stringliteral">&quot;source&quot;</span>, <span class="stringliteral">&quot;target&quot;</span>, <span class="stringliteral">&quot;topic&quot;</span>).value();</div>
<div class="line">    msg.container().set_value(<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;value1&quot;</span>);</div>
<div class="line">    msg.container().set_value(<span class="stringliteral">&quot;key2&quot;</span>, 42);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> _ : state) {</div>
<div class="line">        <span class="keyword">auto</span> result = msg.serialize();</div>
<div class="line">        benchmark::DoNotOptimize(result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    state.SetItemsProcessed(state.iterations());</div>
<div class="line">    state.SetBytesProcessed(state.iterations() * msg.serialize().value().size());</div>
<div class="line">}</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_MessageSerialization);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5851750faa9cfec10f7cad1f3b89697e">BENCHMARK_MAIN</a>();</div>
<div class="ttc" id="alog__level__benchmark_8cpp_html_a5851750faa9cfec10f7cad1f3b89697e"><div class="ttname"><a href="../../dd/df2/log__level__benchmark_8cpp.html#a5851750faa9cfec10f7cad1f3b89697e">BENCHMARK_MAIN</a></div><div class="ttdeci">BENCHMARK_MAIN()</div></div>
<div class="ttc" id="alog__level__benchmark_8cpp_html_a5ac153b82890aad253a9a12b1c89543b"><div class="ttname"><a href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a></div><div class="ttdeci">BENCHMARK(BM_LogLevelFiltering_Enabled)</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2149"></a>
4. Security Review (Task 4.4)</h2>
<p><b>Security Checklist Document:</b></p>
<p><b>File:</b> <code>docs/phase4/SECURITY_REVIEW.md</code></p>
<div class="fragment"><div class="line"># Security Review Checklist - Phase 4</div>
<div class="line"> </div>
<div class="line">## 1. Input Validation</div>
<div class="line"> </div>
<div class="line">- [ ] All user inputs validated before processing</div>
<div class="line">- [ ] Topic names validated against injection attacks</div>
<div class="line">- [ ] Message size limits enforced (prevent DoS)</div>
<div class="line">- [ ] Rate limiting implemented on incoming connections</div>
<div class="line">- [ ] Malformed message handling tested</div>
<div class="line"> </div>
<div class="line">**Test Cases:**</div>
</div><!-- fragment --><p> cpp TEST(SecurityTest, RejectOversizedMessage) { std::vector&lt;uint8_t&gt; huge_payload(100 * 1024 * 1024); // 100MB auto result = MessagingContainer::deserialize(huge_payload); EXPECT_TRUE(result.is_error()); EXPECT_EQ(result.error().code, error::SERIALIZATION_ERROR); }</p>
<p>TEST(SecurityTest, RejectInvalidTopicName) { auto result = MessagingContainer::create("src", "tgt", "../../../etc/passwd"); EXPECT_TRUE(result.is_error()); } </p><div class="fragment"><div class="line">## 2. Memory Safety</div>
<div class="line"> </div>
<div class="line">- [ ] No buffer overflows in serialization/deserialization</div>
<div class="line">- [ ] RAII used consistently (no manual memory management)</div>
<div class="line">- [ ] All Result&lt;T&gt; errors handled (no ignored errors)</div>
<div class="line">- [ ] Thread-safe data structures verified</div>
<div class="line">- [ ] ASAN/TSAN/UBSAN tests passed</div>
<div class="line"> </div>
<div class="line">**Sanitizer Tests:**</div>
</div><!-- fragment --><p> bash </p>
<h1><a class="anchor" id="autotoc_md2150"></a>
Address Sanitizer</h1>
<p>cmake &ndash;preset asan cmake &ndash;build &ndash;preset asan ./build-asan/test/messaging_tests</p>
<h1><a class="anchor" id="autotoc_md2151"></a>
Thread Sanitizer</h1>
<p>cmake &ndash;preset tsan cmake &ndash;build &ndash;preset tsan ./build-tsan/test/messaging_tests</p>
<h1><a class="anchor" id="autotoc_md2152"></a>
Undefined Behavior Sanitizer</h1>
<p>cmake &ndash;preset ubsan cmake &ndash;build &ndash;preset ubsan ./build-ubsan/test/messaging_tests </p><div class="fragment"><div class="line">## 3. Network Security</div>
<div class="line"> </div>
<div class="line">- [ ] TLS support tested (if enabled)</div>
<div class="line">- [ ] Certificate validation enforced</div>
<div class="line">- [ ] Connection limits enforced</div>
<div class="line">- [ ] Timeout handling prevents resource exhaustion</div>
<div class="line">- [ ] No plaintext secrets in logs</div>
<div class="line"> </div>
<div class="line">**TLS Configuration:**</div>
</div><!-- fragment --><p> yaml network: tls: enabled: true cert_file: /path/to/server.crt key_file: /path/to/server.key verify_client: true ca_file: /path/to/ca.crt </p><div class="fragment"><div class="line">## 4. Database Security</div>
<div class="line"> </div>
<div class="line">- [ ] SQL injection prevention (parameterized queries)</div>
<div class="line">- [ ] Connection string does not expose credentials</div>
<div class="line">- [ ] Least privilege database user configured</div>
<div class="line">- [ ] Database connection pooling limits enforced</div>
<div class="line">- [ ] Prepared statements used exclusively</div>
<div class="line"> </div>
<div class="line">**ORM Security:**</div>
</div><!-- fragment --><p> cpp // GOOD: Parameterized query via ORM auto result = entity_manager_-&gt;find&lt;MessageEntity&gt;( "topic = ? AND status = ?", {"user.created", "PENDING"} );</p>
<p>// BAD: String concatenation (DO NOT USE) // std::string query = "SELECT * FROM messages WHERE topic = '" + topic + "'"; </p><div class="fragment"><div class="line">## 5. Logging and Monitoring</div>
<div class="line"> </div>
<div class="line">- [ ] No sensitive data in logs (passwords, tokens, PII)</div>
<div class="line">- [ ] Log injection attacks prevented</div>
<div class="line">- [ ] Audit logs for critical operations</div>
<div class="line">- [ ] Monitoring does not leak internal architecture</div>
<div class="line">- [ ] Trace IDs do not contain sensitive data</div>
<div class="line"> </div>
<div class="line">**Safe Logging:**</div>
</div><!-- fragment --><p> cpp // GOOD: Safe logging logger_-&gt;log(logger::log_level::info, fmt::format("[{}] User action: type={}, user_id={}", trace_id, action_type, hash(user_id)));</p>
<p>// BAD: Exposing sensitive data // logger_-&gt;log(logger::log_level::info, // fmt::format("Password reset for {}", email_address)); </p><div class="fragment"><div class="line">## 6. Dependency Security</div>
<div class="line"> </div>
<div class="line">- [ ] All external systems from trusted sources</div>
<div class="line">- [ ] Dependency versions pinned (not floating)</div>
<div class="line">- [ ] Known CVEs checked (GitHub Security Advisories)</div>
<div class="line">- [ ] License compliance verified</div>
<div class="line">- [ ] SBOM (Software Bill of Materials) generated</div>
<div class="line"> </div>
<div class="line">**Dependency Verification:**</div>
</div><!-- fragment --><p> cmake FetchContent_Declare( CommonSystem GIT_REPOSITORY <a href="https://github.com/kcenon/common_system.git">https://github.com/kcenon/common_system.git</a> GIT_TAG v1.0.0 # Pinned version, not 'main' GIT_SHALLOW TRUE ) </p><div class="fragment"><div class="line">## 7. Code Quality</div>
<div class="line"> </div>
<div class="line">- [ ] Static analysis passed (clang-tidy, cppcheck)</div>
<div class="line">- [ ] Code coverage &gt;80%</div>
<div class="line">- [ ] All compiler warnings resolved (-Wall -Wextra -Wpedantic)</div>
<div class="line">- [ ] Peer review completed</div>
<div class="line">- [ ] Security-sensitive code double-reviewed</div>
<div class="line"> </div>
<div class="line">**Static Analysis:**</div>
</div><!-- fragment --><p> bash </p>
<h1><a class="anchor" id="autotoc_md2153"></a>
clang-tidy</h1>
<p>clang-tidy src/**/*.cpp &ndash; -std=c++20</p>
<h1><a class="anchor" id="autotoc_md2154"></a>
cppcheck</h1>
<p>cppcheck &ndash;enable=all &ndash;suppress=missingInclude src/ </p><div class="fragment"><div class="line">## Security Review Sign-off</div>
<div class="line"> </div>
<div class="line">| Reviewer | Role | Status | Date |</div>
<div class="line">|----------|------|--------|------|</div>
<div class="line">| [Name] | Security Engineer | [ ] Approved | YYYY-MM-DD |</div>
<div class="line">| [Name] | Lead Developer | [ ] Approved | YYYY-MM-DD |</div>
<div class="line">| [Name] | DevOps | [ ] Approved | YYYY-MM-DD |</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2155"></a>
5. Performance Validation (Task 4.2)</h3>
<p><b>Performance Test Script:</b></p>
<p><b>File:</b> <code>scripts/validate_performance.sh</code></p>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"> </div>
<div class="line">set -euo pipefail</div>
<div class="line"> </div>
<div class="line">SCRIPT_DIR=&quot;$(cd &quot;$(dirname &quot;${BASH_SOURCE[0]}&quot;)&quot; &amp;&amp; pwd)&quot;</div>
<div class="line">PROJECT_ROOT=&quot;$(cd &quot;${SCRIPT_DIR}/..&quot; &amp;&amp; pwd)&quot;</div>
<div class="line">BUILD_DIR=&quot;${PROJECT_ROOT}/build-release&quot;</div>
<div class="line">RESULTS_DIR=&quot;${PROJECT_ROOT}/benchmark_results&quot;</div>
<div class="line"> </div>
<div class="line">mkdir -p &quot;${RESULTS_DIR}&quot;</div>
<div class="line"> </div>
<div class="line">echo &quot;=== Performance Validation ===&quot;</div>
<div class="line">echo &quot;&quot;</div>
<div class="line"> </div>
<div class="line"># Build in release mode</div>
<div class="line">echo &quot;Building in Release mode...&quot;</div>
<div class="line">cmake --preset release</div>
<div class="line">cmake --build --preset release</div>
<div class="line"> </div>
<div class="line"># Run benchmarks</div>
<div class="line">echo &quot;Running benchmarks...&quot;</div>
<div class="line">&quot;${BUILD_DIR}/test/messaging_benchmarks&quot; \</div>
<div class="line">    --benchmark_format=json \</div>
<div class="line">    --benchmark_out=&quot;${RESULTS_DIR}/benchmarks_$(date +%Y%m%d_%H%M%S).json&quot;</div>
<div class="line"> </div>
<div class="line"># Parse results and validate against targets</div>
<div class="line">echo &quot;&quot;</div>
<div class="line">echo &quot;=== Performance Targets Validation ===&quot;</div>
<div class="line"> </div>
<div class="line">python3 - &lt;&lt;EOF</div>
<div class="line">import json</div>
<div class="line">import sys</div>
<div class="line"> </div>
<div class="line">with open(&quot;${RESULTS_DIR}/benchmarks_latest.json&quot;, &quot;r&quot;) as f:</div>
<div class="line">    data = json.load(f)</div>
<div class="line"> </div>
<div class="line">targets = {</div>
<div class="line">    &quot;BM_MessageCreation&quot;: 5_000_000,  # 5M ops/s</div>
<div class="line">    &quot;BM_MessageSerialization&quot;: 2_000_000,  # 2M ops/s</div>
<div class="line">    &quot;BM_TopicRouter_ExactMatch&quot;: 100_000,  # 100K ops/s</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">failed = []</div>
<div class="line"> </div>
<div class="line">for benchmark in data[&quot;benchmarks&quot;]:</div>
<div class="line">    name = benchmark[&quot;name&quot;]</div>
<div class="line">    if name in targets:</div>
<div class="line">        actual_ops = 1e9 / benchmark[&quot;cpu_time&quot;]  # ns to ops/s</div>
<div class="line">        target_ops = targets[name]</div>
<div class="line"> </div>
<div class="line">        status = &quot;✓ PASS&quot; if actual_ops &gt;= target_ops else &quot;✗ FAIL&quot;</div>
<div class="line">        print(f&quot;{status} {name}: {actual_ops:.0f} ops/s (target: {target_ops:.0f})&quot;)</div>
<div class="line"> </div>
<div class="line">        if actual_ops &lt; target_ops:</div>
<div class="line">            failed.append(name)</div>
<div class="line"> </div>
<div class="line">if failed:</div>
<div class="line">    print(f&quot;\n❌ {len(failed)} benchmark(s) failed to meet targets&quot;)</div>
<div class="line">    sys.exit(1)</div>
<div class="line">else:</div>
<div class="line">    print(&quot;\n✅ All benchmarks meet performance targets&quot;)</div>
<div class="line">    sys.exit(0)</div>
<div class="line">EOF</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2156"></a>
6. Deployment Artifacts (Task 4.5)</h3>
<p><b>Production Deployment Configuration:</b></p>
<p><b>File:</b> <code>deploy/production/config.yaml</code></p>
<div class="fragment"><div class="line">messaging_system:</div>
<div class="line">  version: &quot;2.0&quot;</div>
<div class="line"> </div>
<div class="line">  network:</div>
<div class="line">    port: 8080</div>
<div class="line">    max_connections: 50000</div>
<div class="line">    timeout_ms: 5000</div>
<div class="line">    retry_attempts: 3</div>
<div class="line">    tls:</div>
<div class="line">      enabled: true</div>
<div class="line">      cert_file: /etc/messaging/certs/server.crt</div>
<div class="line">      key_file: /etc/messaging/certs/server.key</div>
<div class="line">      verify_client: true</div>
<div class="line">      ca_file: /etc/messaging/certs/ca.crt</div>
<div class="line"> </div>
<div class="line">  thread_pools:</div>
<div class="line">    io:</div>
<div class="line">      workers: 4</div>
<div class="line">      queue_size: 100000</div>
<div class="line">    work:</div>
<div class="line">      workers: 32</div>
<div class="line">      queue_size: 500000</div>
<div class="line">      lockfree: true</div>
<div class="line"> </div>
<div class="line">  database:</div>
<div class="line">    type: postgresql</div>
<div class="line">    connection_string: &quot;${DB_CONNECTION_STRING}&quot;</div>
<div class="line">    pool:</div>
<div class="line">      min_connections: 10</div>
<div class="line">      max_connections: 100</div>
<div class="line">      idle_timeout_s: 60</div>
<div class="line">      max_lifetime_s: 3600</div>
<div class="line"> </div>
<div class="line">  logging:</div>
<div class="line">    level: info</div>
<div class="line">    async: true</div>
<div class="line">    writers:</div>
<div class="line">      - type: rotating_file</div>
<div class="line">        path: /var/log/messaging/app.log</div>
<div class="line">        max_size_mb: 100</div>
<div class="line">        max_files: 10</div>
<div class="line">      - type: syslog</div>
<div class="line">        facility: local0</div>
<div class="line"> </div>
<div class="line">  monitoring:</div>
<div class="line">    enabled: true</div>
<div class="line">    interval_ms: 1000</div>
<div class="line">    exporters:</div>
<div class="line">      - type: prometheus</div>
<div class="line">        port: 9090</div>
<div class="line">      - type: statsd</div>
<div class="line">        host: localhost</div>
<div class="line">        port: 8125</div>
</div><!-- fragment --><p><b>Docker Configuration:</b></p>
<p><b>File:</b> <code>deploy/Dockerfile</code></p>
<div class="fragment"><div class="line">FROM ubuntu:22.04 AS builder</div>
<div class="line"> </div>
<div class="line">RUN apt-get update &amp;&amp; apt-get install -y \</div>
<div class="line">    build-essential \</div>
<div class="line">    cmake \</div>
<div class="line">    git \</div>
<div class="line">    libssl-dev \</div>
<div class="line">    libpq-dev \</div>
<div class="line">    &amp;&amp; rm -rf /var/lib/apt/lists<span class="comment">/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">WORKDIR /build</span></div>
<div class="line"><span class="comment">COPY . .</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">RUN cmake --preset release -DMESSAGING_USE_FETCHCONTENT=ON</span></div>
<div class="line"><span class="comment">RUN cmake --build --preset release</span></div>
<div class="line"><span class="comment">RUN ctest --preset default</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">FROM ubuntu:22.04</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">RUN apt-get update &amp;&amp; apt-get install -y \</span></div>
<div class="line"><span class="comment">    libssl3 \</span></div>
<div class="line"><span class="comment">    libpq5 \</span></div>
<div class="line"><span class="comment">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">COPY --from=builder /build/build-release/bin/messaging_system /usr/local/bin/</span></div>
<div class="line"><span class="comment">COPY deploy/production/config.yaml /etc/messaging/config.yaml</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">RUN useradd -r -s /bin/false messaging</span></div>
<div class="line"><span class="comment">USER messaging</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">EXPOSE 8080 9090</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">CMD [&quot;/usr/local/bin/messaging_system&quot;, &quot;--config&quot;, &quot;/etc/messaging/config.yaml&quot;]</span></div>
</div><!-- fragment --><p><b>Kubernetes Deployment:</b></p>
<p><b>File:</b> <code>deploy/k8s/deployment.yaml</code></p>
<div class="fragment"><div class="line">apiVersion: apps/v1</div>
<div class="line">kind: Deployment</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-system</div>
<div class="line">  namespace: messaging</div>
<div class="line">spec:</div>
<div class="line">  replicas: 3</div>
<div class="line">  selector:</div>
<div class="line">    matchLabels:</div>
<div class="line">      app: messaging-system</div>
<div class="line">  template:</div>
<div class="line">    metadata:</div>
<div class="line">      labels:</div>
<div class="line">        app: messaging-system</div>
<div class="line">        version: &quot;2.0&quot;</div>
<div class="line">    spec:</div>
<div class="line">      containers:</div>
<div class="line">      - name: messaging</div>
<div class="line">        image: messaging-system:2.0</div>
<div class="line">        ports:</div>
<div class="line">        - containerPort: 8080</div>
<div class="line">          name: messaging</div>
<div class="line">          protocol: TCP</div>
<div class="line">        - containerPort: 9090</div>
<div class="line">          name: metrics</div>
<div class="line">          protocol: TCP</div>
<div class="line">        env:</div>
<div class="line">        - name: DB_CONNECTION_STRING</div>
<div class="line">          valueFrom:</div>
<div class="line">            secretKeyRef:</div>
<div class="line">              name: messaging-db-secret</div>
<div class="line">              key: connection-string</div>
<div class="line">        resources:</div>
<div class="line">          requests:</div>
<div class="line">            memory: &quot;512Mi&quot;</div>
<div class="line">            cpu: &quot;1000m&quot;</div>
<div class="line">          limits:</div>
<div class="line">            memory: &quot;2Gi&quot;</div>
<div class="line">            cpu: &quot;4000m&quot;</div>
<div class="line">        livenessProbe:</div>
<div class="line">          httpGet:</div>
<div class="line">            path: /health</div>
<div class="line">            port: 9090</div>
<div class="line">          initialDelaySeconds: 30</div>
<div class="line">          periodSeconds: 10</div>
<div class="line">        readinessProbe:</div>
<div class="line">          httpGet:</div>
<div class="line">            path: /ready</div>
<div class="line">            port: 9090</div>
<div class="line">          initialDelaySeconds: 10</div>
<div class="line">          periodSeconds: 5</div>
<div class="line">        volumeMounts:</div>
<div class="line">        - name: config</div>
<div class="line">          mountPath: /etc/messaging</div>
<div class="line">          readOnly: true</div>
<div class="line">        - name: certs</div>
<div class="line">          mountPath: /etc/messaging/certs</div>
<div class="line">          readOnly: true</div>
<div class="line">      volumes:</div>
<div class="line">      - name: config</div>
<div class="line">        configMap:</div>
<div class="line">          name: messaging-config</div>
<div class="line">      - name: certs</div>
<div class="line">        secret:</div>
<div class="line">          secretName: messaging-tls-certs</div>
<div class="line">---</div>
<div class="line">apiVersion: v1</div>
<div class="line">kind: Service</div>
<div class="line">metadata:</div>
<div class="line">  name: messaging-service</div>
<div class="line">  namespace: messaging</div>
<div class="line">spec:</div>
<div class="line">  selector:</div>
<div class="line">    app: messaging-system</div>
<div class="line">  ports:</div>
<div class="line">  - name: messaging</div>
<div class="line">    port: 8080</div>
<div class="line">    targetPort: 8080</div>
<div class="line">    protocol: TCP</div>
<div class="line">  - name: metrics</div>
<div class="line">    port: 9090</div>
<div class="line">    targetPort: 9090</div>
<div class="line">    protocol: TCP</div>
<div class="line">  type: LoadBalancer</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2157"></a>
Testing Strategy</h2>
<h3><a class="anchor" id="autotoc_md2158"></a>
Validation Phases</h3>
<p><b>Phase 4.1: Unit Testing (Week 1)</b></p><ul>
<li>Write unit tests for all core components</li>
<li>Achieve &gt;80% code coverage</li>
<li>All tests pass with ASAN/TSAN/UBSAN</li>
</ul>
<p><b>Phase 4.2: Integration Testing (Week 2)</b></p><ul>
<li>End-to-end message flow tests</li>
<li>Multi-subscriber scenarios</li>
<li>Failover and recovery tests</li>
<li>Performance validation (100K+ msg/s)</li>
</ul>
<p><b>Phase 4.3: Benchmarking (Week 2)</b></p><ul>
<li>Message creation: 5M+ containers/sec</li>
<li>Serialization: 2M+ containers/sec</li>
<li>Routing: 100K+ routes/sec</li>
<li>Network throughput: 100K+ msg/s end-to-end</li>
</ul>
<p><b>Phase 4.4: Security Review (Week 3)</b></p><ul>
<li>Static analysis (clang-tidy, cppcheck)</li>
<li>Dynamic analysis (sanitizers)</li>
<li>Dependency vulnerability scan</li>
<li>Code review with security focus</li>
</ul>
<p><b>Phase 4.5: Deployment Preparation (Week 3)</b></p><ul>
<li>Docker image creation</li>
<li>Kubernetes manifests</li>
<li>Production configuration</li>
<li>Rollback procedures documented</li>
</ul>
<h2><a class="anchor" id="autotoc_md2159"></a>
Performance Targets</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Metric   </th><th class="markdownTableHeadNone">Target   </th><th class="markdownTableHeadNone">Measurement Method    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message creation   </td><td class="markdownTableBodyNone">5M/s   </td><td class="markdownTableBodyNone">Google Benchmark    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Serialization   </td><td class="markdownTableBodyNone">2M/s   </td><td class="markdownTableBodyNone">Google Benchmark    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Routing   </td><td class="markdownTableBodyNone">100K/s   </td><td class="markdownTableBodyNone">Google Benchmark    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">End-to-end throughput   </td><td class="markdownTableBodyNone">100K+ msg/s   </td><td class="markdownTableBodyNone">Integration test    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">P95 latency   </td><td class="markdownTableBodyNone">&lt;10ms   </td><td class="markdownTableBodyNone">Integration test    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Memory usage   </td><td class="markdownTableBodyNone">&lt;500MB @ 10K conn   </td><td class="markdownTableBodyNone">Integration test    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU usage   </td><td class="markdownTableBodyNone">&lt;80% @ max load   </td><td class="markdownTableBodyNone">Integration test   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2160"></a>
Success Criteria</h2>
<ul>
<li>[ ] All unit tests pass (&gt;80% coverage)</li>
<li>[ ] All integration tests pass</li>
<li>[ ] All performance benchmarks meet targets</li>
<li>[ ] Security review approved</li>
<li>[ ] Zero critical/high vulnerabilities</li>
<li>[ ] Docker image builds successfully</li>
<li>[ ] Kubernetes deployment tested</li>
<li>[ ] Production configuration validated</li>
<li>[ ] Rollback procedure documented and tested</li>
<li>[ ] Documentation complete</li>
</ul>
<h2><a class="anchor" id="autotoc_md2161"></a>
Implementation Timeline</h2>
<p><b>Week 1: Testing Infrastructure</b></p><ul>
<li>Day 1-2: Set up unit test framework</li>
<li>Day 3-4: Write core unit tests</li>
<li>Day 5: Code coverage analysis</li>
</ul>
<p><b>Week 2: Integration and Performance</b></p><ul>
<li>Day 1-2: Integration test suite</li>
<li>Day 3-4: Performance benchmarks</li>
<li>Day 5: Performance validation</li>
</ul>
<p><b>Week 3: Security and Deployment</b></p><ul>
<li>Day 1-2: Security review and fixes</li>
<li>Day 3-4: Deployment artifacts</li>
<li>Day 5: Final validation and sign-off</li>
</ul>
<h2><a class="anchor" id="autotoc_md2162"></a>
Rollback Plan</h2>
<p>If Phase 4 validation fails:</p><ol type="1">
<li>Document failing test cases</li>
<li>Isolate root cause</li>
<li>Determine if Phase 1-3 rework needed</li>
<li>Fix issues and re-run validation</li>
<li>Do not proceed to production until all criteria met </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
