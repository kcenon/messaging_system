<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Messaging System 재구성 실행 계획</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d01/md_docs_2REBUILD__PLAN.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Messaging System 재구성 실행 계획</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2265"></a> </p>
<h1><a class="anchor" id="autotoc_md2266"></a>
개요 및 우선순위</h1>
<p>본 계획은 7개 외부 시스템(common_system, thread_system, logger_system, monitoring_system, container_system, database_system, network_system)을 활용한 messaging_system 재구성을 위한 실행 계획이다.</p>
<p><b>핵심 원칙:</b></p><ul>
<li><b>common_system 최우선 통합</b>: 모든 시스템이 의존하는 핵심 추상화 계층</li>
<li><b>단계적 마이그레이션</b>: 점진적 전환으로 리스크 최소화</li>
<li><b>성능 목표 명확화</b>: 각 Phase별 정량적 검증 기준 제시</li>
<li><b>병렬 작업 최대화</b>: Phase 2/3 일부 Task 동시 진행 가능</li>
</ul>
<p><b>성능 목표:</b></p><ul>
<li>메시지 처리량: 100K msg/s (최소), 200K msg/s (목표)</li>
<li>P95 지연시간: &lt;10ms</li>
<li>메모리 사용량: &lt;500MB (10K 동시 연결)</li>
<li>CPU 사용률: &lt;80% (최대 부하)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2267"></a>
Phase 0. 준비 및 기반 정비</h1>
<h2><a class="anchor" id="autotoc_md2268"></a>
**Task 0.0 – common_system 즉시 통합 (최우선)**</h2>
<p>**목적:** 모든 후속 작업의 기반이 되는 핵심 추상화 계층 확보 **작업 내용:**</p><ul>
<li>`common_system` 패키지 설치 또는 FetchContent 설정</li>
<li>CMakeLists.txt에 `find_package(CommonSystem 1.0 REQUIRED)` 추가</li>
<li>핵심 인터페이스 확인:<ul>
<li>`Result&lt;T&gt;<code>/</code>VoidResult<code>(에러 처리) -</code>event_bus<code>(Pub/Sub) -</code>IExecutor<code>,</code>ILogger<code>,</code>IMonitor<code>,</code>IDatabase<code>(계약)</code></li>
</ul>
</li>
<li><code>전역 include 경로 설정:</code>include/kcenon/common/`</li>
</ul>
<p><em>결과물</em>: common_system 통합 완료, 빌드 성공 확인 <em>선행 조건</em>: 없음 (최우선 작업) <em>예상 소요</em>: 0.5일</p>
<h2><a class="anchor" id="autotoc_md2269"></a>
&lt;strong&gt;Task 0.1 – 시스템 인터페이스 맵핑&lt;/strong&gt;</h2>
<p><b>목적:</b> 레거시 타입과 새 인터페이스 간 명확한 대응 관계 정립 <b>작업 내용:</b></p><ul>
<li><code>common_system</code>의 Result, 이벤트 버스, IExecutor/ILogger/IMonitor 계약을 목록화</li>
<li>기존 메시징 코어가 사용하는 내부 타입 대응표 정리</li>
<li>에러 코드 범위 문서화:<ul>
<li>-1 ~ -99: common_system</li>
<li>-100 ~ -199: thread_system</li>
<li>-200 ~ -299: messaging_system (신규 정의)</li>
<li>-300 ~ -399: logger_system</li>
<li>기타 시스템별 범위</li>
</ul>
</li>
<li><code>exception_mapper</code> 활용 방안 문서화</li>
</ul>
<p><em>결과물</em>: 인터페이스 매핑 문서, 레거시 의존성 제거 리스트, 에러 코드 정의 문서 <em>선행 조건</em>: Task 0.0 완료 <em>예상 소요</em>: 1일 </p>
<h2><a class="anchor" id="autotoc_md2270"></a>
&lt;strong&gt;Task 0.2 – 빌드 환경 감사&lt;/strong&gt;</h2>
<p><b>목적:</b> 모든 외부 시스템의 통합 전략 확정 <b>작업 내용:</b></p><ul>
<li><code>messaging_system/CMakeLists.txt</code> 및 하위 <code>libraries/*</code> CMake 구성 분석</li>
<li>서브모듈 의존 경로와 Fetch/Find 전략 정의:<ul>
<li><b>FetchContent 방식</b>: 개발 환경, 빠른 반복</li>
<li><b>find_package 방식</b>: 배포 환경, 안정성 우선</li>
</ul>
</li>
<li>공유 옵션 전달 방법 표준화:<ul>
<li><code>MESSAGING_USE_LOCKFREE</code>: 락프리 구조 사용 여부</li>
<li><code>MESSAGING_ENABLE_MONITORING</code>: 모니터링 활성화</li>
<li><code>MESSAGING_ENABLE_LOGGING</code>: 로깅 활성화</li>
<li><code>MESSAGING_ENABLE_TLS</code>: TLS/SSL 지원</li>
<li><code>MESSAGING_BUILD_PROFILE</code>: Debug/Release/ASAN/TSAN</li>
</ul>
</li>
<li>CMake Presets 작성 (cmake-presets.json)</li>
</ul>
<p><em>결과물</em>: 빌드 구성 설계 노트, CMake Presets 파일, 의존성 설치 가이드 <em>선행 조건</em>: Task 0.0 완료 <em>예상 소요</em>: 1일</p>
<h2><a class="anchor" id="autotoc_md2271"></a>
&lt;strong&gt;Task 0.3 – 위험 및 마이그레이션 전략 확정&lt;/strong&gt;</h2>
<p><b>목적:</b> 안전한 점진적 전환 경로 확보 <b>작업 내용:</b></p><ul>
<li>레거시 API와 외부 통합 지점 식별</li>
<li>호환성 레이어 설계:<ul>
<li>Feature Flag: <code>MESSAGING_LEGACY_API_COMPAT</code></li>
<li>예외 기반 API → Result&lt;T&gt; 래퍼 제공</li>
<li>2 릴리스 사이클 동시 지원 계획</li>
</ul>
</li>
<li>점진적 마이그레이션 시나리오:<ul>
<li><b>v1.x</b>: 레거시 + 신규 API 동시 지원 (deprecation warning)</li>
<li><b>v1.x+1</b>: 레거시 API 제거 예고</li>
<li><b>v2.x</b>: 신규 API만 지원</li>
</ul>
</li>
<li>롤백 시나리오:<ul>
<li>Blue-Green 배포 전략</li>
<li>DB 마이그레이션 롤백 스크립트</li>
<li>설정 파일 버전 관리</li>
</ul>
</li>
</ul>
<p><em>결과물</em>: 리스크 레지스터, 롤백/전환 전략 문서, 호환성 레이어 설계 <em>선행 조건</em>: Task 0.1 완료 <em>예상 소요</em>: 1.5일</p>
<h2><a class="anchor" id="autotoc_md2272"></a>
&lt;strong&gt;Task 0.4 – 레거시 구현 차단 계획 수립&lt;/strong&gt;</h2>
<p><b>목적:</b> 명확한 코드 제거 로드맵 확보 <b>작업 내용:</b></p><ul>
<li>레거시 코드 목록 작성:<ul>
<li>내장 container 구현 → <code>container_system</code> 대체</li>
<li>내장 network 구현 → <code>network_system</code> 대체</li>
<li>내장 thread pool → <code>thread_system</code> 대체</li>
<li>예외 기반 에러 처리 → <code>common_system::Result&lt;T&gt;</code> 대체</li>
</ul>
</li>
<li>책임 매트릭스 정의: <div class="fragment"><div class="line">| 기능 영역          | 레거시 담당     | 신규 담당           | 인터페이스       |</div>
<div class="line">|-------------------|----------------|--------------------|--------------------|</div>
<div class="line">| 에러 처리         | std::exception | common_system      | Result&lt;T&gt;          |</div>
<div class="line">| 비동기 실행       | 내장 thread    | thread_system      | IExecutor          |</div>
<div class="line">| 메시지 직렬화     | 내장 container | container_system   | value_container    |</div>
<div class="line">| 네트워크 I/O      | 내장 network   | network_system     | messaging_client   |</div>
<div class="line">| 영속화            | 직접 SQL       | database_system    | IDatabase, ORM     |</div>
<div class="line">| 로깅              | std::cout      | logger_system      | ILogger            |</div>
<div class="line">| 메트릭            | 없음           | monitoring_system  | IMonitor           |</div>
</div><!-- fragment --></li>
<li>빌드 가드 코드 설계: <div class="fragment"><div class="line"><span class="preprocessor">#ifndef MESSAGING_USE_EXTERNAL_SYSTEMS</span></div>
<div class="line"><span class="preprocessor">  #error &quot;Legacy internal systems deprecated. Set MESSAGING_USE_EXTERNAL_SYSTEMS=ON&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --></li>
<li>아카이브 이동 스크립트 작성</li>
</ul>
<p><em>결과물</em>: 레거시 제거 체크리스트, 책임 매트릭스, 빌드 가드 헤더, 아카이브 스크립트 <em>선행 조건</em>: Task 0.2 완료 <em>예상 소요</em>: 1일</p>
<h1><a class="anchor" id="autotoc_md2273"></a>
Phase 1. 빌드 및 의존성 리팩터링</h1>
<p><b>Phase 목표:</b> 모든 외부 시스템을 빌드 시스템에 통합하고 레거시 코드 제거</p>
<h2><a class="anchor" id="autotoc_md2274"></a>
&lt;strong&gt;Task 1.1 – 외부 모듈 통합 재구성&lt;/strong&gt;</h2>
<p><b>목적:</b> 7개 외부 시스템의 빌드 시스템 통합 <b>작업 내용:</b></p><ul>
<li>CMakeLists.txt 수정: <div class="fragment"><div class="line"># FetchContent 방식 (개발 환경)</div>
<div class="line">include(FetchContent)</div>
<div class="line">FetchContent_Declare(CommonSystem GIT_REPOSITORY ... GIT_TAG main)</div>
<div class="line">FetchContent_Declare(ThreadSystem GIT_REPOSITORY ... GIT_TAG main)</div>
<div class="line"># ... 기타 시스템</div>
<div class="line">FetchContent_MakeAvailable(CommonSystem ThreadSystem ...)</div>
<div class="line"> </div>
<div class="line"># find_package 방식 (배포 환경)</div>
<div class="line">find_package(CommonSystem 1.0 REQUIRED)</div>
<div class="line">find_package(ThreadSystem 1.0 REQUIRED)</div>
<div class="line">find_package(LoggerSystem 1.0 REQUIRED)</div>
<div class="line">find_package(MonitoringSystem 1.0 REQUIRED)</div>
<div class="line">find_package(ContainerSystem 1.0 REQUIRED)</div>
<div class="line">find_package(DatabaseSystem 1.0 REQUIRED)</div>
<div class="line">find_package(NetworkSystem 1.0 REQUIRED)</div>
</div><!-- fragment --></li>
<li>ALIAS 타깃 정의: <div class="fragment"><div class="line">if(NOT TARGET common)</div>
<div class="line">  add_library(common ALIAS CommonSystem::common)</div>
<div class="line">endif()</div>
<div class="line">if(NOT TARGET thread_pool)</div>
<div class="line">  add_library(thread_pool ALIAS ThreadSystem::Core)</div>
<div class="line">endif()</div>
<div class="line"># ... 기타 ALIAS</div>
</div><!-- fragment --></li>
<li>통합 의존성 타깃 생성: <div class="fragment"><div class="line">add_library(messaging_system_deps INTERFACE)</div>
<div class="line">target_link_libraries(messaging_system_deps INTERFACE</div>
<div class="line">  CommonSystem::common</div>
<div class="line">  ThreadSystem::Core</div>
<div class="line">  LoggerSystem::logger</div>
<div class="line">  MonitoringSystem::monitoring</div>
<div class="line">  ContainerSystem::container</div>
<div class="line">  DatabaseSystem::database</div>
<div class="line">  NetworkSystem::network</div>
<div class="line">)</div>
</div><!-- fragment --></li>
</ul>
<p><em>결과물</em>: 업데이트된 CMakeLists.txt, ALIAS 타깃 정의, 의존성 설치 가이드 <em>선행 조건</em>: Phase 0 완료 <em>예상 소요</em>: 2일</p>
<h2><a class="anchor" id="autotoc_md2275"></a>
&lt;strong&gt;Task 1.2 – 컴파일 옵션 및 피처 플래그 통합&lt;/strong&gt;</h2>
<p><b>목적:</b> 일관된 빌드 설정 전파 메커니즘 구축 <b>작업 내용:</b></p><ul>
<li>통합 CMake 캐시 변수 정의: <div class="fragment"><div class="line"># 공통 옵션</div>
<div class="line">set(MESSAGING_CXX_STANDARD 20 CACHE STRING &quot;C++ standard&quot;)</div>
<div class="line">set(MESSAGING_WARNING_LEVEL &quot;High&quot; CACHE STRING &quot;Warning level&quot;)</div>
<div class="line"> </div>
<div class="line"># 피처 플래그</div>
<div class="line">option(MESSAGING_USE_LOCKFREE &quot;Enable lock-free structures&quot; OFF)</div>
<div class="line">option(MESSAGING_ENABLE_MONITORING &quot;Enable monitoring&quot; ON)</div>
<div class="line">option(MESSAGING_ENABLE_LOGGING &quot;Enable logging&quot; ON)</div>
<div class="line">option(MESSAGING_ENABLE_METRICS &quot;Enable metrics&quot; ON)</div>
<div class="line">option(MESSAGING_ENABLE_TLS &quot;Enable TLS/SSL&quot; OFF)</div>
<div class="line"> </div>
<div class="line"># 빌드 프로파일</div>
<div class="line">set(MESSAGING_BUILD_PROFILE &quot;Release&quot; CACHE STRING &quot;Build profile&quot;)</div>
<div class="line">set_property(CACHE MESSAGING_BUILD_PROFILE PROPERTY STRINGS</div>
<div class="line">  &quot;Debug&quot; &quot;Release&quot; &quot;RelWithDebInfo&quot; &quot;ASAN&quot; &quot;TSAN&quot; &quot;UBSAN&quot;)</div>
<div class="line"> </div>
<div class="line"># 프로파일별 플래그</div>
<div class="line">if(MESSAGING_BUILD_PROFILE STREQUAL &quot;ASAN&quot;)</div>
<div class="line">  set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -fsanitize=address -fno-omit-frame-pointer&quot;)</div>
<div class="line">elseif(MESSAGING_BUILD_PROFILE STREQUAL &quot;TSAN&quot;)</div>
<div class="line">  set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -fsanitize=thread&quot;)</div>
<div class="line">elseif(MESSAGING_BUILD_PROFILE STREQUAL &quot;UBSAN&quot;)</div>
<div class="line">  set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -fsanitize=undefined&quot;)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line"># 하위 모듈 전파</div>
<div class="line">set(USE_LOCKFREE_BY_DEFAULT ${MESSAGING_USE_LOCKFREE} CACHE BOOL &quot;&quot; FORCE)</div>
<div class="line">set(ENABLE_MONITORING ${MESSAGING_ENABLE_MONITORING} CACHE BOOL &quot;&quot; FORCE)</div>
<div class="line">set(ENABLE_LOGGING ${MESSAGING_ENABLE_LOGGING} CACHE BOOL &quot;&quot; FORCE)</div>
</div><!-- fragment --></li>
<li>CI 프로파일별 문서화 (README.md)</li>
</ul>
<p><em>결과물</em>: 통합 빌드 옵션 정의, CI 프로파일 문서, 빌드 설정 가이드 <em>선행 조건</em>: Task 1.1 완료 <em>예상 소요</em>: 1일</p>
<h2><a class="anchor" id="autotoc_md2276"></a>
&lt;strong&gt;Task 1.3 – 구성 검증 자동화&lt;/strong&gt;</h2>
<p><b>목적:</b> 빌드 시 의존성 누락 조기 발견 <b>작업 내용:</b></p><ul>
<li>CMake 검증 함수 작성 (cmake/validate_dependencies.cmake): <div class="fragment"><div class="line">function(validate_messaging_dependencies)</div>
<div class="line">  set(REQUIRED_TARGETS</div>
<div class="line">    CommonSystem::common</div>
<div class="line">    ThreadSystem::Core</div>
<div class="line">    LoggerSystem::logger</div>
<div class="line">    MonitoringSystem::monitoring</div>
<div class="line">    ContainerSystem::container</div>
<div class="line">    DatabaseSystem::database</div>
<div class="line">    NetworkSystem::network</div>
<div class="line">  )</div>
<div class="line"> </div>
<div class="line">  foreach(target ${REQUIRED_TARGETS})</div>
<div class="line">    if(NOT TARGET ${target})</div>
<div class="line">      message(FATAL_ERROR</div>
<div class="line">        &quot;Required dependency ${target} not found. &quot;</div>
<div class="line">        &quot;Please install all external modules or use FetchContent.&quot;)</div>
<div class="line">    endif()</div>
<div class="line">  endforeach()</div>
<div class="line"> </div>
<div class="line">  message(STATUS &quot;✅ All messaging_system dependencies validated&quot;)</div>
<div class="line">endfunction()</div>
<div class="line"> </div>
<div class="line">validate_messaging_dependencies()</div>
</div><!-- fragment --></li>
<li>CMake Presets 작성 (CMakePresets.json): <div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: 3,</div>
<div class="line">  &quot;configurePresets&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot;: &quot;default&quot;,</div>
<div class="line">      &quot;binaryDir&quot;: &quot;${sourceDir}/build&quot;,</div>
<div class="line">      &quot;cacheVariables&quot;: {</div>
<div class="line">        &quot;CMAKE_BUILD_TYPE&quot;: &quot;Release&quot;</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot;: &quot;asan&quot;,</div>
<div class="line">      &quot;inherits&quot;: &quot;default&quot;,</div>
<div class="line">      &quot;cacheVariables&quot;: {</div>
<div class="line">        &quot;MESSAGING_BUILD_PROFILE&quot;: &quot;ASAN&quot;</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot;: &quot;tsan&quot;,</div>
<div class="line">      &quot;inherits&quot;: &quot;default&quot;,</div>
<div class="line">      &quot;cacheVariables&quot;: {</div>
<div class="line">        &quot;MESSAGING_BUILD_PROFILE&quot;: &quot;TSAN&quot;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<p><em>결과물</em>: 검증 스크립트, CMake Presets, 설정 가이드 <em>선행 조건</em>: Task 1.2 완료 <em>예상 소요</em>: 0.5일</p>
<h2><a class="anchor" id="autotoc_md2277"></a>
&lt;strong&gt;Task 1.4 – 레거시 코드 비활성화 및 제거&lt;/strong&gt;</h2>
<p><b>목적:</b> 레거시 코드 빌드 제외 및 안전한 아카이브 <b>작업 내용:</b></p><ul>
<li>빌드 가드 헤더 추가 (include/messaging_system/legacy_guard.h): <div class="fragment"><div class="line"><span class="preprocessor">#ifndef MESSAGING_USE_EXTERNAL_SYSTEMS</span></div>
<div class="line"><span class="preprocessor">  #error &quot;Legacy internal systems deprecated. Set MESSAGING_USE_EXTERNAL_SYSTEMS=ON&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !defined(HAS_COMMON_SYSTEM)</span></div>
<div class="line"><span class="preprocessor">  #error &quot;CommonSystem not found. Install common_system package.&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !defined(HAS_THREAD_SYSTEM)</span></div>
<div class="line"><span class="preprocessor">  #error &quot;ThreadSystem not found. Install thread_system package.&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// ... 기타 시스템 검증</span></div>
</div><!-- fragment --></li>
<li>아카이브 스크립트 작성 (scripts/archive_legacy.sh): <div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">LEGACY_DIRS=(</div>
<div class="line">  &quot;src/legacy_container&quot;</div>
<div class="line">  &quot;src/legacy_network&quot;</div>
<div class="line">  &quot;src/legacy_thread&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">mkdir -p _archived/$(date +%Y%m%d)</div>
<div class="line">for dir in &quot;${LEGACY_DIRS[@]}&quot;; do</div>
<div class="line">  if [ -d &quot;$dir&quot; ]; then</div>
<div class="line">    mv &quot;$dir&quot; &quot;_archived/$(date +%Y%m%d)/&quot;</div>
<div class="line">    echo &quot;Archived: $dir&quot;</div>
<div class="line">  fi</div>
<div class="line">done</div>
</div><!-- fragment --></li>
<li>CMakeLists.txt에서 레거시 소스 제외</li>
</ul>
<p><em>결과물</em>: 빌드 가드 헤더, 아카이브 스크립트, 업데이트된 빌드 파일 <em>선행 조건</em>: Task 1.3 완료 <em>예상 소요</em>: 1일</p>
<p><b>Phase 1 완료 기준:</b></p><ul>
<li>✅ 모든 외부 시스템 빌드 성공</li>
<li>✅ 레거시 코드 빌드 대상에서 제외</li>
<li>✅ CI 파이프라인 통과 (모든 프로파일)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2278"></a>
Phase 2. 메시징 코어 재설계</h1>
<p><b>Phase 목표:</b> Result&lt;T&gt; 기반 메시징 코어 구축 및 DI 아키텍처 적용 <b>병렬 작업:</b> Task 2.1-2.2는 Task 3.1(네트워크 경계)과 병렬 진행 가능</p>
<h2><a class="anchor" id="autotoc_md2279"></a>
&lt;strong&gt;Task 2.1 – 메시지 컨테이너 DSL 정립&lt;/strong&gt;</h2>
<p><b>목적:</b> container_system 기반 메시지 구조 표준화 <b>작업 내용:</b></p><ul>
<li>메시지 구조 정의: <div class="fragment"><div class="line"><span class="comment">// Header: source, target, topic, trace_id, timestamp, version</span></div>
<div class="line"><span class="comment">// Body: operation, parameters (타입별 value_container)</span></div>
<div class="line"><span class="comment">// Metadata: priority, ttl, retry_count</span></div>
</div><!-- fragment --></li>
<li>Fluent Builder API 작성: <div class="fragment"><div class="line"><span class="keyword">auto</span> msg = messaging_container_builder()</div>
<div class="line">  .source(<span class="stringliteral">&quot;client_123&quot;</span>)</div>
<div class="line">  .target(<span class="stringliteral">&quot;service_xyz&quot;</span>)</div>
<div class="line">  .topic(<span class="stringliteral">&quot;user.events.created&quot;</span>)</div>
<div class="line">  .trace_id(generate_trace_id())</div>
<div class="line">  .add_header(<span class="stringliteral">&quot;version&quot;</span>, <span class="stringliteral">&quot;1.0&quot;</span>)</div>
<div class="line">  .add_body(<span class="stringliteral">&quot;operation&quot;</span>, <span class="stringliteral">&quot;create_user&quot;</span>)</div>
<div class="line">  .add_body(<span class="stringliteral">&quot;user_id&quot;</span>, 12345)</div>
<div class="line">  .add_metadata(<span class="stringliteral">&quot;priority&quot;</span>, <span class="stringliteral">&quot;HIGH&quot;</span>)</div>
<div class="line">  .optimize_for_speed()  <span class="comment">// optimized_container 사용</span></div>
<div class="line">  .build();</div>
</div><!-- fragment --></li>
<li>직렬화 포맷 지원:<ul>
<li>Binary (기본): 2M containers/s</li>
<li>JSON (디버깅): 800K containers/s</li>
</ul>
</li>
<li>성능 검증: 메시지 생성 5M/s, 직렬화 2M/s</li>
</ul>
<p><em>결과물</em>: messaging_container.h, messaging_container_builder.h, 단위 테스트 <em>선행 조건</em>: Phase 1 완료 <em>예상 소요</em>: 2일 <em>성능 목표</em>: 메시지 생성 5M/s, 직렬화 2M/s</p>
<h2><a class="anchor" id="autotoc_md2280"></a>
&lt;strong&gt;Task 2.2 – Result 기반 플로우 제로화&lt;/strong&gt;</h2>
<p><b>목적:</b> 예외 없는 에러 처리로 전환 <b>작업 내용:</b></p><ul>
<li>에러 코드 정의 (include/messaging_system/error_codes.h): <div class="fragment"><div class="line"><span class="keyword">namespace </span>messaging::error {</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> INVALID_MESSAGE = -200;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> ROUTING_FAILED = -201;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> SERIALIZATION_ERROR = -202;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> NETWORK_ERROR = -203;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> DATABASE_ERROR = -204;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> QUEUE_FULL = -205;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> TIMEOUT = -206;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> AUTHENTICATION_FAILED = -207;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> AUTHORIZATION_FAILED = -208;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>API 변환 패턴: <div class="fragment"><div class="line"><span class="comment">// 레거시</span></div>
<div class="line"><span class="keywordtype">void</span> MessageBus::publish(<span class="keyword">const</span> Message&amp; msg) { <span class="keywordflow">throw</span> ...; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 신규</span></div>
<div class="line">Result&lt;void&gt; MessageBus::publish(<span class="keyword">const</span> Message&amp; msg) {</div>
<div class="line">  <span class="keyword">auto</span> validation = validate(msg);</div>
<div class="line">  RETURN_IF_ERROR(validation);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> network-&gt;send(msg)</div>
<div class="line">    .and_then([](<span class="keyword">auto</span>) { <span class="keywordflow">return</span> persist(msg); })</div>
<div class="line">    .map([](<span class="keyword">auto</span>) { <span class="keywordflow">return</span> std::monostate{}; });</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>헬퍼 매크로 활용:<ul>
<li><code>RETURN_IF_ERROR(result)</code></li>
<li><code>ASSIGN_OR_RETURN(var, result)</code></li>
<li><code>RETURN_ERROR_IF(condition, code, message)</code></li>
</ul>
</li>
<li>exception_mapper 통합 (레거시 호환)</li>
</ul>
<p><em>결과물</em>: error_codes.h, Result 기반 API, 마이그레이션 가이드 <em>선행 조건</em>: Task 2.1 완료 <em>예상 소요</em>: 3일</p>
<h2><a class="anchor" id="autotoc_md2281"></a>
&lt;strong&gt;Task 2.3 – IExecutor 주입식 아키텍처 구현&lt;/strong&gt;</h2>
<p><b>목적:</b> DI 기반 실행기 주입으로 유연성 확보 <b>작업 내용:</b></p><ul>
<li>service_registry 활용: <div class="fragment"><div class="line"><span class="comment">// 실행기 등록</span></div>
<div class="line"><span class="keyword">auto</span> io_executor = std::make_shared&lt;thread_pool&gt;(2);  <span class="comment">// I/O 전용</span></div>
<div class="line"><span class="keyword">auto</span> work_executor = std::make_shared&lt;typed_thread_pool&gt;(8);  <span class="comment">// 비즈니스 로직</span></div>
<div class="line">service_registry::register_service&lt;IExecutor&gt;(<span class="stringliteral">&quot;io&quot;</span>, io_executor);</div>
<div class="line">service_registry::register_service&lt;IExecutor&gt;(<span class="stringliteral">&quot;work&quot;</span>, work_executor);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// MessageBus 생성</span></div>
<div class="line"><span class="keyword">class </span>MessageBus {</div>
<div class="line">  std::shared_ptr&lt;IExecutor&gt; io_executor_;</div>
<div class="line">  std::shared_ptr&lt;IExecutor&gt; work_executor_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  MessageBus(std::shared_ptr&lt;IExecutor&gt; io, std::shared_ptr&lt;IExecutor&gt; work)</div>
<div class="line">    : io_executor_(io), work_executor_(work) {}</div>
<div class="line"> </div>
<div class="line">  Result&lt;void&gt; publish_async(Message msg) {</div>
<div class="line">    <span class="keyword">auto</span> job = std::make_unique&lt;MessageProcessJob&gt;(std::move(msg));</div>
<div class="line">    <span class="keywordflow">return</span> work_executor_-&gt;execute(std::move(job));</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>typed_thread_pool 활용 (메시지 타입별 라우팅): <div class="fragment"><div class="line">typed_pool-&gt;register_type&lt;HighPriorityMessage&gt;(2);</div>
<div class="line">typed_pool-&gt;register_type&lt;NormalMessage&gt;(6);</div>
</div><!-- fragment --></li>
<li>성능 검증: 1.24M jobs/s (typed_thread_pool)</li>
</ul>
<p><em>결과물</em>: DI 기반 MessageBus, IExecutor 통합, 성능 테스트 <em>선행 조건</em>: Task 2.2 완료 <em>예상 소요</em>: 2일 <em>성능 목표</em>: 1.2M+ jobs/s</p>
<h2><a class="anchor" id="autotoc_md2282"></a>
&lt;strong&gt;Task 2.4 – 라우팅/토픽 엔진 정비&lt;/strong&gt;</h2>
<p><b>목적:</b> 고성능 Pub/Sub 엔진 구축 <b>작업 내용:</b></p><ul>
<li>TopicRouter 구현: <div class="fragment"><div class="line"><span class="keyword">class </span>TopicRouter {</div>
<div class="line">  <span class="keyword">using </span>SubscriberCallback = std::function&lt;Result&lt;void&gt;(<span class="keyword">const</span> value_container&amp;)&gt;;</div>
<div class="line">  <span class="keyword">using </span>Filter = std::function&lt;bool(<span class="keyword">const</span> value_container&amp;)&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>Subscription {</div>
<div class="line">    std::string topic_pattern;  <span class="comment">// &quot;user.*.created&quot;, &quot;order.#&quot;</span></div>
<div class="line">    Filter filter;</div>
<div class="line">    SubscriberCallback callback;</div>
<div class="line">    <span class="keywordtype">int</span> priority;  <span class="comment">// 0-10, 높을수록 우선</span></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Result&lt;void&gt; subscribe(<span class="keyword">const</span> std::string&amp; topic,</div>
<div class="line">                         SubscriberCallback cb,</div>
<div class="line">                         Filter filter = <span class="keyword">nullptr</span>,</div>
<div class="line">                         <span class="keywordtype">int</span> priority = 5);</div>
<div class="line"> </div>
<div class="line">  Result&lt;void&gt; publish(<span class="keyword">const</span> std::string&amp; topic,</div>
<div class="line">                       <span class="keyword">const</span> value_container&amp; msg);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::unordered_map&lt;std::string, std::vector&lt;Subscription&gt;&gt; subscriptions_;</div>
<div class="line">  std::shared_ptr&lt;IExecutor&gt; executor_;</div>
<div class="line">  std::shared_ptr&lt;bounded_job_queue&gt; queue_;  <span class="comment">// 백프레셔 지원</span></div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>백프레셔 정책 통합: <div class="fragment"><div class="line"><span class="keyword">auto</span> bounded_queue = std::make_shared&lt;bounded_job_queue&gt;(10000);</div>
<div class="line">bounded_queue-&gt;set_overflow_policy(overflow_policy::drop_oldest);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 메트릭 수집</span></div>
<div class="line"><span class="keyword">auto</span> metrics = bounded_queue-&gt;get_metrics();</div>
<div class="line"><span class="keywordflow">if</span> (metrics.utilization &gt; 0.8) {</div>
<div class="line">  logger-&gt;log(log_level::warning, <span class="stringliteral">&quot;Queue 80% full&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>패턴 매칭 엔진:<ul>
<li><code>*</code>: 단일 레벨 와일드카드 (user.*.created)</li>
<li><code>#</code>: 다중 레벨 와일드카드 (order.#)</li>
<li>정규식 지원 (옵션)</li>
</ul>
</li>
</ul>
<p><em>결과물</em>: TopicRouter, 패턴 매칭 엔진, 백프레셔 통합, 벤치마크 <em>선행 조건</em>: Task 2.3 완료 <em>예상 소요</em>: 3일 <em>성능 목표</em>: 100K+ msg/s 라우팅 처리량</p>
<p><b>Phase 2 완료 기준:</b></p><ul>
<li>✅ 메시지 컨테이너 생성 5M/s</li>
<li>✅ 직렬화 2M/s</li>
<li>✅ 모든 API Result&lt;T&gt; 반환</li>
<li>✅ 라우팅 처리량 100K+ msg/s</li>
</ul>
<h1><a class="anchor" id="autotoc_md2283"></a>
Phase 3. 인프라 통합 계층 구축</h1>
<p><b>Phase 목표:</b> 네트워크/DB/로깅/모니터링 시스템 통합 <b>병렬 작업:</b> Task 3.1은 Task 2.1-2.2와 병렬, Task 3.2는 Task 2.3-2.4와 병렬 가능</p>
<h2><a class="anchor" id="autotoc_md2284"></a>
&lt;strong&gt;Task 3.1 – 네트워크 경계 계층 구현&lt;/strong&gt;</h2>
<p><b>목적:</b> network_system 기반 고성능 메시지 송수신 파이프라인 <b>작업 내용:</b></p><ul>
<li>MessagingNetworkBridge 구현: <div class="fragment"><div class="line"><span class="keyword">class </span>MessagingNetworkBridge {</div>
<div class="line">  std::shared_ptr&lt;messaging_server&gt; server_;</div>
<div class="line">  std::shared_ptr&lt;IExecutor&gt; io_executor_;    <span class="comment">// I/O 전용 (1-2 쓰레드)</span></div>
<div class="line">  std::shared_ptr&lt;IExecutor&gt; work_executor_;  <span class="comment">// 비즈니스 로직 (N 쓰레드)</span></div>
<div class="line">  std::shared_ptr&lt;TopicRouter&gt; router_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Result&lt;void&gt; start(uint16_t port);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  Result&lt;void&gt; on_message_received(</div>
<div class="line">    std::shared_ptr&lt;messaging_session&gt; session,</div>
<div class="line">    std::vector&lt;uint8_t&gt; data);</div>
<div class="line"> </div>
<div class="line">  Result&lt;void&gt; process_message(</div>
<div class="line">    std::shared_ptr&lt;messaging_session&gt; session,</div>
<div class="line">    <span class="keyword">const</span> value_container&amp; container);</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>I/O와 워크 쓰레드 분리:<ul>
<li>I/O 쓰레드: 네트워크 이벤트 처리 (비차단)</li>
<li>워크 쓰레드: 역직렬화 + 비즈니스 로직 (병렬)</li>
</ul>
</li>
<li>파이프라인 구성:<ol type="1">
<li>수신 → 2. 역직렬화 (I/O) → 3. 라우팅 (Worker) → 4. 직렬화 (Worker) → 5. 송신 (I/O)</li>
</ol>
</li>
<li>성능 목표: 네트워크 계층 305K msg/s → 전체 파이프라인 100K+ msg/s</li>
</ul>
<p><em>결과물</em>: MessagingNetworkBridge, 파이프라인 구현, 성능 벤치마크 <em>선행 조건</em>: Task 2.1-2.2 완료 (병렬 가능) <em>예상 소요</em>: 3일 <em>성능 목표</em>: 100K+ msg/s 처리량, P95 &lt;10ms</p>
<h2><a class="anchor" id="autotoc_md2285"></a>
&lt;strong&gt;Task 3.2 – 영속성 및 재처리 경로 구성&lt;/strong&gt;</h2>
<p><b>목적:</b> database_system 기반 메시지 영속화 및 재처리 <b>작업 내용:</b></p><ul>
<li>ORM Entity 정의: <div class="fragment"><div class="line"><span class="keyword">struct </span>MessageEntity : entity_base {</div>
<div class="line">  int64_t id;</div>
<div class="line">  std::string topic;</div>
<div class="line">  std::string payload;</div>
<div class="line">  std::string status;  <span class="comment">// PENDING, PROCESSING, COMPLETED, FAILED</span></div>
<div class="line">  std::chrono::system_clock::time_point created_at;</div>
<div class="line">  <span class="keywordtype">int</span> retry_count;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> entity_metadata metadata();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ConsumerOffset : entity_base {</div>
<div class="line">  std::string consumer_group;</div>
<div class="line">  std::string topic;</div>
<div class="line">  int64_t offset;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> entity_metadata metadata();</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>PersistentMessageQueue 구현: <div class="fragment"><div class="line"><span class="keyword">class </span>PersistentMessageQueue {</div>
<div class="line">  std::shared_ptr&lt;connection_pool&gt; pool_;</div>
<div class="line">  std::shared_ptr&lt;entity_manager&gt; em_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Result&lt;void&gt; enqueue(<span class="keyword">const</span> value_container&amp; msg);</div>
<div class="line">  Result&lt;std::vector&lt;MessageEntity&gt;&gt; dequeue_batch(<span class="keywordtype">int</span> limit = 100);</div>
<div class="line">  Result&lt;void&gt; mark_completed(int64_t message_id);</div>
<div class="line">  Result&lt;void&gt; mark_failed(int64_t message_id);</div>
<div class="line">  Result&lt;void&gt; reprocess_failed(<span class="keywordtype">int</span> max_retries = 3);</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>트랜잭션 경계: <div class="fragment"><div class="line">RETURN_IF_ERROR(conn-&gt;begin_transaction());</div>
<div class="line"><span class="keyword">auto</span> result = em_-&gt;save(entity);</div>
<div class="line"><span class="keywordflow">if</span> (result.is_error()) {</div>
<div class="line">  conn-&gt;rollback_transaction();</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">return</span> conn-&gt;commit_transaction();</div>
</div><!-- fragment --></li>
<li>커넥션 풀 설정:<ul>
<li>min_connections: 5, max_connections: 50</li>
<li>idle_timeout: 30s, acquire_timeout: 5s</li>
</ul>
</li>
</ul>
<p><em>결과물</em>: ORM Entities, PersistentMessageQueue, 재처리 로직, 통합 테스트 <em>선행 조건</em>: Task 2.3-2.4 완료 (병렬 가능) <em>예상 소요</em>: 3일 <em>성능 목표</em>: P95 영속화 지연 &lt;50ms</p>
<h2><a class="anchor" id="autotoc_md2286"></a>
&lt;strong&gt;Task 3.3 – 로깅/모니터링 데이터 흐름 통합&lt;/strong&gt;</h2>
<p><b>목적:</b> 분산 추적 및 실시간 메트릭 수집 <b>작업 내용:</b></p><ul>
<li>trace_id 전파 메커니즘: <div class="fragment"><div class="line"><span class="keyword">class </span>TraceContext {</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">thread_local</span> std::string current_trace_id;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> set_trace_id(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>);</div>
<div class="line">  <span class="keyword">static</span> std::string get_trace_id();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 사용 예시</span></div>
<div class="line">Result&lt;void&gt; handle_request(<span class="keyword">const</span> value_container&amp; req) {</div>
<div class="line">  <span class="keyword">auto</span> trace_id = req.get_value(<span class="stringliteral">&quot;header.trace_id&quot;</span>)-&gt;to_string();</div>
<div class="line">  TraceContext::set_trace_id(trace_id);</div>
<div class="line"> </div>
<div class="line">  logger_-&gt;log(log_level::info,</div>
<div class="line">    fmt::format(<span class="stringliteral">&quot;[{}] Request received&quot;</span>, TraceContext::get_trace_id()));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// 비즈니스 로직 ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// 다음 서비스 호출 시 trace_id 전파</span></div>
<div class="line">  <span class="keyword">auto</span> next_req = messaging_container_builder()</div>
<div class="line">    .add_value(<span class="stringliteral">&quot;header.trace_id&quot;</span>, TraceContext::get_trace_id())</div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> send_to_next_service(next_req);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>logger_system 통합: <div class="fragment"><div class="line"><span class="keyword">auto</span> logger = logger_builder()</div>
<div class="line">  .with_async(<span class="keyword">true</span>)</div>
<div class="line">  .with_buffer_size(16384)</div>
<div class="line">  .with_batch_size(100)</div>
<div class="line">  .add_writer(<span class="stringliteral">&quot;console&quot;</span>, std::make_unique&lt;console_writer&gt;())</div>
<div class="line">  .add_writer(<span class="stringliteral">&quot;file&quot;</span>, std::make_unique&lt;rotating_file_writer&gt;(<span class="stringliteral">&quot;messaging.log&quot;</span>))</div>
<div class="line">  .build();</div>
</div><!-- fragment --></li>
<li>monitoring_system 통합: <div class="fragment"><div class="line"><span class="comment">// 메시지 처리 시작</span></div>
<div class="line">PERF_TIMER(<span class="stringliteral">&quot;message_processing&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 메트릭 수집</span></div>
<div class="line">monitor-&gt;record_metric(<span class="stringliteral">&quot;messages_sent_total&quot;</span>, 1.0, {{<span class="stringliteral">&quot;topic&quot;</span>, topic}});</div>
<div class="line">monitor-&gt;record_metric(<span class="stringliteral">&quot;message_latency_us&quot;</span>, latency.count(), {{<span class="stringliteral">&quot;topic&quot;</span>, topic}});</div>
<div class="line">monitor-&gt;record_metric(<span class="stringliteral">&quot;queue_depth&quot;</span>, <a class="code hl_variable" href="../../df/de0/optimized__storage_8h.html#ae2675266cf3fa5cb732880a692af6dc6">queue_depth</a>, {{<span class="stringliteral">&quot;queue&quot;</span>, queue_name}});</div>
<div class="ttc" id="aoptimized__storage_8h_html_ae2675266cf3fa5cb732880a692af6dc6"><div class="ttname"><a href="../../df/de0/optimized__storage_8h.html#ae2675266cf3fa5cb732880a692af6dc6">queue_depth</a></div><div class="ttdeci">std::uint16_t queue_depth</div><div class="ttdef"><b>Definition</b> <a href="../../df/de0/optimized__storage_8h_source.html#l00005">optimized_storage.h:5</a></div></div>
</div><!-- fragment --></li>
<li>로깅 레벨: info (프로덕션), debug (개발)</li>
<li>메트릭 수집 간격: 1000ms</li>
</ul>
<p><em>결과물</em>: TraceContext, 로깅/모니터링 통합, 대시보드 구성 <em>선행 조건</em>: Task 3.1-3.2 완료 <em>예상 소요</em>: 2일</p>
<h2><a class="anchor" id="autotoc_md2287"></a>
&lt;strong&gt;Task 3.4 – 구성 및 정책 레이어&lt;/strong&gt;</h2>
<p><b>목적:</b> YAML 기반 통합 구성 시스템 <b>작업 내용:</b></p><ul>
<li>구성 파일 스키마 (config/messaging_system.yaml): <div class="fragment"><div class="line">messaging_system:</div>
<div class="line">  version: &quot;2.0&quot;</div>
<div class="line"> </div>
<div class="line">  network:</div>
<div class="line">    server:</div>
<div class="line">      port: 8080</div>
<div class="line">      max_connections: 10000</div>
<div class="line">    client:</div>
<div class="line">      timeout_ms: 5000</div>
<div class="line">      retry_attempts: 3</div>
<div class="line"> </div>
<div class="line">  thread_pools:</div>
<div class="line">    io_pool:</div>
<div class="line">      workers: 2</div>
<div class="line">      queue_size: 100000</div>
<div class="line">    work_pool:</div>
<div class="line">      workers: 16</div>
<div class="line">      queue_size: 100000</div>
<div class="line">      lockfree: true</div>
<div class="line"> </div>
<div class="line">  database:</div>
<div class="line">    type: &quot;postgresql&quot;</div>
<div class="line">    connection_string: &quot;host=localhost port=5432 dbname=messaging&quot;</div>
<div class="line">    pool:</div>
<div class="line">      min_connections: 5</div>
<div class="line">      max_connections: 50</div>
<div class="line"> </div>
<div class="line">  logging:</div>
<div class="line">    level: &quot;info&quot;</div>
<div class="line">    async: true</div>
<div class="line"> </div>
<div class="line">  monitoring:</div>
<div class="line">    enabled: true</div>
<div class="line">    metrics_interval_ms: 1000</div>
<div class="line"> </div>
<div class="line">  policies:</div>
<div class="line">    backpressure:</div>
<div class="line">      enabled: true</div>
<div class="line">      strategy: &quot;drop_oldest&quot;</div>
<div class="line">      threshold: 0.8</div>
<div class="line">    retry:</div>
<div class="line">      max_attempts: 3</div>
<div class="line">      backoff_ms: [100, 500, 2000]</div>
</div><!-- fragment --></li>
<li>MessagingSystemConfig 클래스: <div class="fragment"><div class="line"><span class="keyword">class </span>MessagingSystemConfig {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> Result&lt;MessagingSystemConfig&gt; load_from_file(<span class="keyword">const</span> std::string&amp; path);</div>
<div class="line">  Result&lt;void&gt; watch_for_changes(std::function&lt;<span class="keywordtype">void</span>(<span class="keyword">const</span> MessagingSystemConfig&amp;)&gt; callback);</div>
<div class="line"> </div>
<div class="line">  uint16_t network_port;</div>
<div class="line">  <span class="keywordtype">int</span> max_connections;</div>
<div class="line">  <span class="keywordtype">int</span> io_workers;</div>
<div class="line">  <span class="keywordtype">int</span> work_workers;</div>
<div class="line">  <span class="keywordtype">bool</span> use_lockfree;</div>
<div class="line">  std::string db_type;</div>
<div class="line">  connection_pool_config db_pool_config;</div>
<div class="line">  log_level log_level;</div>
<div class="line">  <span class="comment">// ... 기타 설정</span></div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>Watch 메커니즘 (inotify/FSEvents)</li>
<li>구성 검증: 스키마 유효성 검사</li>
</ul>
<p><em>결과물</em>: 구성 로더, YAML 스키마, Watch 메커니즘, 검증 로직 <em>선행 조건</em>: Task 3.3 완료 <em>예상 소요</em>: 2일</p>
<p><b>Phase 3 완료 기준:</b></p><ul>
<li>✅ 네트워크 파이프라인 100K+ msg/s</li>
<li>✅ DB 영속화 P95 &lt;50ms</li>
<li>✅ 분산 추적 trace_id 전파 동작</li>
<li>✅ YAML 구성 로더 동작</li>
</ul>
<h1><a class="anchor" id="autotoc_md2288"></a>
Phase 4. 검증·배포 준비</h1>
<p><b>Phase 목표:</b> 프로덕션 배포를 위한 검증 및 문서화</p>
<h2><a class="anchor" id="autotoc_md2289"></a>
&lt;strong&gt;Task 4.1 – 교차 모듈 테스트 수립&lt;/strong&gt;</h2>
<p><b>목적:</b> End-to-End 통합 테스트 및 CI/CD 구성 <b>작업 내용:</b></p><ul>
<li>통합 테스트 시나리오:<ol type="1">
<li><b>End-to-End 파이프라인</b>: 메시지 발행 → 라우팅 → 영속화 → 수신</li>
<li><b>네트워크 왕복</b>: 클라이언트 송신 → 서버 수신 → 응답 → 클라이언트 수신</li>
<li><b>DB 영속화</b>: 메시지 저장 → 조회 → 상태 업데이트</li>
<li><b>로깅/모니터링</b>: trace_id 전파, 메트릭 수집</li>
</ol>
</li>
<li>CI/CD 파이프라인 (.github/workflows/ci.yml): <div class="fragment"><div class="line">jobs:</div>
<div class="line">  build-and-test:</div>
<div class="line">    strategy:</div>
<div class="line">      matrix:</div>
<div class="line">        build_type: [Debug, Release, ASAN, TSAN]</div>
<div class="line">    steps:</div>
<div class="line">      - Configure: cmake -DMESSAGING_BUILD_PROFILE=${{matrix.build_type}}</div>
<div class="line">      - Build: cmake --build build -j$(nproc)</div>
<div class="line">      - Test: ctest --parallel $(nproc)</div>
<div class="line">      - Coverage: lcov (Debug only)</div>
</div><!-- fragment --></li>
<li>커버리지 목표: 80%+</li>
<li>성능 벤치마크:<ul>
<li>메시지 처리량: 100K+ msg/s</li>
<li>P95 지연시간: &lt;10ms</li>
<li>메모리 사용량: &lt;500MB (10K 연결)</li>
</ul>
</li>
</ul>
<p>*결과물*: 통합 테스트 Suite, CI/CD 구성, 커버리지 리포트 *선행 조건*: Phase 3 완료 *예상 소요*: 3일</p>
<h2><a class="anchor" id="autotoc_md2290"></a>
**Task 4.2 – 마이그레이션 가이드 및 API 문서화**</h2>
<p>**목적:** 사용자 대상 문서 완성 **작업 내용:**</p><ul>
<li>마이그레이션 가이드 (docs/MIGRATION_GUIDE.md):<ul>
<li>Breaking Changes 목록</li>
<li>API 변환 패턴 (예외 → Result&lt;T&gt;)</li>
<li>Step-by-Step 마이그레이션 절차</li>
<li>호환성 레이어 사용법</li>
<li>FAQ</li>
</ul>
</li>
<li>API 레퍼런스:<ul>
<li>Doxygen 주석 추가</li>
<li>모든 public API 문서화</li>
<li>사용 예제 코드</li>
</ul>
</li>
<li>배포 가이드 (<a class="el" href="../../dd/deb/DEPLOYMENT__GUIDE_8md.html">docs/DEPLOYMENT_GUIDE.md</a>):<ul>
<li>시스템 요구사항</li>
<li>설치 절차</li>
<li>설정 파일 작성 가이드</li>
<li>모니터링 대시보드 구성</li>
</ul>
</li>
<li>성능 튜닝 가이드 (docs/PERFORMANCE_TUNING.md):<ul>
<li>스레드 풀 크기 조정</li>
<li>DB 커넥션 풀 설정</li>
<li>네트워크 버퍼 크기</li>
<li>백프레셔 정책 선택</li>
</ul>
</li>
</ul>
<p><em>결과물</em>: 마이그레이션 가이드, API 레퍼런스, 배포 가이드, 튜닝 가이드 <em>선행 조건</em>: Task 4.1 완료 <em>예상 소요</em>: 2일</p>
<h2><a class="anchor" id="autotoc_md2291"></a>
&lt;strong&gt;Task 4.3 – 성능 및 회귀 검증&lt;/strong&gt;</h2>
<p><b>목적:</b> 성능 목표 달성 검증 및 회귀 방지 <b>작업 내용:</b></p><ul>
<li>통합 벤치마크 Suite: <div class="fragment"><div class="line"><span class="comment">// benchmarks/end_to_end_benchmark.cpp</span></div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_MessagePublish)-&gt;Threads(1)-&gt;Threads(4)-&gt;Threads(8);</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_MessageRoundtrip);</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_DatabasePersistence);</div>
<div class="line"><a class="code hl_function" href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a>(BM_TopicRouting);</div>
<div class="ttc" id="alog__level__benchmark_8cpp_html_a5ac153b82890aad253a9a12b1c89543b"><div class="ttname"><a href="../../dd/df2/log__level__benchmark_8cpp.html#a5ac153b82890aad253a9a12b1c89543b">BENCHMARK</a></div><div class="ttdeci">BENCHMARK(BM_LogLevelFiltering_Enabled)</div></div>
</div><!-- fragment --></li>
<li>성능 목표 검증: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">메트릭   </th><th class="markdownTableHeadNone">목표   </th><th class="markdownTableHeadNone">측정 방법    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">메시지 처리량   </td><td class="markdownTableBodyNone">100K msg/s   </td><td class="markdownTableBodyNone">BM_MessagePublish    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">P95 지연시간   </td><td class="markdownTableBodyNone">&lt;10ms   </td><td class="markdownTableBodyNone">BM_MessageRoundtrip    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">P95 DB 영속화   </td><td class="markdownTableBodyNone">&lt;50ms   </td><td class="markdownTableBodyNone">BM_DatabasePersistence    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">메모리 사용량   </td><td class="markdownTableBodyNone">&lt;500MB   </td><td class="markdownTableBodyNone">Valgrind massif    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU 사용률   </td><td class="markdownTableBodyNone">&lt;80%   </td><td class="markdownTableBodyNone">perf stat   </td></tr>
</table>
</li>
<li>회귀 테스트:<ul>
<li>기준 성능 메트릭 저장 (baselines/)</li>
<li>CI에서 자동 비교</li>
<li>10% 이상 저하 시 빌드 실패</li>
</ul>
</li>
<li>프로파일링:<ul>
<li>CPU: perf record/report</li>
<li>메모리: Valgrind massif</li>
<li>락 경합: perf lock</li>
</ul>
</li>
</ul>
<p><em>결과물</em>: 벤치마크 Suite, 성능 리포트, 회귀 테스트 설정 <em>선행 조건</em>: Task 4.2 완료 <em>예상 소요</em>: 2일 <em>검증 기준</em>: 모든 성능 목표 달성</p>
<h2><a class="anchor" id="autotoc_md2292"></a>
&lt;strong&gt;Task 4.4 – 보안 검토 및 강화&lt;/strong&gt;</h2>
<p><b>목적:</b> 프로덕션 배포를 위한 보안 강화 (추가 제안) <b>작업 내용:</b></p><ul>
<li>TLS/SSL 지원:<ul>
<li>network_system의 pipeline.encrypt() 활용</li>
<li>OpenSSL 통합</li>
<li>인증서 관리</li>
</ul>
</li>
<li>인증/권한 시스템:<ul>
<li>database_system의 access_control 활용</li>
<li>RBAC (Role-Based Access Control)</li>
<li>API 키 관리</li>
</ul>
</li>
<li>감사 로그:<ul>
<li>database_system의 audit_logger 활용</li>
<li>모든 메시지 송수신 기록</li>
<li>민감한 작업 추적</li>
</ul>
</li>
<li>보안 취약점 스캔:<ul>
<li>정적 분석: clang-tidy, cppcheck</li>
<li>동적 분석: ASAN, UBSAN</li>
<li>의존성 취약점: OWASP Dependency-Check</li>
</ul>
</li>
</ul>
<p><em>결과물</em>: TLS 구성, 인증 시스템, 감사 로그, 보안 스캔 리포트 <em>선행 조건</em>: Task 4.3 완료 <em>예상 소요</em>: 3일</p>
<h2><a class="anchor" id="autotoc_md2293"></a>
&lt;strong&gt;Task 4.5 – 출시 체크리스트/런북 작성&lt;/strong&gt;</h2>
<p><b>목적:</b> 운영 준비 완료 <b>작업 내용:</b></p><ul>
<li>배포 전 체크리스트:<ul>
<li>[ ] 모든 CI 테스트 통과 (모든 빌드 타입)</li>
<li>[ ] 성능 벤치마크 목표 달성</li>
<li>[ ] 보안 감사 완료</li>
<li>[ ] DB 마이그레이션 스크립트 검증</li>
<li>[ ] 백업 및 롤백 절차 준비</li>
<li>[ ] 모니터링 대시보드 구성</li>
<li>[ ] 알림 임계값 설정</li>
<li>[ ] 문서 업데이트</li>
<li>[ ] 스테이징 환경 배포 및 검증</li>
<li>[ ] 부하 테스트 (예상 트래픽의 150%)</li>
</ul>
</li>
<li>배포 절차:<ol type="1">
<li>DB 마이그레이션</li>
<li>설정 파일 배포</li>
<li>Rolling/Blue-Green 배포</li>
<li>Health Check 검증</li>
</ol>
</li>
<li>모니터링 체크리스트:<ul>
<li>[ ] 메시지 처리율 &gt;50K msg/s</li>
<li>[ ] P95 지연시간 &lt;50ms</li>
<li>[ ] CPU 사용률 &lt;80%</li>
<li>[ ] 메모리 사용률 &lt;80%</li>
<li>[ ] DB 커넥션 풀 &gt;20% 여유</li>
<li>[ ] 큐 깊이 &lt;5000 메시지</li>
<li>[ ] 에러율 &lt;1%</li>
</ul>
</li>
<li>롤백 절차:<ol type="1">
<li>트래픽 차단</li>
<li>이전 버전 복구</li>
<li>DB 롤백 (필요 시)</li>
<li>설정 복원</li>
<li>검증</li>
</ol>
</li>
<li>인시던트 대응:<ul>
<li>높은 지연시간: 큐 깊이/DB 상태 확인</li>
<li>메시지 손실: DB PENDING 조회, DLQ 확인</li>
<li>메모리 누수: Heap 프로파일링</li>
</ul>
</li>
</ul>
<p>*결과물*: 배포 체크리스트, 배포 스크립트, 모니터링 설정, 런북 *선행 조건*: Task 4.4 완료 *예상 소요*: 1일</p>
<p>**Phase 4 완료 기준:**</p><ul>
<li>✅ 모든 통합 테스트 통과</li>
<li>✅ 성능 목표 달성 (100K msg/s, P95 &lt;10ms)</li>
<li>✅ 커버리지 80%+ 달성</li>
<li>✅ 보안 감사 완료</li>
<li>✅ 문서 완성</li>
<li>✅ 운영 런북 작성 완료</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2295"></a>
전체 일정 요약</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Phase   </th><th class="markdownTableHeadNone">예상 소요   </th><th class="markdownTableHeadNone">누적 소요   </th><th class="markdownTableHeadNone">주요 산출물    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Phase 0</b>   </td><td class="markdownTableBodyNone">4일   </td><td class="markdownTableBodyNone">4일   </td><td class="markdownTableBodyNone">common_system 통합, 인터페이스 매핑, 빌드 환경 설계    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Phase 1</b>   </td><td class="markdownTableBodyNone">4.5일   </td><td class="markdownTableBodyNone">8.5일   </td><td class="markdownTableBodyNone">외부 모듈 통합, CMake 구성, 레거시 제거    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Phase 2</b>   </td><td class="markdownTableBodyNone">10일   </td><td class="markdownTableBodyNone">18.5일   </td><td class="markdownTableBodyNone">메시지 컨테이너, Result&lt;T&gt; API, DI 아키텍처, TopicRouter    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Phase 3</b>   </td><td class="markdownTableBodyNone">10일   </td><td class="markdownTableBodyNone">28.5일   </td><td class="markdownTableBodyNone">네트워크 브리지, DB 영속화, 로깅/모니터링, YAML 구성    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Phase 4</b>   </td><td class="markdownTableBodyNone">11일   </td><td class="markdownTableBodyNone">39.5일   </td><td class="markdownTableBodyNone">통합 테스트, 문서화, 성능 검증, 보안 강화, 런북   </td></tr>
</table>
<p><b>총 예상 소요:</b> 약 40일 (8주, 병렬 작업 고려 시 ~6주)</p>
<h1><a class="anchor" id="autotoc_md2296"></a>
병렬 작업 최적화</h1>
<p><b>Phase 2 + Phase 3 병렬 구간:</b></p><ul>
<li>Task 2.1-2.2 (메시지 컨테이너, Result 전환) + Task 3.1 (네트워크 브리지)</li>
<li>Task 2.3-2.4 (DI, 라우팅) + Task 3.2 (DB 영속화)</li>
<li>병렬 진행 시 약 2주 단축 가능</li>
</ul>
<p><b>실제 예상 소요:</b> 6주 (병렬 최적화 적용)</p>
<h1><a class="anchor" id="autotoc_md2297"></a>
성공 기준 (최종)</h1>
<p>✅ <b>기능 완성도:</b></p><ul>
<li>모든 Phase 완료</li>
<li>모든 Task 산출물 검수 완료</li>
<li>통합 테스트 100% 통과</li>
</ul>
<p>✅ <b>성능 목표:</b></p><ul>
<li>메시지 처리량: 100K+ msg/s (목표 200K msg/s)</li>
<li>P95 지연시간: &lt;10ms</li>
<li>메모리 사용량: &lt;500MB (10K 연결)</li>
<li>CPU 사용률: &lt;80%</li>
</ul>
<p>✅ **품질 기준:**</p><ul>
<li>테스트 커버리지: 80%+</li>
<li>모든 빌드 프로파일 통과 (Debug, Release, ASAN, TSAN)</li>
<li>Zero 메모리 누수 (ASAN)</li>
<li>Zero 데이터 레이스 (TSAN)</li>
</ul>
<p>✅ **운영 준비:**</p><ul>
<li>문서 완성 (마이그레이션, API, 배포, 튜닝)</li>
<li>모니터링 대시보드 구성</li>
<li>보안 감사 완료</li>
<li>런북 작성 완료</li>
</ul>
<hr  />
<p><b>본 계획은 Phase별 선행 조건을 포함하고 있으므로 각 Phase 완료 시 산출물을 검토한 뒤 다음 Phase를 착수한다.</b></p>
<p><b>핵심 개선사항 요약:</b></p><ol type="1">
<li>✅ common_system 최우선 통합 (Task 0.0 신설)</li>
<li>✅ 성능 목표 명확화 (각 Phase별 정량적 목표)</li>
<li>✅ 병렬 작업 가이드라인 (Phase 2/3 병렬 가능)</li>
<li>✅ 보안 검토 추가 (Task 4.4 신설)</li>
<li>✅ 상세한 코드 예제 및 구현 가이드</li>
<li>✅ 예상 소요 시간 및 일정 명시 </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
