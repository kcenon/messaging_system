<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Phase 3: Infrastructure Integration - Design Document</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/de1/md_docs_2phase3_2DESIGN.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Phase 3: Infrastructure Integration - Design Document</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md638"></a> </p>
<h1><a class="anchor" id="autotoc_md639"></a>
Overview</h1>
<p>Integrate network, database, logging, and monitoring systems with messaging core.</p>
<h1><a class="anchor" id="autotoc_md640"></a>
Architecture</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────┐</div>
<div class="line">│                      Client Applications                     │</div>
<div class="line">└───────────────────────────┬─────────────────────────────────┘</div>
<div class="line">                            │ TCP/TLS</div>
<div class="line">┌───────────────────────────┴─────────────────────────────────┐</div>
<div class="line">│              MessagingNetworkBridge (Phase 3.1)             │</div>
<div class="line">│  ┌────────────┐    ┌─────────────┐    ┌─────────────────┐  │</div>
<div class="line">│  │ I/O Thread │───▶│ Deserialize │───▶│  Worker Threads │  │</div>
<div class="line">│  └────────────┘    └─────────────┘    └────────┬────────┘  │</div>
<div class="line">└──────────────────────────────────────────────────┼──────────┘</div>
<div class="line">                                                   │</div>
<div class="line">┌──────────────────────────────────────────────────┼──────────┐</div>
<div class="line">│                   MessageBus &amp; TopicRouter       │          │</div>
<div class="line">│                         (Phase 2)                │          │</div>
<div class="line">└──────────────────────────────────────────────────┼──────────┘</div>
<div class="line">                                                   │</div>
<div class="line">                    ┌──────────────┬───────────────┴───────┐</div>
<div class="line">                    │              │                       │</div>
<div class="line">┌───────────────────▼───┐  ┌───────▼────────┐  ┌──────────▼─────┐</div>
<div class="line">│ PersistentMessageQueue │  │ TraceContext   │  │ ConfigLoader   │</div>
<div class="line">│    (Phase 3.2)         │  │ + Logger       │  │  (Phase 3.4)   │</div>
<div class="line">│                        │  │ + Monitor      │  │                │</div>
<div class="line">│  - enqueue()           │  │ (Phase 3.3)    │  │  - YAML parse  │</div>
<div class="line">│  - dequeue()           │  │                │  │  - Watch       │</div>
<div class="line">│  - reprocess()         │  │                │  │                │</div>
<div class="line">└────────────────────────┘  └────────────────┘  └────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md641"></a>
Component Designs</h1>
<h2><a class="anchor" id="autotoc_md642"></a>
1. Network Bridge (Task 3.1)</h2>
<p><b>Header:</b> <code>include/messaging_system/integration/network_bridge.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/network/core/messaging_server.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/network/core/messaging_client.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/interfaces/executor_interface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d9/d29/message__bus_8h.html">core/message_bus.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MessagingNetworkBridge {</div>
<div class="line">    std::shared_ptr&lt;network::messaging_server&gt; server_;</div>
<div class="line">    std::shared_ptr&lt;common::IExecutor&gt; io_executor_;</div>
<div class="line">    std::shared_ptr&lt;common::IExecutor&gt; work_executor_;</div>
<div class="line">    std::shared_ptr&lt;MessageBus&gt; message_bus_;</div>
<div class="line">    uint16_t port_;</div>
<div class="line">    std::atomic&lt;bool&gt; running_{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MessagingNetworkBridge(</div>
<div class="line">        uint16_t port,</div>
<div class="line">        std::shared_ptr&lt;common::IExecutor&gt; io_executor,</div>
<div class="line">        std::shared_ptr&lt;common::IExecutor&gt; work_executor,</div>
<div class="line">        std::shared_ptr&lt;MessageBus&gt; message_bus</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    Result&lt;void&gt; start();</div>
<div class="line">    Result&lt;void&gt; stop();</div>
<div class="line">    <span class="keywordtype">bool</span> is_running()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> running_.load(); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// Called on I/O thread</span></div>
<div class="line">    Result&lt;void&gt; on_message_received(</div>
<div class="line">        std::shared_ptr&lt;network::messaging_session&gt; session,</div>
<div class="line">        std::vector&lt;uint8_t&gt; data</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Executed on worker thread</span></div>
<div class="line">    Result&lt;void&gt; process_message(</div>
<div class="line">        std::shared_ptr&lt;network::messaging_session&gt; session,</div>
<div class="line">        <span class="keyword">const</span> MessagingContainer&amp; msg</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    Result&lt;void&gt; send_response(</div>
<div class="line">        std::shared_ptr&lt;network::messaging_session&gt; session,</div>
<div class="line">        <span class="keyword">const</span> MessagingContainer&amp; response</div>
<div class="line">    );</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace messaging</span></div>
<div class="ttc" id="amessage__bus_8h_html"><div class="ttname"><a href="../../d9/d29/message__bus_8h.html">message_bus.h</a></div></div>
</div><!-- fragment --><p><b>Pipeline Flow:</b></p><ol type="1">
<li><b>Receive</b> (I/O thread): TCP data → buffer</li>
<li><b>Deserialize</b> (I/O thread): buffer → MessagingContainer</li>
<li><b>Offload</b> (I/O thread): Submit to work_executor</li>
<li><b>Process</b> (Worker thread): Route message via MessageBus</li>
<li><b>Serialize</b> (Worker thread): Response → buffer</li>
<li><b>Send</b> (I/O thread): buffer → TCP</li>
</ol>
<p><b>Performance Target:</b> 100K+ msg/s end-to-end</p>
<h2><a class="anchor" id="autotoc_md643"></a>
2. Persistent Message Queue (Task 3.2)</h2>
<p><b>Header:</b> <code>include/messaging_system/integration/persistent_queue.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/database/database_manager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/database/orm/entity_manager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;core/messaging_container.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>MessageEntity {</div>
<div class="line">    int64_t id;</div>
<div class="line">    std::string topic;</div>
<div class="line">    std::string payload;</div>
<div class="line">    std::string status;  <span class="comment">// PENDING, PROCESSING, COMPLETED, FAILED</span></div>
<div class="line">    std::chrono::system_clock::time_point created_at;</div>
<div class="line">    std::chrono::system_clock::time_point updated_at;</div>
<div class="line">    <span class="keywordtype">int</span> retry_count;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> database::entity_metadata metadata();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ConsumerOffset {</div>
<div class="line">    std::string consumer_group;</div>
<div class="line">    std::string topic;</div>
<div class="line">    int64_t offset;</div>
<div class="line">    std::chrono::system_clock::time_point updated_at;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> database::entity_metadata metadata();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>PersistentMessageQueue {</div>
<div class="line">    std::shared_ptr&lt;database::connection_pool&gt; pool_;</div>
<div class="line">    std::shared_ptr&lt;database::entity_manager&gt; entity_manager_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    PersistentMessageQueue(</div>
<div class="line">        std::shared_ptr&lt;database::connection_pool&gt; pool</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Queue operations</span></div>
<div class="line">    Result&lt;void&gt; enqueue(<span class="keyword">const</span> MessagingContainer&amp; msg);</div>
<div class="line">    Result&lt;std::vector&lt;MessageEntity&gt;&gt; dequeue_batch(<span class="keywordtype">int</span> limit = 100);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Status updates</span></div>
<div class="line">    Result&lt;void&gt; mark_completed(int64_t message_id);</div>
<div class="line">    Result&lt;void&gt; mark_failed(int64_t message_id);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Reprocessing</span></div>
<div class="line">    Result&lt;void&gt; reprocess_failed(<span class="keywordtype">int</span> max_retries = 3);</div>
<div class="line">    Result&lt;size_t&gt; count_pending() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Consumer offset management</span></div>
<div class="line">    Result&lt;void&gt; save_offset(<span class="keyword">const</span> std::string&amp; group, <span class="keyword">const</span> std::string&amp; topic, int64_t offset);</div>
<div class="line">    Result&lt;int64_t&gt; load_offset(<span class="keyword">const</span> std::string&amp; group, <span class="keyword">const</span> std::string&amp; topic);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace messaging</span></div>
</div><!-- fragment --><p><b>Database Schema:</b> </p><div class="fragment"><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> messages (</div>
<div class="line">    id BIGSERIAL <span class="keyword">PRIMARY</span> KEY,</div>
<div class="line">    topic <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">255</span>) <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    payload TEXT <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    status <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">20</span>) <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> <span class="stringliteral">&#39;PENDING&#39;</span>,</div>
<div class="line">    created_at <span class="keywordtype">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</div>
<div class="line">    updated_at <span class="keywordtype">TIMESTAMP</span>,</div>
<div class="line">    retry_count <span class="keywordtype">INT</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> <span class="stringliteral">0</span>,</div>
<div class="line">    INDEX idx_topic (topic),</div>
<div class="line">    INDEX idx_status (status),</div>
<div class="line">    INDEX idx_created_at (created_at)</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> consumer_offsets (</div>
<div class="line">    consumer_group <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">255</span>) <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    topic <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">255</span>) <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    offset <span class="keywordtype">BIGINT</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    updated_at <span class="keywordtype">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</div>
<div class="line">    <span class="keyword">PRIMARY</span> KEY (consumer_group, topic)</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Performance Target:</b> P95 latency &lt;50ms</p>
<h2><a class="anchor" id="autotoc_md644"></a>
3. Tracing and Monitoring (Task 3.3)</h2>
<p><b>Header:</b> <code>include/messaging_system/integration/trace_context.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>TraceContext {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">thread_local</span> std::string current_trace_id_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> set_trace_id(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>);</div>
<div class="line">    <span class="keyword">static</span> std::string get_trace_id();</div>
<div class="line">    <span class="keyword">static</span> std::string generate_trace_id();</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> clear();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Usage in message handlers</span></div>
<div class="line"><span class="keyword">class </span>ScopedTrace {</div>
<div class="line">    std::string previous_trace_id_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> ScopedTrace(<span class="keyword">const</span> std::string&amp; trace_id);</div>
<div class="line">    ~ScopedTrace();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace messaging</span></div>
</div><!-- fragment --><p><b>Logger Integration:</b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/core/logger.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MessageLogger {</div>
<div class="line">    std::shared_ptr&lt;logger::logger&gt; logger_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> log_message_received(<span class="keyword">const</span> MessagingContainer&amp; msg) {</div>
<div class="line">        <span class="keyword">auto</span> trace_id = TraceContext::get_trace_id();</div>
<div class="line">        logger_-&gt;log(</div>
<div class="line">            logger::log_level::info,</div>
<div class="line">            fmt::format(<span class="stringliteral">&quot;[{}] Message received: topic={}, size={}&quot;</span>,</div>
<div class="line">                trace_id, msg.topic(), msg.container().serialize().size()</div>
<div class="line">            )</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> log_message_processed(<span class="keyword">const</span> MessagingContainer&amp; msg, std::chrono::microseconds latency) {</div>
<div class="line">        <span class="keyword">auto</span> trace_id = TraceContext::get_trace_id();</div>
<div class="line">        logger_-&gt;log(</div>
<div class="line">            logger::log_level::info,</div>
<div class="line">            fmt::format(<span class="stringliteral">&quot;[{}] Message processed: topic={}, latency={}μs&quot;</span>,</div>
<div class="line">                trace_id, msg.topic(), latency.count()</div>
<div class="line">            )</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Monitoring Integration:</b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/monitoring/core/performance_monitor.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MessagingMetrics {</div>
<div class="line">    std::shared_ptr&lt;monitoring::performance_monitor&gt; monitor_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> record_message_sent(<span class="keyword">const</span> std::string&amp; topic, <span class="keywordtype">size_t</span> bytes) {</div>
<div class="line">        monitor_-&gt;record_metric(<span class="stringliteral">&quot;messages_sent_total&quot;</span>, 1.0, {{<span class="stringliteral">&quot;topic&quot;</span>, topic}});</div>
<div class="line">        monitor_-&gt;record_metric(<span class="stringliteral">&quot;bytes_sent_total&quot;</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(bytes), {{<span class="stringliteral">&quot;topic&quot;</span>, topic}});</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> record_message_latency(<span class="keyword">const</span> std::string&amp; topic, std::chrono::microseconds latency) {</div>
<div class="line">        monitor_-&gt;record_metric(<span class="stringliteral">&quot;message_latency_us&quot;</span>, latency.count(), {{<span class="stringliteral">&quot;topic&quot;</span>, topic}});</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> record_queue_depth(<span class="keyword">const</span> std::string&amp; queue, <span class="keywordtype">size_t</span> depth) {</div>
<div class="line">        monitor_-&gt;record_metric(<span class="stringliteral">&quot;queue_depth&quot;</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(depth), {{<span class="stringliteral">&quot;queue&quot;</span>, queue}});</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md645"></a>
4. Configuration System (Task 3.4)</h2>
<p><b>Header:</b> <code>include/messaging_system/integration/config_loader.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;yaml-cpp/yaml.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/common/patterns/result.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/database/connection_pool_config.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>messaging {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>NetworkConfig {</div>
<div class="line">    uint16_t port{8080};</div>
<div class="line">    <span class="keywordtype">size_t</span> max_connections{10000};</div>
<div class="line">    std::chrono::milliseconds <a class="code hl_enumvalue" href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#a0ebc74b13acdfe5c2939ed4e5acaeab6a90272dda245ae1fb3cf197e91a8689dc">timeout</a>{5000};</div>
<div class="line">    <span class="keywordtype">int</span> retry_attempts{3};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ThreadPoolConfig {</div>
<div class="line">    <span class="keywordtype">size_t</span> io_workers{2};</div>
<div class="line">    <span class="keywordtype">size_t</span> work_workers{16};</div>
<div class="line">    <span class="keywordtype">size_t</span> queue_size{100000};</div>
<div class="line">    <span class="keywordtype">bool</span> use_lockfree{<span class="keyword">false</span>};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>DatabaseConfig {</div>
<div class="line">    std::string type{<span class="stringliteral">&quot;postgresql&quot;</span>};</div>
<div class="line">    std::string connection_string;</div>
<div class="line">    database::connection_pool_config pool_config;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>LoggingConfig {</div>
<div class="line">    std::string level{<span class="stringliteral">&quot;info&quot;</span>};</div>
<div class="line">    <span class="keywordtype">bool</span> async{<span class="keyword">true</span>};</div>
<div class="line">    std::vector&lt;std::string&gt; writers;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>MonitoringConfig {</div>
<div class="line">    <span class="keywordtype">bool</span> enabled{<span class="keyword">true</span>};</div>
<div class="line">    std::chrono::milliseconds interval{1000};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>MessagingSystemConfig {</div>
<div class="line">    std::string version;</div>
<div class="line">    NetworkConfig network;</div>
<div class="line">    ThreadPoolConfig thread_pools;</div>
<div class="line">    DatabaseConfig database;</div>
<div class="line">    LoggingConfig logging;</div>
<div class="line">    MonitoringConfig monitoring;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> Result&lt;MessagingSystemConfig&gt; load_from_file(<span class="keyword">const</span> std::string&amp; path);</div>
<div class="line">    Result&lt;void&gt; <a class="code hl_enumvalue" href="../../dd/df3/namespacekcenon_1_1messaging_1_1services_1_1container.html#a221266e349efd48a805f4d942db56320af9ab05454998236921a6b0e281fae632">validate</a>() <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// File watcher for hot-reload</span></div>
<div class="line"><span class="keyword">class </span>ConfigWatcher {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using </span>Callback = std::function&lt;void(<span class="keyword">const</span> MessagingSystemConfig&amp;)&gt;;</div>
<div class="line"> </div>
<div class="line">    Result&lt;void&gt; watch(<span class="keyword">const</span> std::string&amp; path, Callback callback);</div>
<div class="line">    <span class="keywordtype">void</span> stop();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace messaging</span></div>
<div class="ttc" id="anamespacekcenon_1_1messaging_1_1core_html_a0ebc74b13acdfe5c2939ed4e5acaeab6a90272dda245ae1fb3cf197e91a8689dc"><div class="ttname"><a href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#a0ebc74b13acdfe5c2939ed4e5acaeab6a90272dda245ae1fb3cf197e91a8689dc">kcenon::messaging::core::message_status::timeout</a></div><div class="ttdeci">@ timeout</div></div>
<div class="ttc" id="anamespacekcenon_1_1messaging_1_1services_1_1container_html_a221266e349efd48a805f4d942db56320af9ab05454998236921a6b0e281fae632"><div class="ttname"><a href="../../dd/df3/namespacekcenon_1_1messaging_1_1services_1_1container.html#a221266e349efd48a805f4d942db56320af9ab05454998236921a6b0e281fae632">kcenon::messaging::services::container::container_operation::validate</a></div><div class="ttdeci">@ validate</div></div>
</div><!-- fragment --><p><b>YAML Schema Example:</b></p>
<div class="fragment"><div class="line">messaging_system:</div>
<div class="line">  version: &quot;2.0&quot;</div>
<div class="line"> </div>
<div class="line">  network:</div>
<div class="line">    port: 8080</div>
<div class="line">    max_connections: 10000</div>
<div class="line">    timeout_ms: 5000</div>
<div class="line">    retry_attempts: 3</div>
<div class="line"> </div>
<div class="line">  thread_pools:</div>
<div class="line">    io:</div>
<div class="line">      workers: 2</div>
<div class="line">      queue_size: 100000</div>
<div class="line">    work:</div>
<div class="line">      workers: 16</div>
<div class="line">      queue_size: 100000</div>
<div class="line">      lockfree: true</div>
<div class="line"> </div>
<div class="line">  database:</div>
<div class="line">    type: postgresql</div>
<div class="line">    connection_string: &quot;host=localhost port=5432 dbname=messaging&quot;</div>
<div class="line">    pool:</div>
<div class="line">      min_connections: 5</div>
<div class="line">      max_connections: 50</div>
<div class="line">      idle_timeout_s: 30</div>
<div class="line"> </div>
<div class="line">  logging:</div>
<div class="line">    level: info</div>
<div class="line">    async: true</div>
<div class="line">    writers:</div>
<div class="line">      - console</div>
<div class="line">      - rotating_file</div>
<div class="line"> </div>
<div class="line">  monitoring:</div>
<div class="line">    enabled: true</div>
<div class="line">    interval_ms: 1000</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md646"></a>
Integration Points</h1>
<h2><a class="anchor" id="autotoc_md647"></a>
Startup Sequence</h2>
<ol type="1">
<li><b>Load Configuration</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> config = MessagingSystemConfig::load_from_file(<span class="stringliteral">&quot;config.yaml&quot;</span>);</div>
<div class="line">RETURN_IF_ERROR(config);</div>
</div><!-- fragment --></li>
<li><b>Initialize Database</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> pool = create_connection_pool(config.value().database);</div>
<div class="line"><span class="keyword">auto</span> persistent_queue = std::make_shared&lt;PersistentMessageQueue&gt;(pool);</div>
</div><!-- fragment --></li>
<li><b>Initialize Thread Pools</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> io_executor = std::make_shared&lt;thread_pool&gt;(config.value().thread_pools.io_workers);</div>
<div class="line"><span class="keyword">auto</span> work_executor = std::make_shared&lt;thread_pool&gt;(config.value().thread_pools.work_workers);</div>
</div><!-- fragment --></li>
<li><b>Initialize Logger and Monitor</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> logger = create_logger(config.value().logging);</div>
<div class="line"><span class="keyword">auto</span> monitor = create_monitor(config.value().monitoring);</div>
</div><!-- fragment --></li>
<li><b>Create MessageBus</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> router = std::make_shared&lt;TopicRouter&gt;(work_executor);</div>
<div class="line"><span class="keyword">auto</span> message_bus = std::make_shared&lt;MessageBus&gt;(io_executor, work_executor, router);</div>
</div><!-- fragment --></li>
<li><b>Start Network Bridge</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> bridge = std::make_shared&lt;MessagingNetworkBridge&gt;(</div>
<div class="line">    config.value().network.port,</div>
<div class="line">    io_executor,</div>
<div class="line">    work_executor,</div>
<div class="line">    message_bus</div>
<div class="line">);</div>
<div class="line">RETURN_IF_ERROR(bridge-&gt;start());</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md648"></a>
Performance Targets</h1>
<ul>
<li><b>Network throughput:</b> 100K+ msg/s</li>
<li><b>DB persistence P95:</b> &lt;50ms</li>
<li><b>Tracing overhead:</b> &lt;1%</li>
<li><b>Config reload:</b> &lt;100ms</li>
</ul>
<h1><a class="anchor" id="autotoc_md649"></a>
Success Criteria</h1>
<ul>
<li>[ ] Network bridge handles 100K+ msg/s</li>
<li>[ ] DB queue operations complete in &lt;50ms (P95)</li>
<li>[ ] Trace IDs propagate correctly</li>
<li>[ ] Config hot-reload works</li>
<li>[ ] Integration tests pass </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
