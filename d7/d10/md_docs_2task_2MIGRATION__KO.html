<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Task 모듈 마이그레이션 가이드</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d10/md_docs_2task_2MIGRATION__KO.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Task 모듈 마이그레이션 가이드</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1800"></a> 이 가이드는 Task 모듈의 이전 버전이나 다른 작업 큐 시스템에서 마이그레이션하는 데 도움을 줍니다.</p>
<h1><a class="anchor" id="autotoc_md1801"></a>
목차</h1>
<ul>
<li>버전 마이그레이션</li>
<li>커스텀 솔루션에서 마이그레이션</li>
<li>마이그레이션 체크리스트</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1803"></a>
버전 마이그레이션</h1>
<h2><a class="anchor" id="autotoc_md1804"></a>
1.0으로 마이그레이션</h2>
<p>이전 개발 버전에서 업그레이드하는 경우 다음 단계를 따르세요:</p>
<h3><a class="anchor" id="autotoc_md1805"></a>
API 변경 사항</h3>
<ol type="1">
<li><p class="startli"><b>Result 타입 패턴</b></p>
<p class="startli">이제 모든 작업이 <code>Result&lt;T&gt;</code> 또는 <code>VoidResult</code>를 반환합니다:</p>
<div class="fragment"><div class="line"><span class="comment">// 이전 (가상의 이전 API)</span></div>
<div class="line">task t = create_task(<span class="stringliteral">&quot;name&quot;</span>, payload);  <span class="comment">// 예외를 던질 수 있음</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 이후</span></div>
<div class="line"><span class="keyword">auto</span> result = task_builder(<span class="stringliteral">&quot;name&quot;</span>).payload(payload).build();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    std::cerr &lt;&lt; result.error().message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line">task t = result.value();</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>작업용 빌더 패턴</b></p>
<div class="fragment"><div class="line"><span class="comment">// 이전</span></div>
<div class="line">task t;</div>
<div class="line">t.set_name(<span class="stringliteral">&quot;task.name&quot;</span>);</div>
<div class="line">t.set_timeout(5000);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 이후</span></div>
<div class="line"><span class="keyword">auto</span> t = task_builder(<span class="stringliteral">&quot;task.name&quot;</span>)</div>
<div class="line">    .timeout(std::chrono::milliseconds(5000))</div>
<div class="line">    .build()</div>
<div class="line">    .value();</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>설정 구조</b></p>
<div class="fragment"><div class="line"><span class="comment">// 이전</span></div>
<div class="line">system.set_worker_count(4);</div>
<div class="line">system.add_queue(<span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 이후</span></div>
<div class="line">task_system_config config;</div>
<div class="line">config.worker.concurrency = 4;</div>
<div class="line">config.worker.queues = {<span class="stringliteral">&quot;default&quot;</span>};</div>
<div class="line">task_system system(config);</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>핸들러 등록</b></p>
<div class="fragment"><div class="line"><span class="comment">// 이전</span></div>
<div class="line">system.add_handler(<span class="stringliteral">&quot;name&quot;</span>, handler_function);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 이후</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;name&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="comment">// 구현</span></div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
</div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="autotoc_md1806"></a>
설정 마이그레이션</h3>
<p>이전 설정을 새 구조에 매핑:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">이전 설정   </th><th class="markdownTableHeadNone">새 설정    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>worker_threads</code>   </td><td class="markdownTableBodyNone"><code>config.worker.concurrency</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>queue_size</code>   </td><td class="markdownTableBodyNone"><code>config.queue.max_size</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>retry_count</code>   </td><td class="markdownTableBodyNone"><code>task_config.max_retries</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>timeout_ms</code>   </td><td class="markdownTableBodyNone"><code>task_config.timeout</code>   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md1808"></a>
커스텀 솔루션에서 마이그레이션</h1>
<h2><a class="anchor" id="autotoc_md1809"></a>
스레드 풀 구현에서 마이그레이션</h2>
<p>커스텀 스레드 풀이 있다면 Task 모듈로 마이그레이션:</p>
<h3><a class="anchor" id="autotoc_md1810"></a>
이전 (커스텀 스레드 풀)</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span>ThreadPool {</div>
<div class="line">    std::vector&lt;std::thread&gt; workers;</div>
<div class="line">    std::queue&lt;std::function&lt;void()&gt;&gt; tasks;</div>
<div class="line">    std::mutex queue_mutex;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> enqueue(std::function&lt;<span class="keywordtype">void</span>()&gt; task) {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; lock(queue_mutex);</div>
<div class="line">        tasks.push(std::move(task));</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">ThreadPool pool(4);</div>
<div class="line">pool.enqueue([data]() {</div>
<div class="line">    process_data(data);</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1811"></a>
이후 (Task 모듈)</h3>
<div class="fragment"><div class="line">task_system_config config;</div>
<div class="line">config.worker.concurrency = 4;</div>
<div class="line">task_system system(config);</div>
<div class="line"> </div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;process.data&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keyword">auto</span> data = t.payload();</div>
<div class="line">    process_data(data);</div>
<div class="line"> </div>
<div class="line">    container_module::value_container result;</div>
<div class="line">    result.add(<span class="stringliteral">&quot;status&quot;</span>, <span class="stringliteral">&quot;processed&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">system.start();</div>
<div class="line"> </div>
<div class="line">container_module::value_container payload;</div>
<div class="line">payload.add(<span class="stringliteral">&quot;data&quot;</span>, data);</div>
<div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;process.data&quot;</span>, payload);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1812"></a>
마이그레이션의 이점</h3>
<ul>
<li>지수 백오프를 통한 자동 재시도</li>
<li>진행 상황 추적</li>
<li>작업 영속성</li>
<li>모니터링 및 통계</li>
<li>예약 실행</li>
<li>Chain 및 Chord 패턴</li>
</ul>
<h2><a class="anchor" id="autotoc_md1813"></a>
메시지 큐 시스템에서 마이그레이션</h2>
<h3><a class="anchor" id="autotoc_md1814"></a>
개념 매핑</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">메시지 큐 개념   </th><th class="markdownTableHeadNone">Task 모듈 동등물    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">메시지   </td><td class="markdownTableBodyNone"><code>task</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">큐   </td><td class="markdownTableBodyNone"><code>task_queue</code>의 명명된 큐    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">컨슈머   </td><td class="markdownTableBodyNone"><code>task_handler</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">프로듀서   </td><td class="markdownTableBodyNone"><code>task_client</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">승인   </td><td class="markdownTableBodyNone">핸들러 완료 시 자동    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">데드 레터 큐   </td><td class="markdownTableBodyNone">결과 백엔드의 실패한 작업   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md1815"></a>
마이그레이션 예제</h3>
<div class="fragment"><div class="line"><span class="comment">// 이전 (메시지 큐 의사 코드)</span></div>
<div class="line">producer.send(<span class="stringliteral">&quot;queue-name&quot;</span>, message);</div>
<div class="line">consumer.subscribe(<span class="stringliteral">&quot;queue-name&quot;</span>, [](Message&amp; msg) {</div>
<div class="line">    process(msg);</div>
<div class="line">    msg.ack();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 이후</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;process&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    process(t.payload());</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;process&quot;</span>)</div>
<div class="line">    .payload(message_data)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;queue-name&quot;</span>)</div>
<div class="line">    .build().value();</div>
<div class="line"> </div>
<div class="line">system.submit(task);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1816"></a>
Cron 작업에서 마이그레이션</h2>
<h3><a class="anchor" id="autotoc_md1817"></a>
이전 (시스템 Cron)</h3>
<div class="fragment"><div class="line"># /etc/crontab</div>
<div class="line">0 3 * * * /usr/bin/my-daily-job</div>
<div class="line">*/15 * * * * /usr/bin/my-sync-job</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1818"></a>
이후 (Task 스케줄러)</h3>
<div class="fragment"><div class="line"><span class="comment">// 매일 오전 3시</span></div>
<div class="line">system.schedule_cron(</div>
<div class="line">    <span class="stringliteral">&quot;daily-job&quot;</span>,</div>
<div class="line">    task_builder(<span class="stringliteral">&quot;daily.task&quot;</span>).build().value(),</div>
<div class="line">    <span class="stringliteral">&quot;0 3 * * *&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 15분마다</span></div>
<div class="line">system.schedule_cron(</div>
<div class="line">    <span class="stringliteral">&quot;sync-job&quot;</span>,</div>
<div class="line">    task_builder(<span class="stringliteral">&quot;sync.task&quot;</span>).build().value(),</div>
<div class="line">    <span class="stringliteral">&quot;*/15 * * * *&quot;</span></div>
<div class="line">);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1819"></a>
이점</h3>
<ul>
<li>중앙화된 스케줄링</li>
<li>실패 시 재시도</li>
<li>진행 모니터링</li>
<li>외부 종속성 없음</li>
<li>프로그래밍 방식 스케줄 관리</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1821"></a>
마이그레이션 체크리스트</h1>
<h2><a class="anchor" id="autotoc_md1822"></a>
마이그레이션 전</h2>
<ul>
<li>[ ] 모든 기존 작업/잡 목록화</li>
<li>[ ] 현재 재시도 및 타임아웃 동작 문서화</li>
<li>[ ] 모든 큐 이름 및 우선순위 기록</li>
<li>[ ] 현재 스케줄링 패턴 기록</li>
<li>[ ] 기존 데이터 및 설정 백업</li>
</ul>
<h2><a class="anchor" id="autotoc_md1823"></a>
마이그레이션 중</h2>
<ul>
<li>[ ] 모든 작업에 대한 동등한 핸들러 생성</li>
<li>[ ] 적절한 설정으로 task_system 구성</li>
<li>[ ] 동등한 큐 구조 설정</li>
<li>[ ] 스케줄링 설정 마이그레이션</li>
<li>[ ] 필요한 곳에 진행 추적 구현</li>
<li>[ ] 모니터링 및 로깅 설정</li>
</ul>
<h2><a class="anchor" id="autotoc_md1824"></a>
마이그레이션 후</h2>
<ul>
<li>[ ] 모든 작업이 올바르게 실행되는지 확인</li>
<li>[ ] 재시도 동작이 예상과 일치하는지 확인</li>
<li>[ ] 스케줄링이 예상대로 작동하는지 확인</li>
<li>[ ] 성능 모니터링 및 설정 조정</li>
<li>[ ] 이전 작업 인프라 제거</li>
<li>[ ] 문서 업데이트</li>
</ul>
<h2><a class="anchor" id="autotoc_md1825"></a>
테스트 체크리스트</h2>
<ul>
<li>[ ] 모든 핸들러에 대한 단위 테스트</li>
<li>[ ] 작업 흐름에 대한 통합 테스트</li>
<li>[ ] 재시도 시나리오 테스트</li>
<li>[ ] 타임아웃 동작 테스트</li>
<li>[ ] Chain 및 Chord 패턴 테스트</li>
<li>[ ] 예약 작업 테스트</li>
<li>[ ] 성능/부하 테스트</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1827"></a>
일반적인 마이그레이션 문제</h1>
<h2><a class="anchor" id="autotoc_md1828"></a>
핸들러가 에러 반환 대신 예외를 던짐</h2>
<div class="fragment"><div class="line"><span class="comment">// 잘못됨 - 예기치 않은 동작 유발</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;bad&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keywordflow">if</span> (error_condition) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;에러!&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 올바름 - 에러 결과 반환</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;good&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keywordflow">if</span> (error_condition) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(error_code::execution_failed, <span class="stringliteral">&quot;에러!&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1829"></a>
누락된 큐 설정</h2>
<div class="fragment"><div class="line"><span class="comment">// 작업이 &quot;special-queue&quot;로 감</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;task&quot;</span>)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;special-queue&quot;</span>)</div>
<div class="line">    .build().value();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 하지만 워커는 &quot;default&quot;만 모니터링</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;default&quot;</span>};  <span class="comment">// &quot;special-queue&quot; 누락!</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 수정: 필요한 모든 큐 추가</span></div>
<div class="line">config.queues = {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;special-queue&quot;</span>};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1830"></a>
타임아웃이 너무 짧음</h2>
<div class="fragment"><div class="line"><span class="comment">// 이전 시스템은 타임아웃이 없어 작업이 영원히 실행됨</span></div>
<div class="line"><span class="comment">// 새 시스템은 기본값이 5분</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 긴 작업의 경우 타임아웃 증가</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;long.task&quot;</span>)</div>
<div class="line">    .timeout(std::chrono::hours(2))</div>
<div class="line">    .build().value();</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1832"></a>
관련 문서</h1>
<ul>
<li><a class="el" href="../../da/dee/md_docs_2task_2QUICK__START__KO.html">빠른 시작 가이드</a></li>
<li><a class="el" href="../../d9/db8/md_docs_2task_2ARCHITECTURE__KO.html">아키텍처 가이드</a></li>
<li><a class="el" href="../../dd/db9/md_docs_2task_2API__REFERENCE__KO.html">API 레퍼런스</a></li>
<li><a class="el" href="../../d4/de7/md_docs_2task_2CONFIGURATION__KO.html">설정 가이드</a></li>
<li><a class="el" href="../../de/da3/md_docs_2task_2TROUBLESHOOTING__KO.html">문제 해결</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
