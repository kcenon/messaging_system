<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Task Module Troubleshooting Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dd/df5/md_docs_2task_2TROUBLESHOOTING.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Task Module Troubleshooting Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1871"></a> This guide helps you diagnose and resolve common issues with the Task module.</p>
<h1><a class="anchor" id="autotoc_md1872"></a>
Table of Contents</h1>
<ul>
<li>Common Issues</li>
<li>Debugging Methods</li>
<li>Performance Issues</li>
<li>FAQ</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1874"></a>
Common Issues</h1>
<h2><a class="anchor" id="autotoc_md1875"></a>
Tasks Not Being Processed</h2>
<p><b>Symptoms:</b></p><ul>
<li>Tasks remain in the queue</li>
<li><code>async_result.is_ready()</code> never returns <code>true</code></li>
<li>Queue size keeps growing</li>
</ul>
<p><b>Possible Causes and Solutions:</b></p>
<ol type="1">
<li><p class="startli"><b>No handler registered for the task name</b></p>
<div class="fragment"><div class="line"><span class="comment">// Check if handler exists</span></div>
<div class="line"><span class="keywordflow">if</span> (!system.workers().has_handler(<span class="stringliteral">&quot;my.task&quot;</span>)) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Handler &#39;my.task&#39; is not registered!\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// List all registered handlers</span></div>
<div class="line"><span class="keyword">auto</span> handlers = system.workers().list_handlers();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; h : handlers) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Registered: &quot;</span> &lt;&lt; h &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>System not started</b></p>
<div class="fragment"><div class="line"><span class="comment">// Ensure the system is running</span></div>
<div class="line"><span class="keywordflow">if</span> (!system.is_running()) {</div>
<div class="line">    <span class="keyword">auto</span> result = system.start();</div>
<div class="line">    <span class="keywordflow">if</span> (!result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to start: &quot;</span> &lt;&lt; result.error().message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Wrong queue name</b></p>
<div class="fragment"><div class="line"><span class="comment">// Task is submitted to a queue that workers don&#39;t monitor</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;my.task&quot;</span>)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;custom-queue&quot;</span>)  <span class="comment">// Workers might not be listening to this</span></div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Ensure workers monitor the queue</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;custom-queue&quot;</span>};  <span class="comment">// Add the queue</span></div>
</div><!-- fragment --></li>
<li><p class="startli"><b>All workers are busy</b></p>
<div class="fragment"><div class="line"><span class="comment">// Check worker status</span></div>
<div class="line"><span class="keyword">auto</span> stats = system.get_statistics();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Active: &quot;</span> &lt;&lt; system.active_workers()</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; system.total_workers() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1876"></a>
Tasks Failing Immediately</h2>
<p><b>Symptoms:</b></p><ul>
<li><code>async_result.is_failed()</code> returns <code>true</code></li>
<li>Tasks complete too quickly</li>
<li>Error messages appear</li>
</ul>
<p><b>Possible Causes and Solutions:</b></p>
<ol type="1">
<li><p class="startli"><b>Handler throws exception</b></p>
<div class="fragment"><div class="line"><span class="comment">// Handlers should return Result, not throw</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;safe.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="comment">// Your logic</span></div>
<div class="line">        <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(error_code::execution_failed, e.what());</div>
<div class="line">    }</div>
<div class="line">});</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Invalid payload data</b></p>
<div class="fragment"><div class="line"><span class="comment">// Validate payload before processing</span></div>
<div class="line"><span class="keyword">auto</span> required_field = t.payload().get_string(<span class="stringliteral">&quot;required&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!required_field) {</div>
<div class="line">    <span class="keywordflow">return</span> common::error(error_code::validation_failed,</div>
<div class="line">                       <span class="stringliteral">&quot;Missing required field&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Resource unavailable</b></p>
<div class="fragment"><div class="line"><span class="comment">// Check external dependencies</span></div>
<div class="line"><span class="keywordflow">if</span> (!database.is_connected()) {</div>
<div class="line">    ctx.log_error(<span class="stringliteral">&quot;Database connection lost&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> common::error(error_code::resource_unavailable,</div>
<div class="line">                       <span class="stringliteral">&quot;Database not available&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1877"></a>
Tasks Timing Out</h2>
<p><b>Symptoms:</b></p><ul>
<li>Tasks run for the full timeout duration then fail</li>
<li><code>error_message()</code> mentions timeout</li>
</ul>
<p><b>Possible Causes and Solutions:</b></p>
<ol type="1">
<li><p class="startli"><b>Handler takes too long</b></p>
<div class="fragment"><div class="line"><span class="comment">// Increase timeout for long tasks</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;long.task&quot;</span>)</div>
<div class="line">    .timeout(std::chrono::minutes(30))</div>
<div class="line">    .build();</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Handler is blocked</b></p>
<p class="startli">Check if the handler:</p><ul>
<li>Waits on an external service that's unresponsive</li>
<li>Has a deadlock in its logic</li>
<li>Is stuck in an infinite loop</li>
</ul>
</li>
<li><p class="startli"><b>Check for blocking operations</b></p>
<div class="fragment"><div class="line"><span class="comment">// Use async operations where possible</span></div>
<div class="line"><span class="comment">// Check for cancellation in long loops</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; items.size(); ++i) {</div>
<div class="line">    <span class="keywordflow">if</span> (ctx.is_cancelled()) {</div>
<div class="line">        <span class="keywordflow">return</span> common::error(<span class="stringliteral">&quot;Cancelled&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    process_item(items[i]);</div>
<div class="line">    ctx.update_progress(<span class="keywordtype">double</span>(i) / items.size(), <span class="stringliteral">&quot;Processing...&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1878"></a>
Retry Not Working</h2>
<p><b>Symptoms:</b></p><ul>
<li>Failed tasks are not retried</li>
<li>Retry count stays at 0</li>
</ul>
<p><b>Possible Causes and Solutions:</b></p>
<ol type="1">
<li><p class="startli"><b>max_retries set to 0</b></p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;retryable.task&quot;</span>)</div>
<div class="line">    .retries(3)  <span class="comment">// Enable retries</span></div>
<div class="line">    .retry_delay(std::chrono::seconds(5))</div>
<div class="line">    .build();</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Non-retryable error returned</b></p>
<p class="startli">Some errors may be configured to skip retry. Ensure your handler returns appropriate errors.</p>
</li>
<li><p class="startli"><b>Task already at max retries</b></p>
<div class="fragment"><div class="line"><span class="comment">// Check attempt count</span></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Attempt: &quot;</span> &lt;&lt; t.attempt_count()</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; t.config().max_retries &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1879"></a>
Memory Usage Growing</h2>
<p><b>Symptoms:</b></p><ul>
<li>Process memory increases over time</li>
<li>System becomes slow</li>
<li>Eventually runs out of memory</li>
</ul>
<p><b>Possible Causes and Solutions:</b></p>
<ol type="1">
<li><p class="startli"><b>Results not being cleaned up</b></p>
<div class="fragment"><div class="line"><span class="comment">// Periodically cleanup old results</span></div>
<div class="line">system.results()-&gt;cleanup_expired(std::chrono::hours(24));</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Queue growing unboundedly</b></p>
<div class="fragment"><div class="line"><span class="comment">// Set maximum queue size</span></div>
<div class="line">task_queue_config queue_config;</div>
<div class="line">queue_config.max_size = 100000;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Progress history accumulating</b></p>
<p class="startli">Progress updates are stored in memory. For very long tasks with frequent updates, this can accumulate.</p>
</li>
<li><p class="startli"><b>Enable persistence to offload memory</b></p>
<div class="fragment"><div class="line">task_queue_config queue_config;</div>
<div class="line">queue_config.enable_persistence = <span class="keyword">true</span>;</div>
<div class="line">queue_config.persistence_path = <span class="stringliteral">&quot;/var/lib/task_queue/&quot;</span>;</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md1881"></a>
Debugging Methods</h1>
<h2><a class="anchor" id="autotoc_md1882"></a>
Enable Logging</h2>
<p>Use the task context to log information:</p>
<div class="fragment"><div class="line">system.register_handler(<span class="stringliteral">&quot;debug.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;Starting task: &quot;</span> + t.task_id());</div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;Payload: &quot;</span> + t.payload().to_string());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... processing ...</span></div>
<div class="line"> </div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;Task completed successfully&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1883"></a>
Monitor Events</h2>
<p>Subscribe to task events for debugging:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> monitor = system.monitor();</div>
<div class="line"><span class="keywordflow">if</span> (monitor) {</div>
<div class="line">    monitor-&gt;on_task_started([](<span class="keyword">const</span> task&amp; t) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[STARTED] &quot;</span> &lt;&lt; t.task_name()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot; (ID: &quot;</span> &lt;&lt; t.task_id() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    monitor-&gt;on_task_completed([](<span class="keyword">const</span> task&amp; t, <span class="keywordtype">bool</span> success) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; (success ? <span class="stringliteral">&quot;SUCCESS&quot;</span> : <span class="stringliteral">&quot;FAILURE&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;] &quot;</span></div>
<div class="line">                  &lt;&lt; t.task_name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    monitor-&gt;on_task_failed([](<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> std::string&amp; error) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[FAILED] &quot;</span> &lt;&lt; t.task_name()</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1884"></a>
Check Queue Status</h2>
<div class="fragment"><div class="line"><span class="comment">// Get queue statistics</span></div>
<div class="line"><span class="keyword">auto</span> monitor = system.monitor();</div>
<div class="line"><span class="keywordflow">if</span> (monitor) {</div>
<div class="line">    <span class="keyword">auto</span> stats = monitor-&gt;get_queue_stats();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; q : stats) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Queue &#39;&quot;</span> &lt;&lt; q.name &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span></div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;pending=&quot;</span> &lt;&lt; q.pending_count</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;, running=&quot;</span> &lt;&lt; q.running_count</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;, delayed=&quot;</span> &lt;&lt; q.delayed_count &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1885"></a>
Check Worker Status</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> stats = system.get_statistics();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Tasks processed: &quot;</span> &lt;&lt; stats.total_tasks_processed &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Tasks succeeded: &quot;</span> &lt;&lt; stats.total_tasks_succeeded &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Tasks failed: &quot;</span> &lt;&lt; stats.total_tasks_failed &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Tasks retried: &quot;</span> &lt;&lt; stats.total_tasks_retried &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Avg execution time: &quot;</span> &lt;&lt; stats.avg_execution_time.count() &lt;&lt; <span class="stringliteral">&quot;ms\n&quot;</span>;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1886"></a>
View Task Logs</h2>
<p>Access logs from completed tasks:</p>
<div class="fragment"><div class="line"><span class="comment">// Logs are stored in task_context</span></div>
<div class="line">system.register_handler(<span class="stringliteral">&quot;logging.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    ctx.log_info(<span class="stringliteral">&quot;Step 1 complete&quot;</span>);</div>
<div class="line">    ctx.log_warning(<span class="stringliteral">&quot;Slow response from service&quot;</span>);</div>
<div class="line">    ctx.log_error(<span class="stringliteral">&quot;Failed to connect, retrying&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// After execution, logs are available</span></div>
<div class="line">    <span class="keyword">auto</span> logs = ctx.logs();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : logs) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; entry.timestamp &lt;&lt; <span class="stringliteral">&quot;] &quot;</span></div>
<div class="line">                  &lt;&lt; level_to_string(entry.log_level) &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">                  &lt;&lt; entry.message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1888"></a>
Performance Issues</h1>
<h2><a class="anchor" id="autotoc_md1889"></a>
High CPU Usage</h2>
<p><b>Possible Causes:</b></p>
<ol type="1">
<li><p class="startli"><b>Too many workers</b></p>
<div class="fragment"><div class="line"><span class="comment">// Reduce concurrency</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.concurrency = std::thread::hardware_concurrency() / 2;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Poll interval too short</b></p>
<div class="fragment"><div class="line"><span class="comment">// Increase poll interval</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.poll_interval = std::chrono::milliseconds(100);</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>CPU-intensive handlers</b></p>
<p class="startli">Consider moving heavy computation to dedicated threads or batching operations.</p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md1890"></a>
High Memory Usage</h2>
<p><b>Possible Causes:</b></p>
<ol type="1">
<li><p class="startli"><b>Large payloads in queue</b></p>
<div class="fragment"><div class="line"><span class="comment">// Limit queue size</span></div>
<div class="line">task_queue_config config;</div>
<div class="line">config.max_size = 10000;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Too many prefetched tasks</b></p>
<div class="fragment"><div class="line"><span class="comment">// Reduce prefetch count</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.prefetch_count = 5;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Result accumulation</b></p>
<div class="fragment"><div class="line"><span class="comment">// Clean up old results</span></div>
<div class="line">system.results()-&gt;cleanup_expired(std::chrono::hours(1));</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1891"></a>
Low Throughput</h2>
<p><b>Possible Causes:</b></p>
<ol type="1">
<li><p class="startli"><b>Insufficient workers</b></p>
<div class="fragment"><div class="line"><span class="comment">// Increase concurrency</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.concurrency = std::thread::hardware_concurrency() * 2;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>I/O bottleneck in handlers</b></p>
<p class="startli">Use async I/O or batch operations where possible.</p>
</li>
<li><p class="startli"><b>Prefetch disabled</b></p>
<div class="fragment"><div class="line"><span class="comment">// Enable prefetching</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.prefetch = <span class="keyword">true</span>;</div>
<div class="line">config.prefetch_count = 20;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Single queue bottleneck</b></p>
<div class="fragment"><div class="line"><span class="comment">// Use multiple queues</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;high&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;low&quot;</span>};</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1892"></a>
High Latency</h2>
<p><b>Possible Causes:</b></p>
<ol type="1">
<li><p class="startli"><b>Long poll interval</b></p>
<div class="fragment"><div class="line"><span class="comment">// Reduce poll interval</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.poll_interval = std::chrono::milliseconds(10);</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Queue depth too high</b></p>
<p class="startli">Monitor queue depth and scale workers or reject new tasks when overloaded.</p>
</li>
<li><p class="startli"><b>Prefetch holding tasks</b></p>
<div class="fragment"><div class="line"><span class="comment">// Disable prefetch for latency-sensitive queues</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.prefetch = <span class="keyword">false</span>;</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md1894"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md1895"></a>
Q: How do I cancel a running task?</h2>
<p>Tasks can be cancelled, but the handler must check for cancellation:</p>
<div class="fragment"><div class="line">system.register_handler(<span class="stringliteral">&quot;cancellable.task&quot;</span>, [](<span class="keyword">const</span> task&amp; t, task_context&amp; ctx) {</div>
<div class="line">    <span class="keywordflow">while</span> (processing) {</div>
<div class="line">        <span class="keywordflow">if</span> (ctx.is_cancelled()) {</div>
<div class="line">            <span class="comment">// Cleanup and return</span></div>
<div class="line">            return common::error(<span class="stringliteral">&quot;Task cancelled by user&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Continue processing</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> common::ok(result);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Request cancellation</span></div>
<div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;cancellable.task&quot;</span>, payload);</div>
<div class="line">result.revoke();  <span class="comment">// This sets the cancellation flag</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1896"></a>
Q: How do I get task progress from outside the handler?</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> result = system.submit(<span class="stringliteral">&quot;long.task&quot;</span>, payload);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Poll for progress</span></div>
<div class="line"><span class="keywordflow">while</span> (!result.is_ready()) {</div>
<div class="line">    <span class="keywordtype">double</span> progress = result.progress();</div>
<div class="line">    std::string message = result.progress_message();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Progress: &quot;</span> &lt;&lt; (progress * 100) &lt;&lt; <span class="stringliteral">&quot;% - &quot;</span> &lt;&lt; message &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    std::this_thread::sleep_for(std::chrono::seconds(1));</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1897"></a>
Q: How do I handle task dependencies?</h2>
<p>Use the chain pattern:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> step1 = task_builder(<span class="stringliteral">&quot;step1&quot;</span>).payload(data).build().value();</div>
<div class="line"><span class="keyword">auto</span> step2 = task_builder(<span class="stringliteral">&quot;step2&quot;</span>).build().value();</div>
<div class="line"><span class="keyword">auto</span> step3 = task_builder(<span class="stringliteral">&quot;step3&quot;</span>).build().value();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> result = client.chain({step1, step2, step3});</div>
<div class="line"><span class="comment">// step2 receives step1&#39;s result, step3 receives step2&#39;s result</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1898"></a>
Q: How do I process tasks in order?</h2>
<p>Set <code>concurrency = 1</code> for strict ordering:</p>
<div class="fragment"><div class="line">worker_config config;</div>
<div class="line">config.concurrency = 1;  <span class="comment">// Single worker ensures order</span></div>
<div class="line">config.queues = {<span class="stringliteral">&quot;ordered-queue&quot;</span>};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1899"></a>
Q: How do I prioritize certain tasks?</h2>
<p>Use priority levels and queue names:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> urgent = task_builder(<span class="stringliteral">&quot;urgent.task&quot;</span>)</div>
<div class="line">    .priority(message_priority::highest)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;critical&quot;</span>)</div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> normal = task_builder(<span class="stringliteral">&quot;normal.task&quot;</span>)</div>
<div class="line">    .priority(message_priority::normal)</div>
<div class="line">    .queue(<span class="stringliteral">&quot;default&quot;</span>)</div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Configure workers to process critical queue first</span></div>
<div class="line">worker_config config;</div>
<div class="line">config.queues = {<span class="stringliteral">&quot;critical&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;background&quot;</span>};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1900"></a>
Q: How do I limit retry attempts?</h2>
<p>Configure via task_config:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;limited.retry&quot;</span>)</div>
<div class="line">    .retries(1)  <span class="comment">// Only retry once</span></div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or disable retries entirely</span></div>
<div class="line"><span class="keyword">auto</span> task = task_builder(<span class="stringliteral">&quot;no.retry&quot;</span>)</div>
<div class="line">    .retries(0)  <span class="comment">// No retries</span></div>
<div class="line">    .build();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1901"></a>
Q: How do I handle poison messages (tasks that always fail)?</h2>
<p>Use the <code>on_failure</code> hook to track failures:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>monitored_handler : <span class="keyword">public</span> task_handler_interface {</div>
<div class="line">    std::unordered_map&lt;std::string, size_t&gt; failure_counts_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> on_failure(<span class="keyword">const</span> task&amp; t, <span class="keyword">const</span> std::string&amp; error)<span class="keyword"> override </span>{</div>
<div class="line">        failure_counts_[t.task_name()]++;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (failure_counts_[t.task_name()] &gt; 10) {</div>
<div class="line">            <span class="comment">// Move to dead letter queue or alert</span></div>
<div class="line">            log_alert(<span class="stringliteral">&quot;Task &quot;</span> + t.task_name() + <span class="stringliteral">&quot; failing repeatedly&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1902"></a>
Q: How do I gracefully shut down the system?</h2>
<div class="fragment"><div class="line"><span class="comment">// Graceful shutdown waits for current tasks to complete</span></div>
<div class="line">system.shutdown_graceful(std::chrono::seconds(30));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This will:</span></div>
<div class="line"><span class="comment">// 1. Stop accepting new tasks</span></div>
<div class="line"><span class="comment">// 2. Wait up to 30 seconds for running tasks to complete</span></div>
<div class="line"><span class="comment">// 3. Force stop if timeout is reached</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1904"></a>
Related Documentation</h1>
<ul>
<li><a class="el" href="../../d9/dff/md_docs_2task_2QUICK__START.html">Quick Start Guide</a></li>
<li><a class="el" href="../../d1/d5e/md_docs_2task_2ARCHITECTURE.html">Architecture Guide</a></li>
<li><a class="el" href="../../df/d18/md_docs_2task_2API__REFERENCE.html">API Reference</a></li>
<li><a class="el" href="../../d5/dd2/md_docs_2task_2PATTERNS.html">Patterns Guide</a></li>
<li><a class="el" href="../../dc/d1e/md_docs_2task_2CONFIGURATION.html">Configuration Guide</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
