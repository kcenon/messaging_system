<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Thread System Architecture</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/d31/md_libraries_2thread__system_2docs_2architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Thread System Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md842"></a> </p>
<h1><a class="anchor" id="autotoc_md843"></a>
Table of Contents</h1>
<ol type="1">
<li>Overview</li>
<li>Core Architecture</li>
<li>Component Design</li>
<li>Implementation Details</li>
<li>Performance Characteristics</li>
<li>Design Patterns</li>
<li>Memory Management</li>
<li>Platform Support</li>
<li>Future Roadmap</li>
</ol>
<h1><a class="anchor" id="autotoc_md844"></a>
Overview</h1>
<p>The Thread System is a modern C++20 multi-threading framework designed for high-performance concurrent programming. It provides a modular, interface-based architecture with clear separation of concerns, enabling both ease of use and advanced customization.</p>
<h2><a class="anchor" id="autotoc_md845"></a>
Architecture Principles</h2>
<ol type="1">
<li><b>Modular Design</b>: Core threading functionality separated from auxiliary features</li>
<li><b>Interface-Based Architecture</b>: Clean contracts enable external module integration</li>
<li><b>Layered Design</b>: Clear separation between core threading primitives and higher-level abstractions</li>
<li><b>Adaptive Performance</b>: Runtime optimization based on workload characteristics</li>
<li><b>Type Safety</b>: Strong typing with compile-time guarantees</li>
<li><b>Zero-Overhead Abstractions</b>: Modern C++ techniques minimize runtime costs</li>
<li><b>Platform Agnostic</b>: Consistent API across Windows, Linux, and macOS</li>
</ol>
<h1><a class="anchor" id="autotoc_md846"></a>
Core Architecture</h1>
<h2><a class="anchor" id="autotoc_md847"></a>
System Layers</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────┐</div>
<div class="line">│                   Applications                      │</div>
<div class="line">├─────────────────────────────────────────────────────┤</div>
<div class="line">│              External Modules                       │</div>
<div class="line">│         (Logger, Monitoring, etc.)                  │</div>
<div class="line">├─────────────────────────────────────────────────────┤</div>
<div class="line">│          High-Level APIs (Thread Pools)             │</div>
<div class="line">├─────────────────────────────────────────────────────┤</div>
<div class="line">│         Core Threading Components                   │</div>
<div class="line">├─────────────────────────────────────────────────────┤</div>
<div class="line">│          Platform Abstraction Layer                 │</div>
<div class="line">├─────────────────────────────────────────────────────┤</div>
<div class="line">│            Operating System APIs                    │</div>
<div class="line">└─────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md848"></a>
Component Hierarchy</h2>
<div class="fragment"><div class="line">[Core Thread System - ~2,700 lines]</div>
<div class="line"> </div>
<div class="line">utilities</div>
<div class="line">    ├── conversion      # String conversions</div>
<div class="line">    ├── core           # Formatters, spans</div>
<div class="line">    ├── io             # File operations</div>
<div class="line">    ├── parsing        # Argument parsing</div>
<div class="line">    └── time           # Date/time utilities</div>
<div class="line"> </div>
<div class="line">thread_base</div>
<div class="line">    ├── core           # Base thread class</div>
<div class="line">    ├── jobs           # Job abstraction</div>
<div class="line">    ├── sync           # Synchronization primitives</div>
<div class="line">    └── lockfree       # Lock-free data structures</div>
<div class="line">        ├── memory     # Hazard pointers, node pools</div>
<div class="line">        └── queues     # MPMC queues, adaptive queues</div>
<div class="line"> </div>
<div class="line">thread_pool</div>
<div class="line">    ├── core           # Thread pool implementation</div>
<div class="line">    ├── workers        # Worker thread management</div>
<div class="line">    └── async          # Future extensions</div>
<div class="line"> </div>
<div class="line">typed_thread_pool</div>
<div class="line">    ├── core           # Type interfaces</div>
<div class="line">    ├── jobs           # Typed job implementations</div>
<div class="line">    ├── pool           # Typed pool implementation</div>
<div class="line">    └── scheduling     # Priority scheduling</div>
<div class="line"> </div>
<div class="line">[External Modules - Separate Projects]</div>
<div class="line"> </div>
<div class="line">logger_module           # https://github.com/kcenon/logger_module</div>
<div class="line">    ├── core           # Logger implementation</div>
<div class="line">    ├── jobs           # Log job processing</div>
<div class="line">    ├── types          # Log types and formatting</div>
<div class="line">    └── writers        # Output destinations</div>
<div class="line"> </div>
<div class="line">monitoring_module      # https://github.com/kcenon/monitoring_module</div>
<div class="line">    ├── core           # Metrics collection</div>
<div class="line">    ├── collectors     # Metric collectors</div>
<div class="line">    └── storage        # Time-series storage</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md849"></a>
Component Design</h1>
<h2><a class="anchor" id="autotoc_md850"></a>
Modular Architecture Benefits</h2>
<p>The modularized architecture provides significant advantages:</p>
<ul>
<li><b>Reduced Complexity</b>: Core thread system focused on threading (~2,700 lines vs ~11,400 lines)</li>
<li><b>Clean Interfaces</b>: Well-defined contracts between modules</li>
<li><b>Independent Development</b>: External modules can evolve separately</li>
<li><b>Selective Usage</b>: Include only the modules you need</li>
<li><b>Easier Testing</b>: Smaller, focused modules are easier to test</li>
<li><b>Better Maintainability</b>: Single responsibility per module</li>
</ul>
<h2><a class="anchor" id="autotoc_md851"></a>
Thread Base Module</h2>
<p>The foundation of the system, providing:</p>
<ul>
<li><b>thread_base</b>: Abstract base class for all worker threads</li>
<li><b>job</b>: Interface for work units</li>
<li><b>job_queue</b>: Thread-safe FIFO queue</li>
<li><b>Adaptive components</b>: Dynamic optimization based on contention</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>thread_base {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">auto</span> before_start() -&gt; <a class="code hl_class" href="../../dd/da2/classthread__module_1_1result__void.html">result_void</a> { <span class="keywordflow">return</span> {}; }</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">auto</span> do_work() -&gt; <a class="code hl_class" href="../../dd/da2/classthread__module_1_1result__void.html">result_void</a> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">auto</span> after_stop() -&gt; <a class="code hl_class" href="../../dd/da2/classthread__module_1_1result__void.html">result_void</a> { <span class="keywordflow">return</span> {}; }</div>
<div class="line">};</div>
<div class="ttc" id="aclassthread__module_1_1result__void_html"><div class="ttname"><a href="../../dd/da2/classthread__module_1_1result__void.html">thread_module::result_void</a></div><div class="ttdoc">Wrapper for void result.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d4e/modular__structure_2core_2include_2thread__system__core_2thread__base_2sync_2error__handling_8h_source.html#l00197">error_handling.h:197</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md852"></a>
Thread Pool Module</h2>
<p>Standard thread pool implementation with:</p>
<ul>
<li><b>Dynamic worker management</b>: Add/remove workers at runtime</li>
<li><b>Adaptive queue optimization</b>: Automatic strategy selection</li>
<li><b>Batch processing support</b>: Process multiple jobs efficiently</li>
</ul>
<h2><a class="anchor" id="autotoc_md853"></a>
Typed Thread Pool Module</h2>
<p>Advanced type-based scheduling:</p>
<ul>
<li><b>Priority levels</b>: RealTime &gt; Batch &gt; Background</li>
<li><b>Per-type queues</b>: Separate queues for each job type</li>
<li><b>Worker specialization</b>: Workers can handle specific types</li>
</ul>
<h2><a class="anchor" id="autotoc_md854"></a>
Interface-Based External Module Integration</h2>
<p>The thread system provides clean interfaces for external modules:</p>
<div class="fragment"><div class="line"><span class="comment">// Example: Logger module integration</span></div>
<div class="line"><span class="keyword">class </span>logger_job : <span class="keyword">public</span> job {</div>
<div class="line">    <span class="comment">// Logger-specific job implementation</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Example: Monitoring module integration</span></div>
<div class="line"><span class="keyword">class </span>metric_collector_job : <span class="keyword">public</span> job {</div>
<div class="line">    <span class="comment">// Metric collection job implementation</span></div>
<div class="line">};</div>
</div><!-- fragment --><p>External modules can:</p><ul>
<li>Implement the <code>job</code> interface for task execution</li>
<li>Use thread pools for concurrent processing</li>
<li>Leverage lock-free structures for performance</li>
<li>Integrate without modifying core thread system</li>
</ul>
<h2><a class="anchor" id="autotoc_md855"></a>
Adaptive Queue System</h2>
<p>The adaptive queue automatically switches between strategies:</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> queue_strategy {</div>
<div class="line">    AUTO_DETECT,    <span class="comment">// Automatic selection</span></div>
<div class="line">    FORCE_LEGACY,   <span class="comment">// Always use mutex</span></div>
<div class="line">    FORCE_LOCKFREE, <span class="comment">// Always use lock-free</span></div>
<div class="line">    ADAPTIVE        <span class="comment">// Dynamic switching</span></div>
<div class="line">};</div>
</div><!-- fragment --><p>Performance characteristics:</p><ul>
<li><b>Low contention</b>: Mutex-based (lower overhead)</li>
<li><b>High contention</b>: Lock-free MPMC (better scalability)</li>
<li><b>Automatic switching</b>: Based on runtime metrics</li>
</ul>
<h1><a class="anchor" id="autotoc_md856"></a>
Implementation Details</h1>
<h2><a class="anchor" id="autotoc_md857"></a>
Lock-Free MPMC Queue</h2>
<p>Uses Michael &amp; Scott algorithm with enhancements:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>lockfree_mpmc_queue {</div>
<div class="line">    <span class="keyword">struct </span>Node {</div>
<div class="line">        std::atomic&lt;T*&gt; data{<span class="keyword">nullptr</span>};</div>
<div class="line">        std::atomic&lt;Node*&gt; next{<span class="keyword">nullptr</span>};</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    std::atomic&lt;Node*&gt; head;</div>
<div class="line">    std::atomic&lt;Node*&gt; tail;</div>
<div class="line">    hazard_pointer_manager hp_manager;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md858"></a>
Hazard Pointer Memory Management</h2>
<p>Safe memory reclamation for lock-free structures:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>hazard_pointer {</div>
<div class="line">    <span class="comment">// Protects pointer from deletion</span></div>
<div class="line">    T* protect(std::atomic&lt;T*&gt;&amp; ptr);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Retires pointer when safe</span></div>
<div class="line">    <span class="keywordtype">void</span> retire(T* ptr);</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md859"></a>
Adaptive Strategy Selection</h2>
<p>The system monitors these metrics:</p><ul>
<li>Contention level (CAS failures)</li>
<li>Operation latency</li>
<li>Queue depth</li>
<li>Throughput</li>
</ul>
<p>Strategy switches when:</p><ul>
<li>Contention &gt; threshold for 100ms</li>
<li>Performance degradation detected</li>
<li>Queue characteristics change</li>
</ul>
<h1><a class="anchor" id="autotoc_md860"></a>
Performance Characteristics</h1>
<h2><a class="anchor" id="autotoc_md861"></a>
Measured Performance (Apple M1, 8 cores)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Workload Type   </th><th class="markdownTableHeadNone">Throughput   </th><th class="markdownTableHeadNone">Latency   </th><th class="markdownTableHeadNone">Scaling    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Empty jobs   </td><td class="markdownTableBodyNone">8.2M/s   </td><td class="markdownTableBodyNone">122ns   </td><td class="markdownTableBodyNone">95%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1μs jobs   </td><td class="markdownTableBodyNone">1.5M/s   </td><td class="markdownTableBodyNone">667ns   </td><td class="markdownTableBodyNone">94%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10μs jobs   </td><td class="markdownTableBodyNone">540K/s   </td><td class="markdownTableBodyNone">1.85μs   </td><td class="markdownTableBodyNone">92%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">100μs jobs   </td><td class="markdownTableBodyNone">70K/s   </td><td class="markdownTableBodyNone">14.3μs   </td><td class="markdownTableBodyNone">90%   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md862"></a>
Adaptive Queue Performance</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Scenario   </th><th class="markdownTableHeadNone">Mutex Time   </th><th class="markdownTableHeadNone">Lock-free Time   </th><th class="markdownTableHeadNone">Improvement    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Low contention (2 threads)   </td><td class="markdownTableBodyNone">45ms   </td><td class="markdownTableBodyNone">52ms   </td><td class="markdownTableBodyNone">Mutex wins    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">High contention (16 threads)   </td><td class="markdownTableBodyNone">892ms   </td><td class="markdownTableBodyNone">756ms   </td><td class="markdownTableBodyNone">+18%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Variable load   </td><td class="markdownTableBodyNone">Baseline   </td><td class="markdownTableBodyNone">Optimized   </td><td class="markdownTableBodyNone">Automatic   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md863"></a>
Design Patterns</h1>
<h2><a class="anchor" id="autotoc_md864"></a>
Template Method Pattern</h2>
<p>Used in <code>thread_base</code> for lifecycle management:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> run() {</div>
<div class="line">    before_start();</div>
<div class="line">    <span class="keywordflow">while</span> (!stop_requested()) {</div>
<div class="line">        do_work();</div>
<div class="line">    }</div>
<div class="line">    after_stop();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md865"></a>
Command Pattern</h2>
<p>Jobs encapsulate work as objects:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>job {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">auto</span> do_work() -&gt; <a class="code hl_class" href="../../dd/da2/classthread__module_1_1result__void.html">result_void</a> = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md866"></a>
Strategy Pattern</h2>
<p>Adaptive queues select strategies at runtime:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>adaptive_job_queue {</div>
<div class="line">    std::unique_ptr&lt;queue_interface&gt; current_strategy;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> switch_strategy() {</div>
<div class="line">        <span class="keywordflow">if</span> (should_use_lockfree()) {</div>
<div class="line">            current_strategy = make_lockfree();</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            current_strategy = make_mutex_based();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md867"></a>
Memory Management</h1>
<h2><a class="anchor" id="autotoc_md868"></a>
Smart Pointer Usage</h2>
<ul>
<li><b>unique_ptr</b>: Exclusive ownership (workers, jobs)</li>
<li><b>shared_ptr</b>: Shared ownership (queues, pools)</li>
<li><b>weak_ptr</b>: Break circular dependencies</li>
</ul>
<h2><a class="anchor" id="autotoc_md869"></a>
RAII Principles</h2>
<p>All resources follow RAII: </p><div class="fragment"><div class="line"><span class="keyword">class </span>thread_worker {</div>
<div class="line">    std::unique_ptr&lt;std::thread&gt; thread_;</div>
<div class="line">    <span class="comment">// Automatic cleanup in destructor</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md870"></a>
Lock-Free Memory Safety</h2>
<p>Hazard pointers prevent use-after-free:</p><ol type="1">
<li>Protect pointer before access</li>
<li>Use pointer safely</li>
<li>Retire when done</li>
<li>Batch reclamation for efficiency</li>
</ol>
<h2><a class="anchor" id="autotoc_md871"></a>
Memory Optimization Strategies</h2>
<h3><a class="anchor" id="autotoc_md872"></a>
Lazy Initialization</h3>
<p>Adaptive queues now use lazy initialization to reduce initial memory footprint: </p><div class="fragment"><div class="line"><span class="keyword">class </span>adaptive_job_queue {</div>
<div class="line">    <span class="keyword">mutable</span> std::unique_ptr&lt;job_queue&gt; legacy_queue_;</div>
<div class="line">    <span class="keyword">mutable</span> std::unique_ptr&lt;lockfree_job_queue&gt; mpmc_queue_;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Queues created only when needed</span></div>
<div class="line">    <span class="keyword">auto</span> ensure_legacy_queue() const -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (!legacy_queue_) {</div>
<div class="line">            legacy_queue_ = std::make_unique&lt;job_queue&gt;();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md873"></a>
Optimized Node Pool</h3>
<p>Node pools now use conservative initial allocation: </p><div class="fragment"><div class="line"><span class="comment">// Before: 4 chunks × 1024 nodes = 4096 nodes pre-allocated</span></div>
<div class="line"><span class="comment">// After: 1 chunk × 256 nodes = 256 nodes pre-allocated</span></div>
<div class="line"><span class="comment">// Memory savings: ~93.75%</span></div>
<div class="line">node_pool(<span class="keywordtype">size_t</span> initial_chunks = 1, <span class="keywordtype">size_t</span> chunk_size = 256);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md874"></a>
Memory Usage Profile</h3>
<ul>
<li><b>Initial allocation</b>: Reduced by &gt;90% for most components</li>
<li><b>On-demand growth</b>: Memory allocated as needed</li>
<li><b>Peak usage</b>: Unchanged - same maximum capacity</li>
<li><b>Performance impact</b>: Negligible - allocation amortized</li>
</ul>
<h1><a class="anchor" id="autotoc_md875"></a>
Platform Support</h1>
<h2><a class="anchor" id="autotoc_md876"></a>
Conditional Compilation</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef USE_STD_JTHREAD</span></div>
<div class="line">    std::jthread worker_thread_;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    std::thread worker_thread_;</div>
<div class="line">    std::atomic&lt;bool&gt; stop_requested_;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md877"></a>
Platform-Specific Features</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Platform   </th><th class="markdownTableHeadNone">Features   </th><th class="markdownTableHeadNone">Optimizations    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Linux   </td><td class="markdownTableBodyNone">Full support   </td><td class="markdownTableBodyNone">NUMA awareness    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Windows   </td><td class="markdownTableBodyNone">Full support   </td><td class="markdownTableBodyNone">IOCP integration    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">macOS   </td><td class="markdownTableBodyNone">Full support   </td><td class="markdownTableBodyNone">GCD compatibility   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md878"></a>
Build Configuration</h2>
<ul>
<li><b>C++20</b>: Primary target with fallback</li>
<li><b>CMake 3.16+</b>: Cross-platform builds</li>
<li><b>vcpkg</b>: Dependency management</li>
</ul>
<h1><a class="anchor" id="autotoc_md879"></a>
Modularization Impact</h1>
<h2><a class="anchor" id="autotoc_md880"></a>
Before Modularization</h2>
<ul>
<li><b>Total Lines</b>: ~11,400</li>
<li><b>Components</b>: Monolithic with logger and monitoring</li>
<li><b>Dependencies</b>: Tightly coupled components</li>
<li><b>Build Time</b>: Longer due to larger codebase</li>
<li><b>Testing</b>: Complex due to interdependencies</li>
</ul>
<h2><a class="anchor" id="autotoc_md881"></a>
After Modularization</h2>
<ul>
<li><b>Core Lines</b>: ~2,700 (76% reduction)</li>
<li><b>Components</b>: Focused on threading only</li>
<li><b>Dependencies</b>: Clean interface-based separation</li>
<li><b>Build Time</b>: Significantly faster</li>
<li><b>Testing</b>: Simplified and more focused</li>
</ul>
<h2><a class="anchor" id="autotoc_md882"></a>
Key Improvements</h2>
<ul>
<li><b>8,700+ lines</b> moved to separate projects</li>
<li><b>Clear separation</b> of concerns</li>
<li><b>Optional dependencies</b> - use only what you need</li>
<li><b>Faster compilation</b> and linking</li>
<li><b>Easier to understand</b> and maintain</li>
</ul>
<h1><a class="anchor" id="autotoc_md883"></a>
Future Roadmap</h1>
<h2><a class="anchor" id="autotoc_md884"></a>
Short Term (Completed)</h2>
<ul>
<li>✅ Remove duplicate code</li>
<li>✅ Simplify architecture</li>
<li>✅ Add formatter macros</li>
<li>✅ Modularize logger into separate project</li>
<li>✅ Modularize monitoring into separate project</li>
<li>✅ Reduce core codebase by 76%</li>
</ul>
<h2><a class="anchor" id="autotoc_md885"></a>
Medium Term</h2>
<ul>
<li>[ ] Enhanced monitoring dashboard</li>
<li>[ ] Dynamic worker scaling</li>
<li>[ ] Work-stealing queues</li>
<li>[ ] CPU affinity support</li>
</ul>
<h2><a class="anchor" id="autotoc_md886"></a>
Long Term</h2>
<ul>
<li>[ ] Distributed thread pools</li>
<li>[ ] GPU task offloading</li>
<li>[ ] Coroutine integration</li>
<li>[ ] Real-time scheduling</li>
<li>[ ] Plugin system for dynamic module loading</li>
<li>[ ] Additional external modules (networking, serialization)</li>
</ul>
<h1><a class="anchor" id="autotoc_md887"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md888"></a>
When to Use Each Component</h2>
<ol type="1">
<li><b>Standard Thread Pool</b>: General-purpose concurrent tasks</li>
<li><b>Typed Thread Pool</b>: Priority-based scheduling requirements</li>
<li><b>Adaptive Queues</b>: Variable or unknown workload patterns</li>
<li><b>Lock-free Structures</b>: High-contention scenarios</li>
</ol>
<h2><a class="anchor" id="autotoc_md889"></a>
Module Integration Guidelines</h2>
<ol type="1">
<li><b>Core Only</b>: Use just the thread system for lightweight applications</li>
<li><b>With Logger</b>: Add the logger module for production applications</li>
<li><b>With Monitoring</b>: Add monitoring for performance-critical systems</li>
<li><b>Custom Modules</b>: Implement the job interface for your own modules</li>
</ol>
<h2><a class="anchor" id="autotoc_md890"></a>
Configuration Guidelines</h2>
<div class="fragment"><div class="line"><span class="comment">// Low-latency configuration</span></div>
<div class="line"><span class="keyword">auto</span> pool = std::make_shared&lt;thread_pool&gt;();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cores; ++i) {</div>
<div class="line">    <span class="keyword">auto</span> worker = std::make_unique&lt;thread_worker&gt;();</div>
<div class="line">    worker-&gt;set_wake_interval(std::chrono::microseconds(100));</div>
<div class="line">    pool-&gt;enqueue(std::move(worker));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// High-throughput configuration</span></div>
<div class="line"><span class="keyword">auto</span> typed_pool = std::make_shared&lt;typed_thread_pool&lt;job_types&gt;&gt;();</div>
<div class="line">typed_pool-&gt;set_queue_strategy(queue_strategy::ADAPTIVE);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md891"></a>
Performance Tuning</h2>
<ol type="1">
<li><b>Match workers to cores</b>: Avoid oversubscription</li>
<li><b>Use batch operations</b>: Reduce synchronization overhead</li>
<li><b>Profile first</b>: Measure before optimizing</li>
<li><b>Consider job granularity</b>: Balance between overhead and parallelism</li>
</ol>
<h1><a class="anchor" id="autotoc_md892"></a>
Conclusion</h1>
<p>The Thread System provides a robust, focused foundation for concurrent programming in modern C++. Through modularization, the core system has been reduced from ~11,400 lines to ~2,700 lines, resulting in a cleaner, more maintainable codebase. The interface-based architecture allows seamless integration with external modules like logging and monitoring, while the adaptive components ensure optimal performance across diverse workloads.</p>
<p>The modular design empowers developers to:</p><ul>
<li>Use only the components they need</li>
<li>Integrate custom modules through clean interfaces</li>
<li>Benefit from faster compilation and easier testing</li>
<li>Focus on threading without auxiliary complexity</li>
</ul>
<p>For practical examples, see the <a href="../../../samples/">samples directory</a>. For API details, consult the <a class="el" href="../../de/ded/md_libraries_2thread__system_2docs_2api-reference.html">API reference</a>.</p>
<h2><a class="anchor" id="autotoc_md893"></a>
External Module Projects</h2>
<ul>
<li><b>Logger Module</b>: <a href="https://github.com/kcenon/logger_module">github.com/kcenon/logger_module</a></li>
<li><b>Monitoring Module</b>: <a href="https://github.com/kcenon/monitoring_module">github.com/kcenon/monitoring_module</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
