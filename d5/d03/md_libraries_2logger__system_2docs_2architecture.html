<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: Logger System Architecture</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/d03/md_libraries_2logger__system_2docs_2architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Logger System Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md241"></a> </p>
<h1><a class="anchor" id="autotoc_md242"></a>
Overview</h1>
<p>The Logger System is designed as a high-performance, modular logging framework that implements the <code><a class="el" href="../../d1/dcb/classthread__module_1_1logger__interface.html" title="Logger interface for thread system.">thread_module::logger_interface</a></code> from the Thread System. It provides both synchronous and asynchronous logging capabilities with a lock-free implementation for minimal contention in multi-threaded environments.</p>
<h1><a class="anchor" id="autotoc_md243"></a>
Architecture Diagram</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────┐</div>
<div class="line">│                      Client Application                      │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│                    logger_interface (API)                    │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│                         logger                               │</div>
<div class="line">│  ┌─────────────────────────────────────────────────────┐    │</div>
<div class="line">│  │                    Sync Mode                         │    │</div>
<div class="line">│  │  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │    │</div>
<div class="line">│  │  │   Format    │→ │   Write     │→ │   Flush    │  │    │</div>
<div class="line">│  │  └─────────────┘  └─────────────┘  └────────────┘  │    │</div>
<div class="line">│  └─────────────────────────────────────────────────────┘    │</div>
<div class="line">│  ┌─────────────────────────────────────────────────────┐    │</div>
<div class="line">│  │                   Async Mode                         │    │</div>
<div class="line">│  │  ┌────────────┐  ┌──────────────┐  ┌────────────┐  │    │</div>
<div class="line">│  │  │   Queue    │→ │ log_collector │→ │   Batch    │  │    │</div>
<div class="line">│  │  └────────────┘  └──────────────┘  └────────────┘  │    │</div>
<div class="line">│  └─────────────────────────────────────────────────────┘    │</div>
<div class="line">├─────────────────────────────────────────────────────────────┤</div>
<div class="line">│                         Writers                              │</div>
<div class="line">│  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐     │</div>
<div class="line">│  │ConsoleWriter │  │ FileWriter   │  │ CustomWriter  │     │</div>
<div class="line">│  └──────────────┘  └──────────────┘  └───────────────┘     │</div>
<div class="line">└─────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md244"></a>
Core Components</h1>
<h2><a class="anchor" id="autotoc_md245"></a>
1. Logger Interface</h2>
<p>The system implements <code><a class="el" href="../../d1/dcb/classthread__module_1_1logger__interface.html" title="Logger interface for thread system.">thread_module::logger_interface</a></code> providing:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>logger_interface {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> log(log_level level, <span class="keyword">const</span> std::string&amp; message) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> log(log_level level, <span class="keyword">const</span> std::string&amp; message,</div>
<div class="line">                     <span class="keyword">const</span> std::string&amp; file, <span class="keywordtype">int</span> line, </div>
<div class="line">                     <span class="keyword">const</span> std::string&amp; function) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_enabled(log_level level) <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> flush() = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md246"></a>
2. Logger Implementation</h2>
<p>The main <code>logger</code> class provides:</p><ul>
<li><b>Dual Mode Operation</b>: Synchronous and asynchronous logging</li>
<li><b>Level Filtering</b>: Configurable minimum log level</li>
<li><b>Multiple Writers</b>: Support for multiple output destinations</li>
<li><b>Thread Safety</b>: Safe for concurrent use</li>
</ul>
<h3><a class="anchor" id="autotoc_md247"></a>
Key Features:</h3>
<ul>
<li><b>PIMPL Pattern</b>: Implementation details hidden for ABI stability</li>
<li><b>Smart Pointer Management</b>: RAII for resource management</li>
<li><b>Configurable Buffer Size</b>: For async mode optimization</li>
</ul>
<h2><a class="anchor" id="autotoc_md248"></a>
3. Log Collector (Async Mode)</h2>
<p>The <code>log_collector</code> manages asynchronous logging:</p><ul>
<li><b>Lock-free Queue</b>: Minimal contention for log producers</li>
<li><b>Background Thread</b>: Dedicated thread for log processing</li>
<li><b>Batch Processing</b>: Efficient handling of multiple log entries</li>
<li><b>Overflow Handling</b>: Graceful handling when buffer is full</li>
</ul>
<h3><a class="anchor" id="autotoc_md249"></a>
Design Decisions:</h3>
<ul>
<li>Simple queue with mutex (can be upgraded to lock-free)</li>
<li>Batch size of 100 entries for efficiency</li>
<li>Condition variable for efficient waiting</li>
</ul>
<h2><a class="anchor" id="autotoc_md250"></a>
4. Writers</h2>
<p>Writers handle the actual output of log messages:</p>
<h3><a class="anchor" id="autotoc_md251"></a>
Base Writer</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span>base_writer {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> write(log_level level, <span class="keyword">const</span> std::string&amp; message,</div>
<div class="line">                      <span class="keyword">const</span> std::string&amp; file, <span class="keywordtype">int</span> line,</div>
<div class="line">                      <span class="keyword">const</span> std::string&amp; function,</div>
<div class="line">                      <span class="keyword">const</span> std::chrono::system_clock::time_point&amp; timestamp) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> flush() = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md252"></a>
Console Writer</h3>
<ul>
<li><b>Color Support</b>: ANSI color codes for different log levels</li>
<li><b>Platform Detection</b>: Automatic color support detection</li>
<li><b>Stream Selection</b>: Error levels to stderr, others to stdout</li>
</ul>
<h3><a class="anchor" id="autotoc_md253"></a>
Extensibility</h3>
<ul>
<li>Easy to add new writers (file, network, database)</li>
<li>Consistent interface for all writers</li>
<li>Format customization support</li>
</ul>
<h1><a class="anchor" id="autotoc_md254"></a>
Threading Model</h1>
<h2><a class="anchor" id="autotoc_md255"></a>
Synchronous Mode</h2>
<ul>
<li>Direct write to all registered writers</li>
<li>Blocking operation - waits for I/O completion</li>
<li>Lower latency for individual messages</li>
<li>Suitable for:<ul>
<li>Low-frequency logging</li>
<li>Critical error messages</li>
<li>Simple applications</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md256"></a>
Asynchronous Mode</h2>
<ul>
<li>Non-blocking enqueue operation</li>
<li>Background thread processes log queue</li>
<li>Higher throughput for bulk logging</li>
<li>Suitable for:<ul>
<li>High-frequency logging</li>
<li>Performance-critical paths</li>
<li>Multi-threaded applications</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md257"></a>
Thread Safety Guarantees</h2>
<ul>
<li>All public methods are thread-safe</li>
<li>Writers are called sequentially (no concurrent writes)</li>
<li>Internal state protected by mutexes</li>
<li>Lock-free operations where possible</li>
</ul>
<h1><a class="anchor" id="autotoc_md258"></a>
Memory Management</h1>
<h2><a class="anchor" id="autotoc_md259"></a>
Buffer Management</h2>
<ul>
<li>Configurable buffer size (default: 8192 entries)</li>
<li>Circular buffer behavior on overflow</li>
<li>Oldest entries dropped when full</li>
</ul>
<h2><a class="anchor" id="autotoc_md260"></a>
Object Lifetime</h2>
<ul>
<li>Shared ownership of logger via shared_ptr</li>
<li>Writers owned by logger</li>
<li>Log entries copied/moved efficiently</li>
</ul>
<h2><a class="anchor" id="autotoc_md261"></a>
Performance Considerations</h2>
<ul>
<li>String operations minimized</li>
<li>Move semantics used where possible</li>
<li>Pre-allocated buffers in async mode</li>
</ul>
<h1><a class="anchor" id="autotoc_md262"></a>
Integration Points</h1>
<h2><a class="anchor" id="autotoc_md263"></a>
Service Container Integration</h2>
<div class="fragment"><div class="line"><span class="comment">// Register logger</span></div>
<div class="line">service_container::global()</div>
<div class="line">    .register_singleton&lt;logger_interface&gt;(logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Automatic resolution in thread_context</span></div>
<div class="line">thread_context context; <span class="comment">// Resolves logger from container</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md264"></a>
Direct Integration</h2>
<div class="fragment"><div class="line"><span class="comment">// Use as logger_interface</span></div>
<div class="line">std::shared_ptr&lt;logger_interface&gt; iface = logger;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pass to components</span></div>
<div class="line"><span class="keyword">auto</span> context = thread_context(iface);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md265"></a>
Performance Characteristics</h1>
<h2><a class="anchor" id="autotoc_md266"></a>
Synchronous Mode</h2>
<ul>
<li><b>Latency</b>: Direct I/O latency (typically &lt; 100μs)</li>
<li><b>Throughput</b>: Limited by I/O speed</li>
<li><b>CPU Usage</b>: Minimal overhead</li>
<li><b>Memory</b>: Low memory footprint</li>
</ul>
<h2><a class="anchor" id="autotoc_md267"></a>
Asynchronous Mode</h2>
<ul>
<li><b>Latency</b>: Enqueue only (typically &lt; 1μs)</li>
<li><b>Throughput</b>: &gt; 1M logs/second possible</li>
<li><b>CPU Usage</b>: One background thread</li>
<li><b>Memory</b>: Buffer size dependent</li>
</ul>
<h1><a class="anchor" id="autotoc_md268"></a>
Future Enhancements</h1>
<h2><a class="anchor" id="autotoc_md269"></a>
Planned Features</h2>
<ol type="1">
<li><b>Lock-free Queue</b>: True lock-free implementation</li>
<li><b>File Writer</b>: Rotating file output with compression</li>
<li><b>Network Writer</b>: Remote logging capability</li>
<li><b>Structured Logging</b>: JSON/Binary format support</li>
<li><b>Log Aggregation</b>: Built-in metrics and sampling</li>
</ol>
<h2><a class="anchor" id="autotoc_md270"></a>
Extension Points</h2>
<ul>
<li>Custom formatters for specialized output</li>
<li>Filter chains for advanced filtering</li>
<li>Async writer batching for better I/O</li>
<li>Memory-mapped file support</li>
</ul>
<h1><a class="anchor" id="autotoc_md271"></a>
Design Patterns Used</h1>
<ol type="1">
<li><b>PIMPL (Pointer to Implementation)</b><ul>
<li>Hides implementation details</li>
<li>Provides ABI stability</li>
<li>Reduces compilation dependencies</li>
</ul>
</li>
<li><b>Strategy Pattern</b><ul>
<li>Writers as strategies for output</li>
<li>Runtime configuration of behavior</li>
</ul>
</li>
<li><b>Observer Pattern</b><ul>
<li>Multiple writers observing log events</li>
<li>Decoupled output handling</li>
</ul>
</li>
<li><b>Factory Pattern</b><ul>
<li>Potential for writer factories</li>
<li>Configuration-based instantiation</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md272"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md273"></a>
For Library Users</h2>
<ul>
<li>Use async mode for production</li>
<li>Set appropriate log levels</li>
<li>Add custom writers for specialized needs</li>
<li>Monitor buffer usage in high-load scenarios</li>
</ul>
<h2><a class="anchor" id="autotoc_md274"></a>
For Contributors</h2>
<ul>
<li>Maintain thread safety invariants</li>
<li>Follow RAII principles</li>
<li>Use move semantics for efficiency</li>
<li>Document performance implications </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
