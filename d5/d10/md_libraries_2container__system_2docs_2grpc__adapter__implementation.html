<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Messaging System: gRPC Adapter Implementation Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Messaging System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Cross-Platform Messaging Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/d10/md_libraries_2container__system_2docs_2grpc__adapter__implementation.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">gRPC Adapter Implementation Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md56"></a> <b>Zero Modification Approach - Technical Specification</b></p>
<hr  />
<h1><a class="anchor" id="autotoc_md58"></a>
1. Complete Adapter Implementation</h1>
<h2><a class="anchor" id="autotoc_md59"></a>
1.1 Value Mapper (Type Conversion)</h2>
<div class="fragment"><div class="line"><span class="comment">// grpc/adapters/value_mapper.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;value_mapper.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/values/bool_value.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/values/numeric_value.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/values/string_value.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/values/bytes_value.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/values/container_value.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>container_grpc {</div>
<div class="line"> </div>
<div class="line">GrpcValue value_mapper::to_grpc_value(</div>
<div class="line">    <span class="keyword">const</span> std::shared_ptr&lt;container_module::value&gt;&amp; val) {</div>
<div class="line">    </div>
<div class="line">    GrpcValue grpc_val;</div>
<div class="line">    grpc_val.set_key(val-&gt;name());</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Determine type from serialized format or type info</span></div>
<div class="line">    <span class="keyword">auto</span> type = val-&gt;type();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">switch</span>(type) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a3ddab1b490ee45549d9ab064cf7c1ace">container_module::value_types::bool_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> bool_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../d7/d22/classcontainer__module_1_1bool__value.html">container_module::bool_value</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (bool_val) {</div>
<div class="line">                grpc_val.set_bool_val(bool_val-&gt;data());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01ad3963fd2ae52a860635366f3c2cf7f94">container_module::value_types::int_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> int_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value&lt;int&gt;</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (int_val) {</div>
<div class="line">                grpc_val.set_int_val(int_val-&gt;data());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a629b6fcb61ec01e74e18393d494fad52">container_module::value_types::long_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> long_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value&lt;long&gt;</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (long_val) {</div>
<div class="line">                grpc_val.set_long_val(long_val-&gt;data());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a50c55af2afeb25bf758254cc1dbd20ec">container_module::value_types::float_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> float_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value&lt;float&gt;</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (float_val) {</div>
<div class="line">                grpc_val.set_float_val(float_val-&gt;data());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01ada592c95f29e54f8276fdd0459a7f69b">container_module::value_types::double_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> double_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value&lt;double&gt;</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (double_val) {</div>
<div class="line">                grpc_val.set_double_val(double_val-&gt;data());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a863a85b49df560a48bb166fcbf59f8b4">container_module::value_types::string_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> str_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../d5/d22/classcontainer__module_1_1string__value.html">container_module::string_value</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (str_val) {</div>
<div class="line">                grpc_val.set_string_val(str_val-&gt;data());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01af1957d06081a29b39f40e5fd74d7152c">container_module::value_types::bytes_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> bytes_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../df/df7/classcontainer__module_1_1bytes__value.html">container_module::bytes_value</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (bytes_val) {</div>
<div class="line">                grpc_val.set_bytes_val(</div>
<div class="line">                    bytes_val-&gt;data(), bytes_val-&gt;size());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01af80b610b6aa1d3009383edc353890cdf">container_module::value_types::container_value</a>: {</div>
<div class="line">            <span class="keyword">auto</span> container_val = std::dynamic_pointer_cast&lt;</div>
<div class="line">                <a class="code hl_class" href="../../da/d1c/classcontainer__module_1_1container__value.html">container_module::container_value</a>&gt;(val);</div>
<div class="line">            <span class="keywordflow">if</span> (container_val &amp;&amp; container_val-&gt;get_container()) {</div>
<div class="line">                *grpc_val.mutable_nested_container() = </div>
<div class="line">                    container_adapter::to_grpc(*container_val-&gt;get_container());</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="comment">// Handle as string fallback</span></div>
<div class="line">            grpc_val.set_string_val(val-&gt;to_string());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> grpc_val;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::shared_ptr&lt;container_module::value&gt; </div>
<div class="line">value_mapper::from_grpc_value(<span class="keyword">const</span> GrpcValue&amp; grpc_val) {</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">const</span> std::string&amp; key = grpc_val.key();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">switch</span>(grpc_val.value_type_case()) {</div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kBoolVal:</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::bool_value&gt;(</div>
<div class="line">                key, grpc_val.bool_val());</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kIntVal:</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::numeric_value&lt;int&gt;&gt;(</div>
<div class="line">                key, grpc_val.int_val());</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kLongVal:</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::numeric_value&lt;long&gt;&gt;(</div>
<div class="line">                key, grpc_val.long_val());</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kFloatVal:</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::numeric_value&lt;float&gt;&gt;(</div>
<div class="line">                key, grpc_val.float_val());</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kDoubleVal:</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::numeric_value&lt;double&gt;&gt;(</div>
<div class="line">                key, grpc_val.double_val());</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kStringVal:</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::string_value&gt;(</div>
<div class="line">                key, grpc_val.string_val());</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kBytesVal: {</div>
<div class="line">            <span class="keyword">const</span> std::string&amp; bytes = grpc_val.bytes_val();</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::bytes_value&gt;(</div>
<div class="line">                key, bytes.data(), bytes.size());</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">case</span> GrpcValue::kNestedContainer: {</div>
<div class="line">            <span class="keyword">auto</span> nested = container_adapter::from_grpc(</div>
<div class="line">                grpc_val.nested_container());</div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::container_value&gt;(</div>
<div class="line">                key, nested);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="comment">// Return null value</span></div>
<div class="line">            <span class="keywordflow">return</span> std::make_shared&lt;container_module::value&gt;(key);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace container_grpc</span></div>
<div class="ttc" id="aclasscontainer__module_1_1bool__value_html"><div class="ttname"><a href="../../d7/d22/classcontainer__module_1_1bool__value.html">container_module::bool_value</a></div><div class="ttdoc">A specialized value for boolean data.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d24/bool__value_8h_source.html#l00043">bool_value.h:44</a></div></div>
<div class="ttc" id="aclasscontainer__module_1_1bytes__value_html"><div class="ttname"><a href="../../df/df7/classcontainer__module_1_1bytes__value.html">container_module::bytes_value</a></div><div class="ttdoc">A specialized value that stores an arbitrary byte array (Base64-encoded in string form).</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d22/bytes__value_8h_source.html#l00044">bytes_value.h:45</a></div></div>
<div class="ttc" id="aclasscontainer__module_1_1container__value_html"><div class="ttname"><a href="../../da/d1c/classcontainer__module_1_1container__value.html">container_module::container_value</a></div><div class="ttdoc">A specialized value that can hold child values, i.e.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d67/container__value_8h_source.html#l00046">container_value.h:47</a></div></div>
<div class="ttc" id="aclasscontainer__module_1_1numeric__value_html"><div class="ttname"><a href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value</a></div><div class="ttdoc">A template class for storing and converting numeric types (integral or floating).</div><div class="ttdef"><b>Definition</b> <a href="../../d6/df0/numeric__value_8h_source.html#l00054">numeric_value.h:55</a></div></div>
<div class="ttc" id="aclasscontainer__module_1_1string__value_html"><div class="ttname"><a href="../../d5/d22/classcontainer__module_1_1string__value.html">container_module::string_value</a></div><div class="ttdoc">A specialized value for storing textual data.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d41/string__value_8h_source.html#l00043">string_value.h:44</a></div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01a3ddab1b490ee45549d9ab064cf7c1ace"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a3ddab1b490ee45549d9ab064cf7c1ace">container_module::value_types::bool_value</a></div><div class="ttdeci">@ bool_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01a50c55af2afeb25bf758254cc1dbd20ec"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a50c55af2afeb25bf758254cc1dbd20ec">container_module::value_types::float_value</a></div><div class="ttdeci">@ float_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01a629b6fcb61ec01e74e18393d494fad52"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a629b6fcb61ec01e74e18393d494fad52">container_module::value_types::long_value</a></div><div class="ttdeci">@ long_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01a863a85b49df560a48bb166fcbf59f8b4"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01a863a85b49df560a48bb166fcbf59f8b4">container_module::value_types::string_value</a></div><div class="ttdeci">@ string_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01ad3963fd2ae52a860635366f3c2cf7f94"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01ad3963fd2ae52a860635366f3c2cf7f94">container_module::value_types::int_value</a></div><div class="ttdeci">@ int_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01ada592c95f29e54f8276fdd0459a7f69b"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01ada592c95f29e54f8276fdd0459a7f69b">container_module::value_types::double_value</a></div><div class="ttdeci">@ double_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01af1957d06081a29b39f40e5fd74d7152c"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01af1957d06081a29b39f40e5fd74d7152c">container_module::value_types::bytes_value</a></div><div class="ttdeci">@ bytes_value</div></div>
<div class="ttc" id="anamespacecontainer__module_html_ac5fba890843eac300daef1fd61c5ff01af80b610b6aa1d3009383edc353890cdf"><div class="ttname"><a href="../../d1/d1a/namespacecontainer__module.html#ac5fba890843eac300daef1fd61c5ff01af80b610b6aa1d3009383edc353890cdf">container_module::value_types::container_value</a></div><div class="ttdeci">@ container_value</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
1.2 Container Adapter (Main Conversion)</h2>
<div class="fragment"><div class="line"><span class="comment">// grpc/adapters/container_adapter.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;container_adapter.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;value_mapper.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>container_grpc {</div>
<div class="line"> </div>
<div class="line">GrpcContainer container_adapter::to_grpc(</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_class" href="../../d9/dad/classcontainer__module_1_1value__container.html">container_module::value_container</a>&amp; container) {</div>
<div class="line">    </div>
<div class="line">    GrpcContainer grpc_container;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Copy header information</span></div>
<div class="line">    grpc_container.set_source_id(container.source_id());</div>
<div class="line">    grpc_container.set_target_id(container.target_id());</div>
<div class="line">    grpc_container.set_message_type(container.message_type());</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Optional: Add sub-ids as metadata</span></div>
<div class="line">    <span class="keywordflow">if</span> (!container.source_sub_id().empty()) {</div>
<div class="line">        (*grpc_container.mutable_metadata())[<span class="stringliteral">&quot;source_sub_id&quot;</span>] = </div>
<div class="line">            container.source_sub_id();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!container.target_sub_id().empty()) {</div>
<div class="line">        (*grpc_container.mutable_metadata())[<span class="stringliteral">&quot;target_sub_id&quot;</span>] = </div>
<div class="line">            container.target_sub_id();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Convert all values</span></div>
<div class="line">    <span class="comment">// Note: We use the public API to iterate values</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>.size(); ++i) {</div>
<div class="line">        <span class="keyword">auto</span> val = <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>.get_value_by_index(i);</div>
<div class="line">        <span class="keywordflow">if</span> (val) {</div>
<div class="line">            *grpc_container.add_values() = </div>
<div class="line">                value_mapper::to_grpc_value(val);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> grpc_container;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::shared_ptr&lt;container_module::value_container&gt; </div>
<div class="line">container_adapter::from_grpc(<span class="keyword">const</span> GrpcContainer&amp; grpc) {</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a> = std::make_shared&lt;</div>
<div class="line">        <a class="code hl_class" href="../../d9/dad/classcontainer__module_1_1value__container.html">container_module::value_container</a>&gt;();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Set header information</span></div>
<div class="line">    <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_source(grpc.source_id(), <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_target(grpc.target_id(), <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_message_type(grpc.message_type());</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Restore sub-ids from metadata if present</span></div>
<div class="line">    <span class="keyword">auto</span> metadata = grpc.metadata();</div>
<div class="line">    <span class="keywordflow">if</span> (metadata.count(<span class="stringliteral">&quot;source_sub_id&quot;</span>)) {</div>
<div class="line">        <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_source(grpc.source_id(), </div>
<div class="line">            metadata.at(<span class="stringliteral">&quot;source_sub_id&quot;</span>));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (metadata.count(<span class="stringliteral">&quot;target_sub_id&quot;</span>)) {</div>
<div class="line">        <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_target(grpc.target_id(), </div>
<div class="line">            metadata.at(<span class="stringliteral">&quot;target_sub_id&quot;</span>));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Convert and add all values</span></div>
<div class="line">    std::vector&lt;std::shared_ptr&lt;container_module::value&gt;&gt; values;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; grpc_val : grpc.values()) {</div>
<div class="line">        <span class="keyword">auto</span> val = value_mapper::from_grpc_value(grpc_val);</div>
<div class="line">        <span class="keywordflow">if</span> (val) {</div>
<div class="line">            values.push_back(val);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (!values.empty()) {</div>
<div class="line">        <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_units(values);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Helper: Convert using serialization (alternative approach)</span></div>
<div class="line">GrpcContainer container_adapter::to_grpc_via_serialization(</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_class" href="../../d9/dad/classcontainer__module_1_1value__container.html">container_module::value_container</a>&amp; container) {</div>
<div class="line">    </div>
<div class="line">    GrpcContainer grpc;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Use JSON as intermediate format (already supported)</span></div>
<div class="line">    std::string json = <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>.to_json();</div>
<div class="line">    grpc.set_serialized_json(json);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> grpc;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::shared_ptr&lt;container_module::value_container&gt;</div>
<div class="line">container_adapter::from_grpc_via_serialization(</div>
<div class="line">    <span class="keyword">const</span> GrpcContainer&amp; grpc) {</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (grpc.has_serialized_json()) {</div>
<div class="line">        <span class="keyword">auto</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a> = std::make_shared&lt;</div>
<div class="line">            <a class="code hl_class" href="../../d9/dad/classcontainer__module_1_1value__container.html">container_module::value_container</a>&gt;();</div>
<div class="line">        <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;from_json(grpc.serialized_json());</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace container_grpc</span></div>
<div class="ttc" id="aclasscontainer__module_1_1value__container_html"><div class="ttname"><a href="../../d9/dad/classcontainer__module_1_1value__container.html">container_module::value_container</a></div><div class="ttdoc">A high-level container for messages, including source/target IDs, message type, and a list of values ...</div><div class="ttdef"><b>Definition</b> <a href="../../db/dae/core_2container_8h_source.html#l00051">container.h:52</a></div></div>
<div class="ttc" id="anamespacemonitoring__system_html_a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863"><div class="ttname"><a href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">monitoring_system::otel_resource_type::container</a></div><div class="ttdeci">@ container</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md62"></a>
2. Service Implementation Example</h1>
<h2><a class="anchor" id="autotoc_md63"></a>
2.1 Complete gRPC Service</h2>
<div class="fragment"><div class="line"><span class="comment">// grpc/server/container_service_impl.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;container_service_impl.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc/adapters/container_adapter.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>container_grpc {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>container_service_impl final </div>
<div class="line">    : <span class="keyword">public</span> ContainerService::Service {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// Optional: Cache for performance</span></div>
<div class="line">    std::unordered_map&lt;std::string, </div>
<div class="line">        std::shared_ptr&lt;container_module::value_container&gt;&gt; cache_;</div>
<div class="line">    std::mutex cache_mutex_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Simple unary RPC</span></div>
<div class="line">    grpc::Status Process(</div>
<div class="line">        grpc::ServerContext* context,</div>
<div class="line">        <span class="keyword">const</span> GrpcContainer* request,</div>
<div class="line">        GrpcContainer* response)<span class="keyword"> override </span>{</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">try</span> {</div>
<div class="line">            <span class="comment">// Convert from gRPC to container</span></div>
<div class="line">            <span class="keyword">auto</span> container = container_adapter::from_grpc(*request);</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Process the container (example logic)</span></div>
<div class="line">            process_business_logic(container);</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Convert back to gRPC</span></div>
<div class="line">            *response = container_adapter::to_grpc(*container);</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">return</span> grpc::Status::OK;</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">            <span class="keywordflow">return</span> grpc::Status(grpc::StatusCode::INTERNAL, e.what());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Server streaming RPC</span></div>
<div class="line">    grpc::Status StreamContainers(</div>
<div class="line">        grpc::ServerContext* context,</div>
<div class="line">        <span class="keyword">const</span> FilterRequest* request,</div>
<div class="line">        grpc::ServerWriter&lt;GrpcContainer&gt;* writer)<span class="keyword"> override </span>{</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Example: Stream cached containers matching filter</span></div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; lock(cache_mutex_);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [<span class="keywordtype">id</span>, container] : cache_) {</div>
<div class="line">            <span class="keywordflow">if</span> (matches_filter(container, request)) {</div>
<div class="line">                GrpcContainer grpc = container_adapter::to_grpc(*container);</div>
<div class="line">                writer-&gt;Write(grpc);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> grpc::Status::OK;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Bidirectional streaming RPC</span></div>
<div class="line">    grpc::Status ProcessStream(</div>
<div class="line">        grpc::ServerContext* context,</div>
<div class="line">        grpc::ServerReaderWriter&lt;GrpcContainer, GrpcContainer&gt;* stream)<span class="keyword"> </span></div>
<div class="line"><span class="keyword">        override </span>{</div>
<div class="line">        </div>
<div class="line">        GrpcContainer <a class="code hl_enumvalue" href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#accdec513cff0fa75c42e41e381b490a4a10573b873d2fa5a365d558a45e328e47">request</a>;</div>
<div class="line">        <span class="keywordflow">while</span> (stream-&gt;Read(&amp;request)) {</div>
<div class="line">            <span class="comment">// Convert and process</span></div>
<div class="line">            <span class="keyword">auto</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a> = container_adapter::from_grpc(request);</div>
<div class="line">            process_business_logic(container);</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Send response</span></div>
<div class="line">            GrpcContainer <a class="code hl_enumvalue" href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#accdec513cff0fa75c42e41e381b490a4ad1fc8eaf36937be0c3ba8cfe0a2c1bfe">response</a> = container_adapter::to_grpc(*container);</div>
<div class="line">            stream-&gt;Write(response);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> grpc::Status::OK;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> process_business_logic(</div>
<div class="line">        std::shared_ptr&lt;container_module::value_container&gt; container) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Example processing using only public APIs</span></div>
<div class="line">        <span class="keyword">auto</span> msg_type = <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;message_type();</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (msg_type == <span class="stringliteral">&quot;echo&quot;</span>) {</div>
<div class="line">            <span class="comment">// Echo: swap source and target</span></div>
<div class="line">            <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;swap_header();</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg_type == <span class="stringliteral">&quot;transform&quot;</span>) {</div>
<div class="line">            <span class="comment">// Transform: add timestamp</span></div>
<div class="line">            <span class="keyword">auto</span> timestamp = std::make_shared&lt;container_module::string_value&gt;(</div>
<div class="line">                <span class="stringliteral">&quot;timestamp&quot;</span>, std::to_string(std::time(<span class="keyword">nullptr</span>)));</div>
<div class="line">            <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;add(timestamp);</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg_type == <span class="stringliteral">&quot;store&quot;</span>) {</div>
<div class="line">            <span class="comment">// Store in cache</span></div>
<div class="line">            std::lock_guard&lt;std::mutex&gt; lock(cache_mutex_);</div>
<div class="line">            cache_[<a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;source_id()] = <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Add processing timestamp</span></div>
<div class="line">        <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;set_value(<span class="stringliteral">&quot;processed&quot;</span>, </div>
<div class="line">            std::make_shared&lt;container_module::bool_value&gt;(<span class="stringliteral">&quot;processed&quot;</span>, <span class="keyword">true</span>));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> matches_filter(</div>
<div class="line">        <span class="keyword">const</span> std::shared_ptr&lt;container_module::value_container&gt;&amp; container,</div>
<div class="line">        <span class="keyword">const</span> FilterRequest* filter) {</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (filter-&gt;has_message_type() &amp;&amp; </div>
<div class="line">            <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;message_type() != filter-&gt;message_type()) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (filter-&gt;has_source_id() &amp;&amp; </div>
<div class="line">            <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;source_id() != filter-&gt;source_id()) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace container_grpc</span></div>
<div class="ttc" id="anamespacekcenon_1_1messaging_1_1core_html_accdec513cff0fa75c42e41e381b490a4a10573b873d2fa5a365d558a45e328e47"><div class="ttname"><a href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#accdec513cff0fa75c42e41e381b490a4a10573b873d2fa5a365d558a45e328e47">kcenon::messaging::core::message_type::request</a></div><div class="ttdeci">@ request</div></div>
<div class="ttc" id="anamespacekcenon_1_1messaging_1_1core_html_accdec513cff0fa75c42e41e381b490a4ad1fc8eaf36937be0c3ba8cfe0a2c1bfe"><div class="ttname"><a href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#accdec513cff0fa75c42e41e381b490a4ad1fc8eaf36937be0c3ba8cfe0a2c1bfe">kcenon::messaging::core::message_type::response</a></div><div class="ttdeci">@ response</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md64"></a>
2.2 Server Runner</h2>
<div class="fragment"><div class="line"><span class="comment">// grpc/server/grpc_server.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc_server.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container_service_impl.cpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpcpp/grpcpp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>container_grpc {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>grpc_server {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::unique_ptr&lt;grpc::Server&gt; server_;</div>
<div class="line">    std::string address_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> grpc_server(<span class="keyword">const</span> std::string&amp; address) </div>
<div class="line">        : address_(address) {}</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> start() {</div>
<div class="line">        container_service_impl service;</div>
<div class="line">        </div>
<div class="line">        grpc::ServerBuilder builder;</div>
<div class="line">        builder.AddListeningPort(address_, </div>
<div class="line">            grpc::InsecureServerCredentials());</div>
<div class="line">        builder.RegisterService(&amp;service);</div>
<div class="line">        </div>
<div class="line">        server_ = builder.BuildAndStart();</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;gRPC server listening on &quot;</span> &lt;&lt; address_ &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> wait() {</div>
<div class="line">        <span class="keywordflow">if</span> (server_) {</div>
<div class="line">            server_-&gt;Wait();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d5/d61/namespacenetwork__system_1_1compat.html#a0fe0715fe4254ad45fca04d53d2ad574">shutdown</a>() {</div>
<div class="line">        <span class="keywordflow">if</span> (server_) {</div>
<div class="line">            server_-&gt;Shutdown();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace container_grpc</span></div>
<div class="ttc" id="anamespacenetwork__system_1_1compat_html_a0fe0715fe4254ad45fca04d53d2ad574"><div class="ttname"><a href="../../d5/d61/namespacenetwork__system_1_1compat.html#a0fe0715fe4254ad45fca04d53d2ad574">network_system::compat::shutdown</a></div><div class="ttdeci">void shutdown()</div><div class="ttdoc">Shutdown network system cleanly.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/ddf/network__system_2include_2network__system_2compatibility_8h_source.html#l00149">compatibility.h:149</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md66"></a>
3. Client Implementation</h1>
<div class="fragment"><div class="line"><span class="comment">// grpc/client/grpc_client.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc_client.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc/adapters/container_adapter.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpcpp/grpcpp.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>container_grpc {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>grpc_client {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::unique_ptr&lt;ContainerService::Stub&gt; stub_;</div>
<div class="line">    std::shared_ptr&lt;grpc::Channel&gt; channel_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> grpc_client(<span class="keyword">const</span> std::string&amp; address) {</div>
<div class="line">        channel_ = grpc::CreateChannel(address, </div>
<div class="line">            grpc::InsecureChannelCredentials());</div>
<div class="line">        stub_ = ContainerService::NewStub(channel_);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Send single container</span></div>
<div class="line">    std::shared_ptr&lt;container_module::value_container&gt; </div>
<div class="line">    process(<span class="keyword">const</span> std::shared_ptr&lt;container_module::value_container&gt;&amp; container) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Convert to gRPC</span></div>
<div class="line">        GrpcContainer request = container_adapter::to_grpc(*container);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Make RPC call</span></div>
<div class="line">        GrpcContainer response;</div>
<div class="line">        grpc::ClientContext context;</div>
<div class="line">        </div>
<div class="line">        grpc::Status status = stub_-&gt;Process(&amp;context, request, &amp;response);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line">            <span class="comment">// Convert response back</span></div>
<div class="line">            <span class="keywordflow">return</span> container_adapter::from_grpc(response);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;RPC failed: &quot;</span> &lt;&lt; status.error_message() &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Stream containers</span></div>
<div class="line">    <span class="keywordtype">void</span> process_stream(</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;container_module::value_container&gt;&gt;&amp; </div>
<div class="line">            containers,</div>
<div class="line">        std::function&lt;<span class="keywordtype">void</span>(std::shared_ptr&lt;container_module::value_container&gt;)&gt; </div>
<div class="line">            callback) {</div>
<div class="line">        </div>
<div class="line">        grpc::ClientContext context;</div>
<div class="line">        <span class="keyword">auto</span> stream = stub_-&gt;ProcessStream(&amp;context);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Writer thread</span></div>
<div class="line">        std::thread writer([&amp;]() {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; container : containers) {</div>
<div class="line">                GrpcContainer <a class="code hl_enumvalue" href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#accdec513cff0fa75c42e41e381b490a4a10573b873d2fa5a365d558a45e328e47">request</a> = container_adapter::to_grpc(*container);</div>
<div class="line">                stream-&gt;Write(request);</div>
<div class="line">            }</div>
<div class="line">            stream-&gt;WritesDone();</div>
<div class="line">        });</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Reader thread</span></div>
<div class="line">        GrpcContainer <a class="code hl_enumvalue" href="../../db/d06/namespacekcenon_1_1messaging_1_1core.html#accdec513cff0fa75c42e41e381b490a4ad1fc8eaf36937be0c3ba8cfe0a2c1bfe">response</a>;</div>
<div class="line">        <span class="keywordflow">while</span> (stream-&gt;Read(&amp;response)) {</div>
<div class="line">            <span class="keyword">auto</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a> = container_adapter::from_grpc(response);</div>
<div class="line">            callback(container);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        writer.join();</div>
<div class="line">        stream-&gt;Finish();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace container_grpc</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md68"></a>
4. Usage Examples</h1>
<h2><a class="anchor" id="autotoc_md69"></a>
4.1 Server Usage</h2>
<div class="fragment"><div class="line"><span class="comment">// grpc/examples/server_main.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc/server/grpc_server.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../db/d5d/basic__usage__example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line">    <span class="comment">// Start gRPC server</span></div>
<div class="line">    container_grpc::grpc_server server(<span class="stringliteral">&quot;0.0.0.0:50051&quot;</span>);</div>
<div class="line">    server.start();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Server runs independently of container system</span></div>
<div class="line">    server.wait();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="abasic__usage__example_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="../../db/d5d/basic__usage__example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> <a href="../../db/d5d/basic__usage__example_8cpp_source.html#l00015">basic_usage_example.cpp:15</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
4.2 Client Usage</h2>
<div class="fragment"><div class="line"><span class="comment">// grpc/examples/client_main.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc/client/grpc_client.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/core/container.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../db/d5d/basic__usage__example_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line">    <span class="comment">// Create container using existing API</span></div>
<div class="line">    <span class="keyword">auto</span> container = std::make_shared&lt;container_module::value_container&gt;();</div>
<div class="line">    container-&gt;set_source(<span class="stringliteral">&quot;client&quot;</span>, <span class="stringliteral">&quot;01&quot;</span>);</div>
<div class="line">    container-&gt;set_target(<span class="stringliteral">&quot;server&quot;</span>, <span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line">    container-&gt;set_message_type(<span class="stringliteral">&quot;echo&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Add some values</span></div>
<div class="line">    container-&gt;add(std::make_shared&lt;container_module::string_value&gt;(</div>
<div class="line">        <span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Hello gRPC!&quot;</span>));</div>
<div class="line">    container-&gt;add(std::make_shared&lt;<a class="code hl_class" href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value&lt;int&gt;</a>&gt;(</div>
<div class="line">        <span class="stringliteral">&quot;count&quot;</span>, 42));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Send via gRPC</span></div>
<div class="line">    container_grpc::grpc_client client(<span class="stringliteral">&quot;localhost:50051&quot;</span>);</div>
<div class="line">    <span class="keyword">auto</span> response = client.process(container);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (response) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Response type: &quot;</span> &lt;&lt; response-&gt;message_type() &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Response from: &quot;</span> &lt;&lt; response-&gt;source_id() &lt;&lt; std::endl;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Access values using existing API</span></div>
<div class="line">        <span class="keyword">auto</span> msg = response-&gt;get_value(<span class="stringliteral">&quot;message&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (msg) {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Message: &quot;</span> &lt;&lt; msg-&gt;to_string() &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md72"></a>
5. Build Instructions</h1>
<div class="fragment"><div class="line"># From container_system root directory</div>
<div class="line"> </div>
<div class="line"># Step 1: Create gRPC directory structure</div>
<div class="line">mkdir -p grpc/{proto,adapters,server,client,examples,tests}</div>
<div class="line"> </div>
<div class="line"># Step 2: Add proto file</div>
<div class="line"># Copy the proto definition to grpc/proto/container_service.proto</div>
<div class="line"> </div>
<div class="line"># Step 3: Build only gRPC extension (no changes to main build)</div>
<div class="line">mkdir build_grpc</div>
<div class="line">cd build_grpc</div>
<div class="line">cmake ../grpc -DCMAKE_PREFIX_PATH=/path/to/vcpkg</div>
<div class="line">make -j4</div>
<div class="line"> </div>
<div class="line"># Step 4: Run examples</div>
<div class="line">./grpc_server_example &amp;</div>
<div class="line">./grpc_client_example</div>
<div class="line"> </div>
<div class="line"># Original container system remains unchanged</div>
<div class="line">cd ../build</div>
<div class="line">./bin/container_test  # Still works exactly as before</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md74"></a>
6. Testing Without Modification</h1>
<div class="fragment"><div class="line"><span class="comment">// grpc/tests/integration_test.cpp</span></div>
<div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;grpc/adapters/container_adapter.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;container/core/container.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>GrpcIntegrationTest : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keywordtype">void</span> SetUp()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// No modifications to container system needed</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d9/dfb/application__layer_2tests_2integration_2test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(GrpcIntegrationTest, RoundTripConversion) {</div>
<div class="line">    <span class="comment">// Create container with existing API</span></div>
<div class="line">    <span class="keyword">auto</span> original = std::make_shared&lt;container_module::value_container&gt;();</div>
<div class="line">    original-&gt;set_message_type(<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line">    original-&gt;add(std::make_shared&lt;container_module::string_value&gt;(</div>
<div class="line">        <span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Convert to gRPC and back</span></div>
<div class="line">    <span class="keyword">auto</span> grpc = container_grpc::container_adapter::to_grpc(*original);</div>
<div class="line">    <span class="keyword">auto</span> restored = container_grpc::container_adapter::from_grpc(grpc);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Verify</span></div>
<div class="line">    EXPECT_EQ(original-&gt;message_type(), restored-&gt;message_type());</div>
<div class="line">    EXPECT_EQ(original-&gt;serialize(), restored-&gt;serialize());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d9/dfb/application__layer_2tests_2integration_2test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a>(GrpcIntegrationTest, PerformanceBenchmark) {</div>
<div class="line">    <span class="keyword">auto</span> <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a> = std::make_shared&lt;container_module::value_container&gt;();</div>
<div class="line">    <span class="comment">// Add 1000 values</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i) {</div>
<div class="line">        <a class="code hl_enumvalue" href="../../de/d3f/namespacemonitoring__system.html#a8e692c8ceac634f141c23c45c3491aa8a5f0b6ebc4bea10285ba2b8a6ce78b863">container</a>-&gt;add(std::make_shared&lt;<a class="code hl_class" href="../../de/dc4/classcontainer__module_1_1numeric__value.html">container_module::numeric_value&lt;int&gt;</a>&gt;(</div>
<div class="line">            <span class="stringliteral">&quot;val_&quot;</span> + std::to_string(i), i));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Benchmark conversion</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; ++i) {</div>
<div class="line">        <span class="keyword">auto</span> grpc = container_grpc::container_adapter::to_grpc(*container);</div>
<div class="line">        <span class="keyword">auto</span> restored = container_grpc::container_adapter::from_grpc(grpc);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::now();</div>
<div class="line">    <span class="keyword">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(</div>
<div class="line">        end - start);</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;100 round-trips: &quot;</span> &lt;&lt; duration.count() &lt;&lt; <span class="stringliteral">&quot;ms&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    EXPECT_LT(duration.count(), 1000);  <span class="comment">// Should be under 1 second</span></div>
<div class="line">}</div>
<div class="ttc" id="aapplication__layer_2tests_2integration_2test__messaging__integration_8cpp_html_afa9a03b8890cf589bc9d9246e1149b1b"><div class="ttname"><a href="../../d9/dfb/application__layer_2tests_2integration_2test__messaging__integration_8cpp.html#afa9a03b8890cf589bc9d9246e1149b1b">TEST_F</a></div><div class="ttdeci">TEST_F(MessagingIntegrationTest, EndToEndMessaging)</div><div class="ttdef"><b>Definition</b> <a href="../../d9/dfb/application__layer_2tests_2integration_2test__messaging__integration_8cpp_source.html#l00038">test_messaging_integration.cpp:38</a></div></div>
</div><!-- fragment --><hr  />
<p><b>이 구현은 기존 <a class="el" href="../../d0/d7b/classContainer.html">Container</a> System 코드를 전혀 수정하지 않고 gRPC 기능을 추가합니다.</b> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
